<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Monorepo</title>
    <link href="/posts/%E5%89%8D%E7%AB%AF/Monorepo%E5%B7%A5%E7%A8%8B%E7%AE%A1%E7%90%86%E6%96%B9%E6%A1%88/41960/"/>
    <url>/posts/%E5%89%8D%E7%AB%AF/Monorepo%E5%B7%A5%E7%A8%8B%E7%AE%A1%E7%90%86%E6%96%B9%E6%A1%88/41960/</url>
    
    <content type="html"><![CDATA[<h1 id="Monorepo工程管理方案"><a href="#Monorepo工程管理方案" class="headerlink" title="Monorepo工程管理方案"></a>Monorepo工程管理方案</h1><h2 id="mutirepo-vs-monorepo"><a href="#mutirepo-vs-monorepo" class="headerlink" title="mutirepo vs monorepo"></a>mutirepo vs monorepo</h2><ul><li>mutirepo : 一个包对应一个仓库</li><li>monorepo : 多个包对应一个仓库<br>常见monorepo管理工具:</li><li><code>pnpm</code></li><li>npm</li><li>yarn</li><li>Lerna</li><li>Nx</li><li>Rush</li><li>……</li></ul><h2 id="pnpm-monorepo"><a href="#pnpm-monorepo" class="headerlink" title="pnpm monorepo"></a>pnpm monorepo</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">touch</span> pnpm-workspace.yaml<br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 子包位置</span><br><span class="hljs-attr">packages:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;packages/*&quot;</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;apps/*&quot;</span><br></code></pre></td></tr></table></figure><p>在工程根目录下执行初始化</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pnpm --workspace-root init<br></code></pre></td></tr></table></figure><h2 id="环境版本锁定"><a href="#环境版本锁定" class="headerlink" title="环境版本锁定"></a>环境版本锁定</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// 跟工程 package.json</span><br><br>  <span class="hljs-attr">&quot;engines&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;node&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&gt;=22.12.0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;npm&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&gt;=10.9.0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;pnpm&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&gt;=10.14.0&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt"># .npmrc<br>engine-strict=true<br></code></pre></td></tr></table></figure><h2 id="TypeScript"><a href="#TypeScript" class="headerlink" title="TypeScript"></a>TypeScript</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pnpm add -Dw typescript @types/node<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">touch</span> tsconfig.json<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// tsconfig.json</span><br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;compilerOptions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;baseUrl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;.&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;module&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;esnext&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;target&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;esnext&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;types&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;lib&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;esnext&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;sourceMap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;declaration&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;declarationMap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;noUncheckedIndexedAccess&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;exactOptionalPropertyTypes&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;strict&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;verbatimModuleSyntax&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;moduleResolution&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;bundler&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;isolatedModules&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;noUncheckedSideEffectImports&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;moduleDetection&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;force&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;skipLibCheck&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;exclude&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;node_modules&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;dist&quot;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="代码风格与质量检查"><a href="#代码风格与质量检查" class="headerlink" title="代码风格与质量检查"></a>代码风格与质量检查</h2><h3 id="prettier"><a href="#prettier" class="headerlink" title="prettier"></a>prettier</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pnpm -Dw add prettier<br><span class="hljs-built_in">touch</span> prettier.config.js<br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// prettier.config.js</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@type</span> &#123;<span class="hljs-type">import(&#x27;prettier&#x27;).Config</span>&#125;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> https://www.prettier.cn/docs/options.html</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>    <span class="hljs-comment">// 指定最大换行长度</span><br>    <span class="hljs-attr">printWidth</span>:<span class="hljs-number">120</span>,<br>    <span class="hljs-comment">// 指定缩进空格数</span><br>    <span class="hljs-attr">tabWidth</span>:<span class="hljs-number">2</span>,<br>    <span class="hljs-comment">// 是否使用制表符进行缩进</span><br>    <span class="hljs-attr">useTabs</span>:<span class="hljs-literal">false</span>,<br>    <span class="hljs-comment">// 是否在语句末尾添加分号</span><br>    <span class="hljs-attr">semi</span>:<span class="hljs-literal">true</span>,<br>    <span class="hljs-comment">// 是否使用单引号 (true:单引号,false:双引号)</span><br>    <span class="hljs-attr">singleQuote</span>:<span class="hljs-literal">false</span>,<br>    <span class="hljs-comment">// 对象属性引用是否使用单引号</span><br>    <span class="hljs-attr">quoteProps</span>:<span class="hljs-string">&quot;as-needed&quot;</span>,<br>    <span class="hljs-comment">// 在JSX中是否使用单引号 (true:单引号,false:双引号)</span><br>    <span class="hljs-attr">jsxSingleQuote</span>:<span class="hljs-literal">false</span>,<br>    <span class="hljs-comment">// 多行时尽可能打印尾随逗号  </span><br>    <span class="hljs-attr">trailingComma</span>:<span class="hljs-string">&quot;none&quot;</span>,<br>    <span class="hljs-comment">// 在对象括号内使用空格</span><br>    <span class="hljs-attr">bracketSpacing</span>:<span class="hljs-literal">true</span>,<br>    <span class="hljs-comment">// 在对象括号内使用空格</span><br>    <span class="hljs-attr">bracketSameLine</span>:<span class="hljs-literal">false</span>,<br>    <span class="hljs-comment">// 箭头函数参数括号</span><br>    <span class="hljs-attr">arrowParens</span>:<span class="hljs-string">&quot;avoid&quot;</span>,<br>    <span class="hljs-attr">requirePragma</span>:<span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">insertPragma</span>:<span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">proseWrap</span>:<span class="hljs-string">&quot;preserve&quot;</span>,<br>    <span class="hljs-attr">htmlWhitespaceSensitivity</span>:<span class="hljs-string">&quot;css&quot;</span>,<br>    <span class="hljs-attr">vueIndentScriptAndStyle</span>:<span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">endOfLine</span>:<span class="hljs-string">&quot;auto&quot;</span>,<br>    <span class="hljs-attr">rangeStart</span>:<span class="hljs-number">0</span>,<br>    <span class="hljs-attr">rangeEnd</span>:<span class="hljs-title class_">Infinity</span>,<br>&#125;<br></code></pre></td></tr></table></figure><p><code>prettier</code>忽略项</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">touch</span> .prettierignore<br></code></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs txt">// .prettierignore<br>dist<br>public<br>node_modules<br>.local<br>pnpm-lock.yaml<br></code></pre></td></tr></table></figure><p><code>prettier</code>脚本命令</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;script&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;lint:prettier&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;prettier --write \&quot;**/*.&#123;js,ts,mjs,cjs,json,tsx,css,less,scss,vue,html,md&#125;\&quot;&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="ESLint"><a href="#ESLint" class="headerlink" title="ESLint"></a>ESLint</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pnpm -Dw add eslint@latest @eslint/js globals typescript-eslint eslint-plugin-prettier eslint-config-prettier eslint-plugin-vue<br></code></pre></td></tr></table></figure><table><thead><tr><th>类别</th><th>库名</th></tr></thead><tbody><tr><td>核心引擎</td><td>eslint</td></tr><tr><td>官方规则集</td><td>@eslint&#x2F;js</td></tr><tr><td>全局变量支持</td><td>globals</td></tr><tr><td>TypeScript支持</td><td>typescript-eslint</td></tr><tr><td>类型定义(辅助)</td><td>@types&#x2F;node</td></tr><tr><td>Prettier集成</td><td>eslint-plugin-prettier, eslint-config-prettier</td></tr><tr><td>Vue支持</td><td>eslint-plugin-vue</td></tr></tbody></table><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs php">touch eslint.config.js<br><br><br>import &#123; defineConfig &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;eslint-define-config&quot;</span>;<br>import eslint <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@eslint/js&quot;</span>;<br>import tseslint <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;typescript-eslint&quot;</span>;<br>import eslintPluginPrettier <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;eslint-plugin-prettier&quot;</span>;<br>import eslintPluginVue <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;eslint-plugin-vue&quot;</span>;<br>import globals <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;globals&quot;</span>;<br>import eslintConfigPrettier <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;eslint-config-prettier&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ignores</span> = [<br>  <span class="hljs-string">&quot;**/dist/**&quot;</span>,<br>  <span class="hljs-string">&quot;**/node_modules/**&quot;</span>,<br>  <span class="hljs-string">&quot;.*&quot;</span>,<br>  <span class="hljs-string">&quot;scripts/**&quot;</span>,<br>  <span class="hljs-string">&quot;**/*.d.ts&quot;</span>,<br>];<br><br>export <span class="hljs-keyword">default</span> <span class="hljs-title function_ invoke__">defineConfig</span>(<br>  // 通用配置<br>  &#123;<br>    ignores, // 忽略项<br>    <span class="hljs-attr">extends</span>: [<br>      eslint.configs.recommended,<br>      ...tseslint.configs.recommended,<br>      eslintConfigPrettier,<br>    ], // 继承规则<br>    <span class="hljs-attr">plugins</span>: &#123;<br>      <span class="hljs-attr">prettier</span>: eslintPluginPrettier,<br>    &#125;,<br>    <span class="hljs-attr">languageOptions</span>: &#123;<br>      <span class="hljs-attr">ecmaVersion</span>: <span class="hljs-string">&quot;latest&quot;</span>,<br>      <span class="hljs-attr">sourceType</span>: <span class="hljs-string">&quot;module&quot;</span>,<br>      <span class="hljs-attr">parse</span>: tseslint.parser,<br>    &#125;,<br>    <span class="hljs-attr">rules</span>: &#123;<br>      // 自定义<br>      <span class="hljs-string">&quot;no-var&quot;</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>    &#125;,<br>  &#125;,<br>  // 前端配置<br>  &#123;<br>    ignores,<br>    <span class="hljs-attr">files</span>: [<br>      <span class="hljs-string">&quot;apps/frontend/**/*.&#123;ts,js,tsx,jsx,vue&#125;&quot;</span>,<br>      <span class="hljs-string">&quot;packages/components/**/*.&#123;ts,js,tsx,jsx,vue&#125;&quot;</span>,<br>    ],<br>    <span class="hljs-attr">extends</span>: [<br>      ...eslintPluginVue.configs[<span class="hljs-string">&quot;flat/recommended&quot;</span>],<br>      eslintConfigPrettier,<br>    ],<br>    <span class="hljs-attr">languageOptions</span>: &#123;<br>      <span class="hljs-attr">globals</span>: &#123;<br>        ...globals.browser,<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>  // 后端配置<br>  &#123;<br>    ignores,<br>    <span class="hljs-attr">files</span>: [<span class="hljs-string">&quot;apps/backend/**/*.&#123;ts,js&#125;&quot;</span>],<br>    <span class="hljs-attr">languageOptions</span>: &#123;<br>      <span class="hljs-attr">globals</span>: &#123;<br>        ...globals.node,<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>);<br><br></code></pre></td></tr></table></figure><h3 id="拼写检查"><a href="#拼写检查" class="headerlink" title="拼写检查"></a>拼写检查</h3><p><code>VsCode插件</code>:<code>Code Spell Checker</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pnpm -Dw add cspell @cspell/dict-lorem-ipsum<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs json">touch cspell.json<br><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;import&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;@cspell/dict-lorem-ipsum/cspell.ext.json&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;caseSensitive&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;dictionaries&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;custom-dictionary&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;dictionaryDefinitions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;custom-dictionary&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./.cspell/custom-dictionary.txt&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;addWords&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;ignorePaths&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-string">&quot;**/node_modules/**&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/dist/**&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/build/**&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/lib/**&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/docs/**&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/vendor/**&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/public/**&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/static/**&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/out/**&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/tmp/**&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/*.d.ts&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/package.json&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/*.md&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/stats.html&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;eslint.config.mjs&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;.gitignore&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;.prettierignore&quot;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br><br></code></pre></td></tr></table></figure><h2 id="git提交规范"><a href="#git提交规范" class="headerlink" title="git提交规范"></a>git提交规范</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs txt">touch .gitignore<br><br># .gitignore<br><br></code></pre></td></tr></table></figure><h3 id="commitizen"><a href="#commitizen" class="headerlink" title="commitizen"></a>commitizen</h3><p>用于检查提交</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pnpm -Dw add @commitlint/cli @commitlint/config-conventional commitizen cz-git<br></code></pre></td></tr></table></figure><ul><li>@commitlint&#x2F;cli 是 commitlint 工具的核心</li><li>@commitlint&#x2F;config-conventional 是基于 conventional commits 规范的配置文件</li><li>commitizen 提供一个交互式撰写commit信息的插件</li><li>cz-git 是国产工具</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// package.json</span><br> <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br> <span class="hljs-attr">&quot;commit&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;git-cz&quot;</span><br> <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br> <span class="hljs-attr">&quot;config&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;commitizen&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;node_modules/cz-git&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br></code></pre></td></tr></table></figure><p>配置 <code>cz-git</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs js">touch commitlint.<span class="hljs-property">config</span>.<span class="hljs-property">js</span><br><br><span class="hljs-comment">/** <span class="hljs-doctag">@type</span> &#123;<span class="hljs-type">import(&#x27;cz-git&#x27;).UserConfig</span>&#125; */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">extends</span>: [<span class="hljs-string">&quot;@commitlint/config-conventional&quot;</span>],<br>  <span class="hljs-attr">rules</span>: &#123;<br>    <span class="hljs-comment">// @see: https://commitlint.js.org/#/reference-rules</span><br>    <span class="hljs-string">&quot;body-leading-blank&quot;</span>: [<span class="hljs-number">2</span>, <span class="hljs-string">&quot;always&quot;</span>],<br>    <span class="hljs-string">&quot;footer-leading-blank&quot;</span>: [<span class="hljs-number">1</span>, <span class="hljs-string">&quot;always&quot;</span>],<br>    <span class="hljs-string">&quot;header-max-length&quot;</span>: [<span class="hljs-number">2</span>, <span class="hljs-string">&quot;always&quot;</span>, <span class="hljs-number">108</span>],<br>    <span class="hljs-string">&quot;subject-case&quot;</span>: [<span class="hljs-number">0</span>],<br>    <span class="hljs-string">&quot;type-enum&quot;</span>: [<br>      <span class="hljs-number">2</span>,<br>      <span class="hljs-string">&quot;always&quot;</span>,<br>      [<br>        <span class="hljs-string">&quot;feat&quot;</span>,<br>        <span class="hljs-string">&quot;fix&quot;</span>,<br>        <span class="hljs-string">&quot;docs&quot;</span>,<br>        <span class="hljs-string">&quot;style&quot;</span>,<br>        <span class="hljs-string">&quot;refactor&quot;</span>,<br>        <span class="hljs-string">&quot;perf&quot;</span>,<br>        <span class="hljs-string">&quot;test&quot;</span>,<br>        <span class="hljs-string">&quot;build&quot;</span>,<br>        <span class="hljs-string">&quot;ci&quot;</span>,<br>        <span class="hljs-string">&quot;chore&quot;</span>,<br>        <span class="hljs-string">&quot;revert&quot;</span>,<br>        <span class="hljs-string">&quot;wip&quot;</span>,<br>        <span class="hljs-string">&quot;workflow&quot;</span>,<br>        <span class="hljs-string">&quot;types&quot;</span>,<br>        <span class="hljs-string">&quot;release&quot;</span><br>      ]<br>    ]<br>  &#125;,<br>  <span class="hljs-attr">prompt</span>: &#123;<br>    <span class="hljs-attr">types</span>: [<br>      &#123; <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;feat&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;新功能：新增功能&quot;</span> &#125;,<br>      &#123; <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;fix&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;修复：修复缺陷&quot;</span> &#125;,<br>      &#123; <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;docs&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;文档：更新文档&quot;</span> &#125;,<br>      &#123; <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;refactor&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;重构：重构代码(不新增功能也不修复 bug)&quot;</span> &#125;,<br>      &#123; <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;perf&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;性能：提升性能&quot;</span> &#125;,<br>      &#123; <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;测试：新增测试&quot;</span> &#125;,<br>      &#123; <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;chore&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;工具：更改构建流程或辅助工具&quot;</span> &#125;,<br>      &#123; <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;revert&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;回滚：代码回滚&quot;</span> &#125;,<br>      &#123; <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;style&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;样式：格式调整(不影响代码运行)&quot;</span> &#125;<br>    ],<br>    <span class="hljs-attr">scopes</span>: [<span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;backend&quot;</span>, <span class="hljs-string">&quot;frontend&quot;</span>, <span class="hljs-string">&quot;components&quot;</span>, <span class="hljs-string">&quot;utils&quot;</span>],<br>    <span class="hljs-attr">allowCustomScopes</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">skipQuestions</span>: [<span class="hljs-string">&quot;body&quot;</span>, <span class="hljs-string">&quot;footerPrefix&quot;</span>, <span class="hljs-string">&quot;footer&quot;</span>, <span class="hljs-string">&quot;breaking&quot;</span>],<br>    <span class="hljs-attr">messages</span>: &#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;选择提交类型：&quot;</span>,<br>      <span class="hljs-attr">scope</span>: <span class="hljs-string">&quot;选择提交范围(可选)：&quot;</span>,<br>      <span class="hljs-attr">subject</span>: <span class="hljs-string">&quot;请简要描述更改：&quot;</span>,<br>      <span class="hljs-attr">body</span>: <span class="hljs-string">&quot;详细描述(可选)：&quot;</span>,<br>      <span class="hljs-attr">footer</span>: <span class="hljs-string">&quot;关联 ISSUE 或 BREAKING CHANGE(可选)：&quot;</span>,<br>      <span class="hljs-attr">confirmCommit</span>: <span class="hljs-string">&quot;✅ 确认提交？&quot;</span><br>    &#125;<br>  &#125;<br>&#125;;<br><br><br></code></pre></td></tr></table></figure><h3 id="husky"><a href="#husky" class="headerlink" title="husky"></a>husky</h3><p>连接 git hook 自定义 提交前后事件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pnpm -Dw add husky<br>pnpx husky init<br></code></pre></td></tr></table></figure><p>配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">// .husky/pre-commit<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">!/usr/bin/env sh</span><br>pnpm lint:prettier &amp;&amp; pnpm lint:eslint &amp;&amp; pnpm lint:cspell<br></code></pre></td></tr></table></figure><h3 id="lint-staged"><a href="#lint-staged" class="headerlink" title="lint-staged"></a>lint-staged</h3><p>检查暂存区文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pnpm -Dw add lint-staged<br></code></pre></td></tr></table></figure><p>配置命令</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;precommit&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;lint-staged&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// .lintstagedrc.js</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br><span class="hljs-string">&quot;*.&#123;js,ts,mjs,json,tsx,css,less,scss,vue,html,md&#125;&quot;</span>:[<span class="hljs-string">&quot;cspell lint&quot;</span>],<br><span class="hljs-string">&quot;*.&#123;js,ts,vue,md&#125;&quot;</span>:[<span class="hljs-string">&quot;prettier --write&quot;</span>,<span class="hljs-string">&quot;eslint&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="公共库打包"><a href="#公共库打包" class="headerlink" title="公共库打包"></a>公共库打包</h2><p>安装<code>rollup</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pnpm -Dw add rollup @rollup/plugin-node-resolve @rollup/plugin-commonjs rollup-plugin-typescript2 @rollup/plugin-terser @vitejs/plugin-vue rollup-plugin-postcss<br></code></pre></td></tr></table></figure><ul><li><code>@rollup/plugin-node-resolve</code>: 解析 node_modules 中的依赖</li><li><code>@rollup/plugin-commonjs</code>: 将 CommonJS 模块转为 ESM</li><li><code>rollup-plugin-typescript2</code>: 让 Rollup 支持 TS 编译</li><li><code>@rollup/plugin-terser</code>： 压缩和混淆</li><li><code>@vitejs/plugin-vue</code>： 支持SFC编译</li><li><code>rollup-plugin-postcss</code>： 处理css代码<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// scropts/buildBase.js</span><br><br><span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;node:path&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-variable constant_">URL</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;node:url&quot;</span>;<br><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;node:fs&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; nodeResolve &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@rollup/plugin-node-resolve&quot;</span>;<br><span class="hljs-keyword">import</span> commonjs <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@rollup/plugin-commonjs&quot;</span>;<br><span class="hljs-keyword">import</span> typescript <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;rollup-plugin-typescript2&quot;</span>;<br><span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@vitejs/plugin-vue&quot;</span>;<br><span class="hljs-keyword">import</span> postcss <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;rollup-plugin-postcss&quot;</span>;<br><br><span class="hljs-keyword">const</span> __filename = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>);<br><span class="hljs-keyword">const</span> __dirname = path.<span class="hljs-title function_">dirname</span>(__filename);<br><br><span class="hljs-keyword">const</span> packages = [<span class="hljs-string">&quot;utils&quot;</span>, <span class="hljs-string">&quot;components&quot;</span>];<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getPackageRoots</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> packages.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">pkg</span> =&gt;</span> path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;../packages&quot;</span>, pkg));<br>&#125;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">packageJson</span>(<span class="hljs-params">root</span>) &#123;<br>  <span class="hljs-keyword">const</span> jsonPath = path.<span class="hljs-title function_">resolve</span>(root, <span class="hljs-string">&quot;package.json&quot;</span>);<br>  <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> fs.<span class="hljs-property">promises</span>.<span class="hljs-title function_">readFile</span>(jsonPath, <span class="hljs-string">&quot;utf-8&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(content);<br>&#125;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getRollupConfig</span>(<span class="hljs-params">root</span>) &#123;<br>  <span class="hljs-keyword">const</span> config = <span class="hljs-keyword">await</span> <span class="hljs-title function_">packageJson</span>(root);<br>  <span class="hljs-keyword">const</span> tsconfig = path.<span class="hljs-title function_">resolve</span>(root, <span class="hljs-string">&quot;tsconfig.json&quot;</span>);<br>  <span class="hljs-keyword">const</span> &#123; name, formats &#125; = config.<span class="hljs-property">buildOptions</span> || &#123;&#125;;<br>  <span class="hljs-keyword">const</span> dist = path.<span class="hljs-title function_">resolve</span>(root, <span class="hljs-string">&quot;./dist&quot;</span>);<br>  <span class="hljs-keyword">const</span> entry = path.<span class="hljs-title function_">resolve</span>(root, <span class="hljs-string">&quot;./src/index.ts&quot;</span>);<br>  <span class="hljs-keyword">const</span> rollupOptions = &#123;<br>    <span class="hljs-attr">input</span>: entry,<br>    <span class="hljs-attr">sourcemap</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">external</span>: [<span class="hljs-string">&quot;vue&quot;</span>],<br>    <span class="hljs-attr">plugins</span>: [<br>      <span class="hljs-title function_">nodeResolve</span>(),<br>      <span class="hljs-title function_">commonjs</span>(),<br>      <span class="hljs-title function_">typescript</span>(&#123;<br>        tsconfig,<br>        <span class="hljs-attr">compilerOptions</span>: &#123;<br>          <span class="hljs-attr">outDir</span>: dist<br>        &#125;<br>      &#125;),<br>      <span class="hljs-title function_">vue</span>(&#123;<br>        <span class="hljs-attr">template</span>: &#123;<br>          <span class="hljs-attr">compilerOptions</span>: &#123;<br>            <span class="hljs-comment">// 自定义转换函数，在生成 AST 时移除特定属性</span><br>            <span class="hljs-attr">nodeTransforms</span>: [<br>              <span class="hljs-function"><span class="hljs-params">node</span> =&gt;</span> &#123;<br>                <span class="hljs-keyword">if</span> (node.<span class="hljs-property">type</span> === <span class="hljs-number">1</span> <span class="hljs-comment">/* NodeTypes.ELEMENT */</span>) &#123;<br>                  <span class="hljs-comment">// 过滤掉所有 data-testid 属性</span><br>                  node.<span class="hljs-property">props</span> = node.<span class="hljs-property">props</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">prop</span> =&gt;</span> &#123;<br>                    <span class="hljs-keyword">if</span> (prop.<span class="hljs-property">type</span> === <span class="hljs-number">6</span> <span class="hljs-comment">/* NodeTypes.ATTRIBUTE */</span>) &#123;<br>                      <span class="hljs-keyword">return</span> prop.<span class="hljs-property">name</span> !== <span class="hljs-string">&quot;data-testid&quot;</span>;<br>                    &#125;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>                  &#125;);<br>                &#125;<br>              &#125;<br>            ]<br>          &#125;<br>        &#125;<br>      &#125;),<br>      <span class="hljs-title function_">postcss</span>()<br>    ],<br>    <span class="hljs-attr">dir</span>: dist<br>  &#125;;<br>  <span class="hljs-keyword">const</span> output = [];<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> format <span class="hljs-keyword">of</span> formats) &#123;<br>    <span class="hljs-keyword">const</span> outputItem = &#123;<br>      format,<br>      <span class="hljs-attr">file</span>: path.<span class="hljs-title function_">resolve</span>(dist, <span class="hljs-string">`index.<span class="hljs-subst">$&#123;format&#125;</span>.js`</span>),<br>      <span class="hljs-attr">sourcemap</span>: <span class="hljs-literal">true</span>,<br>      <span class="hljs-attr">globals</span>: &#123;<br>        <span class="hljs-attr">vue</span>: <span class="hljs-string">&quot;Vue&quot;</span><br>      &#125;<br>    &#125;;<br>    <span class="hljs-keyword">if</span> (format === <span class="hljs-string">&quot;iife&quot;</span>) &#123;<br>      outputItem.<span class="hljs-property">name</span> = name;<br>    &#125;<br>    output.<span class="hljs-title function_">push</span>(outputItem);<br>  &#125;<br>  rollupOptions.<span class="hljs-property">output</span> = output;<br>  <span class="hljs-comment">// watch options</span><br>  rollupOptions.<span class="hljs-property">watch</span> = &#123;<br>    <span class="hljs-attr">include</span>: path.<span class="hljs-title function_">resolve</span>(root, <span class="hljs-string">&quot;src/**&quot;</span>),<br>    <span class="hljs-attr">exclude</span>: path.<span class="hljs-title function_">resolve</span>(root, <span class="hljs-string">&quot;node_modules/**&quot;</span>),<br>    <span class="hljs-attr">clearScreen</span>: <span class="hljs-literal">false</span><br>  &#125;;<br>  <span class="hljs-keyword">return</span> rollupOptions;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getRollupConfigs</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> roots = <span class="hljs-title function_">getPackageRoots</span>();<br>  <span class="hljs-keyword">const</span> configs = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(roots.<span class="hljs-title function_">map</span>(getRollupConfig));<br>  <span class="hljs-keyword">const</span> result = &#123;&#125;;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; packages.<span class="hljs-property">length</span>; i++) &#123;<br>    result[packages[i]] = configs[i];<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">clearDist</span>(<span class="hljs-params">name</span>) &#123;<br>  <span class="hljs-keyword">const</span> dist = path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;../packages&quot;</span>, name, <span class="hljs-string">&quot;dist&quot;</span>);<br>  <span class="hljs-keyword">if</span> (fs.<span class="hljs-title function_">existsSync</span>(dist)) &#123;<br>    fs.<span class="hljs-title function_">rmSync</span>(dist, &#123; <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">force</span>: <span class="hljs-literal">true</span> &#125;);<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// scripts/build.js</span><br><span class="hljs-keyword">import</span> &#123; getRollupConfigs, clearDist &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./buildBase.js&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; rollup &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;rollup&quot;</span>;<br><span class="hljs-keyword">import</span> terser <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@rollup/plugin-terser&quot;</span>;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> configs = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getRollupConfigs</span>();<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> name <span class="hljs-keyword">in</span> configs) &#123;<br>    <span class="hljs-title function_">clearDist</span>(name);<br>    <span class="hljs-keyword">const</span> config = configs[name];<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`📦 正在打包: <span class="hljs-subst">$&#123;name&#125;</span>`</span>);<br>    <span class="hljs-keyword">const</span> bundle = <span class="hljs-keyword">await</span> <span class="hljs-title function_">rollup</span>(&#123;<br>      <span class="hljs-attr">input</span>: config.<span class="hljs-property">input</span>,<br>      <span class="hljs-attr">plugins</span>: [...config.<span class="hljs-property">plugins</span>, <span class="hljs-title function_">terser</span>()],<br>      <span class="hljs-attr">external</span>: config.<span class="hljs-property">external</span><br>    &#125;);<br>    <span class="hljs-keyword">const</span> tasks = [];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> output <span class="hljs-keyword">of</span> config.<span class="hljs-property">output</span>) &#123;<br>      tasks.<span class="hljs-title function_">push</span>(bundle.<span class="hljs-title function_">write</span>(output));<br>    &#125;<br>    <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(tasks);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`✅ <span class="hljs-subst">$&#123;name&#125;</span> 打包完成`</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-title function_">build</span>();<br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// scripts/dev.js</span><br><span class="hljs-keyword">import</span> &#123; getRollupConfigs &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./buildBase.js&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; watch &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;rollup&quot;</span>;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">dev</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> configs = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getRollupConfigs</span>();<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> name <span class="hljs-keyword">in</span> configs) &#123;<br>    <span class="hljs-keyword">const</span> config = configs[name];<br>    <span class="hljs-keyword">const</span> watcher = <span class="hljs-title function_">watch</span>(<br>      config.<span class="hljs-property">output</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> (&#123;<br>        <span class="hljs-attr">input</span>: config.<span class="hljs-property">input</span>,<br>        <span class="hljs-attr">plugins</span>: config.<span class="hljs-property">plugins</span>,<br>        <span class="hljs-attr">external</span>: config.<span class="hljs-property">external</span>,<br>        <span class="hljs-attr">output</span>: o,<br>        <span class="hljs-attr">watch</span>: config.<span class="hljs-property">watch</span><br>      &#125;))<br>    );<br>    watcher.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;event&quot;</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (event.<span class="hljs-property">code</span> === <span class="hljs-string">&quot;START&quot;</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`👁️ 开始监听: <span class="hljs-subst">$&#123;name&#125;</span>`</span>);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.<span class="hljs-property">code</span> === <span class="hljs-string">&quot;ERROR&quot;</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`❌ <span class="hljs-subst">$&#123;name&#125;</span>打包失败:`</span>, event.<span class="hljs-property">error</span>);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.<span class="hljs-property">code</span> === <span class="hljs-string">&quot;BUNDLE_START&quot;</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`📦 正在打包: <span class="hljs-subst">$&#123;name&#125;</span>`</span>);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.<span class="hljs-property">code</span> === <span class="hljs-string">&quot;BUNDLE_END&quot;</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`✅ <span class="hljs-subst">$&#123;name&#125;</span> 打包完成`</span>);<br>      &#125;<br>    &#125;);<br>  &#125;<br>&#125;<br><br><span class="hljs-title function_">dev</span>();<br></code></pre></td></tr></table></figure><h2 id="统一测试"><a href="#统一测试" class="headerlink" title="统一测试"></a>统一测试</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pnpm -Dw add vitest @vitest/browser vitest-browser-vue vue<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>前端</category>
      
      <category>Monorepo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Monorepo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>从零构建企业级自动化部署脚本</title>
    <link href="/posts/%E5%90%8E%E7%AB%AF/Shell/%E4%BB%8E%E9%9B%B6%E6%9E%84%E5%BB%BA%E4%BC%81%E4%B8%9A%E7%BA%A7%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC/36122/"/>
    <url>/posts/%E5%90%8E%E7%AB%AF/Shell/%E4%BB%8E%E9%9B%B6%E6%9E%84%E5%BB%BA%E4%BC%81%E4%B8%9A%E7%BA%A7%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC/36122/</url>
    
    <content type="html"><![CDATA[<h1 id="从零构建企业级自动化部署脚本：支持多项目并发部署与智能备份"><a href="#从零构建企业级自动化部署脚本：支持多项目并发部署与智能备份" class="headerlink" title="从零构建企业级自动化部署脚本：支持多项目并发部署与智能备份"></a>从零构建企业级自动化部署脚本：支持多项目并发部署与智能备份</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在现代软件开发中，部署是一个频繁且重要的环节。传统的手动部署方式不仅效率低下，还容易出现人为错误。本文将详细介绍一个企业级的自动化部署脚本，它支持多项目并发部署、智能备份、文件校验等功能，大大提升了部署效率和可靠性。</p><h2 id="脚本设计目标"><a href="#脚本设计目标" class="headerlink" title="脚本设计目标"></a>脚本设计目标</h2><h3 id="核心需求"><a href="#核心需求" class="headerlink" title="核心需求"></a>核心需求</h3><ol><li><p><strong>多项目支持</strong>：从JSON配置文件读取多个项目的部署信息</p></li><li><p><strong>智能备份</strong>：自动备份服务器上的现有项目，避免数据丢失</p></li><li><p><strong>并发部署</strong>：多个项目同时部署，提升整体效率</p></li><li><p><strong>文件校验</strong>：部署完成后验证文件完整性</p></li><li><p><strong>用户友好</strong>：提供进度条和详细的状态反馈</p></li><li><p><strong>安全可靠</strong>：支持SSH密钥认证，防止意外交互</p></li></ol><h3 id="技术特性"><a href="#技术特性" class="headerlink" title="技术特性"></a>技术特性</h3><ul><li><p>支持断点续传（rsync的–partial选项）</p></li><li><p>彩色输出和进度条显示</p></li><li><p>详细的成功&#x2F;失败报告</p></li><li><p>可选的单项目或多项目部署</p></li></ul><h2 id="核心架构设计"><a href="#核心架构设计" class="headerlink" title="核心架构设计"></a>核心架构设计</h2><h3 id="1-配置驱动"><a href="#1-配置驱动" class="headerlink" title="1. 配置驱动"></a>1. 配置驱动</h3><p>脚本采用JSON配置文件的方式管理部署信息，每个项目包含：</p><ul><li><p>项目名称</p></li><li><p>服务器信息（IP、端口、用户）</p></li><li><p>本地源码目录</p></li><li><p>远程目标目录</p></li></ul><h3 id="2-并发控制"><a href="#2-并发控制" class="headerlink" title="2. 并发控制"></a>2. 并发控制</h3><p>使用bash的后台作业管理，通过<code>&amp;</code>和<code>wait</code>命令实现并发部署，同时限制最大并发数避免服务器过载。</p><h3 id="3-状态管理"><a href="#3-状态管理" class="headerlink" title="3. 状态管理"></a>3. 状态管理</h3><p>通过临时文件在子进程和父进程之间传递状态信息，确保部署结果的准确记录。</p><h2 id="代码实现详解"><a href="#代码实现详解" class="headerlink" title="代码实现详解"></a>代码实现详解</h2><h3 id="第一步：环境准备和依赖检查"><a href="#第一步：环境准备和依赖检查" class="headerlink" title="第一步：环境准备和依赖检查"></a>第一步：环境准备和依赖检查</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment">#!/bin/bash</span><br><br><br><br><span class="hljs-comment"># 颜色输出函数</span><br><br><span class="hljs-function"><span class="hljs-title">green</span></span>() &#123; <span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;\033[32m%b\033[0m\n&#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span>; &#125;<br><br><span class="hljs-function"><span class="hljs-title">red</span></span>() &#123; <span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;\033[31m%b\033[0m\n&#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span>; &#125;<br><br><span class="hljs-function"><span class="hljs-title">yellow</span></span>() &#123; <span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;\033[33m%b\033[0m\n&#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span>; &#125;<br><br><span class="hljs-function"><span class="hljs-title">blue</span></span>() &#123; <span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;\033[34m%b\033[0m\n&#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span>; &#125;<br><br>  <br><br><span class="hljs-comment"># 依赖检查</span><br><br><span class="hljs-built_in">command</span> -v rsync &gt;/dev/null || &#123; red <span class="hljs-string">&quot;请先安装 rsync&quot;</span>; <span class="hljs-built_in">exit</span> 1; &#125;<br><br><span class="hljs-built_in">command</span> -v jq &gt;/dev/null || &#123; red <span class="hljs-string">&quot;请先安装 jq&quot;</span>; <span class="hljs-built_in">exit</span> 1; &#125;<br><br></code></pre></td></tr></table></figure><p><strong>设计思路</strong>：</p><ul><li><p>使用ANSI转义序列实现彩色输出，提升用户体验</p></li><li><p>在脚本开始时检查必要工具，避免运行时才发现依赖缺失</p></li></ul><h3 id="第二步：进度条实现"><a href="#第二步：进度条实现" class="headerlink" title="第二步：进度条实现"></a>第二步：进度条实现</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-function"><span class="hljs-title">progress_bar</span></span>() &#123;<br><br><span class="hljs-built_in">local</span> current=<span class="hljs-variable">$1</span><br><br><span class="hljs-built_in">local</span> total=<span class="hljs-variable">$2</span><br><br><span class="hljs-built_in">local</span> width=50<br><br><span class="hljs-built_in">local</span> percentage=$((current * <span class="hljs-number">100</span> / total))<br><br><span class="hljs-built_in">local</span> filled=$((current * width / total))<br><br><span class="hljs-built_in">local</span> empty=$((width - filled))<br><br>  <br><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;\r\033[36m[&#x27;</span><br><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;%*s&#x27;</span> <span class="hljs-variable">$filled</span> | <span class="hljs-built_in">tr</span> <span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-string">&#x27;#&#x27;</span><br><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;%*s&#x27;</span> <span class="hljs-variable">$empty</span> | <span class="hljs-built_in">tr</span> <span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-string">&#x27;-&#x27;</span><br><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;] %d%%\033[0m&#x27;</span> <span class="hljs-variable">$percentage</span><br><br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>设计思路</strong>：</p><ul><li><p>使用<code>\r</code>实现同行刷新，避免输出过多行</p></li><li><p>通过计算填充和空白字符数量实现可视化进度</p></li><li><p>使用<code>#</code>和<code>-</code>字符确保在不同终端环境下的兼容性</p></li></ul><h3 id="第三步：配置解析"><a href="#第三步：配置解析" class="headerlink" title="第三步：配置解析"></a>第三步：配置解析</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment"># 读取配置文件</span><br><br>DEPLOY_CONFIG=<span class="hljs-string">&quot;scripts/deploy.json&quot;</span><br><br>PROJECTS_DATA=$(jq -r <span class="hljs-string">&#x27;.&#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$DEPLOY_CONFIG</span>&quot;</span>)<br><br>PROJECT_COUNT=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$PROJECTS_DATA</span>&quot;</span> | jq <span class="hljs-string">&#x27;length&#x27;</span>)<br><br>  <br><br><span class="hljs-comment"># 解析项目信息</span><br><br><span class="hljs-function"><span class="hljs-title">get_project_info</span></span>() &#123;<br><br><span class="hljs-built_in">local</span> index=<span class="hljs-variable">$1</span><br><br><span class="hljs-built_in">local</span> field=<span class="hljs-variable">$2</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$PROJECTS_DATA</span>&quot;</span> | jq -r <span class="hljs-string">&quot;.[<span class="hljs-variable">$index</span>].<span class="hljs-variable">$field</span>&quot;</span><br><br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>设计思路</strong>：</p><ul><li><p>使用<code>jq</code>一次性读取整个JSON文件，避免多次文件IO</p></li><li><p>通过函数封装项目信息获取，提高代码复用性</p></li><li><p>预先计算项目总数，用于进度条显示</p></li></ul><h3 id="第四步：用户交互"><a href="#第四步：用户交互" class="headerlink" title="第四步：用户交互"></a>第四步：用户交互</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;请选择部署方式：&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;a) 部署所有项目&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;s) 选择特定项目&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;q) 退出&quot;</span><br><br>  <br><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;请输入选择 (a/s/q): &quot;</span> choice<br><br>  <br><br><span class="hljs-keyword">case</span> <span class="hljs-variable">$choice</span> <span class="hljs-keyword">in</span><br><br>a) SELECTED_INDICES=$(<span class="hljs-built_in">seq</span> 0 $((PROJECT_COUNT - <span class="hljs-number">1</span>)));;<br><br>s)<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;可用项目：&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 0 $((PROJECT_COUNT - <span class="hljs-number">1</span>))); <span class="hljs-keyword">do</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$i</span>) <span class="hljs-subst">$(get_project_info $i name)</span>&quot;</span><br><br><span class="hljs-keyword">done</span><br><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;请输入项目编号（多个用空格分隔）: &quot;</span> -a indices<br><br>SELECTED_INDICES=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;indices[@]&#125;</span>&quot;</span><br><br>;;<br><br>q) <span class="hljs-built_in">exit</span> 0;;<br><br>*) red <span class="hljs-string">&quot;无效选择&quot;</span>; <span class="hljs-built_in">exit</span> 1;;<br><br><span class="hljs-keyword">esac</span><br><br></code></pre></td></tr></table></figure><p><strong>设计思路</strong>：</p><ul><li><p>提供灵活的部署选择，支持全量或选择性部署</p></li><li><p>使用数组存储用户选择，便于后续处理</p></li><li><p>清晰的用户界面，降低使用门槛</p></li></ul><h3 id="第五步：核心部署函数"><a href="#第五步：核心部署函数" class="headerlink" title="第五步：核心部署函数"></a>第五步：核心部署函数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-function"><span class="hljs-title">deploy_project</span></span>() &#123;<br><br><span class="hljs-built_in">local</span> index=<span class="hljs-variable">$1</span><br><br><span class="hljs-built_in">local</span> PROJECT_NAME=$(get_project_info <span class="hljs-variable">$index</span> name)<br><br><span class="hljs-built_in">local</span> SERVER=$(get_project_info <span class="hljs-variable">$index</span> server)<br><br><span class="hljs-built_in">local</span> PORT=$(get_project_info <span class="hljs-variable">$index</span> port)<br><br><span class="hljs-built_in">local</span> TARGET_DIR=$(get_project_info <span class="hljs-variable">$index</span> target_dir)<br><br><span class="hljs-built_in">local</span> SRC_DIR=$(get_project_info <span class="hljs-variable">$index</span> src_dir)<br><br><span class="hljs-built_in">local</span> SSH_KEY=<span class="hljs-string">&quot;~/.ssh/id_rsa&quot;</span><br><br><span class="hljs-built_in">local</span> log_file=<span class="hljs-string">&quot;/tmp/deploy_<span class="hljs-variable">$&#123;PROJECT_NAME&#125;</span>_$$.log&quot;</span><br><br><span class="hljs-built_in">local</span> exit_code=0<br><br><span class="hljs-comment"># 检查源目录</span><br><br><span class="hljs-keyword">if</span> [[ ! -d <span class="hljs-string">&quot;<span class="hljs-variable">$SRC_DIR</span>&quot;</span> ]]; <span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;FAILED:<span class="hljs-variable">$PROJECT_NAME</span>:源目录不存在 (<span class="hljs-variable">$SRC_DIR</span>)&quot;</span> &gt;&gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span><br><br><span class="hljs-built_in">return</span> 1<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># 检查SSH连接</span><br><br><span class="hljs-keyword">if</span> ! ssh -i <span class="hljs-string">&quot;<span class="hljs-variable">$SSH_KEY</span>&quot;</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$PORT</span>&quot;</span> -o BatchMode=<span class="hljs-built_in">yes</span> -o ConnectTimeout=10 -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null <span class="hljs-string">&quot;<span class="hljs-variable">$SERVER</span>&quot;</span> <span class="hljs-string">&quot;echo &#x27;SSH连接测试&#x27;&quot;</span> &gt;/dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;FAILED:<span class="hljs-variable">$PROJECT_NAME</span>:SSH连接失败&quot;</span> &gt;&gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span><br><br><span class="hljs-built_in">return</span> 1<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># 备份现有目录</span><br><br><span class="hljs-keyword">if</span> ssh -i <span class="hljs-string">&quot;<span class="hljs-variable">$SSH_KEY</span>&quot;</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$PORT</span>&quot;</span> -o BatchMode=<span class="hljs-built_in">yes</span> -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null <span class="hljs-string">&quot;<span class="hljs-variable">$SERVER</span>&quot;</span> <span class="hljs-string">&quot;[ -d &#x27;<span class="hljs-variable">$TARGET_DIR</span>&#x27; ]&quot;</span>; <span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">local</span> backup_suffix=$(<span class="hljs-built_in">date</span> +%Y%m%d%H%M)<br><br><span class="hljs-built_in">local</span> dir_name=$(<span class="hljs-built_in">basename</span> <span class="hljs-string">&quot;<span class="hljs-variable">$TARGET_DIR</span>&quot;</span>)<br><br><span class="hljs-built_in">local</span> BACKUP_NAME=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;dir_name&#125;</span>_back<span class="hljs-variable">$&#123;backup_suffix&#125;</span>&quot;</span><br><br><span class="hljs-built_in">local</span> backup_path=$(<span class="hljs-built_in">dirname</span> <span class="hljs-string">&quot;<span class="hljs-variable">$TARGET_DIR</span>&quot;</span>)/<span class="hljs-variable">$BACKUP_NAME</span><br><br>ssh -i <span class="hljs-string">&quot;<span class="hljs-variable">$SSH_KEY</span>&quot;</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$PORT</span>&quot;</span> -o BatchMode=<span class="hljs-built_in">yes</span> -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null <span class="hljs-string">&quot;<span class="hljs-variable">$SERVER</span>&quot;</span> <span class="hljs-string">&quot;mv &#x27;<span class="hljs-variable">$TARGET_DIR</span>&#x27; &#x27;<span class="hljs-variable">$backup_path</span>&#x27;&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$PROJECT_NAME</span> -&gt; <span class="hljs-variable">$BACKUP_NAME</span>&quot;</span> &gt; <span class="hljs-string">&quot;/tmp/renamed_<span class="hljs-variable">$&#123;PROJECT_NAME&#125;</span>_$$.tmp&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># 执行rsync同步</span><br><br><span class="hljs-keyword">if</span> rsync -avz --delete --progress \<br><br>-e <span class="hljs-string">&quot;ssh -i <span class="hljs-variable">$SSH_KEY</span> -p <span class="hljs-variable">$PORT</span> -o BatchMode=yes -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null&quot;</span> \<br><br>--iconv=UTF-8-MAC,UTF-8 \<br><br>--partial \<br><br>--partial-dir=.rsync-partial \<br><br><span class="hljs-string">&quot;<span class="hljs-variable">$SRC_DIR</span>/&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$SERVER</span>:<span class="hljs-variable">$TARGET_DIR</span>/&quot;</span> &gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span> 2&gt;&amp;1; <span class="hljs-keyword">then</span><br><br><span class="hljs-comment"># 文件数量校验</span><br><br>local_file_count=$(find <span class="hljs-string">&quot;<span class="hljs-variable">$SRC_DIR</span>&quot;</span> -<span class="hljs-built_in">type</span> f \( -name <span class="hljs-string">&quot;.*&quot;</span> -o -name <span class="hljs-string">&quot;*.tmp&quot;</span> -o -name <span class="hljs-string">&quot;*.log&quot;</span> -o -name <span class="hljs-string">&quot;.DS_Store&quot;</span> \) -prune -o -<span class="hljs-built_in">type</span> f -<span class="hljs-built_in">print</span> | <span class="hljs-built_in">wc</span> -l)<br><br>remote_file_count=$(ssh -i <span class="hljs-string">&quot;<span class="hljs-variable">$SSH_KEY</span>&quot;</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$PORT</span>&quot;</span> -o BatchMode=<span class="hljs-built_in">yes</span> -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null <span class="hljs-string">&quot;<span class="hljs-variable">$SERVER</span>&quot;</span> <span class="hljs-string">&quot;find <span class="hljs-variable">$TARGET_DIR</span> -type f \( -name &#x27;.*&#x27; -o -name &#x27;*.tmp&#x27; -o -name &#x27;*.log&#x27; -o -name &#x27;.DS_Store&#x27; \) -prune -o -type f -print | wc -l&quot;</span> 2&gt;/dev/null)<br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-string">&quot;<span class="hljs-variable">$local_file_count</span>&quot;</span> == <span class="hljs-string">&quot;<span class="hljs-variable">$remote_file_count</span>&quot;</span> &amp;&amp; <span class="hljs-string">&quot;<span class="hljs-variable">$local_file_count</span>&quot;</span> -gt 0 ]]; <span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;SUCCESS:<span class="hljs-variable">$PROJECT_NAME</span>:<span class="hljs-variable">$local_file_count</span>&quot;</span> &gt;&gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span><br><br><span class="hljs-keyword">else</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;FAILED:<span class="hljs-variable">$PROJECT_NAME</span>:文件数量不匹配 (本地:<span class="hljs-variable">$local_file_count</span>, 远程:<span class="hljs-variable">$remote_file_count</span>)&quot;</span> &gt;&gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span><br><br>exit_code=1<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">else</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;FAILED:<span class="hljs-variable">$PROJECT_NAME</span>:rsync同步失败&quot;</span> &gt;&gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span><br><br>exit_code=1<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-built_in">return</span> <span class="hljs-variable">$exit_code</span><br><br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>设计思路</strong>：</p><ul><li><p><strong>分层错误处理</strong>：每个关键步骤都有独立的错误检查</p></li><li><p><strong>智能备份</strong>：自动检测并备份现有目录，使用时间戳避免冲突</p></li><li><p><strong>断点续传</strong>：rsync的<code>--partial</code>选项支持中断后继续传输</p></li><li><p><strong>文件校验</strong>：通过文件数量对比验证部署完整性</p></li><li><p><strong>状态记录</strong>：使用临时文件记录详细状态，便于父进程处理</p></li></ul><h3 id="第六步：并发管理和结果处理"><a href="#第六步：并发管理和结果处理" class="headerlink" title="第六步：并发管理和结果处理"></a>第六步：并发管理和结果处理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment"># 并发控制</span><br><br>MAX_CONCURRENT=3<br><br>current_jobs=0<br><br>job_pids=<span class="hljs-string">&quot;&quot;</span><br><br>job_names=<span class="hljs-string">&quot;&quot;</span><br><br>  <br><br><span class="hljs-comment"># 部署所有选中的项目</span><br><br><span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-variable">$SELECTED_INDICES</span>; <span class="hljs-keyword">do</span><br><br><span class="hljs-comment"># 控制并发数</span><br><br><span class="hljs-keyword">while</span> [[ <span class="hljs-variable">$current_jobs</span> -ge <span class="hljs-variable">$MAX_CONCURRENT</span> ]]; <span class="hljs-keyword">do</span><br><br>wait_for_job<br><br><span class="hljs-keyword">done</span><br><br><span class="hljs-comment"># 启动新任务</span><br><br>deploy_project <span class="hljs-variable">$index</span> &amp;<br><br><span class="hljs-built_in">local</span> pid=$!<br><br>job_pids=<span class="hljs-string">&quot;<span class="hljs-variable">$job_pids</span> <span class="hljs-variable">$pid</span>&quot;</span><br><br>job_names=<span class="hljs-string">&quot;<span class="hljs-variable">$job_names</span> <span class="hljs-variable">$index</span>&quot;</span><br><br>current_jobs=$((current_jobs + <span class="hljs-number">1</span>))<br><br><span class="hljs-keyword">done</span><br><br>  <br><br><span class="hljs-comment"># 等待所有任务完成</span><br><br><span class="hljs-keyword">while</span> [[ <span class="hljs-variable">$current_jobs</span> -gt 0 ]]; <span class="hljs-keyword">do</span><br><br>wait_for_job<br><br><span class="hljs-keyword">done</span><br><br></code></pre></td></tr></table></figure><p><strong>设计思路</strong>：</p><ul><li><p><strong>并发限制</strong>：通过<code>MAX_CONCURRENT</code>控制同时运行的任务数</p></li><li><p><strong>动态等待</strong>：使用<code>wait_for_job</code>函数处理完成的任务</p></li><li><p><strong>状态跟踪</strong>：通过字符串存储PID和项目名称，便于管理</p></li></ul><h3 id="第七步：结果汇总和展示"><a href="#第七步：结果汇总和展示" class="headerlink" title="第七步：结果汇总和展示"></a>第七步：结果汇总和展示</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment"># 显示最终结果</span><br><br><span class="hljs-built_in">echo</span><br><br><span class="hljs-keyword">if</span> [[ -n <span class="hljs-string">&quot;<span class="hljs-variable">$RENAMED_DETAILS</span>&quot;</span> ]]; <span class="hljs-keyword">then</span><br><br>blue <span class="hljs-string">&quot;📁 重命名备份的项目：<span class="hljs-variable">$RENAMED_DETAILS</span>&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br>  <br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$SUCCESS_COUNT</span> -gt 0 ]]; <span class="hljs-keyword">then</span><br><br>green <span class="hljs-string">&quot;✅ 部署成功的项目：<span class="hljs-variable">$SUCCESS_PROJECTS</span>&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br>  <br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$FAILED_COUNT</span> -gt 0 ]]; <span class="hljs-keyword">then</span><br><br>red <span class="hljs-string">&quot;❌ 部署失败的项目：<span class="hljs-variable">$FAILED_PROJECTS</span>&quot;</span><br><br><span class="hljs-built_in">echo</span><br><br>red <span class="hljs-string">&quot;失败原因：&quot;</span><br><br><span class="hljs-keyword">for</span> reason <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;FAILED_REASONS[@]&#125;</span>&quot;</span>; <span class="hljs-keyword">do</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; - <span class="hljs-variable">$reason</span>&quot;</span><br><br><span class="hljs-keyword">done</span><br><br><span class="hljs-keyword">fi</span><br><br>  <br><br><span class="hljs-comment"># 根据结果选择颜色</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$FAILED_COUNT</span> -eq 0 ]]; <span class="hljs-keyword">then</span><br><br>green <span class="hljs-string">&quot;部署完成！共部署 <span class="hljs-variable">$SUCCESS_COUNT</span> 个项目，失败 <span class="hljs-variable">$FAILED_COUNT</span> 个项目&quot;</span><br><br><span class="hljs-keyword">else</span><br><br>red <span class="hljs-string">&quot;部署完成！共部署 <span class="hljs-variable">$SUCCESS_COUNT</span> 个项目，失败 <span class="hljs-variable">$FAILED_COUNT</span> 个项目&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br></code></pre></td></tr></table></figure><p><strong>设计思路</strong>：</p><ul><li><p><strong>分类展示</strong>：分别显示备份、成功、失败的项目</p></li><li><p><strong>详细反馈</strong>：提供具体的失败原因，便于问题排查</p></li><li><p><strong>动态颜色</strong>：根据部署结果选择不同的颜色显示</p></li></ul><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment">#!/bin/bash</span><br><br>  <br><br><span class="hljs-comment"># -------------------------------------------------</span><br><br><span class="hljs-comment"># deploy.sh — 一键把本地文件/目录推到远端 Linux 服务器</span><br><br><span class="hljs-comment"># 依赖: rsync (本地+远端都要有), jq (用于解析JSON)</span><br><br><span class="hljs-comment"># -------------------------------------------------</span><br><br><span class="hljs-comment"># 从 deploy.json 读取配置并遍历推送</span><br><br>  <br><br><span class="hljs-comment"># 颜色输出函数</span><br><br><span class="hljs-function"><span class="hljs-title">green</span></span>() &#123; <span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;\033[32m%b\033[0m\n&#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span>; &#125;<br><br><span class="hljs-function"><span class="hljs-title">red</span></span>() &#123; <span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;\033[31m%b\033[0m\n&#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span>; &#125;<br><br><span class="hljs-function"><span class="hljs-title">yellow</span></span>() &#123; <span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;\033[33m%b\033[0m\n&#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span>; &#125;<br><br><span class="hljs-function"><span class="hljs-title">blue</span></span>() &#123; <span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;\033[34m%b\033[0m\n&#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span>; &#125;<br><br>  <br><br><span class="hljs-comment"># 进度条函数</span><br><br><span class="hljs-function"><span class="hljs-title">progress_bar</span></span>() &#123;<br><br><span class="hljs-built_in">local</span> current=<span class="hljs-variable">$1</span><br><br><span class="hljs-built_in">local</span> total=<span class="hljs-variable">$2</span><br><br><span class="hljs-built_in">local</span> width=50<br><br><span class="hljs-built_in">local</span> percentage=$((current * <span class="hljs-number">100</span> / total))<br><br><span class="hljs-built_in">local</span> filled=$((current * width / total))<br><br><span class="hljs-built_in">local</span> empty=$((width - filled))<br><br>  <br><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;\r\033[36m[&#x27;</span><br><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;%*s&#x27;</span> <span class="hljs-variable">$filled</span> | <span class="hljs-built_in">tr</span> <span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-string">&#x27;#&#x27;</span><br><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;%*s&#x27;</span> <span class="hljs-variable">$empty</span> | <span class="hljs-built_in">tr</span> <span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-string">&#x27;-&#x27;</span><br><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;] %d%%\033[0m&#x27;</span> <span class="hljs-variable">$percentage</span><br><br>&#125;<br><br>  <br><br><span class="hljs-comment"># 检查依赖</span><br><br><span class="hljs-built_in">command</span> -v rsync &gt;/dev/null || &#123; red <span class="hljs-string">&quot;请先安装 rsync&quot;</span>; <span class="hljs-built_in">exit</span> 1; &#125;<br><br><span class="hljs-built_in">command</span> -v jq &gt;/dev/null || &#123; red <span class="hljs-string">&quot;请先安装 jq&quot;</span>; <span class="hljs-built_in">exit</span> 1; &#125;<br><br>  <br><br><span class="hljs-comment"># 配置文件</span><br><br>DEPLOY_CONFIG=<span class="hljs-string">&quot;scripts/deploy.json&quot;</span><br><br>[[ -f <span class="hljs-string">&quot;<span class="hljs-variable">$DEPLOY_CONFIG</span>&quot;</span> ]] || &#123; red <span class="hljs-string">&quot;配置文件不存在：<span class="hljs-variable">$DEPLOY_CONFIG</span>&quot;</span>; <span class="hljs-built_in">exit</span> 1; &#125;<br><br>  <br><br><span class="hljs-comment"># 读取项目数据</span><br><br>PROJECTS_DATA=$(jq -r <span class="hljs-string">&#x27;.&#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$DEPLOY_CONFIG</span>&quot;</span>)<br><br>PROJECT_COUNT=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$PROJECTS_DATA</span>&quot;</span> | jq <span class="hljs-string">&#x27;length&#x27;</span>)<br><br>  <br><br><span class="hljs-comment"># 获取项目信息的辅助函数</span><br><br><span class="hljs-function"><span class="hljs-title">get_project_info</span></span>() &#123;<br><br><span class="hljs-built_in">local</span> index=<span class="hljs-variable">$1</span><br><br><span class="hljs-built_in">local</span> field=<span class="hljs-variable">$2</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$PROJECTS_DATA</span>&quot;</span> | jq -r <span class="hljs-string">&quot;.[<span class="hljs-variable">$index</span>].<span class="hljs-variable">$field</span>&quot;</span><br><br>&#125;<br><br>  <br><br><span class="hljs-comment"># 获取项目名称的辅助函数</span><br><br><span class="hljs-function"><span class="hljs-title">get_project_name</span></span>() &#123;<br><br><span class="hljs-built_in">local</span> pid=<span class="hljs-variable">$1</span><br><br><span class="hljs-built_in">local</span> index=0<br><br><span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> <span class="hljs-variable">$job_pids</span>; <span class="hljs-keyword">do</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$p</span> -eq <span class="hljs-variable">$pid</span> ]]; <span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">local</span> name_index=0<br><br><span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-variable">$job_names</span>; <span class="hljs-keyword">do</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$name_index</span> -eq <span class="hljs-variable">$index</span> ]]; <span class="hljs-keyword">then</span><br><br>get_project_info <span class="hljs-variable">$n</span> name<br><br><span class="hljs-built_in">return</span><br><br><span class="hljs-keyword">fi</span><br><br>name_index=$((name_index + <span class="hljs-number">1</span>))<br><br><span class="hljs-keyword">done</span><br><br><span class="hljs-keyword">fi</span><br><br>index=$((index + <span class="hljs-number">1</span>))<br><br><span class="hljs-keyword">done</span><br><br>&#125;<br><br>  <br><br><span class="hljs-comment"># 从PID列表中移除指定PID</span><br><br><span class="hljs-function"><span class="hljs-title">remove_pid</span></span>() &#123;<br><br><span class="hljs-built_in">local</span> target_pid=<span class="hljs-variable">$1</span><br><br><span class="hljs-built_in">local</span> new_pids=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-built_in">local</span> new_names=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-built_in">local</span> index=0<br><br><span class="hljs-keyword">for</span> pid <span class="hljs-keyword">in</span> <span class="hljs-variable">$job_pids</span>; <span class="hljs-keyword">do</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$pid</span> -ne <span class="hljs-variable">$target_pid</span> ]]; <span class="hljs-keyword">then</span><br><br>new_pids=<span class="hljs-string">&quot;<span class="hljs-variable">$new_pids</span> <span class="hljs-variable">$pid</span>&quot;</span><br><br><span class="hljs-comment"># 获取对应的项目名称</span><br><br><span class="hljs-built_in">local</span> name_index=0<br><br><span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> <span class="hljs-variable">$job_names</span>; <span class="hljs-keyword">do</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$name_index</span> -eq <span class="hljs-variable">$index</span> ]]; <span class="hljs-keyword">then</span><br><br>new_names=<span class="hljs-string">&quot;<span class="hljs-variable">$new_names</span> <span class="hljs-variable">$name</span>&quot;</span><br><br><span class="hljs-built_in">break</span><br><br><span class="hljs-keyword">fi</span><br><br>name_index=$((name_index + <span class="hljs-number">1</span>))<br><br><span class="hljs-keyword">done</span><br><br><span class="hljs-keyword">fi</span><br><br>index=$((index + <span class="hljs-number">1</span>))<br><br><span class="hljs-keyword">done</span><br><br>job_pids=<span class="hljs-string">&quot;<span class="hljs-variable">$new_pids</span>&quot;</span><br><br>job_names=<span class="hljs-string">&quot;<span class="hljs-variable">$new_names</span>&quot;</span><br><br>&#125;<br><br>  <br><br><span class="hljs-comment"># 等待作业完成的函数</span><br><br><span class="hljs-function"><span class="hljs-title">wait_for_job</span></span>() &#123;<br><br><span class="hljs-built_in">local</span> completed_pid<br><br><span class="hljs-keyword">for</span> pid <span class="hljs-keyword">in</span> <span class="hljs-variable">$job_pids</span>; <span class="hljs-keyword">do</span><br><br><span class="hljs-keyword">if</span> ! <span class="hljs-built_in">kill</span> -0 <span class="hljs-variable">$pid</span> 2&gt;/dev/null; <span class="hljs-keyword">then</span><br><br>completed_pid=<span class="hljs-variable">$pid</span><br><br><span class="hljs-built_in">break</span><br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">done</span><br><br><span class="hljs-keyword">if</span> [[ -n <span class="hljs-string">&quot;<span class="hljs-variable">$completed_pid</span>&quot;</span> ]]; <span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">local</span> project_name=$(get_project_name <span class="hljs-variable">$completed_pid</span>)<br><br><span class="hljs-built_in">local</span> log_file=<span class="hljs-string">&quot;/tmp/deploy_<span class="hljs-variable">$&#123;project_name&#125;</span>_$$.log&quot;</span><br><br><span class="hljs-comment"># 检查部署结果</span><br><br><span class="hljs-keyword">if</span> grep -q <span class="hljs-string">&quot;SUCCESS:<span class="hljs-variable">$project_name</span>:&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span>; <span class="hljs-keyword">then</span><br><br><span class="hljs-comment"># 获取文件数量信息</span><br><br>file_count=$(grep <span class="hljs-string">&quot;SUCCESS:<span class="hljs-variable">$project_name</span>:&quot;</span> <span class="hljs-string">&quot;/tmp/deploy_<span class="hljs-variable">$&#123;project_name&#125;</span>_$$.log&quot;</span> | <span class="hljs-built_in">cut</span> -d<span class="hljs-string">&#x27;:&#x27;</span> -f3)<br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$SUCCESS_COUNT</span> -eq 0 ]]; <span class="hljs-keyword">then</span><br><br>SUCCESS_PROJECTS=<span class="hljs-string">&quot;<span class="hljs-variable">$project_name</span> -&gt; 共<span class="hljs-variable">$&#123;file_count&#125;</span>个文件&quot;</span><br><br><span class="hljs-keyword">else</span><br><br>SUCCESS_PROJECTS=<span class="hljs-string">&quot;<span class="hljs-variable">$SUCCESS_PROJECTS</span>, <span class="hljs-variable">$project_name</span> -&gt; 共<span class="hljs-variable">$&#123;file_count&#125;</span>个文件&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br>SUCCESS_COUNT=$((SUCCESS_COUNT + <span class="hljs-number">1</span>))<br><br><span class="hljs-keyword">else</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$FAILED_COUNT</span> -eq 0 ]]; <span class="hljs-keyword">then</span><br><br>FAILED_PROJECTS=<span class="hljs-string">&quot;<span class="hljs-variable">$project_name</span>&quot;</span><br><br><span class="hljs-keyword">else</span><br><br>FAILED_PROJECTS=<span class="hljs-string">&quot;<span class="hljs-variable">$FAILED_PROJECTS</span>, <span class="hljs-variable">$project_name</span>&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br>FAILED_COUNT=$((FAILED_COUNT + <span class="hljs-number">1</span>))<br><br><span class="hljs-comment"># 获取失败原因</span><br><br><span class="hljs-built_in">local</span> reason=$(grep <span class="hljs-string">&quot;FAILED:<span class="hljs-variable">$project_name</span>:&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span> | <span class="hljs-built_in">cut</span> -d<span class="hljs-string">&#x27;:&#x27;</span> -f3-)<br><br>FAILED_REASONS+=(<span class="hljs-string">&quot;<span class="hljs-variable">$project_name</span>: <span class="hljs-variable">$reason</span>&quot;</span>)<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># 检查是否有重命名记录</span><br><br><span class="hljs-keyword">if</span> [[ -f <span class="hljs-string">&quot;/tmp/renamed_<span class="hljs-variable">$&#123;project_name&#125;</span>_$$.tmp&quot;</span> ]]; <span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">local</span> renamed_info=$(<span class="hljs-built_in">cat</span> <span class="hljs-string">&quot;/tmp/renamed_<span class="hljs-variable">$&#123;project_name&#125;</span>_$$.tmp&quot;</span>)<br><br><span class="hljs-keyword">if</span> [[ -z <span class="hljs-string">&quot;<span class="hljs-variable">$RENAMED_DETAILS</span>&quot;</span> ]]; <span class="hljs-keyword">then</span><br><br>RENAMED_DETAILS=<span class="hljs-string">&quot;<span class="hljs-variable">$renamed_info</span>&quot;</span><br><br><span class="hljs-keyword">else</span><br><br>RENAMED_DETAILS=<span class="hljs-string">&quot;<span class="hljs-variable">$RENAMED_DETAILS</span>, <span class="hljs-variable">$renamed_info</span>&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-built_in">rm</span> -f <span class="hljs-string">&quot;/tmp/renamed_<span class="hljs-variable">$&#123;project_name&#125;</span>_$$.tmp&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># 清理日志文件</span><br><br><span class="hljs-built_in">rm</span> -f <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span><br><br><span class="hljs-comment"># 从PID列表中移除</span><br><br>remove_pid <span class="hljs-variable">$completed_pid</span><br><br>current_jobs=$((current_jobs - <span class="hljs-number">1</span>))<br><br><span class="hljs-comment"># 更新进度条</span><br><br><span class="hljs-built_in">local</span> completed=$((TOTAL_JOBS - current_jobs))<br><br>progress_bar <span class="hljs-variable">$completed</span> <span class="hljs-variable">$TOTAL_JOBS</span><br><br><span class="hljs-keyword">fi</span><br><br>&#125;<br><br>  <br><br><span class="hljs-comment"># 部署单个项目的函数</span><br><br><span class="hljs-function"><span class="hljs-title">deploy_project</span></span>() &#123;<br><br><span class="hljs-built_in">local</span> index=<span class="hljs-variable">$1</span><br><br><span class="hljs-built_in">local</span> PROJECT_NAME=$(get_project_info <span class="hljs-variable">$index</span> name)<br><br><span class="hljs-built_in">local</span> SERVER=$(get_project_info <span class="hljs-variable">$index</span> server)<br><br><span class="hljs-built_in">local</span> PORT=$(get_project_info <span class="hljs-variable">$index</span> port)<br><br><span class="hljs-built_in">local</span> TARGET_DIR=$(get_project_info <span class="hljs-variable">$index</span> target_dir)<br><br><span class="hljs-built_in">local</span> SRC_DIR=$(get_project_info <span class="hljs-variable">$index</span> src_dir)<br><br><span class="hljs-built_in">local</span> SSH_KEY=<span class="hljs-string">&quot;~/.ssh/id_rsa&quot;</span><br><br><span class="hljs-built_in">local</span> log_file=<span class="hljs-string">&quot;/tmp/deploy_<span class="hljs-variable">$&#123;PROJECT_NAME&#125;</span>_$$.log&quot;</span><br><br><span class="hljs-built_in">local</span> exit_code=0<br><br><span class="hljs-comment"># 检查源目录</span><br><br><span class="hljs-keyword">if</span> [[ ! -d <span class="hljs-string">&quot;<span class="hljs-variable">$SRC_DIR</span>&quot;</span> ]]; <span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;FAILED:<span class="hljs-variable">$PROJECT_NAME</span>:源目录不存在 (<span class="hljs-variable">$SRC_DIR</span>)&quot;</span> &gt;&gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span><br><br><span class="hljs-built_in">return</span> 1<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># 检查SSH连接</span><br><br><span class="hljs-keyword">if</span> ! ssh -i <span class="hljs-string">&quot;<span class="hljs-variable">$SSH_KEY</span>&quot;</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$PORT</span>&quot;</span> -o BatchMode=<span class="hljs-built_in">yes</span> -o ConnectTimeout=10 -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null <span class="hljs-string">&quot;<span class="hljs-variable">$SERVER</span>&quot;</span> <span class="hljs-string">&quot;echo &#x27;SSH连接测试&#x27;&quot;</span> &gt;/dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;FAILED:<span class="hljs-variable">$PROJECT_NAME</span>:SSH连接失败&quot;</span> &gt;&gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span><br><br><span class="hljs-built_in">return</span> 1<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># 备份现有目录</span><br><br><span class="hljs-keyword">if</span> ssh -i <span class="hljs-string">&quot;<span class="hljs-variable">$SSH_KEY</span>&quot;</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$PORT</span>&quot;</span> -o BatchMode=<span class="hljs-built_in">yes</span> -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null <span class="hljs-string">&quot;<span class="hljs-variable">$SERVER</span>&quot;</span> <span class="hljs-string">&quot;[ -d &#x27;<span class="hljs-variable">$TARGET_DIR</span>&#x27; ]&quot;</span>; <span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">local</span> backup_suffix=$(<span class="hljs-built_in">date</span> +%Y%m%d%H%M)<br><br><span class="hljs-built_in">local</span> dir_name=$(<span class="hljs-built_in">basename</span> <span class="hljs-string">&quot;<span class="hljs-variable">$TARGET_DIR</span>&quot;</span>)<br><br><span class="hljs-built_in">local</span> BACKUP_NAME=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;dir_name&#125;</span>_back<span class="hljs-variable">$&#123;backup_suffix&#125;</span>&quot;</span><br><br><span class="hljs-built_in">local</span> backup_path=$(<span class="hljs-built_in">dirname</span> <span class="hljs-string">&quot;<span class="hljs-variable">$TARGET_DIR</span>&quot;</span>)/<span class="hljs-variable">$BACKUP_NAME</span><br><br>ssh -i <span class="hljs-string">&quot;<span class="hljs-variable">$SSH_KEY</span>&quot;</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$PORT</span>&quot;</span> -o BatchMode=<span class="hljs-built_in">yes</span> -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null <span class="hljs-string">&quot;<span class="hljs-variable">$SERVER</span>&quot;</span> <span class="hljs-string">&quot;mv &#x27;<span class="hljs-variable">$TARGET_DIR</span>&#x27; &#x27;<span class="hljs-variable">$backup_path</span>&#x27;&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$PROJECT_NAME</span> -&gt; <span class="hljs-variable">$BACKUP_NAME</span>&quot;</span> &gt; <span class="hljs-string">&quot;/tmp/renamed_<span class="hljs-variable">$&#123;PROJECT_NAME&#125;</span>_$$.tmp&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># 执行rsync同步</span><br><br><span class="hljs-keyword">if</span> rsync -avz --delete --progress \<br><br>-e <span class="hljs-string">&quot;ssh -i <span class="hljs-variable">$SSH_KEY</span> -p <span class="hljs-variable">$PORT</span> -o BatchMode=yes -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null&quot;</span> \<br><br>--iconv=UTF-8-MAC,UTF-8 \<br><br>--partial \<br><br>--partial-dir=.rsync-partial \<br><br><span class="hljs-string">&quot;<span class="hljs-variable">$SRC_DIR</span>/&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$SERVER</span>:<span class="hljs-variable">$TARGET_DIR</span>/&quot;</span> &gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span> 2&gt;&amp;1; <span class="hljs-keyword">then</span><br><br><span class="hljs-comment"># 计算文件数量校验</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;计算文件数量...&quot;</span><br><br>local_file_count=$(find <span class="hljs-string">&quot;<span class="hljs-variable">$SRC_DIR</span>&quot;</span> -<span class="hljs-built_in">type</span> f \( -name <span class="hljs-string">&quot;.*&quot;</span> -o -name <span class="hljs-string">&quot;*.tmp&quot;</span> -o -name <span class="hljs-string">&quot;*.log&quot;</span> -o -name <span class="hljs-string">&quot;.DS_Store&quot;</span> \) -prune -o -<span class="hljs-built_in">type</span> f -<span class="hljs-built_in">print</span> | <span class="hljs-built_in">wc</span> -l)<br><br>remote_file_count=$(ssh -i <span class="hljs-string">&quot;<span class="hljs-variable">$SSH_KEY</span>&quot;</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$PORT</span>&quot;</span> -o BatchMode=<span class="hljs-built_in">yes</span> -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null <span class="hljs-string">&quot;<span class="hljs-variable">$SERVER</span>&quot;</span> <span class="hljs-string">&quot;find <span class="hljs-variable">$TARGET_DIR</span> -type f \( -name &#x27;.*&#x27; -o -name &#x27;*.tmp&#x27; -o -name &#x27;*.log&#x27; -o -name &#x27;.DS_Store&#x27; \) -prune -o -type f -print | wc -l&quot;</span> 2&gt;/dev/null)<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;本地文件数量: <span class="hljs-variable">$local_file_count</span>&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;远程文件数量: <span class="hljs-variable">$remote_file_count</span>&quot;</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-string">&quot;<span class="hljs-variable">$local_file_count</span>&quot;</span> == <span class="hljs-string">&quot;<span class="hljs-variable">$remote_file_count</span>&quot;</span> &amp;&amp; <span class="hljs-string">&quot;<span class="hljs-variable">$local_file_count</span>&quot;</span> -gt 0 ]]; <span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;✅ 文件数量匹配，部署成功&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;SUCCESS:<span class="hljs-variable">$PROJECT_NAME</span>:<span class="hljs-variable">$local_file_count</span>&quot;</span> &gt;&gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span><br><br><span class="hljs-keyword">else</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;❌ 文件数量不匹配，部署失败&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;FAILED:<span class="hljs-variable">$PROJECT_NAME</span>:文件数量不匹配 (本地:<span class="hljs-variable">$local_file_count</span>, 远程:<span class="hljs-variable">$remote_file_count</span>)&quot;</span> &gt;&gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span><br><br>exit_code=1<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">else</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;FAILED:<span class="hljs-variable">$PROJECT_NAME</span>:rsync同步失败&quot;</span> &gt;&gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span><br><br>exit_code=1<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-built_in">return</span> <span class="hljs-variable">$exit_code</span><br><br>&#125;<br><br>  <br><br><span class="hljs-comment"># 主程序开始</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;🚀 自动化部署脚本启动&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;📋 发现 <span class="hljs-variable">$PROJECT_COUNT</span> 个配置项目&quot;</span><br><br>  <br><br><span class="hljs-comment"># 用户选择部署方式</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;请选择部署方式：&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;a) 部署所有项目&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;s) 选择特定项目&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;q) 退出&quot;</span><br><br>  <br><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;请输入选择 (a/s/q): &quot;</span> choice<br><br>  <br><br><span class="hljs-keyword">case</span> <span class="hljs-variable">$choice</span> <span class="hljs-keyword">in</span><br><br>a) SELECTED_INDICES=$(<span class="hljs-built_in">seq</span> 0 $((PROJECT_COUNT - <span class="hljs-number">1</span>)));;<br><br>s)<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;可用项目：&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 0 $((PROJECT_COUNT - <span class="hljs-number">1</span>))); <span class="hljs-keyword">do</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$i</span>) <span class="hljs-subst">$(get_project_info $i name)</span>&quot;</span><br><br><span class="hljs-keyword">done</span><br><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;请输入项目编号（多个用空格分隔）: &quot;</span> -a indices<br><br>SELECTED_INDICES=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;indices[@]&#125;</span>&quot;</span><br><br>;;<br><br>q) <span class="hljs-built_in">exit</span> 0;;<br><br>*) red <span class="hljs-string">&quot;无效选择&quot;</span>; <span class="hljs-built_in">exit</span> 1;;<br><br><span class="hljs-keyword">esac</span><br><br>  <br><br><span class="hljs-comment"># 初始化变量</span><br><br>SUCCESS_COUNT=0<br><br>FAILED_COUNT=0<br><br>SUCCESS_PROJECTS=<span class="hljs-string">&quot;&quot;</span><br><br>FAILED_PROJECTS=<span class="hljs-string">&quot;&quot;</span><br><br>RENAMED_DETAILS=<span class="hljs-string">&quot;&quot;</span><br><br>FAILED_REASONS=()<br><br>MAX_CONCURRENT=3<br><br>current_jobs=0<br><br>job_pids=<span class="hljs-string">&quot;&quot;</span><br><br>job_names=<span class="hljs-string">&quot;&quot;</span><br><br>TOTAL_JOBS=$(<span class="hljs-built_in">echo</span> <span class="hljs-variable">$SELECTED_INDICES</span> | <span class="hljs-built_in">wc</span> -w)<br><br>  <br><br><span class="hljs-built_in">echo</span><br><br>blue <span class="hljs-string">&quot;开始部署 <span class="hljs-variable">$TOTAL_JOBS</span> 个项目...&quot;</span><br><br>  <br><br><span class="hljs-comment"># 部署所有选中的项目</span><br><br><span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-variable">$SELECTED_INDICES</span>; <span class="hljs-keyword">do</span><br><br><span class="hljs-comment"># 控制并发数</span><br><br><span class="hljs-keyword">while</span> [[ <span class="hljs-variable">$current_jobs</span> -ge <span class="hljs-variable">$MAX_CONCURRENT</span> ]]; <span class="hljs-keyword">do</span><br><br>wait_for_job<br><br><span class="hljs-keyword">done</span><br><br><span class="hljs-comment"># 启动新任务</span><br><br>deploy_project <span class="hljs-variable">$index</span> &amp;<br><br><span class="hljs-built_in">local</span> pid=$!<br><br>job_pids=<span class="hljs-string">&quot;<span class="hljs-variable">$job_pids</span> <span class="hljs-variable">$pid</span>&quot;</span><br><br>job_names=<span class="hljs-string">&quot;<span class="hljs-variable">$job_names</span> <span class="hljs-variable">$index</span>&quot;</span><br><br>current_jobs=$((current_jobs + <span class="hljs-number">1</span>))<br><br><span class="hljs-keyword">done</span><br><br>  <br><br><span class="hljs-comment"># 等待所有任务完成</span><br><br><span class="hljs-keyword">while</span> [[ <span class="hljs-variable">$current_jobs</span> -gt 0 ]]; <span class="hljs-keyword">do</span><br><br>wait_for_job<br><br><span class="hljs-keyword">done</span><br><br>  <br><br><span class="hljs-comment"># 显示最终结果</span><br><br><span class="hljs-built_in">echo</span><br><br><span class="hljs-keyword">if</span> [[ -n <span class="hljs-string">&quot;<span class="hljs-variable">$RENAMED_DETAILS</span>&quot;</span> ]]; <span class="hljs-keyword">then</span><br><br>blue <span class="hljs-string">&quot;📁 重命名备份的项目：<span class="hljs-variable">$RENAMED_DETAILS</span>&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br>  <br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$SUCCESS_COUNT</span> -gt 0 ]]; <span class="hljs-keyword">then</span><br><br>green <span class="hljs-string">&quot;✅ 部署成功的项目：<span class="hljs-variable">$SUCCESS_PROJECTS</span>&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br>  <br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$FAILED_COUNT</span> -gt 0 ]]; <span class="hljs-keyword">then</span><br><br>red <span class="hljs-string">&quot;❌ 部署失败的项目：<span class="hljs-variable">$FAILED_PROJECTS</span>&quot;</span><br><br><span class="hljs-built_in">echo</span><br><br>red <span class="hljs-string">&quot;失败原因：&quot;</span><br><br><span class="hljs-keyword">for</span> reason <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;FAILED_REASONS[@]&#125;</span>&quot;</span>; <span class="hljs-keyword">do</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; - <span class="hljs-variable">$reason</span>&quot;</span><br><br><span class="hljs-keyword">done</span><br><br><span class="hljs-keyword">fi</span><br><br>  <br><br><span class="hljs-comment"># 根据结果选择颜色</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$FAILED_COUNT</span> -eq 0 ]]; <span class="hljs-keyword">then</span><br><br>green <span class="hljs-string">&quot;部署完成！共部署 <span class="hljs-variable">$SUCCESS_COUNT</span> 个项目，失败 <span class="hljs-variable">$FAILED_COUNT</span> 个项目&quot;</span><br><br><span class="hljs-keyword">else</span><br><br>red <span class="hljs-string">&quot;部署完成！共部署 <span class="hljs-variable">$SUCCESS_COUNT</span> 个项目，失败 <span class="hljs-variable">$FAILED_COUNT</span> 个项目&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br></code></pre></td></tr></table></figure><h2 id="配置文件示例"><a href="#配置文件示例" class="headerlink" title="配置文件示例"></a>配置文件示例</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs json"><br><span class="hljs-punctuation">[</span><br><br><span class="hljs-punctuation">&#123;</span><br><br><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;前端项目&quot;</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;server&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;deploy@192.168.1.100&quot;</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2222</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;target_dir&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/var/www/frontend&quot;</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;src_dir&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dist/frontend&quot;</span><br><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-punctuation">&#123;</span><br><br><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;管理后台&quot;</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;server&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;deploy@192.168.1.100&quot;</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2222</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;target_dir&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/var/www/admin&quot;</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;src_dir&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dist/admin&quot;</span><br><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-punctuation">&#123;</span><br><br><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;API服务&quot;</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;server&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;deploy@192.168.1.101&quot;</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2222</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;target_dir&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/var/www/api&quot;</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;src_dir&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dist/api&quot;</span><br><br><span class="hljs-punctuation">&#125;</span><br><br><span class="hljs-punctuation">]</span><br><br></code></pre></td></tr></table></figure><p><strong>配置说明</strong>：</p><ul><li><p><code>name</code>: 项目名称，用于显示和日志记录</p></li><li><p><code>server</code>: 服务器地址，格式为 <code>用户@主机</code></p></li><li><p><code>port</code>: SSH端口号，建议使用非标准端口</p></li><li><p><code>target_dir</code>: 远程服务器上的目标目录</p></li><li><p><code>src_dir</code>: 本地源码目录，相对于脚本执行位置</p></li></ul><h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><h3 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1. 环境准备"></a>1. 环境准备</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment"># 安装依赖工具</span><br><br><span class="hljs-comment"># Ubuntu/Debian</span><br><br><span class="hljs-built_in">sudo</span> apt-get install rsync jq<br><br>  <br><br><span class="hljs-comment"># CentOS/RHEL</span><br><br><span class="hljs-built_in">sudo</span> yum install rsync jq<br><br>  <br><br><span class="hljs-comment"># macOS</span><br><br>brew install rsync jq<br><br></code></pre></td></tr></table></figure><h3 id="2-SSH密钥配置"><a href="#2-SSH密钥配置" class="headerlink" title="2. SSH密钥配置"></a>2. SSH密钥配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment"># 生成SSH密钥（如果还没有）</span><br><br>ssh-keygen -t rsa -b 4096<br><br>  <br><br><span class="hljs-comment"># 将公钥复制到服务器</span><br><br>ssh-copy-id user@server.example.com<br><br></code></pre></td></tr></table></figure><h3 id="3-配置文件设置"><a href="#3-配置文件设置" class="headerlink" title="3. 配置文件设置"></a>3. 配置文件设置</h3><p>在<code>scripts/deploy.json</code>中配置您的项目信息，注意脱敏处理：</p><ul><li><p>使用内网IP或域名替代公网IP</p></li><li><p>使用非标准端口</p></li><li><p>配置适当的用户权限</p></li></ul><h3 id="4-执行部署"><a href="#4-执行部署" class="headerlink" title="4. 执行部署"></a>4. 执行部署</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment"># 给脚本执行权限</span><br><br><span class="hljs-built_in">chmod</span> +x scripts/deploy.sh<br><br>  <br><br><span class="hljs-comment"># 执行部署</span><br><br>./scripts/deploy.sh<br><br></code></pre></td></tr></table></figure><h2 id="实际使用示例"><a href="#实际使用示例" class="headerlink" title="实际使用示例"></a>实际使用示例</h2><h3 id="1-脚本执行过程"><a href="#1-脚本执行过程" class="headerlink" title="1. 脚本执行过程"></a>1. 脚本执行过程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>$ ./scripts/deploy.sh<br><br>  <br><br>🚀 自动化部署脚本启动<br><br>📋 发现 3 个配置项目<br><br>  <br><br>请选择部署方式：<br><br>a) 部署所有项目<br><br>s) 选择特定项目<br><br>q) 退出<br><br>  <br><br>请输入选择 (a/s/q): a<br><br>  <br><br>开始部署 3 个项目...<br><br>  <br><br>[##################################################] 100%<br><br>  <br><br>📁 重命名备份的项目：前端项目 -&gt; frontend_back202412230145, 管理后台 -&gt; admin_back202412230145<br><br>✅ 部署成功的项目：前端项目 -&gt; 共1250个文件, 管理后台 -&gt; 共892个文件, API服务 -&gt; 共567个文件<br><br>部署完成！共部署 3 个项目，失败 0 个项目<br><br></code></pre></td></tr></table></figure><h3 id="2-选择性部署"><a href="#2-选择性部署" class="headerlink" title="2. 选择性部署"></a>2. 选择性部署</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>$ ./scripts/deploy.sh<br><br>  <br><br>🚀 自动化部署脚本启动<br><br>📋 发现 3 个配置项目<br><br>  <br><br>请选择部署方式：<br><br>a) 部署所有项目<br><br>s) 选择特定项目<br><br>q) 退出<br><br>  <br><br>请输入选择 (a/s/q): s<br><br>  <br><br>可用项目：<br><br>0) 前端项目<br><br>1) 管理后台<br><br>2) API服务<br><br>  <br><br>请输入项目编号（多个用空格分隔）: 0 2<br><br>  <br><br>开始部署 2 个项目...<br><br>  <br><br>[##################################################] 100%<br><br>  <br><br>✅ 部署成功的项目：前端项目 -&gt; 共1250个文件, API服务 -&gt; 共567个文件<br><br>部署完成！共部署 2 个项目，失败 0 个项目<br><br></code></pre></td></tr></table></figure><h3 id="3-部署失败处理"><a href="#3-部署失败处理" class="headerlink" title="3. 部署失败处理"></a>3. 部署失败处理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>$ ./scripts/deploy.sh<br><br>  <br><br>🚀 自动化部署脚本启动<br><br>📋 发现 3 个配置项目<br><br>  <br><br>请选择部署方式：<br><br>a) 部署所有项目<br><br>s) 选择特定项目<br><br>q) 退出<br><br>  <br><br>请输入选择 (a/s/q): a<br><br>  <br><br>开始部署 3 个项目...<br><br>  <br><br>[##################################################] 100%<br><br>  <br><br>✅ 部署成功的项目：前端项目 -&gt; 共1250个文件<br><br>❌ 部署失败的项目：管理后台, API服务<br><br>  <br><br>失败原因：<br><br>- 管理后台: SSH连接失败<br><br>- API服务: 源目录不存在 (dist/api)<br><br>  <br><br>部署完成！共部署 1 个项目，失败 2 个项目<br><br></code></pre></td></tr></table></figure><h2 id="脚本优势"><a href="#脚本优势" class="headerlink" title="脚本优势"></a>脚本优势</h2><h3 id="1-高效性"><a href="#1-高效性" class="headerlink" title="1. 高效性"></a>1. 高效性</h3><ul><li><p><strong>并发部署</strong>：多个项目同时进行，大幅提升效率</p></li><li><p><strong>断点续传</strong>：支持网络中断后继续传输</p></li><li><p><strong>增量同步</strong>：只传输变更的文件</p></li></ul><h3 id="2-可靠性"><a href="#2-可靠性" class="headerlink" title="2. 可靠性"></a>2. 可靠性</h3><ul><li><p><strong>智能备份</strong>：自动备份现有项目，避免数据丢失</p></li><li><p><strong>文件校验</strong>：部署完成后验证文件完整性</p></li><li><p><strong>错误处理</strong>：详细的错误信息和失败原因</p></li></ul><h3 id="3-易用性"><a href="#3-易用性" class="headerlink" title="3. 易用性"></a>3. 易用性</h3><ul><li><p><strong>配置驱动</strong>：通过JSON文件管理项目配置</p></li><li><p><strong>交互选择</strong>：支持全量或选择性部署</p></li><li><p><strong>进度显示</strong>：实时显示部署进度和状态</p></li></ul><h3 id="4-安全性"><a href="#4-安全性" class="headerlink" title="4. 安全性"></a>4. 安全性</h3><ul><li><p><strong>SSH密钥认证</strong>：避免密码明文传输</p></li><li><p><strong>批量模式</strong>：防止意外交互</p></li><li><p><strong>权限控制</strong>：支持不同用户和端口配置</p></li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这个自动化部署脚本通过合理的设计和实现，解决了传统部署方式中的效率低下、容易出错等问题。它支持多项目并发部署、智能备份、文件校验等企业级功能，大大提升了部署的效率和可靠性。</p><p>脚本采用模块化设计，每个功能都有清晰的职责划分，便于维护和扩展。通过配置文件驱动的方式，使得添加新项目变得非常简单。同时，详细的错误处理和状态反馈，让用户能够快速定位和解决问题。</p><p>在实际使用中，建议根据具体环境调整并发数量、SSH超时时间等参数，以获得最佳的性能和稳定性。</p><hr><p><em>本文详细介绍了从零构建企业级自动化部署脚本的完整过程，包括设计思路、实现细节和使用方法。希望对您的自动化部署实践有所帮助！</em></p>]]></content>
    
    
    <categories>
      
      <category>后端</category>
      
      <category>Shell</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Shell</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Rust入门</title>
    <link href="/posts/%E5%90%8E%E7%AB%AF/Rust/Rust%E5%85%A5%E9%97%A8/29388/"/>
    <url>/posts/%E5%90%8E%E7%AB%AF/Rust/Rust%E5%85%A5%E9%97%A8/29388/</url>
    
    <content type="html"><![CDATA[<h1 id="环境安装"><a href="#环境安装" class="headerlink" title="环境安装"></a>环境安装</h1><h2 id="RustRover安装"><a href="#RustRover安装" class="headerlink" title="RustRover安装"></a>RustRover安装</h2><p><a href="https://www.jetbrains.com/rust/">下载地址</a></p><h2 id="Rust安装"><a href="#Rust安装" class="headerlink" title="Rust安装"></a>Rust安装</h2><p>下载安装：</p><ul><li><a href="https://www.rust-lang.org/tools/install">RUSTUP-INIT.EXE</a></li><li><a href="https://visualstudio.microsoft.com/zh-hans/">Visual Studio C++ Build Tools</a></li><li>升级：<code>rustup update</code></li><li>卸载：<code>rustup self uninstall</code></li></ul><h1 id="基本语法和数据类型"><a href="#基本语法和数据类型" class="headerlink" title="基本语法和数据类型"></a>基本语法和数据类型</h1><h2 id="变量-可变性"><a href="#变量-可变性" class="headerlink" title="变量&amp;可变性"></a>变量&amp;可变性</h2><ul><li>声明变量<br>  <code>let some_number = 1;</code><br>  默认：变量是不可变的</li><li>声明可变变量<br>  <code>let mut another_number = 2;</code></li></ul><h2 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h2><ul><li>声明常量<br>  <code>const SPECIAL_NUMBER:i32 = 3;</code><br>  <code>const THREE_HOURS_IN_SECONDS:u32 = 60*60*3;</code><ul><li>使用<code>const</code>声明</li><li>不可以使用<code>mut</code></li><li>必须标注类型</li><li>可在任意作用域声明</li><li>仅可以使用常量表达式赋值</li></ul></li></ul><h2 id="变量遮蔽-Shadowing"><a href="#变量遮蔽-Shadowing" class="headerlink" title="变量遮蔽(Shadowing)"></a>变量遮蔽(Shadowing)</h2><p><code>let my_number = 1;</code><br><code>let my_number = 2;</code></p><ul><li>可以用之前变量相同的名字声明一个新变量：第一个变量被第二个变量“遮蔽”了</li><li>就是创建了一个新变量，只不过名字相同</li></ul><h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><h3 id="Interger-整数"><a href="#Interger-整数" class="headerlink" title="Interger 整数"></a>Interger 整数</h3><p><code>let my_number:i32 = 1;</code></p><table><thead><tr><th>Length长度</th><th>Signed有符号</th><th>Unsigned无符号</th></tr></thead><tbody><tr><td>8-bit</td><td>i8</td><td>u8</td></tr><tr><td>16-bit</td><td>i16</td><td>u16</td></tr><tr><td>32-bit</td><td>i32</td><td>u32</td></tr><tr><td>64-bit</td><td>i64</td><td>u64</td></tr><tr><td>128-bit</td><td>i128</td><td>u128</td></tr><tr><td>arch</td><td>isize</td><td>usize</td></tr></tbody></table><table><thead><tr><th>Number literals 数值字面值</th><th>示例</th></tr></thead><tbody><tr><td>Decimal 十进制</td><td>98_222</td></tr><tr><td>Hex 十六进制</td><td>0xff</td></tr><tr><td>Octal 八进制</td><td>0o77</td></tr><tr><td>Binary 二进制</td><td>0b1111_0000</td></tr><tr><td>Byte(u8 only) 字节</td><td>b’A’</td></tr></tbody></table><h3 id="Floating-Point-浮点"><a href="#Floating-Point-浮点" class="headerlink" title="Floating Point 浮点"></a>Floating Point 浮点</h3><p><code>let my_floating_point:f64 = 2.5;</code></p><ul><li>f32：4字节</li><li>f64：8字节</li><li>都有符号</li></ul><h3 id="Boolean-布尔"><a href="#Boolean-布尔" class="headerlink" title="Boolean 布尔"></a>Boolean 布尔</h3><p><code>let this_is_bool:bool = true;</code></p><ul><li>两个值：true，false</li><li>1字节</li></ul><h3 id="Character-字符"><a href="#Character-字符" class="headerlink" title="Character 字符"></a>Character 字符</h3><p><code>let this_is_chat:char = &#39;A&#39;;</code></p><ul><li>4字节</li><li>表示一个Unicode标量值</li></ul><h3 id="Tuple-元组"><a href="#Tuple-元组" class="headerlink" title="Tuple 元组"></a>Tuple 元组</h3><p><code>let my_tuple = (&#39;A&#39;,1,1.2);</code><br><code>my_tuple.0;</code></p><ul><li>固定长度</li><li>可包含不同类型的元素</li></ul><h3 id="Array数组"><a href="#Array数组" class="headerlink" title="Array数组"></a>Array数组</h3><p><code>let my_array =[1,2,3];</code><br><code>let a=[3;5]; // 5,5,5,5,5</code></p><ul><li>固定长度</li><li>元素类型相同</li></ul><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><ul><li>函数&amp;变量的命名规范：snakecase:</li><li>所有字母都小写；</li><li>单词之间用_连接；<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>()&#123;<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;Hello&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">demo</span>(val:<span class="hljs-type">i32</span>,unit:<span class="hljs-type">char</span>)&#123;<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;demo:&#123;&#125;&quot;</span>,val);<br><span class="hljs-keyword">return</span> val;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Control-Flow-控制流"><a href="#Control-Flow-控制流" class="headerlink" title="Control Flow 控制流"></a>Control Flow 控制流</h2><h3 id="if表达式"><a href="#if表达式" class="headerlink" title="if表达式"></a>if表达式</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>()&#123;<br><span class="hljs-keyword">let</span> <span class="hljs-variable">number</span> =<span class="hljs-number">3</span>;<br><span class="hljs-keyword">if</span> number &lt; <span class="hljs-number">5</span> &#123;<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;1&quot;</span>);<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> number % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>&#123;<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;2&quot;</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;3&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="循环-loop-while-for"><a href="#循环-loop-while-for" class="headerlink" title="循环 loop while for"></a>循环 loop while for</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>()&#123;<br><span class="hljs-keyword">loop</span> &#123;<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;loop&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>break: 停止loop</li><li>continue: 跳出本次迭代<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>()&#123;<br><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">number</span> = <span class="hljs-number">3</span>;<br><span class="hljs-keyword">while</span> number != <span class="hljs-number">0</span> &#123;<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;while number:&#123;number&#125;&quot;</span>);<br>number -= <span class="hljs-number">1</span>;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>()&#123;<br><span class="hljs-keyword">let</span> <span class="hljs-variable">a</span> = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>];<br><span class="hljs-keyword">for</span> <span class="hljs-variable">item</span> <span class="hljs-keyword">in</span> a &#123;<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;for item:&#123;item&#125;&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>()&#123;<br><span class="hljs-keyword">for</span> <span class="hljs-variable">item</span> <span class="hljs-keyword">in</span> (<span class="hljs-number">1</span>..<span class="hljs-number">4</span>).<span class="hljs-title function_ invoke__">rev</span>() &#123;<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;for Range:&#123;item&#125;&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>后端</category>
      
      <category>Rust</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Rust</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows安装WSL</title>
    <link href="/posts/%E5%90%8E%E7%AB%AF/Windows%E5%AE%89%E8%A3%85WSL/61426/"/>
    <url>/posts/%E5%90%8E%E7%AB%AF/Windows%E5%AE%89%E8%A3%85WSL/61426/</url>
    
    <content type="html"><![CDATA[<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs txt">wsl --install<br><br>jhy@JHY:~$ lsb_release -a<br>No LSB modules are available.<br>Distributor ID: Ubuntu<br>Description:    Ubuntu 24.04.2 LTS<br>Release:        24.04<br>Codename:       noble<br><br>wsl --export Ubuntu D:\jhy\WSL\wsl-ubuntu24.04.tar<br>wsl --unregister Ubuntu<br>wsl --import Ubuntu D:\jhy\WSL\wsl-ubuntu D:\jhy\WSL\wsl-ubuntu24.04.tar<br>wsl -d Ubuntu <br># 关闭<br>wsl --shutdown<br></code></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">sudo apt update<br>sudo apt upgrade<br></code></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs txt">sudo apt install nodejs npm<br><br>node --version<br>npm --version<br></code></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs txt">sudo npm install -g @anthropic-ai/claude-code<br>npm config set os linux<br><br>claude<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WSL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WSL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cursor插件栏改为纵向</title>
    <link href="/posts/%E5%89%8D%E7%AB%AF/Tools/Cursor%E6%8F%92%E4%BB%B6%E6%A0%8F%E6%94%B9%E4%B8%BA%E7%BA%B5%E5%90%91/32536/"/>
    <url>/posts/%E5%89%8D%E7%AB%AF/Tools/Cursor%E6%8F%92%E4%BB%B6%E6%A0%8F%E6%94%B9%E4%B8%BA%E7%BA%B5%E5%90%91/32536/</url>
    
    <content type="html"><![CDATA[<h1 id="修改-Cursor-插件栏改为纵向"><a href="#修改-Cursor-插件栏改为纵向" class="headerlink" title="修改 Cursor 插件栏改为纵向"></a>修改 Cursor 插件栏改为纵向</h1><ol><li><code>Ctrl+Shift+P</code>打开搜索<code>Open User Settings</code></li><li>设置中搜索：<code>workbench.activityBar.orientation</code>，修改为 <code>vertical</code> 即可。</li></ol>]]></content>
    
    
    <categories>
      
      <category>前端</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Cursor</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flutter不同终端屏幕适配</title>
    <link href="/posts/%E5%89%8D%E7%AB%AF/Flutter/Flutter%E4%B8%8D%E5%90%8C%E7%BB%88%E7%AB%AF%E5%B1%8F%E5%B9%95%E9%80%82%E9%85%8D/33879/"/>
    <url>/posts/%E5%89%8D%E7%AB%AF/Flutter/Flutter%E4%B8%8D%E5%90%8C%E7%BB%88%E7%AB%AF%E5%B1%8F%E5%B9%95%E9%80%82%E9%85%8D/33879/</url>
    
    <content type="html"><![CDATA[<h1 id="Flutter不同终端屏幕适配"><a href="#Flutter不同终端屏幕适配" class="headerlink" title="Flutter不同终端屏幕适配"></a>Flutter不同终端屏幕适配</h1><p><a href="https://github.com/OpenFlutter/flutter_screenutil/blob/master/README_CN.md">flutter_screenutil中文官方文档</a></p><h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h2><p>运行命令:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">flutter pub add flutter_screenutil<br></code></pre></td></tr></table></figure><p>运行以上命令会在<code>pubspec.yaml</code>中添加:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-string">...</span><br>  <span class="hljs-attr">flutter_screenutil:</span> <span class="hljs-string">^5.9.3</span><br></code></pre></td></tr></table></figure><h2 id="2-封装"><a href="#2-封装" class="headerlink" title="2. 封装"></a>2. 封装</h2><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_screenutil/flutter_screenutil.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:get/get.dart&#x27;</span>;<br><br><span class="hljs-comment">/// <span class="language-markdown">屏幕适配工具类</span></span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ScreenAdapter</span> </span>&#123;<br>  <span class="hljs-comment">/// <span class="language-markdown">初始化方法</span></span><br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> init(BuildContext context) &#123;<br>    ScreenUtil.init(<br>      context,<br>      designSize: _getDesignSize(context),<br>      minTextAdapt: <span class="hljs-keyword">true</span>,<br>      splitScreenMode: <span class="hljs-keyword">true</span>,<br>    );<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">根据屏幕方向获取设计尺寸</span></span><br>  <span class="hljs-keyword">static</span> Size _getDesignSize(BuildContext context) &#123;<br>    <span class="hljs-keyword">final</span> orientation = MediaQuery.of(context).orientation;<br>    <span class="hljs-keyword">return</span> orientation == Orientation.portrait<br>        ? <span class="hljs-keyword">const</span> Size(<span class="hljs-number">375</span>, <span class="hljs-number">812</span>) <span class="hljs-comment">// 竖屏设计尺寸</span><br>        : <span class="hljs-keyword">const</span> Size(<span class="hljs-number">812</span>, <span class="hljs-number">375</span>); <span class="hljs-comment">// 横屏设计尺寸</span><br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">宽度适配</span></span><br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> width(<span class="hljs-built_in">double</span> width) &#123;<br>    <span class="hljs-keyword">return</span> width.w;<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">高度适配</span></span><br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> height(<span class="hljs-built_in">double</span> height) &#123;<br>    <span class="hljs-keyword">return</span> height.h;<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">字体大小适配</span></span><br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> fontSize(<span class="hljs-built_in">double</span> fontSize) &#123;<br>    <span class="hljs-keyword">return</span> fontSize.sp;<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">获取屏幕宽度</span></span><br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> <span class="hljs-keyword">get</span> screenWidth =&gt; Get.width;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">获取屏幕高度</span></span><br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> <span class="hljs-keyword">get</span> screenHeight =&gt; Get.height;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">设备像素比</span></span><br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> <span class="hljs-keyword">get</span> pixelRatio =&gt; Get.pixelRatio;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">设备类型判断</span></span><br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-keyword">get</span> isPhone =&gt; screenWidth &lt; <span class="hljs-number">600</span>;<br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-keyword">get</span> isTablet =&gt; screenWidth &gt;= <span class="hljs-number">600</span> &amp;&amp; screenWidth &lt; <span class="hljs-number">1024</span>;<br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-keyword">get</span> isDesktop =&gt; screenWidth &gt;= <span class="hljs-number">1024</span>;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">响应式布局方法</span></span><br>  <span class="hljs-keyword">static</span> T responsive&lt;T&gt;(&#123;<br>    <span class="hljs-keyword">required</span> T phone,<br>    T? tablet,<br>    T? desktop,<br>  &#125;) &#123;<br>    <span class="hljs-keyword">if</span> (isDesktop &amp;&amp; desktop != <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> desktop;<br>    <span class="hljs-keyword">if</span> (isTablet &amp;&amp; tablet != <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> tablet;<br>    <span class="hljs-keyword">return</span> phone;<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">边距适配</span></span><br>  <span class="hljs-keyword">static</span> EdgeInsets padding(&#123;<br>    <span class="hljs-built_in">double?</span> all,<br>    <span class="hljs-built_in">double?</span> horizontal,<br>    <span class="hljs-built_in">double?</span> vertical,<br>    <span class="hljs-built_in">double?</span> left,<br>    <span class="hljs-built_in">double?</span> right,<br>    <span class="hljs-built_in">double?</span> top,<br>    <span class="hljs-built_in">double?</span> bottom,<br>  &#125;) &#123;<br>    <span class="hljs-keyword">return</span> EdgeInsets.only(<br>      left: (left ?? horizontal ?? all ?? <span class="hljs-number">0</span>).w,<br>      right: (right ?? horizontal ?? all ?? <span class="hljs-number">0</span>).w,<br>      top: (top ?? vertical ?? all ?? <span class="hljs-number">0</span>).h,<br>      bottom: (bottom ?? vertical ?? all ?? <span class="hljs-number">0</span>).h,<br>    );<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">圆角适配</span></span><br>  <span class="hljs-keyword">static</span> BorderRadius radius([<span class="hljs-built_in">double</span> radius = <span class="hljs-number">0</span>]) &#123;<br>    <span class="hljs-keyword">return</span> BorderRadius.circular(radius.r);<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">横竖屏切换监听（正确实现）</span></span><br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> addOrientationListener(VoidCallback callback) &#123;<br>    <span class="hljs-comment">// 使用 GetX 的 Workers 监听屏幕变化</span><br>    ever(Get.mediaQuery <span class="hljs-keyword">as</span> RxInterface&lt;<span class="hljs-built_in">Object?</span>&gt;, (_) =&gt; callback());<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">获取当前屏幕方向</span></span><br>  <span class="hljs-keyword">static</span> Orientation <span class="hljs-keyword">get</span> orientation =&gt; Get.mediaQuery.orientation;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>前端</category>
      
      <category>Flutter</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Flutter</tag>
      
      <tag>GetX</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>get_cli安装和使用</title>
    <link href="/posts/%E5%89%8D%E7%AB%AF/Flutter/GetX%E9%9B%86%E6%88%90/40222/"/>
    <url>/posts/%E5%89%8D%E7%AB%AF/Flutter/GetX%E9%9B%86%E6%88%90/40222/</url>
    
    <content type="html"><![CDATA[<h1 id="GetX集成"><a href="#GetX集成" class="headerlink" title="GetX集成"></a>GetX集成</h1><p><a href="https://github.com/jonataslaw/getx/blob/master/README.zh-cn.md">GetX中文官方文档</a></p><h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h2><p>运行命令:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">flutter pub add get<br></code></pre></td></tr></table></figure><p>运行以上命令会在<code>pubspec.yaml</code>中添加:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-string">...</span><br>  <span class="hljs-attr">get:</span> <span class="hljs-string">^4.6.5</span> <br></code></pre></td></tr></table></figure><h2 id="2-目录结构"><a href="#2-目录结构" class="headerlink" title="2. 目录结构"></a>2. 目录结构</h2><h3 id="2-1-GetX-Pattern"><a href="#2-1-GetX-Pattern" class="headerlink" title="2.1 GetX Pattern"></a>2.1 GetX Pattern</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">lib/<br>├─app/               <span class="hljs-comment"># 应用主目录（可选层级）</span><br>│  ├─data/           <span class="hljs-comment"># 数据层（可能存放模型或仓储）</span><br>│  ├─modules/        <span class="hljs-comment"># 模块化目录</span><br>│  │  └─home/        <span class="hljs-comment"># 首页模块</span><br>│  │     ├─bindings/ <span class="hljs-comment"># 依赖绑定</span><br>│  │     ├─controllers/ <span class="hljs-comment"># 控制器</span><br>│  │     └─views/    <span class="hljs-comment"># 页面UI</span><br>│  └─routes/         <span class="hljs-comment"># 路由配置</span><br>└─main.dart            <span class="hljs-comment"># 入口文件</span><br></code></pre></td></tr></table></figure><p>2.2 推荐混合结构</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">lib/<br>├─app/               <span class="hljs-comment"># 应用主目录（可选层级）</span><br>|  ├─controllers/    <span class="hljs-comment"># 全局控制器</span><br>|  ├─views/          <span class="hljs-comment"># 全局视图</span><br>|  ├─core/           <span class="hljs-comment"># 常量、工具、主题</span><br>│  |  ├─constants/<br>│  |  ├─utils/<br>│  |  └─themes/<br>│  ├─data/           <span class="hljs-comment"># 数据层（可能存放模型或仓储）</span><br>│  ├─modules/        <span class="hljs-comment"># 模块化目录</span><br>|  ├─services/       <span class="hljs-comment"># 全局服务</span><br>│  │  └─home/        <span class="hljs-comment"># 首页模块</span><br>│  │     ├─bindings/ <span class="hljs-comment"># 依赖绑定</span><br>│  │     ├─controllers/ <span class="hljs-comment"># 控制器</span><br>│  │     └─views/    <span class="hljs-comment"># 页面UI</span><br>│  └─routes/         <span class="hljs-comment"># 路由配置</span><br>└─main.dart            <span class="hljs-comment"># 入口文件</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>前端</category>
      
      <category>Flutter</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Flutter</tag>
      
      <tag>GetX</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>get_cli安装和使用</title>
    <link href="/posts/%E5%89%8D%E7%AB%AF/Flutter/get_cli%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/40222/"/>
    <url>/posts/%E5%89%8D%E7%AB%AF/Flutter/get_cli%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/40222/</url>
    
    <content type="html"><![CDATA[<h1 id="get-cli安装和使用"><a href="#get-cli安装和使用" class="headerlink" title="get_cli安装和使用"></a>get_cli安装和使用</h1><h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h2><p>运行命令:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">flutter pub global activate get_cli<br></code></pre></td></tr></table></figure><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs maxima">C:\Users\x&gt;flutter pub global <span class="hljs-built_in">activate</span> get_cli<br>Flutter assets will be downloaded from https://storage.flutter-io.cn. Make sure you trust this source!<br>Package get_cli <span class="hljs-built_in">is</span> currently active <span class="hljs-built_in">at</span> version <span class="hljs-number">1.8</span><span class="hljs-number">.4</span>.<br>Resolving <span class="hljs-built_in">dependencies</span>...<br>The package get_cli <span class="hljs-built_in">is</span> already activated <span class="hljs-built_in">at</span> newest available version.<br>To recompile executables, <span class="hljs-built_in">first</span> run `flutter pub global <span class="hljs-built_in">deactivate</span> get_cli`.<br>Installed executables <span class="hljs-built_in">get</span> <span class="hljs-keyword">and</span> getx.<br>Warning: Pub installs executables into C:\Users\x\AppData\Local\Pub\Cache\bin, which <span class="hljs-built_in">is</span> <span class="hljs-keyword">not</span> on your path.<br>You can <span class="hljs-built_in">fix</span> that by adding that <span class="hljs-built_in">directory</span> to your <span class="hljs-built_in">system</span>&#x27;s <span class="hljs-string">&quot;Path&quot;</span> environment variable.<br>A web search <span class="hljs-keyword">for</span> <span class="hljs-string">&quot;configure windows path&quot;</span> will <span class="hljs-built_in">show</span> you how.<br>Activated get_cli <span class="hljs-number">1.8</span><span class="hljs-number">.4</span>.<br><br>Windows:将 C:\Users\x\AppData\Local\Pub\Cache\bin 添加进环境变量 Path里<br></code></pre></td></tr></table></figure><h2 id="2-验证安装"><a href="#2-验证安装" class="headerlink" title="2. 验证安装"></a>2. 验证安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">C:\Users\x&gt;get -v<br>░██████╗░███████╗████████╗   ░█████╗░██╗░░░░░░██╗<br>██╔════╝░██╔════╝╚══██╔══╝   ██╔══██╗██║░░░░░░██║<br>██║░░██╗░█████╗░░░░░██║░░░   ██║░░╚═╝██║░░░░░░██║<br>██║░░╚██╗██╔══╝░░░░░██║░░░   ██║░░██╗██║░░░░░░██║<br>╚██████╔╝███████╗░░░██║░░░   ╚█████╔╝███████╗ ██║<br>░╚═════╝░╚══════╝░░░╚═╝░░░   ░╚════╝░╚══════╝ ╚═╝<br><br>Version: 1.8.4<br><br>Time: 66 Milliseconds<br></code></pre></td></tr></table></figure><h2 id="3-使用"><a href="#3-使用" class="headerlink" title="3. 使用"></a>3. 使用</h2><table><thead><tr><th>功能</th><th>命令</th><th>备注</th></tr></thead><tbody><tr><td>新建项目</td><td>get create project</td><td>新建一个项目，执行期间会选择几个属性，一路下去就行了</td></tr><tr><td>初始化</td><td>get init</td><td>新建项目里也会执行这步，清空lib文件夹内容，填充为初始的目录结构</td></tr><tr><td>创建页面</td><td>get create page:页面名字</td><td>会创建view, controller ，binding 和 routes</td></tr><tr><td>创建控制器</td><td>get create controller:test</td><td>指定文件夹不用写完整路径末级名字就行</td></tr><tr><td>创建控制器</td><td>get create controller:auth</td><td>用模版或者url创建控制器</td></tr><tr><td>创建view</td><td>get create view:name</td><td>创建view</td></tr><tr><td>国际化</td><td>get generate locales assets&#x2F;locales</td><td>需要在指定目录创建对应json文件</td></tr><tr><td>创建实体类</td><td>get generate model on home with assets&#x2F;models&#x2F;user.json</td><td>需要在指定目录创建对应json文件</td></tr></tbody></table><p>其他命令可参考官方文档: <a href="https://github.com/jonataslaw/get_cli/blob/master/README-zh_CN.md">get_cli中文官方文档</a></p>]]></content>
    
    
    <categories>
      
      <category>前端</category>
      
      <category>Flutter</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Flutter</tag>
      
      <tag>get_cli</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flutter GetX 实战&lt;小米商城&gt;</title>
    <link href="/posts/%E5%89%8D%E7%AB%AF/FlutterGetX%E5%AE%9E%E6%88%98/64979/"/>
    <url>/posts/%E5%89%8D%E7%AB%AF/FlutterGetX%E5%AE%9E%E6%88%98/64979/</url>
    
    <content type="html"><![CDATA[<h2 id="安装get-cli"><a href="#安装get-cli" class="headerlink" title="安装get_cli"></a>安装get_cli</h2><p><code>flutter pub global activate get_cli</code></p><p>临时: <code>flutter pub global activate -s git https://github.com/jonataslaw/get_cli</code></p><p>win: <code>安装路径添加进path环境变量</code></p><h2 id="集成"><a href="#集成" class="headerlink" title="集成"></a>集成</h2><p>创建完项目执行<code>get init</code></p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-symbol">E:</span>\CoreCode\GS\XDS\xmshop&gt;<span class="hljs-keyword">get</span> init<br>? Which architecture <span class="hljs-keyword">do</span> you want <span class="hljs-keyword">to</span> use? (Use arrow keys)<br>&gt; GetX Pattern (<span class="hljs-keyword">by</span> Kauê)<br>  CLEAN (<span class="hljs-keyword">by</span> Arktekko)<br>? 你的 <span class="hljs-keyword">lib</span> 文件夹不是空的。你确定要覆盖你的应用吗？ <br> 警告:操作不可逆 (Use arrow keys)<br>&gt; 是的!<br>  不<br>✓  <span class="hljs-comment">&#x27;Package: get 已安装！</span><br>✓  文件: main.dart 创建成功，路径: <span class="hljs-keyword">lib</span>\\main.dart<br>✓  文件: home_controller.dart 创建成功，路径: <span class="hljs-keyword">lib</span>\app\modules\home\\controllers\\home_controller.dart<br>✓  文件: home_view.dart 创建成功，路径: <span class="hljs-keyword">lib</span>\app\modules\home\\views\\home_view.dart<br>✓  文件: home_binding.dart 创建成功，路径: <span class="hljs-keyword">lib</span>\app\modules\home\\bindings\\home_binding.dart<br>✓  文件: app_routes.dart 创建成功，路径: <span class="hljs-keyword">lib</span>\\app\\routes\\app_routes.dart<br>✓  文件: app_pages.dart 创建成功，路径: <span class="hljs-keyword">lib</span>\\app\\routes\\app_pages.dart<br>✓  home route 创建成功.<br>✓  Home page 创建成功.<br>✓  GetX 结构生成成功。<br></code></pre></td></tr></table></figure><h3 id="get命令创建页面"><a href="#get命令创建页面" class="headerlink" title="get命令创建页面"></a>get命令创建页面</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">get</span> <span class="hljs-keyword">create</span> page:tabs<br><span class="hljs-keyword">get</span> <span class="hljs-keyword">create</span> page:home<br><span class="hljs-keyword">get</span> <span class="hljs-keyword">create</span> page:category<br><span class="hljs-keyword">get</span> <span class="hljs-keyword">create</span> page:service<br><span class="hljs-keyword">get</span> <span class="hljs-keyword">create</span> page:cart<br><span class="hljs-keyword">get</span> <span class="hljs-keyword">create</span> page:<span class="hljs-keyword">user</span><br><span class="hljs-keyword">get</span> <span class="hljs-keyword">create</span> page:serach<br></code></pre></td></tr></table></figure><h2 id="路由设置"><a href="#路由设置" class="headerlink" title="路由设置"></a>路由设置</h2><ol><li><p>优化页面路由 只留tabs</p></li><li><p>在tabs 的bindings里加载其他页面</p><p> <a href="E:\CoreCode\GS\XDS\xmshop\lib\app\modules\tabs\bindings\tabs_binding.dart">tabs_binding.dart</a> </p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:get/get.dart&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../controllers/tabs_controller.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../home/controllers/home_controller.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../category/controllers/category_controller.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../give/controllers/give_controller.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../cart/controllers/cart_controller.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../user/controllers/user_controller.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TabsBinding</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Bindings</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> dependencies() &#123;<br>    Get.lazyPut&lt;TabsController&gt;(<br>      () =&gt; TabsController(),<br>    );<br>    Get.lazyPut&lt;HomeController&gt;(<br>      () =&gt; HomeController(),<br>    );<br>    Get.lazyPut&lt;CategoryController&gt;(<br>      () =&gt; CategoryController(),<br>    );<br>    Get.lazyPut&lt;GiveController&gt;(<br>      () =&gt; GiveController(),<br>    );<br>    Get.lazyPut&lt;CartController&gt;(<br>      () =&gt; CartController(),<br>    );<br>    Get.lazyPut&lt;UserController&gt;(<br>      () =&gt; UserController(),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h2 id="配置tab切换"><a href="#配置tab切换" class="headerlink" title="配置tab切换"></a>配置tab切换</h2><p>   bottomNavigationBar</p>   <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:get/get.dart&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../controllers/tabs_controller.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TabsView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetView</span>&lt;<span class="hljs-title">TabsController</span>&gt; </span>&#123;<br>  <span class="hljs-keyword">const</span> TabsView(&#123;Key? key&#125;) : <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Obx(() =&gt; Scaffold(<br>          appBar: AppBar(<br>            title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&#x27;TabsView&#x27;</span>),<br>            centerTitle: <span class="hljs-keyword">true</span>,<br>          ),<br>          body: Text(<span class="hljs-string">&quot;tab&quot;</span>),<br>          bottomNavigationBar: BottomNavigationBar(<br>            fixedColor: Colors.red,<br>            currentIndex: controller.currentIndex.value,<br>            type: BottomNavigationBarType.fixed,<br>            onTap: (index) &#123;<br>              controller.setCurrentIndex(index);<br>            &#125;,<br>            items: <span class="hljs-keyword">const</span> [<br>              BottomNavigationBarItem(<br>                icon: Icon(Icons.home),<br>                label: <span class="hljs-string">&quot;首页&quot;</span>,<br>              ),<br>              BottomNavigationBarItem(<br>                icon: Icon(Icons.category),<br>                label: <span class="hljs-string">&quot;分类&quot;</span>,<br>              ),<br>              BottomNavigationBarItem(<br>                icon: Icon(Icons.room_service),<br>                label: <span class="hljs-string">&quot;服务&quot;</span>,<br>              ),<br>              BottomNavigationBarItem(<br>                icon: Icon(Icons.shopping_cart),<br>                label: <span class="hljs-string">&quot;购物车&quot;</span>,<br>              ),<br>              BottomNavigationBarItem(<br>                icon: Icon(Icons.people),<br>                label: <span class="hljs-string">&quot;我的&quot;</span>,<br>              )<br>            ],<br>          ),<br>        ));<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>   <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:get/get.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TabsController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetxController</span> </span>&#123;<br>  RxInt currentIndex = <span class="hljs-number">0</span>.obs;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> onInit() &#123;<br>    <span class="hljs-keyword">super</span>.onInit();<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> onClose() &#123;<br>    <span class="hljs-keyword">super</span>.onClose();<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> setCurrentIndex(index) &#123;<br>    currentIndex.value = index;<br>    update();<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="切换页面"><a href="#切换页面" class="headerlink" title="切换页面"></a>切换页面</h2>   <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:get/get.dart&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../controllers/tabs_controller.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TabsView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetView</span>&lt;<span class="hljs-title">TabsController</span>&gt; </span>&#123;<br>  <span class="hljs-keyword">const</span> TabsView(&#123;<span class="hljs-keyword">super</span>.key&#125;);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Obx(() =&gt; Scaffold(<br>          <span class="hljs-comment">// 简单切换页面</span><br>          <span class="hljs-comment">// body: controller.pages[controller.currentIndex.value],</span><br>          <span class="hljs-comment">// 可左右滑动切换</span><br>          body: PageView(<br>            controller: controller.pageController,<br>            children: controller.pages,<br>            onPageChanged: (index) &#123;<br>              controller.setCurrentIndex(index);<br>            &#125;,<br>          ),<br>          bottomNavigationBar: BottomNavigationBar(<br>            fixedColor: Colors.red,<br>            currentIndex: controller.currentIndex.value,<br>            type: BottomNavigationBarType.fixed,<br>            onTap: (index) &#123;<br>              controller.setCurrentIndex(index);<br>              controller.pageController.jumpToPage(index);<br>            &#125;,<br>            items: <span class="hljs-keyword">const</span> [<br>              BottomNavigationBarItem(<br>                icon: Icon(Icons.home),<br>                label: <span class="hljs-string">&quot;首页&quot;</span>,<br>              ),<br>              BottomNavigationBarItem(<br>                icon: Icon(Icons.category),<br>                label: <span class="hljs-string">&quot;分类&quot;</span>,<br>              ),<br>              BottomNavigationBarItem(<br>                icon: Icon(Icons.room_service),<br>                label: <span class="hljs-string">&quot;服务&quot;</span>,<br>              ),<br>              BottomNavigationBarItem(<br>                icon: Icon(Icons.shopping_cart),<br>                label: <span class="hljs-string">&quot;购物车&quot;</span>,<br>              ),<br>              BottomNavigationBarItem(<br>                icon: Icon(Icons.people),<br>                label: <span class="hljs-string">&quot;我的&quot;</span>,<br>              )<br>            ],<br>          ),<br>        ));<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>   <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:get/get.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../cart/views/cart_view.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../category/views/category_view.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../give/views/give_view.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../home/views/home_view.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../user/views/user_view.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TabsController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetxController</span> </span>&#123;<br>  <span class="hljs-comment">// 当前选中tab的索引</span><br>  RxInt currentIndex = <span class="hljs-number">0</span>.obs;<br><br>  <span class="hljs-comment">// 页面列表</span><br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;Widget&gt; pages = <span class="hljs-keyword">const</span> [<br>    HomeView(),<br>    CategoryView(),<br>    GiveView(),<br>    UserView(),<br>    CartView()<br>  ];<br><br>  PageController pageController = PageController(initialPage: <span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">void</span> setCurrentIndex(index) &#123;<br>    currentIndex.value = index;<br>    update();<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>   <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:get/get.dart&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../controllers/home_controller.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../../services/keepAliveWrapper.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetView</span>&lt;<span class="hljs-title">HomeController</span>&gt; </span>&#123;<br>  <span class="hljs-keyword">const</span> HomeView(&#123;<span class="hljs-keyword">super</span>.key&#125;);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-comment">// 页面缓存</span><br>    <span class="hljs-keyword">return</span> KeepAliveWrapper(<br>        child: Scaffold(<br>            appBar: AppBar(<br>              title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&#x27;HomeView&#x27;</span>),<br>              centerTitle: <span class="hljs-keyword">true</span>,<br>            ),<br>            body: ListView(<br>              children: <span class="hljs-keyword">const</span> [<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;2222&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;567567567566666666666666666666&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;567567567&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;5675675667567&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>              ],<br>            )));<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>   <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KeepAliveWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-keyword">const</span> KeepAliveWrapper(<br>      &#123;<span class="hljs-keyword">super</span>.key, <span class="hljs-meta">@required</span> <span class="hljs-keyword">this</span>.child, <span class="hljs-keyword">this</span>.keepAlive = <span class="hljs-keyword">true</span>&#125;);<br><br>  <span class="hljs-keyword">final</span> Widget? child;<br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> keepAlive;<br><br>  <span class="hljs-meta">@override</span><br>  State&lt;KeepAliveWrapper&gt; createState() =&gt; _KeepAliveWrapperState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_KeepAliveWrapperState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">KeepAliveWrapper</span>&gt;</span><br><span class="hljs-class">    <span class="hljs-title">with</span> <span class="hljs-title">AutomaticKeepAliveClientMixin</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> widget.child!;<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-built_in">bool</span> <span class="hljs-keyword">get</span> wantKeepAlive =&gt; widget.keepAlive;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="不同终端屏幕适配"><a href="#不同终端屏幕适配" class="headerlink" title="不同终端屏幕适配"></a>不同终端屏幕适配</h2><p><a href="https://pub.dev/packages/flutter_screenutil">https://pub.dev/packages/flutter_screenutil</a></p><p><a href="https://github.com/OpenFlutter/flutter_screenutil/blob/master/README_CN.md">https://github.com/OpenFlutter/flutter_screenutil/blob/master/README_CN.md</a></p><p>pubspec.yaml</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">dependencies:</span><br><span class="hljs-symbol">  flutter:</span><br><span class="hljs-symbol">    sdk:</span> flutter<br>  <span class="hljs-meta"># add flutter_screenutil</span><br><span class="hljs-symbol">  flutter_screenutil:</span> ^<span class="hljs-number">5.9</span><span class="hljs-number">.3</span><br></code></pre></td></tr></table></figure><p>使用的地方引入</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_screenutil/flutter_screenutil.dart&#x27;</span>;<br></code></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> main() =&gt; runApp(MyApp());<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-comment">//填入设计稿中设备的屏幕尺寸,单位dp</span><br>    <span class="hljs-keyword">return</span> ScreenUtilInit(<br>      designSize: <span class="hljs-keyword">const</span> Size(<span class="hljs-number">360</span>, <span class="hljs-number">690</span>),<br>      minTextAdapt: <span class="hljs-keyword">true</span>,<br>      splitScreenMode: <span class="hljs-keyword">true</span>,<br>      builder: (context , child) &#123;<br>        <span class="hljs-keyword">return</span> MaterialApp(<br>          debugShowCheckedModeBanner: <span class="hljs-keyword">false</span>,<br>          title: <span class="hljs-string">&#x27;First Method&#x27;</span>,<br>          <span class="hljs-comment">// You can use the library anywhere in the app even in theme</span><br>          theme: ThemeData(<br>            primarySwatch: Colors.blue,<br>            textTheme: Typography.englishLike2018.apply(fontSizeFactor: <span class="hljs-number">1</span>.sp),<br>          ),<br>          home: child,<br>        );<br>      &#125;,<br>      child: <span class="hljs-keyword">const</span> HomePage(title: <span class="hljs-string">&#x27;First Method&#x27;</span>),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="封装screenutil"><a href="#封装screenutil" class="headerlink" title="封装screenutil"></a>封装screenutil</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_screenutil/flutter_screenutil.dart&#x27;</span>;<br><br><span class="hljs-comment">/// <span class="language-markdown">屏幕适配</span></span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ScreenAdapter</span> </span>&#123;<br>  <span class="hljs-comment">/// <span class="language-markdown">获取对象的高度属性</span></span><br>  <span class="hljs-keyword">static</span> height(<span class="hljs-built_in">num</span> v) &#123;<br>    <span class="hljs-keyword">return</span> v.h;<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">获取对象的宽度属性</span></span><br>  <span class="hljs-keyword">static</span> width(<span class="hljs-built_in">num</span> v) &#123;<br>    <span class="hljs-keyword">return</span> v.w;<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">获取对象的字体大小属性</span></span><br>  <span class="hljs-keyword">static</span> fontSize(<span class="hljs-built_in">num</span> v) &#123;<br>    <span class="hljs-keyword">return</span> v.sp;<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">获取屏幕宽度</span></span><br>  <span class="hljs-keyword">static</span> getScreenWidth() &#123;<br>    <span class="hljs-comment">// return ScreenUtil().screenWidth;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>.sw;<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">获取屏幕高度</span></span><br>  <span class="hljs-keyword">static</span> getScreenHeight() &#123;<br>    <span class="hljs-comment">// return ScreenUtil().screenHeight;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>.sh;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="透明状态栏"><a href="#透明状态栏" class="headerlink" title="透明状态栏"></a>透明状态栏</h2><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// 配置透明的状态栏</span><br>SystemUiOverlayStyle systemUiOverlayStyle =<br>    <span class="hljs-keyword">const</span> SystemUiOverlayStyle(statusBarColor: Colors.transparent);<br>SystemChrome.setSystemUIOverlayStyle(systemUiOverlayStyle);<br></code></pre></td></tr></table></figure><h2 id="透明顶部导航-上下滑动切换动画"><a href="#透明顶部导航-上下滑动切换动画" class="headerlink" title="透明顶部导航 &amp; 上下滑动切换动画"></a>透明顶部导航 &amp; 上下滑动切换动画</h2><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// home_view.dart</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:get/get.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:xmshop/app/services/hyIcon.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:xmshop/app/services/screenAdapter.dart&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../controllers/home_controller.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../../services/keepAliveWrapper.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetView</span>&lt;<span class="hljs-title">HomeController</span>&gt; </span>&#123;<br>  <span class="hljs-keyword">const</span> HomeView(&#123;<span class="hljs-keyword">super</span>.key&#125;);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-comment">// 页面缓存</span><br>    <span class="hljs-keyword">return</span> KeepAliveWrapper(<br>        child: Scaffold(<br>            body: Stack(children: [<br>      ListView.builder(<br>          controller: controller.scrollController, <span class="hljs-comment">// 绑定控制器</span><br>          itemCount: <span class="hljs-number">20</span>,<br>          itemBuilder: (context, index) &#123;<br>            <span class="hljs-keyword">if</span> (index == <span class="hljs-number">0</span>) &#123;<br>              <span class="hljs-keyword">return</span> SizedBox(<br>                width: ScreenAdapter.width(<span class="hljs-number">1080</span>),<br>                height: ScreenAdapter.height(<span class="hljs-number">682</span>),<br>                child: Image.network(<br>                  <span class="hljs-string">&quot;https://www.itying.com/images/focus/focus02.png&quot;</span>,<br>                  fit: BoxFit.cover,<br>                ),<br>              );<br>            &#125;<br>            <span class="hljs-keyword">return</span> ListTile(title: Text(<span class="hljs-string">&#x27;第<span class="hljs-subst">$index</span>个元素&#x27;</span>));<br>          &#125;),<br>      Positioned(<br>          top: <span class="hljs-number">0</span>,<br>          left: <span class="hljs-number">0</span>,<br>          right: <span class="hljs-number">0</span>,<br>          child: Obx(() =&gt; AppBar(<br>                leading: controller.flag.value<br>                    ? <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&quot;&quot;</span>)<br>                    : <span class="hljs-keyword">const</span> Icon(<br>                        HyIcon.xiaomi,<br>                        color: Colors.white,<br>                      ),<br>                <span class="hljs-comment">// leading 宽度</span><br>                leadingWidth:<br>                    controller.flag.value ? <span class="hljs-number">10</span> : ScreenAdapter.width(<span class="hljs-number">140</span>),<br>                <span class="hljs-comment">// 动画容器</span><br>                title: AnimatedContainer(<br>                  <span class="hljs-comment">// 改变宽度</span><br>                  width: controller.flag.value<br>                      ? ScreenAdapter.width(<span class="hljs-number">800</span>)<br>                      : ScreenAdapter.width(<span class="hljs-number">620</span>),<br>                  height: ScreenAdapter.height(<span class="hljs-number">96</span>),<br>                  decoration: BoxDecoration(<br>                      color: <span class="hljs-keyword">const</span> Color.fromARGB(<span class="hljs-number">200</span>, <span class="hljs-number">241</span>, <span class="hljs-number">236</span>, <span class="hljs-number">225</span>),<br>                      borderRadius:<br>                          BorderRadius.circular(ScreenAdapter.width(<span class="hljs-number">50</span>))),<br>                  duration: <span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">300</span>),<br>                  child: Row(<br>                    crossAxisAlignment: CrossAxisAlignment.center,<br>                    children: [<br>                      Padding(<br>                        padding: EdgeInsets.fromLTRB(ScreenAdapter.width(<span class="hljs-number">34</span>), <span class="hljs-number">0</span>,<br>                            ScreenAdapter.width(<span class="hljs-number">10</span>), <span class="hljs-number">0</span>),<br>                        child: Icon(<br>                          Icons.search,<br>                          size: ScreenAdapter.fontSize(<span class="hljs-number">40</span>),<br>                        ),<br>                      ),<br>                      Text(<br>                        <span class="hljs-string">&quot;手机&quot;</span>,<br>                        style: TextStyle(<br>                            fontSize: ScreenAdapter.fontSize(<span class="hljs-number">32</span>),<br>                            color: Colors.black54),<br>                      )<br>                    ],<br>                  ),<br>                ),<br>                centerTitle: <span class="hljs-keyword">true</span>,<br>                backgroundColor:<br>                    controller.flag.value ? Colors.white : Colors.transparent,<br>                elevation: <span class="hljs-number">0</span>,<br>                actions: [<br>                  IconButton(<br>                      onPressed: () &#123;<br>                        Get.toNamed(<span class="hljs-string">&#x27;/cart&#x27;</span>);<br>                      &#125;,<br>                      icon: Icon(<br>                        Icons.qr_code,<br>                        color: controller.flag.value<br>                            ? Colors.black87<br>                            : Colors.white,<br>                      )),<br>                  IconButton(<br>                      onPressed: () &#123;<br>                        Get.toNamed(<span class="hljs-string">&#x27;/cart&#x27;</span>);<br>                      &#125;,<br>                      icon: Icon(<br>                        Icons.message,<br>                        color: controller.flag.value<br>                            ? Colors.black87<br>                            : Colors.white,<br>                      ))<br>                ],<br>              )))<br>    ])));<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// home_controller.dart</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:get/get.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetxController</span> </span>&#123;<br>  <span class="hljs-comment">// 滚动条控制器</span><br>  <span class="hljs-keyword">final</span> ScrollController scrollController = ScrollController();<br><br>  <span class="hljs-comment">// 开关</span><br>  <span class="hljs-keyword">final</span> RxBool flag = <span class="hljs-keyword">false</span>.obs;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> onInit() &#123;<br>    <span class="hljs-keyword">super</span>.onInit();<br>    <span class="hljs-comment">// 监听滚动条滚动</span><br>    scrollController.addListener(() &#123;<br>      <span class="hljs-comment">// 下拉高度大于10时，显示返回顶部按钮</span><br>      <span class="hljs-keyword">final</span> pixels = scrollController.position.pixels;<br>      <span class="hljs-comment">// 根据滚动位置更新 flag 值</span><br>      <span class="hljs-keyword">if</span> (pixels &gt;= <span class="hljs-number">10</span> &amp;&amp; !flag.value) &#123;<br>        flag.value = <span class="hljs-keyword">true</span>;<br>        update(); <span class="hljs-comment">// 显示返回顶部按钮</span><br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pixels &lt; <span class="hljs-number">10</span> &amp;&amp; flag.value) &#123;<br>        flag.value = <span class="hljs-keyword">false</span>;<br>        update(); <span class="hljs-comment">// 隐藏返回顶部按钮</span><br>      &#125;<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> onReady() &#123;<br>    <span class="hljs-keyword">super</span>.onReady();<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> onClose() &#123;<br>    <span class="hljs-keyword">super</span>.onClose();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="轮播图"><a href="#轮播图" class="headerlink" title="轮播图"></a>轮播图</h2><h3 id="swiper-插件"><a href="#swiper-插件" class="headerlink" title="swiper 插件"></a>swiper 插件</h3><p><a href="https://pub.dev/packages/flutter_swiper_view">https://pub.dev/packages/flutter_swiper_view</a></p><p><a href="https://github.com/feicien/flutter_swiper_view/blob/master/README-ZH.md">https://github.com/feicien/flutter_swiper_view/blob/master/README-ZH.md</a></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span> <br>  <span class="hljs-attr">flutter_swiper_view:</span> <span class="hljs-string">^1.1.8</span><br></code></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_swiper_view/flutter_swiper_view.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() =&gt; runApp(<span class="hljs-keyword">const</span> MyApp());<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-keyword">const</span> MyApp(&#123;Key? key&#125;) : <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> MaterialApp(<br>      title: <span class="hljs-string">&#x27;Flutter Demo&#x27;</span>,<br>      theme: ThemeData(<br>        primarySwatch: Colors.blue,<br>      ),<br>      home: <span class="hljs-keyword">const</span> MyHomePage(title: <span class="hljs-string">&#x27;Flutter Demo Home Page&#x27;</span>),<br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyHomePage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-keyword">const</span> MyHomePage(&#123;Key? key, <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.title&#125;) : <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> title;<br><br>  <span class="hljs-meta">@override</span><br>  State&lt;MyHomePage&gt; createState() =&gt; _MyHomePageState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_MyHomePageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">MyHomePage</span>&gt; </span>&#123;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(widget.title),<br>      ),<br>      body: Swiper(<br>        itemBuilder: (context, index)&#123;<br>          <span class="hljs-keyword">return</span> Image.network(<span class="hljs-string">&quot;https://via.placeholder.com/350x150&quot;</span>,fit: BoxFit.fill,);<br>        &#125;,<br>        itemCount: <span class="hljs-number">3</span>,<br>        pagination: <span class="hljs-keyword">const</span> SwiperPagination(),<br>        control: <span class="hljs-keyword">const</span> SwiperControl(),<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Dio-网络请求"><a href="#Dio-网络请求" class="headerlink" title="Dio 网络请求"></a>Dio 网络请求</h3><p><a href="https://pub.dev/packages/dio">https://pub.dev/packages/dio</a></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span> <br>  <span class="hljs-attr">dio:</span> <span class="hljs-string">^5.5.0+1</span><br></code></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">/// <span class="language-markdown">内容区域</span></span><br> Widget _homePage() &#123;<br>   <span class="hljs-keyword">return</span> Positioned(<br>       top: -<span class="hljs-number">40</span>,<br>       left: <span class="hljs-number">0</span>,<br>       right: <span class="hljs-number">0</span>,<br>       bottom: <span class="hljs-number">0</span>,<br>       <span class="hljs-comment">// https://www.itying.com/images/focus/focus02.png</span><br>       child: ListView(<br>         controller: controller.scrollController,<br>         children: [<br>           SizedBox(<br>             width: ScreenAdapter.getScreenWidth(),<br>             height: ScreenAdapter.height(<span class="hljs-number">682</span>),<br>             child: Obx(() =&gt; Swiper(<br>                   itemBuilder: (context, index) &#123;<br>                     <span class="hljs-built_in">String</span> picUrl =<br>                         <span class="hljs-string">&quot;https://miapp.itying.com/<span class="hljs-subst">$&#123;controller.swiperList[index][<span class="hljs-string">&#x27;pic&#x27;</span>]&#125;</span>&quot;</span>;<br>                     <span class="hljs-keyword">return</span> Image.network(<br>                       picUrl.replaceAll(<span class="hljs-string">&quot;\\&quot;</span>, <span class="hljs-string">&quot;/&quot;</span>),<br>                       fit: BoxFit.fill,<br>                     );<br>                   &#125;,<br>                   itemCount: controller.swiperList.length,<br><br>                   pagination:<br>                       <span class="hljs-keyword">const</span> SwiperPagination(builder: SwiperPagination.rect),<br>                   <span class="hljs-comment">// 自动轮播</span><br>                   autoplay: <span class="hljs-keyword">true</span>,<br>                   <span class="hljs-comment">// 循环轮播</span><br>                   loop: <span class="hljs-keyword">true</span>,<br>                   <span class="hljs-comment">// 动画切换时间</span><br>                   duration: <span class="hljs-number">2000</span>,<br>                 )),<br>           )<br>         ],<br>       ));<br> &#125;<br></code></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// controller</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:get/get.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:dio/dio.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetxController</span> </span>&#123;<br>  <span class="hljs-comment">// 滚动条控制器</span><br>  <span class="hljs-keyword">final</span> ScrollController scrollController = ScrollController();<br><br>  <span class="hljs-comment">// 浮动导航开关</span><br>  <span class="hljs-keyword">final</span> RxBool flag = <span class="hljs-keyword">false</span>.obs;<br><br>  <span class="hljs-comment">// https://miapp.itying.com/api/focus</span><br>  RxList swiperList = [].obs;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> onInit() &#123;<br>    <span class="hljs-keyword">super</span>.onInit();<br>    <span class="hljs-comment">// 监听滚动条滚动</span><br>    scrollControllerListener();<br>    <span class="hljs-comment">// 获取焦点数据</span><br>    getFocusData();<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">监听滚动条滚动</span></span><br>  scrollControllerListener() &#123;<br>    scrollController.addListener(() &#123;<br>      <span class="hljs-comment">// 下拉高度大于10时，显示返回顶部按钮</span><br>      <span class="hljs-keyword">final</span> pixels = scrollController.position.pixels;<br>      <span class="hljs-comment">// 根据滚动位置更新 flag 值</span><br>      <span class="hljs-keyword">if</span> (pixels &gt;= <span class="hljs-number">10</span> &amp;&amp; !flag.value) &#123;<br>        flag.value = <span class="hljs-keyword">true</span>;<br>        update(); <span class="hljs-comment">// 显示返回顶部按钮</span><br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pixels &lt; <span class="hljs-number">10</span> &amp;&amp; flag.value) &#123;<br>        flag.value = <span class="hljs-keyword">false</span>;<br>        update(); <span class="hljs-comment">// 隐藏返回顶部按钮</span><br>      &#125;<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">获取焦点数据</span></span><br>  getFocusData() <span class="hljs-keyword">async</span> &#123;<br>    <span class="hljs-keyword">var</span> response = <span class="hljs-keyword">await</span> Dio().<span class="hljs-keyword">get</span>(<span class="hljs-string">&quot;https://miapp.itying.com/api/focus&quot;</span>);<br>    swiperList.value = response.data[<span class="hljs-string">&quot;result&quot;</span>];<br>    update();<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="模型类"><a href="#模型类" class="headerlink" title="模型类"></a>模型类</h2><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">/// <span class="language-markdown">焦点数据模型</span></span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FocusModel</span> </span>&#123;<br>  <span class="hljs-built_in">String?</span> sId;<br>  <span class="hljs-built_in">String?</span> title;<br>  <span class="hljs-built_in">String?</span> status;<br>  <span class="hljs-built_in">String?</span> pic;<br>  <span class="hljs-built_in">String?</span> url;<br><br>  FocusModel(&#123;<span class="hljs-keyword">this</span>.sId, <span class="hljs-keyword">this</span>.title, <span class="hljs-keyword">this</span>.status, <span class="hljs-keyword">this</span>.pic, <span class="hljs-keyword">this</span>.url&#125;);<br><br>  FocusModel.fromJson(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; json) &#123;<br>    sId = json[<span class="hljs-string">&#x27;_id&#x27;</span>];<br>    title = json[<span class="hljs-string">&#x27;title&#x27;</span>];<br>    status = json[<span class="hljs-string">&#x27;status&#x27;</span>];<br>    pic = json[<span class="hljs-string">&#x27;pic&#x27;</span>];<br>    url = json[<span class="hljs-string">&#x27;url&#x27;</span>];<br>  &#125;<br><br>  <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; toJson() &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; data = &lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;&#123;&#125;;<br>    data[<span class="hljs-string">&#x27;_id&#x27;</span>] = sId;<br>    data[<span class="hljs-string">&#x27;title&#x27;</span>] = title;<br>    data[<span class="hljs-string">&#x27;status&#x27;</span>] = status;<br>    data[<span class="hljs-string">&#x27;pic&#x27;</span>] = pic;<br>    data[<span class="hljs-string">&#x27;url&#x27;</span>] = url;<br>    <span class="hljs-keyword">return</span> data;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="在线网站生成"><a href="#在线网站生成" class="headerlink" title="在线网站生成"></a>在线网站生成</h3><p><a href="https://autocode.icu/jsontodart">https://autocode.icu/jsontodart</a></p><h3 id="get-cli-生成"><a href="#get-cli-生成" class="headerlink" title="get_cli 生成"></a>get_cli 生成</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs verilog">get <span class="hljs-keyword">generate</span> model on models from <span class="hljs-string">&quot;https://miapp.itying.com/api/focus&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Focus</span> </span>&#123;<br>  <span class="hljs-built_in">List</span>&lt;Result&gt;? result;<br><br>  Focus(&#123;<span class="hljs-keyword">this</span>.result&#125;);<br><br>  Focus.fromJson(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; json) &#123;<br>    <span class="hljs-keyword">if</span> (json[<span class="hljs-string">&#x27;result&#x27;</span>] != <span class="hljs-keyword">null</span>) &#123;<br>      result = &lt;Result&gt;[];<br>      json[<span class="hljs-string">&#x27;result&#x27;</span>].forEach((v) &#123;<br>        result?.add(Result.fromJson(v));<br>      &#125;);<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; toJson() &#123;<br>    <span class="hljs-keyword">final</span> data = &lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;&#123;&#125;;<br>    <span class="hljs-keyword">if</span> (result != <span class="hljs-keyword">null</span>) &#123;<br>      data[<span class="hljs-string">&#x27;result&#x27;</span>] = result?.map((v) =&gt; v.toJson()).toList();<br>    &#125;<br>    <span class="hljs-keyword">return</span> data;<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Result</span> </span>&#123;<br>  <span class="hljs-built_in">String?</span> sId;<br>  <span class="hljs-built_in">String?</span> title;<br>  <span class="hljs-built_in">String?</span> status;<br>  <span class="hljs-built_in">String?</span> pic;<br>  <span class="hljs-built_in">String?</span> url;<br>  <span class="hljs-built_in">int?</span> position;<br><br>  Result(<br>      &#123;<span class="hljs-keyword">this</span>.sId, <span class="hljs-keyword">this</span>.title, <span class="hljs-keyword">this</span>.status, <span class="hljs-keyword">this</span>.pic, <span class="hljs-keyword">this</span>.url, <span class="hljs-keyword">this</span>.position&#125;);<br><br>  Result.fromJson(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; json) &#123;<br>    sId = json[<span class="hljs-string">&#x27;_id&#x27;</span>];<br>    title = json[<span class="hljs-string">&#x27;title&#x27;</span>];<br>    status = json[<span class="hljs-string">&#x27;status&#x27;</span>];<br>    pic = json[<span class="hljs-string">&#x27;pic&#x27;</span>];<br>    url = json[<span class="hljs-string">&#x27;url&#x27;</span>];<br>    position = json[<span class="hljs-string">&#x27;position&#x27;</span>];<br>  &#125;<br><br>  <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; toJson() &#123;<br>    <span class="hljs-keyword">final</span> data = &lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;&#123;&#125;;<br>    data[<span class="hljs-string">&#x27;_id&#x27;</span>] = sId;<br>    data[<span class="hljs-string">&#x27;title&#x27;</span>] = title;<br>    data[<span class="hljs-string">&#x27;status&#x27;</span>] = status;<br>    data[<span class="hljs-string">&#x27;pic&#x27;</span>] = pic;<br>    data[<span class="hljs-string">&#x27;url&#x27;</span>] = url;<br>    data[<span class="hljs-string">&#x27;position&#x27;</span>] = position;<br>    <span class="hljs-keyword">return</span> data;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="使用第三方库生成"><a href="#使用第三方库生成" class="headerlink" title="使用第三方库生成"></a>使用第三方库生成</h3><p><a href="https://doc.flutterchina.club/json/">https://doc.flutterchina.club/json/</a></p><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">/// <span class="language-markdown">获取焦点数据</span></span><br>  getFocusData() <span class="hljs-keyword">async</span> &#123;<br>    <span class="hljs-keyword">var</span> response = <span class="hljs-keyword">await</span> Dio().<span class="hljs-keyword">get</span>(<span class="hljs-string">&quot;https://miapp.itying.com/api/focus&quot;</span>);<br>    <span class="hljs-built_in">print</span>(response.data[<span class="hljs-string">&quot;result&quot;</span>]);<br>    FocusModel focusModel = FocusModel.fromJson(response.data);<br>    swiperList.value = focusModel.result!;<br>    update();<br>  &#125;<br><br><span class="hljs-built_in">String</span> picUrl = <span class="hljs-string">&quot;https://miapp.itying.com/<span class="hljs-subst">$&#123;controller.swiperList[index].pic&#125;</span>&quot;</span>;<br></code></pre></td></tr></table></figure><h2 id="轮播分类数据渲染"><a href="#轮播分类数据渲染" class="headerlink" title="轮播分类数据渲染"></a>轮播分类数据渲染</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 配置本地资源图片</span><br><span class="hljs-attr">flutter:</span><br>  <span class="hljs-attr">assets:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">assets/images/xiaomiBanner.png</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">assets/images/2.0x/xiaomiBanner.png</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">assets/images/3.0x/xiaomiBanner.png</span><br></code></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">/// <span class="language-markdown">分类</span></span><br>  Widget _category() &#123;<br>    <span class="hljs-keyword">return</span> SizedBox(<br>      width: ScreenAdapter.getScreenWidth(),<br>      height: ScreenAdapter.height(<span class="hljs-number">470</span>),<br>      child: Obx(() =&gt; Swiper(<br>            itemBuilder: (context, index) &#123;<br>              <span class="hljs-keyword">return</span> GridView.builder(<br>                  itemCount: <span class="hljs-number">10</span>,<br>                  gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(<br>                    crossAxisCount: <span class="hljs-number">5</span>,<br>                    crossAxisSpacing: ScreenAdapter.width(<span class="hljs-number">20</span>),<br>                    mainAxisSpacing: ScreenAdapter.height(<span class="hljs-number">20</span>),<br>                  ),<br>                  itemBuilder: (context, i) &#123;<br>                    <span class="hljs-keyword">return</span> Column(<br>                      children: [<br>                        Container(<br>                          alignment: Alignment.center,<br>                          width: ScreenAdapter.height(<span class="hljs-number">140</span>),<br>                          height: ScreenAdapter.height(<span class="hljs-number">140</span>),<br>                          child: Image.network(<br>                            <span class="hljs-string">&quot;https://miapp.itying.com/<span class="hljs-subst">$&#123;controller.categoryList[index * <span class="hljs-number">10</span> + i].pic&#125;</span>&quot;</span>,<br>                            fit: BoxFit.fitHeight,<br>                          ),<br>                        ),<br>                        Padding(<br>                          padding: EdgeInsets.fromLTRB(<br>                              <span class="hljs-number">0</span>, ScreenAdapter.height(<span class="hljs-number">4</span>), <span class="hljs-number">0</span>, <span class="hljs-number">0</span>),<br>                          child: Text(<br>                            <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;controller.categoryList[index * <span class="hljs-number">10</span> + i].title&#125;</span>&quot;</span>,<br>                            style:<br>                                TextStyle(fontSize: ScreenAdapter.fontSize(<span class="hljs-number">34</span>)),<br>                          ),<br>                        )<br>                      ],<br>                    );<br>                  &#125;);<br>            &#125;,<br>            itemCount: controller.categoryList.length ~/ <span class="hljs-number">10</span>, <span class="hljs-comment">// 取整</span><br>            <span class="hljs-comment">// 自定义指示器</span><br>            pagination: SwiperPagination(<br>              margin: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">0.0</span>),<br>              builder: SwiperCustomPagination(<br>                  builder: (BuildContext context, SwiperPluginConfig config) &#123;<br>                <span class="hljs-keyword">return</span> ConstrainedBox(<br>                    constraints:<br>                        BoxConstraints.expand(height: ScreenAdapter.height(<span class="hljs-number">20</span>)),<br>                    child: Row(<br>                      children: &lt;Widget&gt;[<br>                        Expanded(<br>                          child: Align(<br>                            alignment: Alignment.center,<br>                            child: <span class="hljs-keyword">const</span> RectSwiperPaginationBuilder(<br>                                    color: Colors.black12,<br>                                    activeColor: Colors.black54)<br>                                .build(context, config),<br>                          ),<br>                        )<br>                      ],<br>                    ));<br>              &#125;),<br>            ),<br>          )),<br>    );<br>  &#125;<br></code></pre></td></tr></table></figure><h2 id="封装Dio"><a href="#封装Dio" class="headerlink" title="封装Dio"></a>封装Dio</h2><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:dio/dio.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:fluttertoast/fluttertoast.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HttpsClient</span> </span>&#123;<br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">String</span> domain = <span class="hljs-string">&quot;https://miapp.itying.com/&quot;</span>;<br>  <span class="hljs-keyword">static</span> Dio dio = Dio();<br><br>  HttpsClient() &#123;<br>    BaseOptions options = BaseOptions();<br>    options.baseUrl = domain;<br>    <span class="hljs-comment">// 超时时间</span><br>    options.connectTimeout = <span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">5</span>);<br>    <span class="hljs-comment">// 接收数据超时时间</span><br>    options.receiveTimeout = <span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">5</span>);<br>    <span class="hljs-comment">// 响应数据格式</span><br>    options.responseType = ResponseType.json;<br>    dio.options = options;<br>  &#125;<br><br>  Future&lt;<span class="hljs-built_in">dynamic</span>&gt; <span class="hljs-keyword">get</span>(<span class="hljs-built_in">String</span> url) <span class="hljs-keyword">async</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">var</span> response = dio.<span class="hljs-keyword">get</span>(url);<br>      <span class="hljs-keyword">return</span> response;<br>    &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>      Fluttertoast.showToast(<br>          msg: <span class="hljs-string">&quot;请求数据异常&quot;</span>,<br>          toastLength: Toast.LENGTH_SHORT,<br>          gravity: ToastGravity.CENTER,<br>          timeInSecForIosWeb: <span class="hljs-number">1</span>,<br>          backgroundColor: Colors.red,<br>          textColor: Colors.white,<br>          fontSize: <span class="hljs-number">16.0</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">static</span> replaceUri(pic) &#123;<br>    <span class="hljs-built_in">String</span> picUrl = domain + pic;<br>    <span class="hljs-keyword">return</span> picUrl.replaceAll(<span class="hljs-string">&quot;\\&quot;</span>, <span class="hljs-string">&quot;/&quot;</span>);<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="封装GetX"><a href="#封装GetX" class="headerlink" title="封装GetX"></a>封装GetX</h2>]]></content>
    
    
    <categories>
      
      <category>前端</category>
      
      <category>Flutter</category>
      
      <category>Dart</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Flutter</tag>
      
      <tag>Getx</tag>
      
      <tag>Dio</tag>
      
      <tag>flutter_screenutil</tag>
      
      <tag>flutter_swiper_view</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo Fluid 文章</title>
    <link href="/posts/%E5%89%8D%E7%AB%AF/Hexo&amp;Fluid/34482/"/>
    <url>/posts/%E5%89%8D%E7%AB%AF/Hexo&amp;Fluid/34482/</url>
    
    <content type="html"><![CDATA[<h2 id="测试发布文章"><a href="#测试发布文章" class="headerlink" title="测试发布文章"></a>测试发布文章</h2><p><code>这是一篇测试发布文章。</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">quick_sort</span>(<span class="hljs-params">arr</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(arr) &lt;= <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> arr<br>    pivot = arr[<span class="hljs-number">0</span>]<br>    left = []<br>    right = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(arr)):<br>        <span class="hljs-keyword">if</span> arr[i] &lt; pivot:<br>            left.append(arr[i])<br>        <span class="hljs-keyword">else</span>:<br>            right.append(arr[i])<br>    <span class="hljs-keyword">return</span> quick_sort(left) + [pivot] + quick_sort(right)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>前端</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Fluid</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
