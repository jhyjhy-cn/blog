<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>企业级权限管理系统数据库设计-MySQL版本</title>
    <link href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/%E4%BC%81%E4%B8%9A%E7%BA%A7%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1-MySQL%E7%89%88%E6%9C%AC/30189/"/>
    <url>/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/%E4%BC%81%E4%B8%9A%E7%BA%A7%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1-MySQL%E7%89%88%E6%9C%AC/30189/</url>
    
    <content type="html"><![CDATA[<h1 id="企业级权限管理系统数据库设计-MySQL版本"><a href="#企业级权限管理系统数据库设计-MySQL版本" class="headerlink" title="企业级权限管理系统数据库设计-MySQL版本"></a>企业级权限管理系统数据库设计-MySQL版本</h1><p>本文档基于 [[企业级权限管理系统数据库设计]] 中的设计，提供 MySQL 8.0+ 版本的建表语句。</p><h2 id="1-数据库创建"><a href="#1-数据库创建" class="headerlink" title="1. 数据库创建"></a>1. 数据库创建</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 创建数据库</span><br><span class="hljs-keyword">CREATE</span> DATABASE IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> `rbac_system`<br><span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CHARACTER SET</span> utf8mb4<br><span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci;<br><br>USE `rbac_system`;<br></code></pre></td></tr></table></figure><h2 id="2-核心业务表"><a href="#2-核心业务表" class="headerlink" title="2. 核心业务表"></a>2. 核心业务表</h2><h3 id="2-1-部门表-sys-dept"><a href="#2-1-部门表-sys-dept" class="headerlink" title="2.1 部门表 (sys_dept)"></a>2.1 部门表 (sys_dept)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `sys_dept` (<br>  `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;部门ID&#x27;</span>,<br>  `dept_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;部门名称&#x27;</span>,<br>  `dept_code` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;部门编码&#x27;</span>,<br>  `parent_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;父部门ID&#x27;</span>,<br>  `leader_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;负责人用户ID&#x27;</span>,<br>  `leader_phone` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;负责人联系电话&#x27;</span>,<br>  `leader_email` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;负责人邮箱&#x27;</span>,<br>  `status` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;状态：0-禁用，1-正常&#x27;</span>,<br>  `sort` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;排序&#x27;</span>,<br>  `create_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>  `creator` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;创建人ID&#x27;</span>,<br>  `update_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;更新时间&#x27;</span>,<br>  `updater` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;更新人ID&#x27;</span>,<br>  `delete_flag` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;是否删除：0-否，1-是&#x27;</span>,<br>  `delete_at` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;删除时间&#x27;</span>,<br>  `version` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;乐观锁版本号&#x27;</span>,<br>  `tenant_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;租户ID&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_dept_code` (`dept_code`, `tenant_id`),<br>  KEY `idx_parent_id` (`parent_id`),<br>  KEY `idx_status` (`status`),<br>  KEY `idx_delete_flag` (`delete_flag`),<br>  KEY `idx_tenant_id` (`tenant_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;部门表&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="2-2-岗位表-sys-post"><a href="#2-2-岗位表-sys-post" class="headerlink" title="2.2 岗位表 (sys_post)"></a>2.2 岗位表 (sys_post)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `sys_post` (<br>  `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;岗位ID&#x27;</span>,<br>  `post_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;岗位名称&#x27;</span>,<br>  `post_code` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;岗位编码&#x27;</span>,<br>  `dept_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;所属部门ID&#x27;</span>,<br>  `sort` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;排序&#x27;</span>,<br>  `status` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;状态：0-禁用，1-正常&#x27;</span>,<br>  `create_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>  `creator` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;创建人ID&#x27;</span>,<br>  `update_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;更新时间&#x27;</span>,<br>  `updater` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;更新人ID&#x27;</span>,<br>  `delete_flag` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;是否删除：0-否，1-是&#x27;</span>,<br>  `delete_at` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;删除时间&#x27;</span>,<br>  `version` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;乐观锁版本号&#x27;</span>,<br>  `tenant_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;租户ID&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_post_code` (`post_code`, `tenant_id`),<br>  KEY `idx_dept_id` (`dept_id`),<br>  KEY `idx_status` (`status`),<br>  KEY `idx_delete_flag` (`delete_flag`),<br>  KEY `idx_tenant_id` (`tenant_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;岗位表&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="2-3-用户表-sys-user"><a href="#2-3-用户表-sys-user" class="headerlink" title="2.3 用户表 (sys_user)"></a>2.3 用户表 (sys_user)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `sys_user` (<br>  `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;用户ID&#x27;</span>,<br>  `username` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;用户名&#x27;</span>,<br>  `password` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;密码&#x27;</span>,<br>  `nickname` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;昵称&#x27;</span>,<br>  `real_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;真实姓名&#x27;</span>,<br>  `email` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;邮箱&#x27;</span>,<br>  `phone` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;手机号&#x27;</span>,<br>  `avatar` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;头像地址&#x27;</span>,<br>  `sex` <span class="hljs-type">CHAR</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;性别：0-未知，1-男，2-女&#x27;</span>,<br>  `birthday` <span class="hljs-type">DATE</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;生日&#x27;</span>,<br>  `dept_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;部门ID&#x27;</span>,<br>  `post_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;岗位ID&#x27;</span>,<br>  `address` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;地址&#x27;</span>,<br>  `remark` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;备注&#x27;</span>,<br>  `sort` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;排序&#x27;</span>,<br>  `status` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;状态：0-禁用，1-正常&#x27;</span>,<br>  `last_login_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;最后登录时间&#x27;</span>,<br>  `last_login_ip` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;最后登录IP&#x27;</span>,<br>  `create_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>  `creator` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;创建人ID&#x27;</span>,<br>  `update_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;更新时间&#x27;</span>,<br>  `updater` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;更新人ID&#x27;</span>,<br>  `delete_flag` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;是否删除：0-否，1-是&#x27;</span>,<br>  `delete_at` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;删除时间&#x27;</span>,<br>  `version` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;乐观锁版本号&#x27;</span>,<br>  `tenant_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;租户ID&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_username` (`username`, `tenant_id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_email` (`email`, `tenant_id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_phone` (`phone`, `tenant_id`),<br>  KEY `idx_dept_id` (`dept_id`),<br>  KEY `idx_post_id` (`post_id`),<br>  KEY `idx_status` (`status`),<br>  KEY `idx_delete_flag` (`delete_flag`),<br>  KEY `idx_tenant_id` (`tenant_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;用户表&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="2-4-角色表-sys-role"><a href="#2-4-角色表-sys-role" class="headerlink" title="2.4 角色表 (sys_role)"></a>2.4 角色表 (sys_role)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `sys_role` (<br>  `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;角色ID&#x27;</span>,<br>  `role_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;角色名称&#x27;</span>,<br>  `role_code` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;角色编码&#x27;</span>,<br>  `remark` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;备注&#x27;</span>,<br>  `data_scope` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;数据权限：1-全部，2-本部门，3-本部门及下级，4-自定义&#x27;</span>,<br>  `sort` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;排序&#x27;</span>,<br>  `status` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;状态：0-禁用，1-正常&#x27;</span>,<br>  `create_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>  `creator` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;创建人ID&#x27;</span>,<br>  `update_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;更新时间&#x27;</span>,<br>  `updater` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;更新人ID&#x27;</span>,<br>  `delete_flag` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;是否删除：0-否，1-是&#x27;</span>,<br>  `delete_at` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;删除时间&#x27;</span>,<br>  `version` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;乐观锁版本号&#x27;</span>,<br>  `tenant_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;租户ID&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_role_code` (`role_code`, `tenant_id`),<br>  KEY `idx_status` (`status`),<br>  KEY `idx_data_scope` (`data_scope`),<br>  KEY `idx_delete_flag` (`delete_flag`),<br>  KEY `idx_tenant_id` (`tenant_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;角色表&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="2-5-菜单表-sys-menu"><a href="#2-5-菜单表-sys-menu" class="headerlink" title="2.5 菜单表 (sys_menu)"></a>2.5 菜单表 (sys_menu)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `sys_menu` (<br>  `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;菜单ID&#x27;</span>,<br>  `menu_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;菜单名称&#x27;</span>,<br>  `menu_code` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;菜单编码/权限标识&#x27;</span>,<br>  `parent_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;父菜单ID&#x27;</span>,<br>  `menu_type` TINYINT <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;菜单类型：1-目录，2-菜单，3-按钮&#x27;</span>,<br>  `path` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;路由路径&#x27;</span>,<br>  `component` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;组件路径&#x27;</span>,<br>  `icon` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;图标&#x27;</span>,<br>  `permission` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;权限标识&#x27;</span>,<br>  `target` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;_self&#x27;</span> COMMENT <span class="hljs-string">&#x27;打开方式：_self-当前页，_blank-新页&#x27;</span>,<br>  `is_cache` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;是否缓存：0-否，1-是&#x27;</span>,<br>  `is_visible` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;是否显示：0-否，1-是&#x27;</span>,<br>  `is_external` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;是否外链：0-否，1-是&#x27;</span>,<br>  `sort` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;排序&#x27;</span>,<br>  `status` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;状态：0-禁用，1-正常&#x27;</span>,<br>  `create_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>  `creator` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;创建人ID&#x27;</span>,<br>  `update_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;更新时间&#x27;</span>,<br>  `updater` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;更新人ID&#x27;</span>,<br>  `delete_flag` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;是否删除：0-否，1-是&#x27;</span>,<br>  `delete_at` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;删除时间&#x27;</span>,<br>  `version` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;乐观锁版本号&#x27;</span>,<br>  `tenant_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;租户ID&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_menu_code` (`menu_code`, `tenant_id`),<br>  KEY `idx_parent_id` (`parent_id`),<br>  KEY `idx_menu_type` (`menu_type`),<br>  KEY `idx_status` (`status`),<br>  KEY `idx_delete_flag` (`delete_flag`),<br>  KEY `idx_tenant_id` (`tenant_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;菜单表&#x27;</span>;<br></code></pre></td></tr></table></figure><h2 id="3-关联表"><a href="#3-关联表" class="headerlink" title="3. 关联表"></a>3. 关联表</h2><h3 id="3-1-用户角色关联表-sys-user-role"><a href="#3-1-用户角色关联表-sys-user-role" class="headerlink" title="3.1 用户角色关联表 (sys_user_role)"></a>3.1 用户角色关联表 (sys_user_role)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `sys_user_role` (<br>  `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;主键ID&#x27;</span>,<br>  `user_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;用户ID&#x27;</span>,<br>  `role_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;角色ID&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_user_role` (`user_id`, `role_id`),<br>  KEY `idx_user_id` (`user_id`),<br>  KEY `idx_role_id` (`role_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;用户角色关联表&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="3-2-角色菜单关联表-sys-role-menu"><a href="#3-2-角色菜单关联表-sys-role-menu" class="headerlink" title="3.2 角色菜单关联表 (sys_role_menu)"></a>3.2 角色菜单关联表 (sys_role_menu)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `sys_role_menu` (<br>  `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;主键ID&#x27;</span>,<br>  `role_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;角色ID&#x27;</span>,<br>  `menu_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;菜单ID&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_role_menu` (`role_id`, `menu_id`),<br>  KEY `idx_role_id` (`role_id`),<br>  KEY `idx_menu_id` (`menu_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;角色菜单关联表&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="3-3-角色部门关联表-sys-role-dept"><a href="#3-3-角色部门关联表-sys-role-dept" class="headerlink" title="3.3 角色部门关联表 (sys_role_dept)"></a>3.3 角色部门关联表 (sys_role_dept)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `sys_role_dept` (<br>  `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;主键ID&#x27;</span>,<br>  `role_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;角色ID&#x27;</span>,<br>  `dept_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;部门ID&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_role_dept` (`role_id`, `dept_id`),<br>  KEY `idx_role_id` (`role_id`),<br>  KEY `idx_dept_id` (`dept_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;角色部门关联表&#x27;</span>;<br></code></pre></td></tr></table></figure><h2 id="4-日志表"><a href="#4-日志表" class="headerlink" title="4. 日志表"></a>4. 日志表</h2><h3 id="4-1-登录日志表-sys-login-log"><a href="#4-1-登录日志表-sys-login-log" class="headerlink" title="4.1 登录日志表 (sys_login_log)"></a>4.1 登录日志表 (sys_login_log)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `sys_login_log` (<br>  `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;日志ID&#x27;</span>,<br>  `username` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;用户名&#x27;</span>,<br>  `user_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;用户ID&#x27;</span>,<br>  `ipaddr` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;登录IP地址&#x27;</span>,<br>  `login_location` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;登录地点&#x27;</span>,<br>  `browser` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;浏览器类型&#x27;</span>,<br>  `os` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;操作系统&#x27;</span>,<br>  `device` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;设备类型&#x27;</span>,<br>  `status` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;登录状态：0-失败，1-成功&#x27;</span>,<br>  `msg` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;提示信息&#x27;</span>,<br>  `login_time` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;登录时间&#x27;</span>,<br>  `create_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`id`),<br>  KEY `idx_user_id` (`user_id`),<br>  KEY `idx_username` (`username`),<br>  KEY `idx_login_time` (`login_time`),<br>  KEY `idx_username_time` (`username`, `login_time`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;登录日志表&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="4-2-操作日志表-sys-operation-log"><a href="#4-2-操作日志表-sys-operation-log" class="headerlink" title="4.2 操作日志表 (sys_operation_log)"></a>4.2 操作日志表 (sys_operation_log)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `sys_operation_log` (<br>  `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;日志ID&#x27;</span>,<br>  `title` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;操作模块&#x27;</span>,<br>  `business_type` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;业务类型（0-其他 1-新增 2-修改 3-删除）&#x27;</span>,<br>  `business_type_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;业务类型名称&#x27;</span>,<br>  `<span class="hljs-keyword">method</span>` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;请求方式&#x27;</span>,<br>  `request_method` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;请求类型&#x27;</span>,<br>  `operator_type` TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;操作类别（0-其它 1-后台用户 2-手机端用户）&#x27;</span>,<br>  `operator_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;操作人员&#x27;</span>,<br>  `dept_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;部门名称&#x27;</span>,<br>  `operation_url` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;请求URL&#x27;</span>,<br>  `operation_ip` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;操作地址&#x27;</span>,<br>  `operation_location` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;操作地点&#x27;</span>,<br>  `operation_param` TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;请求参数&#x27;</span>,<br>  `json_result` TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;返回参数&#x27;</span>,<br>  `operation_status` TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;操作状态：0-正常，1-异常&#x27;</span>,<br>  `error_msg` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">2000</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;错误消息&#x27;</span>,<br>  `operation_time` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;操作时间&#x27;</span>,<br>  `cost_time` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;消耗时间&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`id`),<br>  KEY `idx_user_id` (`operator_name`),<br>  KEY `idx_operation_time` (`operation_time`),<br>  KEY `idx_business_type` (`business_type`),<br>  KEY `idx_operation_status` (`operation_status`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;操作日志表&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="4-3-错误日志表-sys-error-log"><a href="#4-3-错误日志表-sys-error-log" class="headerlink" title="4.3 错误日志表 (sys_error_log)"></a>4.3 错误日志表 (sys_error_log)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `sys_error_log` (<br>  `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;日志ID&#x27;</span>,<br>  `title` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;错误标题&#x27;</span>,<br>  `request_uri` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;请求URL&#x27;</span>,<br>  `request_method` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;请求方式&#x27;</span>,<br>  `request_params` TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;请求参数&#x27;</span>,<br>  `user_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;用户ID&#x27;</span>,<br>  `username` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;用户名&#x27;</span>,<br>  `user_ip` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;操作IP地址&#x27;</span>,<br>  `user_agent` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;用户代理&#x27;</span>,<br>  `exception_info` TEXT <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;错误消息&#x27;</span>,<br>  `exception_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;异常名称&#x27;</span>,<br>  `stack_trace` TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;错误堆栈&#x27;</span>,<br>  `line_number` <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;错误行号&#x27;</span>,<br>  `class_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;Java类名&#x27;</span>,<br>  `method_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;方法名&#x27;</span>,<br>  `status` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;状态&#x27;</span>,<br>  `process_user_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;处理人ID&#x27;</span>,<br>  `process_user_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;处理人&#x27;</span>,<br>  `process_remark` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;处理备注&#x27;</span>,<br>  `process_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;处理时间&#x27;</span>,<br>  `create_time` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`id`),<br>  KEY `idx_user_id` (`user_id`),<br>  KEY `idx_create_time` (`create_time`),<br>  KEY `idx_status` (`status`),<br>  KEY `idx_exception_name` (`exception_name`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;错误日志表&#x27;</span>;<br></code></pre></td></tr></table></figure><h2 id="5-租户管理表"><a href="#5-租户管理表" class="headerlink" title="5. 租户管理表"></a>5. 租户管理表</h2><h3 id="5-1-租户表-sys-tenant"><a href="#5-1-租户表-sys-tenant" class="headerlink" title="5.1 租户表 (sys_tenant)"></a>5.1 租户表 (sys_tenant)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `sys_tenant` (<br>  `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;租户ID&#x27;</span>,<br>  `tenant_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;租户名称&#x27;</span>,<br>  `tenant_code` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;租户编码&#x27;</span>,<br>  `contact_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">30</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;联系人&#x27;</span>,<br>  `contact_phone` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;联系电话&#x27;</span>,<br>  `contact_email` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;联系邮箱&#x27;</span>,<br>  `company_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;企业名称&#x27;</span>,<br>  `domain` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;域名&#x27;</span>,<br>  `address` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;地址&#x27;</span>,<br>  `phone` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;电话&#x27;</span>,<br>  `email` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;邮箱&#x27;</span>,<br>  `package_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;套餐ID&#x27;</span>,<br>  `expire_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;到期时间&#x27;</span>,<br>  `account_count` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;账号数量&#x27;</span>,<br>  `sort` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;排序&#x27;</span>,<br>  `status` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;状态：0-禁用，1-正常&#x27;</span>,<br>  `create_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>  `creator` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;创建人ID&#x27;</span>,<br>  `update_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;更新时间&#x27;</span>,<br>  `updater` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;更新人ID&#x27;</span>,<br>  `delete_flag` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;是否删除：0-否，1-是&#x27;</span>,<br>  `delete_at` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;删除时间&#x27;</span>,<br>  `version` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;乐观锁版本号&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_tenant_code` (`tenant_code`),<br>  KEY `idx_package_id` (`package_id`),<br>  KEY `idx_status` (`status`),<br>  KEY `idx_delete_flag` (`delete_flag`),<br>  KEY `idx_expire_time` (`expire_time`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;租户表&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="5-2-租户套餐表-sys-tenant-package"><a href="#5-2-租户套餐表-sys-tenant-package" class="headerlink" title="5.2 租户套餐表 (sys_tenant_package)"></a>5.2 租户套餐表 (sys_tenant_package)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `sys_tenant_package` (<br>  `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;套餐ID&#x27;</span>,<br>  `package_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;套餐名称&#x27;</span>,<br>  `package_code` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;套餐编码&#x27;</span>,<br>  `max_users` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">10</span> COMMENT <span class="hljs-string">&#x27;最大用户数&#x27;</span>,<br>  `max_storage` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1073741824</span> COMMENT <span class="hljs-string">&#x27;最大存储空间（字节）&#x27;</span>,<br>  `price` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0.00</span> COMMENT <span class="hljs-string">&#x27;价格&#x27;</span>,<br>  `cycle_unit` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;计费周期：1-月，2-季，3-年&#x27;</span>,<br>  `features` TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;功能特性（JSON格式）&#x27;</span>,<br>  `description` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;套餐描述&#x27;</span>,<br>  `status` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;状态：0-禁用，1-正常&#x27;</span>,<br>  `sort_order` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;排序&#x27;</span>,<br>  `create_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>  `creator` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;创建人ID&#x27;</span>,<br>  `update_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;更新时间&#x27;</span>,<br>  `updater` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;更新人ID&#x27;</span>,<br>  `delete_flag` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;是否删除：0-否，1-是&#x27;</span>,<br>  `delete_at` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;删除时间&#x27;</span>,<br>  `version` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;乐观锁版本号&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_package_code` (`package_code`),<br>  KEY `idx_status` (`status`),<br>  KEY `idx_delete_flag` (`delete_flag`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;租户套餐表&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="5-3-租户配置表-sys-tenant-config"><a href="#5-3-租户配置表-sys-tenant-config" class="headerlink" title="5.3 租户配置表 (sys_tenant_config)"></a>5.3 租户配置表 (sys_tenant_config)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `sys_tenant_config` (<br>  `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;配置ID&#x27;</span>,<br>  `tenant_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;租户ID&#x27;</span>,<br>  `config_key` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;配置键&#x27;</span>,<br>  `config_value` TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;配置值&#x27;</span>,<br>  `config_type` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;系统内置（0-否 1-是）&#x27;</span>,<br>  `is_encrypted` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;是否加密（0-否 1-是）&#x27;</span>,<br>  `remark` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;备注&#x27;</span>,<br>  `create_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>  `creator` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;创建人ID&#x27;</span>,<br>  `update_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;更新时间&#x27;</span>,<br>  `updater` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;更新人ID&#x27;</span>,<br>  `delete_flag` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;是否删除：0-否，1-是&#x27;</span>,<br>  `delete_at` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;删除时间&#x27;</span>,<br>  `version` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;乐观锁版本号&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_tenant_key` (`tenant_id`, `config_key`),<br>  KEY `idx_tenant_id` (`tenant_id`),<br>  KEY `idx_config_key` (`config_key`),<br>  KEY `idx_config_type` (`config_type`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;租户配置表&#x27;</span>;<br></code></pre></td></tr></table></figure><h2 id="6-系统配置表"><a href="#6-系统配置表" class="headerlink" title="6. 系统配置表"></a>6. 系统配置表</h2><h3 id="6-1-字典类型表-sys-dict-type"><a href="#6-1-字典类型表-sys-dict-type" class="headerlink" title="6.1 字典类型表 (sys_dict_type)"></a>6.1 字典类型表 (sys_dict_type)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `sys_dict_type` (<br>  `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;字典主键&#x27;</span>,<br>  `dict_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;字典名称&#x27;</span>,<br>  `dict_type` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;字典类型&#x27;</span>,<br>  `sort` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;排序&#x27;</span>,<br>  `status` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;状态（0正常 1停用）&#x27;</span>,<br>  `create_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>  `creator` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;创建人&#x27;</span>,<br>  `update_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;更新时间&#x27;</span>,<br>  `updater` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;更新人&#x27;</span>,<br>  `delete_flag` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;是否删除&#x27;</span>,<br>  `delete_at` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;删除时间&#x27;</span>,<br>  `version` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;乐观锁版本号&#x27;</span>,<br>  `remark` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;备注&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_dict_type` (`dict_type`),<br>  KEY `idx_status` (`status`),<br>  KEY `idx_delete_flag` (`delete_flag`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;字典类型表&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="6-2-字典数据表-sys-dict-data"><a href="#6-2-字典数据表-sys-dict-data" class="headerlink" title="6.2 字典数据表 (sys_dict_data)"></a>6.2 字典数据表 (sys_dict_data)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `sys_dict_data` (<br>  `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;数据编号&#x27;</span>,<br>  `dict_sort` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;字典排序&#x27;</span>,<br>  `dict_label` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;字典标签&#x27;</span>,<br>  `dict_value` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;字典键值&#x27;</span>,<br>  `dict_type` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;字典类型&#x27;</span>,<br>  `css_class` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;表格回显样式&#x27;</span>,<br>  `list_class` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;表格列表样式&#x27;</span>,<br>  `is_default` <span class="hljs-type">CHAR</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;N&#x27;</span> COMMENT <span class="hljs-string">&#x27;是否默认（Y是 N否）&#x27;</span>,<br>  `sort` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;排序&#x27;</span>,<br>  `status` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;状态（0正常 1停用）&#x27;</span>,<br>  `create_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>  `creator` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;创建人&#x27;</span>,<br>  `update_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;更新时间&#x27;</span>,<br>  `updater` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;更新人&#x27;</span>,<br>  `delete_flag` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;是否删除&#x27;</span>,<br>  `delete_at` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;删除时间&#x27;</span>,<br>  `version` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;乐观锁版本号&#x27;</span>,<br>  `remark` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;备注&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`id`),<br>  KEY `idx_dict_type_status` (`dict_type`, `status`),<br>  KEY `idx_dict_sort` (`dict_sort`),<br>  KEY `idx_delete_flag` (`delete_flag`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;字典数据表&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="6-3-参数配置表-sys-params"><a href="#6-3-参数配置表-sys-params" class="headerlink" title="6.3 参数配置表 (sys_params)"></a>6.3 参数配置表 (sys_params)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `sys_params` (<br>  `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;参数ID&#x27;</span>,<br>  `param_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;参数名称&#x27;</span>,<br>  `param_key` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;参数键名&#x27;</span>,<br>  `param_value` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;参数键值&#x27;</span>,<br>  `is_system` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;系统内置（0-否 1-是）&#x27;</span>,<br>  `is_encrypted` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;是否加密（0-否 1-是）&#x27;</span>,<br>  `sort` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;排序&#x27;</span>,<br>  `status` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;状态（0正常 1停用）&#x27;</span>,<br>  `remark` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;备注&#x27;</span>,<br>  `create_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>  `creator` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;创建人ID&#x27;</span>,<br>  `update_at` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;更新时间&#x27;</span>,<br>  `updater` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;更新人ID&#x27;</span>,<br>  `delete_flag` TINYINT <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;是否删除：0-否，1-是&#x27;</span>,<br>  `delete_at` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;删除时间&#x27;</span>,<br>  `version` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">&#x27;乐观锁版本号&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `uk_param_key` (`param_key`),<br>  KEY `idx_is_system` (`is_system`),<br>  KEY `idx_status` (`status`),<br>  KEY `idx_delete_flag` (`delete_flag`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;参数配置表&#x27;</span>;<br></code></pre></td></tr></table></figure><h2 id="7-外键约束"><a href="#7-外键约束" class="headerlink" title="7. 外键约束"></a>7. 外键约束</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 部门表外键</span><br><span class="hljs-keyword">ALTER TABLE</span> `sys_dept` <span class="hljs-keyword">ADD CONSTRAINT</span> `fk_dept_leader`<br><span class="hljs-keyword">FOREIGN KEY</span> (`leader_id`) <span class="hljs-keyword">REFERENCES</span> `sys_user` (`id`) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">NULL</span>;<br><br><span class="hljs-comment">-- 岗位表外键</span><br><span class="hljs-keyword">ALTER TABLE</span> `sys_post` <span class="hljs-keyword">ADD CONSTRAINT</span> `fk_post_dept`<br><span class="hljs-keyword">FOREIGN KEY</span> (`dept_id`) <span class="hljs-keyword">REFERENCES</span> `sys_dept` (`id`) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE;<br><br><span class="hljs-comment">-- 用户表外键</span><br><span class="hljs-keyword">ALTER TABLE</span> `sys_user` <span class="hljs-keyword">ADD CONSTRAINT</span> `fk_user_dept`<br><span class="hljs-keyword">FOREIGN KEY</span> (`dept_id`) <span class="hljs-keyword">REFERENCES</span> `sys_dept` (`id`) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">NULL</span>;<br><span class="hljs-keyword">ALTER TABLE</span> `sys_user` <span class="hljs-keyword">ADD CONSTRAINT</span> `fk_user_post`<br><span class="hljs-keyword">FOREIGN KEY</span> (`post_id`) <span class="hljs-keyword">REFERENCES</span> `sys_post` (`id`) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">NULL</span>;<br><br><span class="hljs-comment">-- 用户角色关联表外键</span><br><span class="hljs-keyword">ALTER TABLE</span> `sys_user_role` <span class="hljs-keyword">ADD CONSTRAINT</span> `fk_ur_user`<br><span class="hljs-keyword">FOREIGN KEY</span> (`user_id`) <span class="hljs-keyword">REFERENCES</span> `sys_user` (`id`) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE;<br><span class="hljs-keyword">ALTER TABLE</span> `sys_user_role` <span class="hljs-keyword">ADD CONSTRAINT</span> `fk_ur_role`<br><span class="hljs-keyword">FOREIGN KEY</span> (`role_id`) <span class="hljs-keyword">REFERENCES</span> `sys_role` (`id`) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE;<br><br><span class="hljs-comment">-- 角色菜单关联表外键</span><br><span class="hljs-keyword">ALTER TABLE</span> `sys_role_menu` <span class="hljs-keyword">ADD CONSTRAINT</span> `fk_rm_role`<br><span class="hljs-keyword">FOREIGN KEY</span> (`role_id`) <span class="hljs-keyword">REFERENCES</span> `sys_role` (`id`) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE;<br><span class="hljs-keyword">ALTER TABLE</span> `sys_role_menu` <span class="hljs-keyword">ADD CONSTRAINT</span> `fk_rm_menu`<br><span class="hljs-keyword">FOREIGN KEY</span> (`menu_id`) <span class="hljs-keyword">REFERENCES</span> `sys_menu` (`id`) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE;<br><br><span class="hljs-comment">-- 角色部门关联表外键</span><br><span class="hljs-keyword">ALTER TABLE</span> `sys_role_dept` <span class="hljs-keyword">ADD CONSTRAINT</span> `fk_rd_role`<br><span class="hljs-keyword">FOREIGN KEY</span> (`role_id`) <span class="hljs-keyword">REFERENCES</span> `sys_role` (`id`) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE;<br><span class="hljs-keyword">ALTER TABLE</span> `sys_role_dept` <span class="hljs-keyword">ADD CONSTRAINT</span> `fk_rd_dept`<br><span class="hljs-keyword">FOREIGN KEY</span> (`dept_id`) <span class="hljs-keyword">REFERENCES</span> `sys_dept` (`id`) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE;<br><br><span class="hljs-comment">-- 租户相关外键</span><br><span class="hljs-keyword">ALTER TABLE</span> `sys_tenant` <span class="hljs-keyword">ADD CONSTRAINT</span> `fk_tenant_package`<br><span class="hljs-keyword">FOREIGN KEY</span> (`package_id`) <span class="hljs-keyword">REFERENCES</span> `sys_tenant_package` (`id`) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">NULL</span>;<br><span class="hljs-keyword">ALTER TABLE</span> `sys_tenant_config` <span class="hljs-keyword">ADD CONSTRAINT</span> `fk_config_tenant`<br><span class="hljs-keyword">FOREIGN KEY</span> (`tenant_id`) <span class="hljs-keyword">REFERENCES</span> `sys_tenant` (`id`) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE;<br><br><span class="hljs-comment">-- 字典数据外键</span><br><span class="hljs-keyword">ALTER TABLE</span> `sys_dict_data` <span class="hljs-keyword">ADD CONSTRAINT</span> `fk_data_type`<br><span class="hljs-keyword">FOREIGN KEY</span> (`dict_type`) <span class="hljs-keyword">REFERENCES</span> `sys_dict_type` (`dict_type`) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE;<br></code></pre></td></tr></table></figure><h2 id="8-初始化数据"><a href="#8-初始化数据" class="headerlink" title="8. 初始化数据"></a>8. 初始化数据</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 默认超级管理员</span><br><span class="hljs-keyword">INSERT INTO</span> `sys_user` (`id`, `username`, `password`, `nickname`, `real_name`, `email`, `status`)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-string">&#x27;$2a$10$7JB720yubVSOfvVtlWGIH.9wNHNl.WPs4F9QDmHtzvpZf4MxOb8.K&#x27;</span>, <span class="hljs-string">&#x27;超级管理员&#x27;</span>, <span class="hljs-string">&#x27;系统管理员&#x27;</span>, <span class="hljs-string">&#x27;admin@example.com&#x27;</span>, <span class="hljs-number">1</span>);<br><br><span class="hljs-comment">-- 默认角色</span><br><span class="hljs-keyword">INSERT INTO</span> `sys_role` (`id`, `role_name`, `role_code`, `remark`, `data_scope`)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;超级管理员&#x27;</span>, <span class="hljs-string">&#x27;ROLE_ADMIN&#x27;</span>, <span class="hljs-string">&#x27;系统超级管理员&#x27;</span>, <span class="hljs-number">1</span>);<br><br><span class="hljs-comment">-- 用户角色关联</span><br><span class="hljs-keyword">INSERT INTO</span> `sys_user_role` (`user_id`, `role_id`) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);<br><br><span class="hljs-comment">-- 默认部门</span><br><span class="hljs-keyword">INSERT INTO</span> `sys_dept` (`id`, `dept_name`, `dept_code`, `parent_id`, `status`)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;总公司&#x27;</span>, <span class="hljs-string">&#x27;ROOT&#x27;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);<br><br><span class="hljs-comment">-- 更新超级管理员部门</span><br><span class="hljs-keyword">UPDATE</span> `sys_user` <span class="hljs-keyword">SET</span> `dept_id` <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> `id` <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br><span class="hljs-comment">-- 默认菜单数据</span><br><span class="hljs-keyword">INSERT INTO</span> `sys_menu` (`menu_name`, `menu_code`, `parent_id`, `menu_type`, `path`, `icon`, `sort`) <span class="hljs-keyword">VALUES</span><br>(<span class="hljs-string">&#x27;系统管理&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;/system&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>, <span class="hljs-number">1</span>),<br>(<span class="hljs-string">&#x27;用户管理&#x27;</span>, <span class="hljs-string">&#x27;system:user&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-number">1</span>),<br>(<span class="hljs-string">&#x27;角色管理&#x27;</span>, <span class="hljs-string">&#x27;system:role&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-string">&#x27;role&#x27;</span>, <span class="hljs-string">&#x27;role&#x27;</span>, <span class="hljs-number">2</span>),<br>(<span class="hljs-string">&#x27;菜单管理&#x27;</span>, <span class="hljs-string">&#x27;system:menu&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-string">&#x27;menu&#x27;</span>, <span class="hljs-string">&#x27;menu&#x27;</span>, <span class="hljs-number">3</span>),<br>(<span class="hljs-string">&#x27;部门管理&#x27;</span>, <span class="hljs-string">&#x27;system:dept&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-string">&#x27;dept&#x27;</span>, <span class="hljs-string">&#x27;dept&#x27;</span>, <span class="hljs-number">4</span>),<br>(<span class="hljs-string">&#x27;岗位管理&#x27;</span>, <span class="hljs-string">&#x27;system:post&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-string">&#x27;post&#x27;</span>, <span class="hljs-string">&#x27;post&#x27;</span>, <span class="hljs-number">5</span>);<br></code></pre></td></tr></table></figure><h2 id="9-完整SQL脚本"><a href="#9-完整SQL脚本" class="headerlink" title="9. 完整SQL脚本"></a>9. 完整SQL脚本</h2><p>完整的MySQL建表脚本已保存为：</p><ul><li>[[企业级权限管理系统数据库设计-MySQL版本-complete.sql]] - 可直接执行的完整SQL脚本</li></ul><h2 id="10-相关链接"><a href="#10-相关链接" class="headerlink" title="10. 相关链接"></a>10. 相关链接</h2><ul><li>[[企业级权限管理系统数据库设计]] - 主设计文档</li><li>[[企业级权限管理系统数据库设计-PostgreSQL版本]] - PostgreSQL版本</li></ul>]]></content>
    
    
    <categories>
      
      <category>数据库</category>
      
    </categories>
    
    
    <tags>
      
      <tag>数据库</tag>
      
      <tag>RBAC</tag>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>企业级权限管理系统数据库设计-PostgreSQL版本</title>
    <link href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/%E4%BC%81%E4%B8%9A%E7%BA%A7%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1-PostgreSQL%E7%89%88%E6%9C%AC/61171/"/>
    <url>/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/%E4%BC%81%E4%B8%9A%E7%BA%A7%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1-PostgreSQL%E7%89%88%E6%9C%AC/61171/</url>
    
    <content type="html"><![CDATA[<h1 id="企业级权限管理系统数据库设计-PostgreSQL版本"><a href="#企业级权限管理系统数据库设计-PostgreSQL版本" class="headerlink" title="企业级权限管理系统数据库设计-PostgreSQL版本"></a>企业级权限管理系统数据库设计-PostgreSQL版本</h1><p>本文档基于 [[企业级权限管理系统数据库设计]] 中的设计，提供 PostgreSQL 14+ 版本的建表语句。</p><h2 id="1-数据库创建"><a href="#1-数据库创建" class="headerlink" title="1. 数据库创建"></a>1. 数据库创建</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 创建数据库</span><br><span class="hljs-keyword">CREATE</span> DATABASE &quot;rbac_system&quot;<br>    <span class="hljs-keyword">WITH</span><br>    OWNER <span class="hljs-operator">=</span> postgres<br>    ENCODING <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;UTF8&#x27;</span><br>    LC_COLLATE <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;en_US.utf8&#x27;</span><br>    LC_CTYPE <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;en_US.utf8&#x27;</span><br>    TABLESPACE <span class="hljs-operator">=</span> pg_default<br>    CONNECTION LIMIT <span class="hljs-operator">=</span> <span class="hljs-number">-1</span>;<br><br><span class="hljs-comment">-- 连接到数据库</span><br>\c &quot;rbac_system&quot;;<br><br><span class="hljs-comment">-- 创建UUID扩展</span><br><span class="hljs-keyword">CREATE</span> EXTENSION IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> &quot;uuid-ossp&quot;;<br><br><span class="hljs-comment">-- 创建加密扩展</span><br><span class="hljs-keyword">CREATE</span> EXTENSION IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> &quot;pgcrypto&quot;;<br></code></pre></td></tr></table></figure><h2 id="2-枚举类型定义"><a href="#2-枚举类型定义" class="headerlink" title="2. 枚举类型定义"></a>2. 枚举类型定义</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 用户性别枚举</span><br><span class="hljs-keyword">CREATE</span> TYPE gender_enum <span class="hljs-keyword">AS</span> ENUM (<span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>);<br><br><span class="hljs-comment">-- 状态枚举</span><br><span class="hljs-keyword">CREATE</span> TYPE status_enum <span class="hljs-keyword">AS</span> ENUM (<span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>);<br><br><span class="hljs-comment">-- 菜单类型枚举</span><br><span class="hljs-keyword">CREATE</span> TYPE menu_type_enum <span class="hljs-keyword">AS</span> ENUM (<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>);<br><br><span class="hljs-comment">-- 数据权限范围枚举</span><br><span class="hljs-keyword">CREATE</span> TYPE data_scope_enum <span class="hljs-keyword">AS</span> ENUM (<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>);<br><br><span class="hljs-comment">-- 业务类型枚举</span><br><span class="hljs-keyword">CREATE</span> TYPE business_type_enum <span class="hljs-keyword">AS</span> ENUM (<span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>);<br><br><span class="hljs-comment">-- 操作类别枚举</span><br><span class="hljs-keyword">CREATE</span> TYPE operator_type_enum <span class="hljs-keyword">AS</span> ENUM (<span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>);<br><br><span class="hljs-comment">-- 是否枚举</span><br><span class="hljs-keyword">CREATE</span> TYPE yes_no_enum <span class="hljs-keyword">AS</span> ENUM (<span class="hljs-string">&#x27;Y&#x27;</span>, <span class="hljs-string">&#x27;N&#x27;</span>);<br><br><span class="hljs-comment">-- 周期单位枚举</span><br><span class="hljs-keyword">CREATE</span> TYPE cycle_unit_enum <span class="hljs-keyword">AS</span> ENUM (<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>);<br></code></pre></td></tr></table></figure><h2 id="3-序列定义"><a href="#3-序列定义" class="headerlink" title="3. 序列定义"></a>3. 序列定义</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 创建自增序列</span><br><span class="hljs-keyword">CREATE</span> SEQUENCE IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> seq_sys_id<br>    <span class="hljs-keyword">START</span> <span class="hljs-keyword">WITH</span> <span class="hljs-number">1</span><br>    INCREMENT <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">NO</span> MINVALUE<br>    <span class="hljs-keyword">NO</span> MAXVALUE<br>    CACHE <span class="hljs-number">1</span>;<br><br><span class="hljs-comment">-- 创建序列函数</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">FUNCTION</span> next_id()<br><span class="hljs-keyword">RETURNS</span> <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">AS</span> $$<br><span class="hljs-keyword">BEGIN</span><br>    <span class="hljs-keyword">RETURN</span> nextval(<span class="hljs-string">&#x27;seq_sys_id&#x27;</span>);<br><span class="hljs-keyword">END</span>;<br>$$ <span class="hljs-keyword">LANGUAGE</span> PLPGSQL;<br></code></pre></td></tr></table></figure><h2 id="4-核心业务表"><a href="#4-核心业务表" class="headerlink" title="4. 核心业务表"></a>4. 核心业务表</h2><h3 id="4-1-部门表-sys-dept"><a href="#4-1-部门表-sys-dept" class="headerlink" title="4.1 部门表 (sys_dept)"></a>4.1 部门表 (sys_dept)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> sys_dept (<br>    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY KEY</span> <span class="hljs-keyword">DEFAULT</span> next_id(),<br>    dept_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    dept_code <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    parent_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,<br>    leader_id <span class="hljs-type">BIGINT</span>,<br>    leader_phone <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>    leader_email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    status status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;1&#x27;</span>,<br>    sort <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,<br>    create_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    creator <span class="hljs-type">BIGINT</span>,<br>    update_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    updater <span class="hljs-type">BIGINT</span>,<br>    delete_flag status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    delete_at <span class="hljs-type">TIMESTAMP</span>,<br>    version <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,<br>    tenant_id <span class="hljs-type">BIGINT</span>,<br>    <span class="hljs-keyword">CONSTRAINT</span> uk_dept_code <span class="hljs-keyword">UNIQUE</span> (dept_code, tenant_id)<br>);<br><br><span class="hljs-comment">-- 添加注释</span><br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">TABLE</span> sys_dept <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;部门表&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dept.id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;部门ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dept.dept_name <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;部门名称&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dept.dept_code <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;部门编码&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dept.parent_id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;父部门ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dept.leader_id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;负责人用户ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dept.leader_phone <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;负责人联系电话&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dept.leader_email <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;负责人邮箱&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dept.status <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;状态：0-禁用，1-正常&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dept.sort <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;排序&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dept.create_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dept.creator <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建人ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dept.update_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;更新时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dept.updater <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;更新人ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dept.delete_flag <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;是否删除：0-否，1-是&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dept.delete_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;删除时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dept.version <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;乐观锁版本号&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dept.tenant_id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;租户ID&#x27;</span>;<br><br><span class="hljs-comment">-- 创建索引</span><br><span class="hljs-keyword">CREATE</span> INDEX idx_dept_parent_id <span class="hljs-keyword">ON</span> sys_dept (parent_id);<br><span class="hljs-keyword">CREATE</span> INDEX idx_dept_status <span class="hljs-keyword">ON</span> sys_dept (status);<br><span class="hljs-keyword">CREATE</span> INDEX idx_dept_delete_flag <span class="hljs-keyword">ON</span> sys_dept (delete_flag);<br><span class="hljs-keyword">CREATE</span> INDEX idx_dept_tenant_id <span class="hljs-keyword">ON</span> sys_dept (tenant_id);<br></code></pre></td></tr></table></figure><h3 id="4-2-岗位表-sys-post"><a href="#4-2-岗位表-sys-post" class="headerlink" title="4.2 岗位表 (sys_post)"></a>4.2 岗位表 (sys_post)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> sys_post (<br>    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY KEY</span> <span class="hljs-keyword">DEFAULT</span> next_id(),<br>    post_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    post_code <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    dept_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span>,<br>    sort <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,<br>    status status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;1&#x27;</span>,<br>    create_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    creator <span class="hljs-type">BIGINT</span>,<br>    update_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    updater <span class="hljs-type">BIGINT</span>,<br>    delete_flag status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    delete_at <span class="hljs-type">TIMESTAMP</span>,<br>    version <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,<br>    tenant_id <span class="hljs-type">BIGINT</span>,<br>    <span class="hljs-keyword">CONSTRAINT</span> uk_post_code <span class="hljs-keyword">UNIQUE</span> (post_code, tenant_id)<br>);<br><br><span class="hljs-comment">-- 添加注释</span><br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">TABLE</span> sys_post <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;岗位表&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_post.id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;岗位ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_post.post_name <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;岗位名称&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_post.post_code <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;岗位编码&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_post.dept_id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;所属部门ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_post.sort <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;排序&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_post.status <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;状态：0-禁用，1-正常&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_post.create_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_post.creator <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建人ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_post.update_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;更新时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_post.updater <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;更新人ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_post.delete_flag <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;是否删除：0-否，1-是&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_post.delete_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;删除时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_post.version <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;乐观锁版本号&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_post.tenant_id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;租户ID&#x27;</span>;<br><br><span class="hljs-comment">-- 创建索引</span><br><span class="hljs-keyword">CREATE</span> INDEX idx_post_dept_id <span class="hljs-keyword">ON</span> sys_post (dept_id);<br><span class="hljs-keyword">CREATE</span> INDEX idx_post_status <span class="hljs-keyword">ON</span> sys_post (status);<br><span class="hljs-keyword">CREATE</span> INDEX idx_post_delete_flag <span class="hljs-keyword">ON</span> sys_post (delete_flag);<br><span class="hljs-keyword">CREATE</span> INDEX idx_post_tenant_id <span class="hljs-keyword">ON</span> sys_post (tenant_id);<br></code></pre></td></tr></table></figure><h3 id="4-3-用户表-sys-user"><a href="#4-3-用户表-sys-user" class="headerlink" title="4.3 用户表 (sys_user)"></a>4.3 用户表 (sys_user)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> sys_user (<br>    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY KEY</span> <span class="hljs-keyword">DEFAULT</span> next_id(),<br>    username <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    password <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    nickname <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),<br>    real_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),<br>    email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    phone <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>    avatar <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>),<br>    sex gender_enum <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    birthday <span class="hljs-type">DATE</span>,<br>    dept_id <span class="hljs-type">BIGINT</span>,<br>    post_id <span class="hljs-type">BIGINT</span>,<br>    address <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>),<br>    remark <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>),<br>    sort <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,<br>    status status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;1&#x27;</span>,<br>    last_login_time <span class="hljs-type">TIMESTAMP</span>,<br>    last_login_ip <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),<br>    create_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    creator <span class="hljs-type">BIGINT</span>,<br>    update_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    updater <span class="hljs-type">BIGINT</span>,<br>    delete_flag status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    delete_at <span class="hljs-type">TIMESTAMP</span>,<br>    version <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,<br>    tenant_id <span class="hljs-type">BIGINT</span>,<br>    <span class="hljs-keyword">CONSTRAINT</span> uk_username <span class="hljs-keyword">UNIQUE</span> (username, tenant_id),<br>    <span class="hljs-keyword">CONSTRAINT</span> uk_email <span class="hljs-keyword">UNIQUE</span> (email, tenant_id),<br>    <span class="hljs-keyword">CONSTRAINT</span> uk_phone <span class="hljs-keyword">UNIQUE</span> (phone, tenant_id)<br>);<br><br><span class="hljs-comment">-- 添加注释</span><br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">TABLE</span> sys_user <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;用户表&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;用户ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.username <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;用户名&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.password <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;密码&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.nickname <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;昵称&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.real_name <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;真实姓名&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.email <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;邮箱&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.phone <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;手机号&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.avatar <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;头像地址&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.sex <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;性别：0-未知，1-男，2-女&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.birthday <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;生日&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.dept_id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;部门ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.post_id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;岗位ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.address <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;地址&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.remark <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;备注&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.sort <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;排序&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.status <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;状态：0-禁用，1-正常&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.last_login_time <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;最后登录时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.last_login_ip <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;最后登录IP&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.create_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.creator <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建人ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.update_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;更新时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.updater <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;更新人ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.delete_flag <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;是否删除：0-否，1-是&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.delete_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;删除时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.version <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;乐观锁版本号&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user.tenant_id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;租户ID&#x27;</span>;<br><br><span class="hljs-comment">-- 创建索引</span><br><span class="hljs-keyword">CREATE</span> INDEX idx_user_dept_id <span class="hljs-keyword">ON</span> sys_user (dept_id);<br><span class="hljs-keyword">CREATE</span> INDEX idx_user_post_id <span class="hljs-keyword">ON</span> sys_user (post_id);<br><span class="hljs-keyword">CREATE</span> INDEX idx_user_status <span class="hljs-keyword">ON</span> sys_user (status);<br><span class="hljs-keyword">CREATE</span> INDEX idx_user_delete_flag <span class="hljs-keyword">ON</span> sys_user (delete_flag);<br><span class="hljs-keyword">CREATE</span> INDEX idx_user_tenant_id <span class="hljs-keyword">ON</span> sys_user (tenant_id);<br></code></pre></td></tr></table></figure><h3 id="4-4-角色表-sys-role"><a href="#4-4-角色表-sys-role" class="headerlink" title="4.4 角色表 (sys_role)"></a>4.4 角色表 (sys_role)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> sys_role (<br>    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY KEY</span> <span class="hljs-keyword">DEFAULT</span> next_id(),<br>    role_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    role_code <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    remark <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>),<br>    data_scope data_scope_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;1&#x27;</span>,<br>    sort <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,<br>    status status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;1&#x27;</span>,<br>    create_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    creator <span class="hljs-type">BIGINT</span>,<br>    update_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    updater <span class="hljs-type">BIGINT</span>,<br>    delete_flag status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    delete_at <span class="hljs-type">TIMESTAMP</span>,<br>    version <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,<br>    tenant_id <span class="hljs-type">BIGINT</span>,<br>    <span class="hljs-keyword">CONSTRAINT</span> uk_role_code <span class="hljs-keyword">UNIQUE</span> (role_code, tenant_id)<br>);<br><br><span class="hljs-comment">-- 添加注释</span><br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">TABLE</span> sys_role <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;角色表&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_role.id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;角色ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_role.role_name <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;角色名称&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_role.role_code <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;角色编码&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_role.remark <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;备注&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_role.data_scope <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;数据权限：1-全部，2-本部门，3-本部门及下级，4-自定义&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_role.sort <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;排序&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_role.status <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;状态：0-禁用，1-正常&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_role.create_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_role.creator <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建人ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_role.update_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;更新时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_role.updater <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;更新人ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_role.delete_flag <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;是否删除：0-否，1-是&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_role.delete_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;删除时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_role.version <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;乐观锁版本号&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_role.tenant_id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;租户ID&#x27;</span>;<br><br><span class="hljs-comment">-- 创建索引</span><br><span class="hljs-keyword">CREATE</span> INDEX idx_role_status <span class="hljs-keyword">ON</span> sys_role (status);<br><span class="hljs-keyword">CREATE</span> INDEX idx_role_data_scope <span class="hljs-keyword">ON</span> sys_role (data_scope);<br><span class="hljs-keyword">CREATE</span> INDEX idx_role_delete_flag <span class="hljs-keyword">ON</span> sys_role (delete_flag);<br><span class="hljs-keyword">CREATE</span> INDEX idx_role_tenant_id <span class="hljs-keyword">ON</span> sys_role (tenant_id);<br></code></pre></td></tr></table></figure><h3 id="4-5-菜单表-sys-menu"><a href="#4-5-菜单表-sys-menu" class="headerlink" title="4.5 菜单表 (sys_menu)"></a>4.5 菜单表 (sys_menu)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> sys_menu (<br>    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY KEY</span> <span class="hljs-keyword">DEFAULT</span> next_id(),<br>    menu_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    menu_code <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    parent_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,<br>    menu_type menu_type_enum <span class="hljs-keyword">NOT NULL</span>,<br>    path <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>),<br>    component <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>),<br>    icon <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    permission <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    target <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;_self&#x27;</span>,<br>    is_cache status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    is_visible status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;1&#x27;</span>,<br>    is_external status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    sort <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,<br>    status status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;1&#x27;</span>,<br>    create_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    creator <span class="hljs-type">BIGINT</span>,<br>    update_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    updater <span class="hljs-type">BIGINT</span>,<br>    delete_flag status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    delete_at <span class="hljs-type">TIMESTAMP</span>,<br>    version <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,<br>    tenant_id <span class="hljs-type">BIGINT</span>,<br>    <span class="hljs-keyword">CONSTRAINT</span> uk_menu_code <span class="hljs-keyword">UNIQUE</span> (menu_code, tenant_id)<br>);<br><br><span class="hljs-comment">-- 添加注释</span><br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">TABLE</span> sys_menu <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;菜单表&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;菜单ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.menu_name <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;菜单名称&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.menu_code <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;菜单编码/权限标识&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.parent_id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;父菜单ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.menu_type <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;菜单类型：1-目录，2-菜单，3-按钮&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.path <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;路由路径&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.component <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;组件路径&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.icon <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;图标&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.permission <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;权限标识&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.target <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;打开方式：_self-当前页，_blank-新页&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.is_cache <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;是否缓存：0-否，1-是&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.is_visible <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;是否显示：0-否，1-是&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.is_external <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;是否外链：0-否，1-是&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.sort <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;排序&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.status <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;状态：0-禁用，1-正常&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.create_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.creator <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建人ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.update_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;更新时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.updater <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;更新人ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.delete_flag <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;是否删除：0-否，1-是&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.delete_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;删除时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.version <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;乐观锁版本号&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_menu.tenant_id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;租户ID&#x27;</span>;<br><br><span class="hljs-comment">-- 创建索引</span><br><span class="hljs-keyword">CREATE</span> INDEX idx_menu_parent_id <span class="hljs-keyword">ON</span> sys_menu (parent_id);<br><span class="hljs-keyword">CREATE</span> INDEX idx_menu_menu_type <span class="hljs-keyword">ON</span> sys_menu (menu_type);<br><span class="hljs-keyword">CREATE</span> INDEX idx_menu_status <span class="hljs-keyword">ON</span> sys_menu (status);<br><span class="hljs-keyword">CREATE</span> INDEX idx_menu_delete_flag <span class="hljs-keyword">ON</span> sys_menu (delete_flag);<br><span class="hljs-keyword">CREATE</span> INDEX idx_menu_tenant_id <span class="hljs-keyword">ON</span> sys_menu (tenant_id);<br></code></pre></td></tr></table></figure><h2 id="5-关联表"><a href="#5-关联表" class="headerlink" title="5. 关联表"></a>5. 关联表</h2><h3 id="5-1-用户角色关联表-sys-user-role"><a href="#5-1-用户角色关联表-sys-user-role" class="headerlink" title="5.1 用户角色关联表 (sys_user_role)"></a>5.1 用户角色关联表 (sys_user_role)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> sys_user_role (<br>    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY KEY</span> <span class="hljs-keyword">DEFAULT</span> next_id(),<br>    user_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span>,<br>    role_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span>,<br>    <span class="hljs-keyword">CONSTRAINT</span> uk_user_role <span class="hljs-keyword">UNIQUE</span> (user_id, role_id)<br>);<br><br><span class="hljs-comment">-- 添加注释</span><br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">TABLE</span> sys_user_role <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;用户角色关联表&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user_role.id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;主键ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user_role.user_id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;用户ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_user_role.role_id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;角色ID&#x27;</span>;<br><br><span class="hljs-comment">-- 创建索引</span><br><span class="hljs-keyword">CREATE</span> INDEX idx_user_role_user_id <span class="hljs-keyword">ON</span> sys_user_role (user_id);<br><span class="hljs-keyword">CREATE</span> INDEX idx_user_role_role_id <span class="hljs-keyword">ON</span> sys_user_role (role_id);<br></code></pre></td></tr></table></figure><h3 id="5-2-角色菜单关联表-sys-role-menu"><a href="#5-2-角色菜单关联表-sys-role-menu" class="headerlink" title="5.2 角色菜单关联表 (sys_role_menu)"></a>5.2 角色菜单关联表 (sys_role_menu)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> sys_role_menu (<br>    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY KEY</span> <span class="hljs-keyword">DEFAULT</span> next_id(),<br>    role_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span>,<br>    menu_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span>,<br>    <span class="hljs-keyword">CONSTRAINT</span> uk_role_menu <span class="hljs-keyword">UNIQUE</span> (role_id, menu_id)<br>);<br><br><span class="hljs-comment">-- 添加注释</span><br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">TABLE</span> sys_role_menu <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;角色菜单关联表&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_role_menu.id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;主键ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_role_menu.role_id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;角色ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_role_menu.menu_id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;菜单ID&#x27;</span>;<br><br><span class="hljs-comment">-- 创建索引</span><br><span class="hljs-keyword">CREATE</span> INDEX idx_role_menu_role_id <span class="hljs-keyword">ON</span> sys_role_menu (role_id);<br><span class="hljs-keyword">CREATE</span> INDEX idx_role_menu_menu_id <span class="hljs-keyword">ON</span> sys_role_menu (menu_id);<br></code></pre></td></tr></table></figure><h3 id="5-3-角色部门关联表-sys-role-dept"><a href="#5-3-角色部门关联表-sys-role-dept" class="headerlink" title="5.3 角色部门关联表 (sys_role_dept)"></a>5.3 角色部门关联表 (sys_role_dept)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> sys_role_dept (<br>    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY KEY</span> <span class="hljs-keyword">DEFAULT</span> next_id(),<br>    role_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span>,<br>    dept_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span>,<br>    <span class="hljs-keyword">CONSTRAINT</span> uk_role_dept <span class="hljs-keyword">UNIQUE</span> (role_id, dept_id)<br>);<br><br><span class="hljs-comment">-- 添加注释</span><br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">TABLE</span> sys_role_dept <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;角色部门关联表&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_role_dept.id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;主键ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_role_dept.role_id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;角色ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_role_dept.dept_id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;部门ID&#x27;</span>;<br><br><span class="hljs-comment">-- 创建索引</span><br><span class="hljs-keyword">CREATE</span> INDEX idx_role_dept_role_id <span class="hljs-keyword">ON</span> sys_role_dept (role_id);<br><span class="hljs-keyword">CREATE</span> INDEX idx_role_dept_dept_id <span class="hljs-keyword">ON</span> sys_role_dept (dept_id);<br></code></pre></td></tr></table></figure><h2 id="6-日志表"><a href="#6-日志表" class="headerlink" title="6. 日志表"></a>6. 日志表</h2><h3 id="6-1-登录日志表-sys-login-log"><a href="#6-1-登录日志表-sys-login-log" class="headerlink" title="6.1 登录日志表 (sys_login_log)"></a>6.1 登录日志表 (sys_login_log)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> sys_login_log (<br>    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY KEY</span> <span class="hljs-keyword">DEFAULT</span> next_id(),<br>    username <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    user_id <span class="hljs-type">BIGINT</span>,<br>    ipaddr <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    login_location <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>),<br>    browser <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),<br>    os <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),<br>    device <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),<br>    status status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    msg <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>),<br>    login_time <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    create_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span><br>);<br><br><span class="hljs-comment">-- 添加注释</span><br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">TABLE</span> sys_login_log <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;登录日志表&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_login_log.id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;日志ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_login_log.username <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;用户名&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_login_log.user_id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;用户ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_login_log.ipaddr <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;登录IP地址&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_login_log.login_location <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;登录地点&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_login_log.browser <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;浏览器类型&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_login_log.os <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;操作系统&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_login_log.device <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;设备类型&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_login_log.status <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;登录状态：0-失败，1-成功&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_login_log.msg <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;提示信息&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_login_log.login_time <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;登录时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_login_log.create_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建时间&#x27;</span>;<br><br><span class="hljs-comment">-- 创建索引</span><br><span class="hljs-keyword">CREATE</span> INDEX idx_login_log_user_id <span class="hljs-keyword">ON</span> sys_login_log (user_id);<br><span class="hljs-keyword">CREATE</span> INDEX idx_login_log_username <span class="hljs-keyword">ON</span> sys_login_log (username);<br><span class="hljs-keyword">CREATE</span> INDEX idx_login_log_login_time <span class="hljs-keyword">ON</span> sys_login_log (login_time);<br><span class="hljs-keyword">CREATE</span> INDEX idx_login_log_username_time <span class="hljs-keyword">ON</span> sys_login_log (username, login_time);<br></code></pre></td></tr></table></figure><h3 id="6-2-操作日志表-sys-operation-log"><a href="#6-2-操作日志表-sys-operation-log" class="headerlink" title="6.2 操作日志表 (sys_operation_log)"></a>6.2 操作日志表 (sys_operation_log)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> sys_operation_log (<br>    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY KEY</span> <span class="hljs-keyword">DEFAULT</span> next_id(),<br>    title <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),<br>    business_type business_type_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    business_type_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),<br>    <span class="hljs-keyword">method</span> <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    request_method <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    operator_type operator_type_enum <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    operator_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),<br>    dept_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),<br>    operation_url <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>),<br>    operation_ip <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    operation_location <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>),<br>    operation_param TEXT,<br>    json_result TEXT,<br>    operation_status status_enum <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    error_msg <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">2000</span>),<br>    operation_time <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    cost_time <span class="hljs-type">BIGINT</span><br>);<br><br><span class="hljs-comment">-- 添加注释</span><br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">TABLE</span> sys_operation_log <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;操作日志表&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_operation_log.id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;日志ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_operation_log.title <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;操作模块&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_operation_log.business_type <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;业务类型（0-其他 1-新增 2-修改 3-删除）&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_operation_log.business_type_name <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;业务类型名称&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_operation_log.method <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;请求方式&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_operation_log.request_method <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;请求类型&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_operation_log.operator_type <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;操作类别（0-其它 1-后台用户 2-手机端用户）&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_operation_log.operator_name <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;操作人员&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_operation_log.dept_name <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;部门名称&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_operation_log.operation_url <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;请求URL&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_operation_log.operation_ip <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;操作地址&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_operation_log.operation_location <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;操作地点&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_operation_log.operation_param <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;请求参数&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_operation_log.json_result <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;返回参数&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_operation_log.operation_status <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;操作状态：0-正常，1-异常&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_operation_log.error_msg <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;错误消息&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_operation_log.operation_time <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;操作时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_operation_log.cost_time <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;消耗时间&#x27;</span>;<br><br><span class="hljs-comment">-- 创建索引</span><br><span class="hljs-keyword">CREATE</span> INDEX idx_operation_log_user_id <span class="hljs-keyword">ON</span> sys_operation_log (operator_name);<br><span class="hljs-keyword">CREATE</span> INDEX idx_operation_log_operation_time <span class="hljs-keyword">ON</span> sys_operation_log (operation_time);<br><span class="hljs-keyword">CREATE</span> INDEX idx_operation_log_business_type <span class="hljs-keyword">ON</span> sys_operation_log (business_type);<br><span class="hljs-keyword">CREATE</span> INDEX idx_operation_log_status <span class="hljs-keyword">ON</span> sys_operation_log (operation_status);<br></code></pre></td></tr></table></figure><h3 id="6-3-错误日志表-sys-error-log"><a href="#6-3-错误日志表-sys-error-log" class="headerlink" title="6.3 错误日志表 (sys_error_log)"></a>6.3 错误日志表 (sys_error_log)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> sys_error_log (<br>    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY KEY</span> <span class="hljs-keyword">DEFAULT</span> next_id(),<br>    title <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>),<br>    request_uri <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    request_method <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    request_params TEXT,<br>    user_id <span class="hljs-type">BIGINT</span>,<br>    username <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),<br>    user_ip <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>),<br>    user_agent <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>),<br>    exception_info TEXT <span class="hljs-keyword">NOT NULL</span>,<br>    exception_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>),<br>    stack_trace TEXT,<br>    line_number <span class="hljs-type">INTEGER</span>,<br>    class_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>),<br>    method_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>),<br>    status status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    process_user_id <span class="hljs-type">BIGINT</span>,<br>    process_user_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),<br>    process_remark <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>),<br>    process_time <span class="hljs-type">TIMESTAMP</span>,<br>    create_time <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span><br>);<br><br><span class="hljs-comment">-- 添加注释</span><br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">TABLE</span> sys_error_log <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;错误日志表&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_error_log.id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;日志ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_error_log.title <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;错误标题&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_error_log.request_uri <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;请求URL&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_error_log.request_method <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;请求方式&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_error_log.request_params <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;请求参数&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_error_log.user_id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;用户ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_error_log.username <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;用户名&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_error_log.user_ip <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;操作IP地址&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_error_log.user_agent <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;用户代理&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_error_log.exception_info <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;错误消息&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_error_log.exception_name <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;异常名称&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_error_log.stack_trace <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;错误堆栈&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_error_log.line_number <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;错误行号&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_error_log.class_name <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;Java类名&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_error_log.method_name <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;方法名&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_error_log.status <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;状态&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_error_log.process_user_id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;处理人ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_error_log.process_user_name <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;处理人&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_error_log.process_remark <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;处理备注&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_error_log.process_time <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;处理时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_error_log.create_time <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建时间&#x27;</span>;<br><br><span class="hljs-comment">-- 创建索引</span><br><span class="hljs-keyword">CREATE</span> INDEX idx_error_log_user_id <span class="hljs-keyword">ON</span> sys_error_log (user_id);<br><span class="hljs-keyword">CREATE</span> INDEX idx_error_log_create_time <span class="hljs-keyword">ON</span> sys_error_log (create_time);<br><span class="hljs-keyword">CREATE</span> INDEX idx_error_log_status <span class="hljs-keyword">ON</span> sys_error_log (status);<br><span class="hljs-keyword">CREATE</span> INDEX idx_error_log_exception_name <span class="hljs-keyword">ON</span> sys_error_log (exception_name);<br></code></pre></td></tr></table></figure><h2 id="7-租户管理表"><a href="#7-租户管理表" class="headerlink" title="7. 租户管理表"></a>7. 租户管理表</h2><h3 id="7-1-租户表-sys-tenant"><a href="#7-1-租户表-sys-tenant" class="headerlink" title="7.1 租户表 (sys_tenant)"></a>7.1 租户表 (sys_tenant)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> sys_tenant (<br>    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY KEY</span> <span class="hljs-keyword">DEFAULT</span> next_id(),<br>    tenant_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    tenant_code <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    contact_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">30</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    contact_phone <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>    contact_email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),<br>    company_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    domain <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    address <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>),<br>    phone <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>    email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    package_id <span class="hljs-type">BIGINT</span>,<br>    expire_time <span class="hljs-type">TIMESTAMP</span>,<br>    account_count <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,<br>    sort <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,<br>    status status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;1&#x27;</span>,<br>    create_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    creator <span class="hljs-type">BIGINT</span>,<br>    update_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    updater <span class="hljs-type">BIGINT</span>,<br>    delete_flag status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    delete_at <span class="hljs-type">TIMESTAMP</span>,<br>    version <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,<br>    <span class="hljs-keyword">CONSTRAINT</span> uk_tenant_code <span class="hljs-keyword">UNIQUE</span> (tenant_code)<br>);<br><br><span class="hljs-comment">-- 添加注释</span><br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">TABLE</span> sys_tenant <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;租户表&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;租户ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.tenant_name <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;租户名称&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.tenant_code <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;租户编码&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.contact_name <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;联系人&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.contact_phone <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;联系电话&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.contact_email <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;联系邮箱&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.company_name <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;企业名称&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.domain <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;域名&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.address <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;地址&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.phone <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;电话&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.email <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;邮箱&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.package_id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;套餐ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.expire_time <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;到期时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.account_count <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;账号数量&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.sort <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;排序&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.status <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;状态：0-禁用，1-正常&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.create_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.creator <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建人ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.update_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;更新时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.updater <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;更新人ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.delete_flag <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;是否删除：0-否，1-是&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.delete_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;删除时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant.version <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;乐观锁版本号&#x27;</span>;<br><br><span class="hljs-comment">-- 创建索引</span><br><span class="hljs-keyword">CREATE</span> INDEX idx_tenant_package_id <span class="hljs-keyword">ON</span> sys_tenant (package_id);<br><span class="hljs-keyword">CREATE</span> INDEX idx_tenant_status <span class="hljs-keyword">ON</span> sys_tenant (status);<br><span class="hljs-keyword">CREATE</span> INDEX idx_tenant_delete_flag <span class="hljs-keyword">ON</span> sys_tenant (delete_flag);<br><span class="hljs-keyword">CREATE</span> INDEX idx_tenant_expire_time <span class="hljs-keyword">ON</span> sys_tenant (expire_time);<br></code></pre></td></tr></table></figure><h3 id="7-2-租户套餐表-sys-tenant-package"><a href="#7-2-租户套餐表-sys-tenant-package" class="headerlink" title="7.2 租户套餐表 (sys_tenant_package)"></a>7.2 租户套餐表 (sys_tenant_package)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> sys_tenant_package (<br>    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY KEY</span> <span class="hljs-keyword">DEFAULT</span> next_id(),<br>    package_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    package_code <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    max_users <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">10</span>,<br>    max_storage <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1073741824</span>,<br>    price <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0.00</span>,<br>    cycle_unit cycle_unit_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;1&#x27;</span>,<br>    features TEXT,<br>    description <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>),<br>    status status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;1&#x27;</span>,<br>    sort_order <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,<br>    create_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    creator <span class="hljs-type">BIGINT</span>,<br>    update_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    updater <span class="hljs-type">BIGINT</span>,<br>    delete_flag status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    delete_at <span class="hljs-type">TIMESTAMP</span>,<br>    version <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,<br>    <span class="hljs-keyword">CONSTRAINT</span> uk_package_code <span class="hljs-keyword">UNIQUE</span> (package_code)<br>);<br><br><span class="hljs-comment">-- 添加注释</span><br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">TABLE</span> sys_tenant_package <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;租户套餐表&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_package.id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;套餐ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_package.package_name <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;套餐名称&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_package.package_code <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;套餐编码&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_package.max_users <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;最大用户数&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_package.max_storage <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;最大存储空间（字节）&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_package.price <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;价格&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_package.cycle_unit <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;计费周期：1-月，2-季，3-年&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_package.features <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;功能特性（JSON格式）&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_package.description <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;套餐描述&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_package.status <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;状态：0-禁用，1-正常&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_package.sort_order <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;排序&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_package.create_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_package.creator <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建人ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_package.update_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;更新时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_package.updater <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;更新人ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_package.delete_flag <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;是否删除：0-否，1-是&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_package.delete_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;删除时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_package.version <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;乐观锁版本号&#x27;</span>;<br><br><span class="hljs-comment">-- 创建索引</span><br><span class="hljs-keyword">CREATE</span> INDEX idx_tenant_package_status <span class="hljs-keyword">ON</span> sys_tenant_package (status);<br><span class="hljs-keyword">CREATE</span> INDEX idx_tenant_package_delete_flag <span class="hljs-keyword">ON</span> sys_tenant_package (delete_flag);<br></code></pre></td></tr></table></figure><h3 id="7-3-租户配置表-sys-tenant-config"><a href="#7-3-租户配置表-sys-tenant-config" class="headerlink" title="7.3 租户配置表 (sys_tenant_config)"></a>7.3 租户配置表 (sys_tenant_config)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> sys_tenant_config (<br>    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY KEY</span> <span class="hljs-keyword">DEFAULT</span> next_id(),<br>    tenant_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT NULL</span>,<br>    config_key <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    config_value TEXT,<br>    config_type status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    is_encrypted status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    remark <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>),<br>    create_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    creator <span class="hljs-type">BIGINT</span>,<br>    update_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    updater <span class="hljs-type">BIGINT</span>,<br>    delete_flag status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    delete_at <span class="hljs-type">TIMESTAMP</span>,<br>    version <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,<br>    <span class="hljs-keyword">CONSTRAINT</span> uk_tenant_key <span class="hljs-keyword">UNIQUE</span> (tenant_id, config_key)<br>);<br><br><span class="hljs-comment">-- 添加注释</span><br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">TABLE</span> sys_tenant_config <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;租户配置表&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_config.id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;配置ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_config.tenant_id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;租户ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_config.config_key <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;配置键&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_config.config_value <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;配置值&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_config.config_type <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;系统内置（0-否 1-是）&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_config.is_encrypted <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;是否加密（0-否 1-是）&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_config.remark <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;备注&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_config.create_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_config.creator <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建人ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_config.update_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;更新时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_config.updater <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;更新人ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_config.delete_flag <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;是否删除：0-否，1-是&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_config.delete_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;删除时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_tenant_config.version <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;乐观锁版本号&#x27;</span>;<br><br><span class="hljs-comment">-- 创建索引</span><br><span class="hljs-keyword">CREATE</span> INDEX idx_tenant_config_tenant_id <span class="hljs-keyword">ON</span> sys_tenant_config (tenant_id);<br><span class="hljs-keyword">CREATE</span> INDEX idx_tenant_config_key <span class="hljs-keyword">ON</span> sys_tenant_config (config_key);<br><span class="hljs-keyword">CREATE</span> INDEX idx_tenant_config_type <span class="hljs-keyword">ON</span> sys_tenant_config (config_type);<br></code></pre></td></tr></table></figure><h2 id="8-系统配置表"><a href="#8-系统配置表" class="headerlink" title="8. 系统配置表"></a>8. 系统配置表</h2><h3 id="8-1-字典类型表-sys-dict-type"><a href="#8-1-字典类型表-sys-dict-type" class="headerlink" title="8.1 字典类型表 (sys_dict_type)"></a>8.1 字典类型表 (sys_dict_type)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> sys_dict_type (<br>    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY KEY</span> <span class="hljs-keyword">DEFAULT</span> next_id(),<br>    dict_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    dict_type <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    sort <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,<br>    status status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;1&#x27;</span>,<br>    create_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    creator <span class="hljs-type">BIGINT</span>,<br>    update_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    updater <span class="hljs-type">BIGINT</span>,<br>    delete_flag status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    delete_at <span class="hljs-type">TIMESTAMP</span>,<br>    version <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,<br>    remark <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>),<br>    <span class="hljs-keyword">CONSTRAINT</span> uk_dict_type <span class="hljs-keyword">UNIQUE</span> (dict_type)<br>);<br><br><span class="hljs-comment">-- 添加注释</span><br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">TABLE</span> sys_dict_type <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;字典类型表&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_type.id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;字典主键&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_type.dict_name <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;字典名称&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_type.dict_type <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;字典类型&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_type.sort <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;排序&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_type.status <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;状态（0正常 1停用）&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_type.create_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_type.creator <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建人&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_type.update_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;更新时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_type.updater <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;更新人&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_type.delete_flag <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;是否删除&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_type.delete_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;删除时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_type.version <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;乐观锁版本号&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_type.remark <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;备注&#x27;</span>;<br><br><span class="hljs-comment">-- 创建索引</span><br><span class="hljs-keyword">CREATE</span> INDEX idx_dict_type_status <span class="hljs-keyword">ON</span> sys_dict_type (status);<br><span class="hljs-keyword">CREATE</span> INDEX idx_dict_type_delete_flag <span class="hljs-keyword">ON</span> sys_dict_type (delete_flag);<br></code></pre></td></tr></table></figure><h3 id="8-2-字典数据表-sys-dict-data"><a href="#8-2-字典数据表-sys-dict-data" class="headerlink" title="8.2 字典数据表 (sys_dict_data)"></a>8.2 字典数据表 (sys_dict_data)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> sys_dict_data (<br>    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY KEY</span> <span class="hljs-keyword">DEFAULT</span> next_id(),<br>    dict_sort <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,<br>    dict_label <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    dict_value <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    dict_type <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    css_class <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    list_class <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    is_default yes_no_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;N&#x27;</span>,<br>    sort <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,<br>    status status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;1&#x27;</span>,<br>    create_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    creator <span class="hljs-type">BIGINT</span>,<br>    update_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    updater <span class="hljs-type">BIGINT</span>,<br>    delete_flag status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    delete_at <span class="hljs-type">TIMESTAMP</span>,<br>    version <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,<br>    remark <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>)<br>);<br><br><span class="hljs-comment">-- 添加注释</span><br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">TABLE</span> sys_dict_data <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;字典数据表&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_data.id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;数据编号&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_data.dict_sort <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;字典排序&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_data.dict_label <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;字典标签&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_data.dict_value <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;字典键值&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_data.dict_type <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;字典类型&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_data.css_class <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;表格回显样式&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_data.list_class <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;表格列表样式&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_data.is_default <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;是否默认（Y是 N否）&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_data.sort <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;排序&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_data.status <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;状态（0正常 1停用）&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_data.create_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_data.creator <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建人&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_data.update_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;更新时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_data.updater <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;更新人&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_data.delete_flag <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;是否删除&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_data.delete_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;删除时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_data.version <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;乐观锁版本号&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_dict_data.remark <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;备注&#x27;</span>;<br><br><span class="hljs-comment">-- 创建索引</span><br><span class="hljs-keyword">CREATE</span> INDEX idx_dict_data_type_status <span class="hljs-keyword">ON</span> sys_dict_data (dict_type, status);<br><span class="hljs-keyword">CREATE</span> INDEX idx_dict_data_sort <span class="hljs-keyword">ON</span> sys_dict_data (dict_sort);<br><span class="hljs-keyword">CREATE</span> INDEX idx_dict_data_delete_flag <span class="hljs-keyword">ON</span> sys_dict_data (delete_flag);<br><br><span class="hljs-comment">-- 添加外键约束</span><br><span class="hljs-keyword">ALTER TABLE</span> sys_dict_data <span class="hljs-keyword">ADD CONSTRAINT</span> fk_data_type<br><span class="hljs-keyword">FOREIGN KEY</span> (dict_type) <span class="hljs-keyword">REFERENCES</span> sys_dict_type (dict_type) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE;<br></code></pre></td></tr></table></figure><h3 id="8-3-参数配置表-sys-params"><a href="#8-3-参数配置表-sys-params" class="headerlink" title="8.3 参数配置表 (sys_params)"></a>8.3 参数配置表 (sys_params)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> sys_params (<br>    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY KEY</span> <span class="hljs-keyword">DEFAULT</span> next_id(),<br>    param_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    param_key <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    param_value <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>),<br>    is_system status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    is_encrypted status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    sort <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,<br>    status status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;1&#x27;</span>,<br>    remark <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>),<br>    create_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    creator <span class="hljs-type">BIGINT</span>,<br>    update_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    updater <span class="hljs-type">BIGINT</span>,<br>    delete_flag status_enum <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span>,<br>    delete_at <span class="hljs-type">TIMESTAMP</span>,<br>    version <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,<br>    <span class="hljs-keyword">CONSTRAINT</span> uk_param_key <span class="hljs-keyword">UNIQUE</span> (param_key)<br>);<br><br><span class="hljs-comment">-- 添加注释</span><br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">TABLE</span> sys_params <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;参数配置表&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_params.id <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;参数ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_params.param_name <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;参数名称&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_params.param_key <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;参数键名&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_params.param_value <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;参数键值&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_params.is_system <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;系统内置（0-否 1-是）&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_params.is_encrypted <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;是否加密（0-否 1-是）&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_params.sort <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;排序&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_params.status <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;状态（0正常 1停用）&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_params.remark <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;备注&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_params.create_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_params.creator <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;创建人ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_params.update_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;更新时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_params.updater <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;更新人ID&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_params.delete_flag <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;是否删除：0-否，1-是&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_params.delete_at <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;删除时间&#x27;</span>;<br>COMMENT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">COLUMN</span> sys_params.version <span class="hljs-keyword">IS</span> <span class="hljs-string">&#x27;乐观锁版本号&#x27;</span>;<br><br><span class="hljs-comment">-- 创建索引</span><br><span class="hljs-keyword">CREATE</span> INDEX idx_params_is_system <span class="hljs-keyword">ON</span> sys_params (is_system);<br><span class="hljs-keyword">CREATE</span> INDEX idx_params_status <span class="hljs-keyword">ON</span> sys_params (status);<br><span class="hljs-keyword">CREATE</span> INDEX idx_params_delete_flag <span class="hljs-keyword">ON</span> sys_params (delete_flag);<br></code></pre></td></tr></table></figure><h2 id="9-外键约束"><a href="#9-外键约束" class="headerlink" title="9. 外键约束"></a>9. 外键约束</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 部门表外键</span><br><span class="hljs-keyword">ALTER TABLE</span> sys_dept <span class="hljs-keyword">ADD CONSTRAINT</span> fk_dept_leader<br><span class="hljs-keyword">FOREIGN KEY</span> (leader_id) <span class="hljs-keyword">REFERENCES</span> sys_user (id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">NULL</span>;<br><br><span class="hljs-comment">-- 岗位表外键</span><br><span class="hljs-keyword">ALTER TABLE</span> sys_post <span class="hljs-keyword">ADD CONSTRAINT</span> fk_post_dept<br><span class="hljs-keyword">FOREIGN KEY</span> (dept_id) <span class="hljs-keyword">REFERENCES</span> sys_dept (id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE;<br><br><span class="hljs-comment">-- 用户表外键</span><br><span class="hljs-keyword">ALTER TABLE</span> sys_user <span class="hljs-keyword">ADD CONSTRAINT</span> fk_user_dept<br><span class="hljs-keyword">FOREIGN KEY</span> (dept_id) <span class="hljs-keyword">REFERENCES</span> sys_dept (id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">NULL</span>;<br><span class="hljs-keyword">ALTER TABLE</span> sys_user <span class="hljs-keyword">ADD CONSTRAINT</span> fk_user_post<br><span class="hljs-keyword">FOREIGN KEY</span> (post_id) <span class="hljs-keyword">REFERENCES</span> sys_post (id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">NULL</span>;<br><br><span class="hljs-comment">-- 用户角色关联表外键</span><br><span class="hljs-keyword">ALTER TABLE</span> sys_user_role <span class="hljs-keyword">ADD CONSTRAINT</span> fk_ur_user<br><span class="hljs-keyword">FOREIGN KEY</span> (user_id) <span class="hljs-keyword">REFERENCES</span> sys_user (id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE;<br><span class="hljs-keyword">ALTER TABLE</span> sys_user_role <span class="hljs-keyword">ADD CONSTRAINT</span> fk_ur_role<br><span class="hljs-keyword">FOREIGN KEY</span> (role_id) <span class="hljs-keyword">REFERENCES</span> sys_role (id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE;<br><br><span class="hljs-comment">-- 角色菜单关联表外键</span><br><span class="hljs-keyword">ALTER TABLE</span> sys_role_menu <span class="hljs-keyword">ADD CONSTRAINT</span> fk_rm_role<br><span class="hljs-keyword">FOREIGN KEY</span> (role_id) <span class="hljs-keyword">REFERENCES</span> sys_role (id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE;<br><span class="hljs-keyword">ALTER TABLE</span> sys_role_menu <span class="hljs-keyword">ADD CONSTRAINT</span> fk_rm_menu<br><span class="hljs-keyword">FOREIGN KEY</span> (menu_id) <span class="hljs-keyword">REFERENCES</span> sys_menu (id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE;<br><br><span class="hljs-comment">-- 角色部门关联表外键</span><br><span class="hljs-keyword">ALTER TABLE</span> sys_role_dept <span class="hljs-keyword">ADD CONSTRAINT</span> fk_rd_role<br><span class="hljs-keyword">FOREIGN KEY</span> (role_id) <span class="hljs-keyword">REFERENCES</span> sys_role (id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE;<br><span class="hljs-keyword">ALTER TABLE</span> sys_role_dept <span class="hljs-keyword">ADD CONSTRAINT</span> fk_rd_dept<br><span class="hljs-keyword">FOREIGN KEY</span> (dept_id) <span class="hljs-keyword">REFERENCES</span> sys_dept (id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE;<br><br><span class="hljs-comment">-- 租户相关外键</span><br><span class="hljs-keyword">ALTER TABLE</span> sys_tenant <span class="hljs-keyword">ADD CONSTRAINT</span> fk_tenant_package<br><span class="hljs-keyword">FOREIGN KEY</span> (package_id) <span class="hljs-keyword">REFERENCES</span> sys_tenant_package (id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">NULL</span>;<br><span class="hljs-keyword">ALTER TABLE</span> sys_tenant_config <span class="hljs-keyword">ADD CONSTRAINT</span> fk_config_tenant<br><span class="hljs-keyword">FOREIGN KEY</span> (tenant_id) <span class="hljs-keyword">REFERENCES</span> sys_tenant (id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE;<br></code></pre></td></tr></table></figure><h2 id="10-触发器和函数"><a href="#10-触发器和函数" class="headerlink" title="10. 触发器和函数"></a>10. 触发器和函数</h2><h3 id="10-1-更新时间触发器函数"><a href="#10-1-更新时间触发器函数" class="headerlink" title="10.1 更新时间触发器函数"></a>10.1 更新时间触发器函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">FUNCTION</span> update_modified_column()<br><span class="hljs-keyword">RETURNS</span> <span class="hljs-keyword">TRIGGER</span> <span class="hljs-keyword">AS</span> $$<br><span class="hljs-keyword">BEGIN</span><br>    NEW.update_at <span class="hljs-operator">=</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>;<br>    <span class="hljs-keyword">RETURN</span> <span class="hljs-keyword">NEW</span>;<br><span class="hljs-keyword">END</span>;<br>$$ <span class="hljs-keyword">language</span> <span class="hljs-string">&#x27;plpgsql&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="10-2-创建更新时间触发器"><a href="#10-2-创建更新时间触发器" class="headerlink" title="10.2 创建更新时间触发器"></a>10.2 创建更新时间触发器</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 部门表触发器</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> tr_dept_update BEFORE <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">ON</span> sys_dept<br>    <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">EACH</span> <span class="hljs-type">ROW</span> <span class="hljs-keyword">EXECUTE</span> <span class="hljs-keyword">FUNCTION</span> update_modified_column();<br><br><span class="hljs-comment">-- 岗位表触发器</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> tr_post_update BEFORE <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">ON</span> sys_post<br>    <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">EACH</span> <span class="hljs-type">ROW</span> <span class="hljs-keyword">EXECUTE</span> <span class="hljs-keyword">FUNCTION</span> update_modified_column();<br><br><span class="hljs-comment">-- 用户表触发器</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> tr_user_update BEFORE <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">ON</span> sys_user<br>    <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">EACH</span> <span class="hljs-type">ROW</span> <span class="hljs-keyword">EXECUTE</span> <span class="hljs-keyword">FUNCTION</span> update_modified_column();<br><br><span class="hljs-comment">-- 角色表触发器</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> tr_role_update BEFORE <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">ON</span> sys_role<br>    <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">EACH</span> <span class="hljs-type">ROW</span> <span class="hljs-keyword">EXECUTE</span> <span class="hljs-keyword">FUNCTION</span> update_modified_column();<br><br><span class="hljs-comment">-- 菜单表触发器</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> tr_menu_update BEFORE <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">ON</span> sys_menu<br>    <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">EACH</span> <span class="hljs-type">ROW</span> <span class="hljs-keyword">EXECUTE</span> <span class="hljs-keyword">FUNCTION</span> update_modified_column();<br><br><span class="hljs-comment">-- 租户表触发器</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> tr_tenant_update BEFORE <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">ON</span> sys_tenant<br>    <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">EACH</span> <span class="hljs-type">ROW</span> <span class="hljs-keyword">EXECUTE</span> <span class="hljs-keyword">FUNCTION</span> update_modified_column();<br><br><span class="hljs-comment">-- 租户套餐表触发器</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> tr_tenant_package_update BEFORE <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">ON</span> sys_tenant_package<br>    <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">EACH</span> <span class="hljs-type">ROW</span> <span class="hljs-keyword">EXECUTE</span> <span class="hljs-keyword">FUNCTION</span> update_modified_column();<br><br><span class="hljs-comment">-- 租户配置表触发器</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> tr_tenant_config_update BEFORE <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">ON</span> sys_tenant_config<br>    <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">EACH</span> <span class="hljs-type">ROW</span> <span class="hljs-keyword">EXECUTE</span> <span class="hljs-keyword">FUNCTION</span> update_modified_column();<br><br><span class="hljs-comment">-- 字典类型表触发器</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> tr_dict_type_update BEFORE <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">ON</span> sys_dict_type<br>    <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">EACH</span> <span class="hljs-type">ROW</span> <span class="hljs-keyword">EXECUTE</span> <span class="hljs-keyword">FUNCTION</span> update_modified_column();<br><br><span class="hljs-comment">-- 字典数据表触发器</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> tr_dict_data_update BEFORE <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">ON</span> sys_dict_data<br>    <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">EACH</span> <span class="hljs-type">ROW</span> <span class="hljs-keyword">EXECUTE</span> <span class="hljs-keyword">FUNCTION</span> update_modified_column();<br><br><span class="hljs-comment">-- 参数配置表触发器</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> tr_params_update BEFORE <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">ON</span> sys_params<br>    <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">EACH</span> <span class="hljs-type">ROW</span> <span class="hljs-keyword">EXECUTE</span> <span class="hljs-keyword">FUNCTION</span> update_modified_column();<br></code></pre></td></tr></table></figure><h3 id="10-3-密码加密函数"><a href="#10-3-密码加密函数" class="headerlink" title="10.3 密码加密函数"></a>10.3 密码加密函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">FUNCTION</span> encrypt_password(p_password TEXT)<br><span class="hljs-keyword">RETURNS</span> TEXT <span class="hljs-keyword">AS</span> $$<br><span class="hljs-keyword">BEGIN</span><br>    <span class="hljs-keyword">RETURN</span> encode(digest(p_password, <span class="hljs-string">&#x27;sha256&#x27;</span>), <span class="hljs-string">&#x27;hex&#x27;</span>);<br><span class="hljs-keyword">END</span>;<br>$$ <span class="hljs-keyword">LANGUAGE</span> plpgsql SECURITY DEFINER;<br></code></pre></td></tr></table></figure><h2 id="11-初始化数据"><a href="#11-初始化数据" class="headerlink" title="11. 初始化数据"></a>11. 初始化数据</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 默认超级管理员</span><br><span class="hljs-keyword">INSERT INTO</span> sys_user (id, username, password, nickname, real_name, email, status)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;admin&#x27;</span>, encrypt_password(<span class="hljs-string">&#x27;admin123&#x27;</span>), <span class="hljs-string">&#x27;超级管理员&#x27;</span>, <span class="hljs-string">&#x27;系统管理员&#x27;</span>, <span class="hljs-string">&#x27;admin@example.com&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>);<br><br><span class="hljs-comment">-- 默认角色</span><br><span class="hljs-keyword">INSERT INTO</span> sys_role (id, role_name, role_code, remark, data_scope)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;超级管理员&#x27;</span>, <span class="hljs-string">&#x27;ROLE_ADMIN&#x27;</span>, <span class="hljs-string">&#x27;系统超级管理员&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>);<br><br><span class="hljs-comment">-- 用户角色关联</span><br><span class="hljs-keyword">INSERT INTO</span> sys_user_role (user_id, role_id) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);<br><br><span class="hljs-comment">-- 默认部门</span><br><span class="hljs-keyword">INSERT INTO</span> sys_dept (id, dept_name, dept_code, parent_id, status)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;总公司&#x27;</span>, <span class="hljs-string">&#x27;ROOT&#x27;</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;1&#x27;</span>);<br><br><span class="hljs-comment">-- 更新超级管理员部门</span><br><span class="hljs-keyword">UPDATE</span> sys_user <span class="hljs-keyword">SET</span> dept_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br><span class="hljs-comment">-- 默认菜单数据</span><br><span class="hljs-keyword">INSERT INTO</span> sys_menu (menu_name, menu_code, parent_id, menu_type, path, icon, sort) <span class="hljs-keyword">VALUES</span><br>(<span class="hljs-string">&#x27;系统管理&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;/system&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>, <span class="hljs-number">1</span>),<br>(<span class="hljs-string">&#x27;用户管理&#x27;</span>, <span class="hljs-string">&#x27;system:user&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-number">1</span>),<br>(<span class="hljs-string">&#x27;角色管理&#x27;</span>, <span class="hljs-string">&#x27;system:role&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;role&#x27;</span>, <span class="hljs-string">&#x27;role&#x27;</span>, <span class="hljs-number">2</span>),<br>(<span class="hljs-string">&#x27;菜单管理&#x27;</span>, <span class="hljs-string">&#x27;system:menu&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;menu&#x27;</span>, <span class="hljs-string">&#x27;menu&#x27;</span>, <span class="hljs-number">3</span>),<br>(<span class="hljs-string">&#x27;部门管理&#x27;</span>, <span class="hljs-string">&#x27;system:dept&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;dept&#x27;</span>, <span class="hljs-string">&#x27;dept&#x27;</span>, <span class="hljs-number">4</span>),<br>(<span class="hljs-string">&#x27;岗位管理&#x27;</span>, <span class="hljs-string">&#x27;system:post&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;post&#x27;</span>, <span class="hljs-string">&#x27;post&#x27;</span>, <span class="hljs-number">5</span>);<br><br><span class="hljs-comment">-- 默认字典类型</span><br><span class="hljs-keyword">INSERT INTO</span> sys_dict_type (dict_name, dict_type) <span class="hljs-keyword">VALUES</span><br>(<span class="hljs-string">&#x27;用户性别&#x27;</span>, <span class="hljs-string">&#x27;user_gender&#x27;</span>),<br>(<span class="hljs-string">&#x27;菜单类型&#x27;</span>, <span class="hljs-string">&#x27;menu_type&#x27;</span>),<br>(<span class="hljs-string">&#x27;数据权限&#x27;</span>, <span class="hljs-string">&#x27;data_scope&#x27;</span>),<br>(<span class="hljs-string">&#x27;业务类型&#x27;</span>, <span class="hljs-string">&#x27;business_type&#x27;</span>);<br><br><span class="hljs-comment">-- 默认字典数据</span><br><span class="hljs-keyword">INSERT INTO</span> sys_dict_data (dict_label, dict_value, dict_type, dict_sort) <span class="hljs-keyword">VALUES</span><br>(<span class="hljs-string">&#x27;未知&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;user_gender&#x27;</span>, <span class="hljs-number">1</span>),<br>(<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;user_gender&#x27;</span>, <span class="hljs-number">2</span>),<br>(<span class="hljs-string">&#x27;女&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;user_gender&#x27;</span>, <span class="hljs-number">3</span>),<br>(<span class="hljs-string">&#x27;目录&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;menu_type&#x27;</span>, <span class="hljs-number">1</span>),<br>(<span class="hljs-string">&#x27;菜单&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;menu_type&#x27;</span>, <span class="hljs-number">2</span>),<br>(<span class="hljs-string">&#x27;按钮&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;menu_type&#x27;</span>, <span class="hljs-number">3</span>),<br>(<span class="hljs-string">&#x27;全部数据&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;data_scope&#x27;</span>, <span class="hljs-number">1</span>),<br>(<span class="hljs-string">&#x27;本部门数据&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;data_scope&#x27;</span>, <span class="hljs-number">2</span>),<br>(<span class="hljs-string">&#x27;本部门及下级&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;data_scope&#x27;</span>, <span class="hljs-number">3</span>),<br>(<span class="hljs-string">&#x27;自定义数据&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>, <span class="hljs-string">&#x27;data_scope&#x27;</span>, <span class="hljs-number">4</span>);<br></code></pre></td></tr></table></figure><h2 id="12-完整SQL脚本"><a href="#12-完整SQL脚本" class="headerlink" title="12. 完整SQL脚本"></a>12. 完整SQL脚本</h2><p>完整的PostgreSQL建表脚本已保存为：</p><ul><li>[[企业级权限管理系统数据库设计-PostgreSQL版本-complete.sql]] - 可直接执行的完整SQL脚本</li></ul><h2 id="13-相关链接"><a href="#13-相关链接" class="headerlink" title="13. 相关链接"></a>13. 相关链接</h2><ul><li>[[企业级权限管理系统数据库设计]] - 主设计文档</li><li>[[企业级权限管理系统数据库设计-MySQL版本]] - MySQL版本</li></ul>]]></content>
    
    
    <categories>
      
      <category>数据库</category>
      
    </categories>
    
    
    <tags>
      
      <tag>数据库</tag>
      
      <tag>RBAC</tag>
      
      <tag>PostgreSQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>企业级权限管理系统数据库设计</title>
    <link href="/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/%E4%BC%81%E4%B8%9A%E7%BA%A7%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/13770/"/>
    <url>/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/%E4%BC%81%E4%B8%9A%E7%BA%A7%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/13770/</url>
    
    <content type="html"><![CDATA[<h1 id="企业级权限管理系统数据库设计"><a href="#企业级权限管理系统数据库设计" class="headerlink" title="企业级权限管理系统数据库设计"></a>企业级权限管理系统数据库设计</h1><p>本文档介绍了一个完整的企业级权限管理系统数据库设计，采用 RBAC (Role-Based Access Control) 模型，并扩展了组织架构管理功能，适用于中大型企业管理系统。</p><h2 id="1-表结构概览"><a href="#1-表结构概览" class="headerlink" title="1. 表结构概览"></a>1. 表结构概览</h2><h3 id="1-1-核心业务表"><a href="#1-1-核心业务表" class="headerlink" title="1.1 核心业务表"></a>1.1 核心业务表</h3><table><thead><tr><th>表名</th><th>表说明</th><th>作用</th></tr></thead><tbody><tr><td><strong>sys_user</strong></td><td>用户表</td><td>存储系统用户的基本信息，包含部门、岗位关联</td></tr><tr><td><strong>sys_role</strong></td><td>角色表</td><td>定义系统中的各种角色，包含数据权限配置</td></tr><tr><td><strong>sys_menu</strong></td><td>菜单表</td><td>管理系统的菜单结构和权限点</td></tr><tr><td><strong>sys_dept</strong></td><td>部门表</td><td>组织架构管理，支持树形结构</td></tr><tr><td><strong>sys_post</strong></td><td>岗位表</td><td>职位管理，与部门关联</td></tr><tr><td><strong>sys_tenant</strong></td><td>租户表</td><td>多租户系统租户信息</td></tr><tr><td><strong>sys_tenant_package</strong></td><td>租户套餐表</td><td>租户套餐配置</td></tr><tr><td><strong>sys_tenant_config</strong></td><td>租户配置表</td><td>租户个性化配置</td></tr><tr><td><strong>sys_dict_type</strong></td><td>字典类型表</td><td>系统字典类型管理</td></tr><tr><td><strong>sys_dict_data</strong></td><td>字典数据表</td><td>字典具体数据</td></tr><tr><td><strong>sys_params</strong></td><td>参数表</td><td>系统参数配置</td></tr><tr><td><strong>sys_login_log</strong></td><td>登录日志表</td><td>记录用户登录登出日志</td></tr><tr><td><strong>sys_operation_log</strong></td><td>操作日志表</td><td>记录用户关键操作日志</td></tr><tr><td><strong>sys_error_log</strong></td><td>错误日志表</td><td>记录系统错误和异常日志</td></tr></tbody></table><h3 id="1-2-关联表"><a href="#1-2-关联表" class="headerlink" title="1.2 关联表"></a>1.2 关联表</h3><table><thead><tr><th>表名</th><th>表说明</th><th>作用</th></tr></thead><tbody><tr><td><strong>sys_user_role</strong></td><td>用户角色关联表</td><td>建立用户和角色之间的多对多关系</td></tr><tr><td><strong>sys_role_menu</strong></td><td>角色菜单关联表</td><td>建立角色和菜单之间的多对多关系</td></tr><tr><td><strong>sys_role_dept</strong></td><td>角色部门关联表</td><td>建立角色和数据权限部门的关系</td></tr></tbody></table><h3 id="1-3-统一字段规范"><a href="#1-3-统一字段规范" class="headerlink" title="1.3 统一字段规范"></a>1.3 统一字段规范</h3><p>所有业务表（非关联表）都包含以下统一字段：</p><table><thead><tr><th>字段名</th><th>类型</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td>id</td><td>BIGINT</td><td>主键ID，自增</td><td>-</td></tr><tr><td>create_at</td><td>DATETIME&#x2F;TIMESTAMP</td><td>创建时间</td><td>CURRENT_TIMESTAMP</td></tr><tr><td>creator</td><td>BIGINT</td><td>创建人ID</td><td>-</td></tr><tr><td>update_at</td><td>DATETIME&#x2F;TIMESTAMP</td><td>更新时间</td><td>CURRENT_TIMESTAMP</td></tr><tr><td>updater</td><td>BIGINT</td><td>更新人ID</td><td>-</td></tr><tr><td>delete_flag</td><td>TINYINT&#x2F;SMALLINT</td><td>是否删除：0-否，1-是</td><td>0</td></tr><tr><td>delete_at</td><td>DATETIME&#x2F;TIMESTAMP</td><td>删除时间</td><td>NULL</td></tr><tr><td>sort</td><td>INT</td><td>排序</td><td>0</td></tr><tr><td>status</td><td>TINYINT</td><td>状态: 0-禁用，1-正常</td><td>0</td></tr><tr><td>version</td><td>INT</td><td>乐观锁版本号</td><td>1</td></tr></tbody></table><h3 id="1-4-额外统一字段规范"><a href="#1-4-额外统一字段规范" class="headerlink" title="1.4 额外统一字段规范"></a>1.4 额外统一字段规范</h3><table><thead><tr><th>字段名</th><th>类型</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td>dept_id</td><td>BIGINT</td><td>部门ID</td><td>NULL</td></tr><tr><td>role_id</td><td>BIGINT</td><td>角色ID</td><td>NULL</td></tr><tr><td>tenant_id</td><td>BIGINT</td><td>租户ID</td><td>NULL</td></tr></tbody></table><h2 id="2-表关系图"><a href="#2-表关系图" class="headerlink" title="2. 表关系图"></a>2. 表关系图</h2><pre><code class=" mermaid">erDiagram    %% 核心业务关系    sys_dept ||--o&#123; sys_user : &quot;所属部门&quot;    sys_dept ||--o&#123; sys_post : &quot;部门岗位&quot;    sys_post &#125;o--|| sys_user : &quot;用户岗位&quot;    sys_user &#125;o--o&#123; sys_user_role : &quot;用户角色&quot;    sys_role ||--o&#123; sys_user_role : &quot;角色用户&quot;    sys_role ||--o&#123; sys_role_menu : &quot;角色菜单&quot;    sys_menu ||--o&#123; sys_role_menu : &quot;菜单角色&quot;    sys_role ||--o&#123; sys_role_dept : &quot;角色数据权限&quot;    sys_dept ||--o&#123; sys_role_dept : &quot;数据权限部门&quot;    %% 日志表关系    sys_user ||--o&#123; sys_login_log : &quot;用户登录日志&quot;    sys_user ||--o&#123; sys_operation_log : &quot;用户操作日志&quot;    sys_user ||--o&#123; sys_error_log : &quot;用户错误日志&quot;    %% 系统配置表关系    sys_tenant_package ||--o&#123; sys_tenant : &quot;租户套餐&quot;    sys_tenant ||--o&#123; sys_tenant_config : &quot;租户配置&quot;    sys_dict_type ||--o&#123; sys_dict_data : &quot;字典数据&quot;    %% 核心业务表    sys_dept &#123;        bigint id PK        varchar dept_name        varchar dept_code        bigint parent_id        bigint leader_id FK        varchar leader_phone        varchar leader_email        tinyint status        int sort_order        datetime create_at        bigint creator        datetime update_at        bigint updater        tinyint delete_flag        datetime delete_at        int version    &#125;    sys_post &#123;        bigint id PK        varchar post_name        varchar post_code        bigint dept_id FK        int sort_order        tinyint status        datetime create_at        bigint creator        datetime update_at        bigint updater        tinyint delete_flag        datetime delete_at        int version    &#125;    sys_user &#123;        bigint id PK        varchar username        varchar password        varchar nickname        varchar real_name        varchar email        varchar phone        varchar avatar        char sex        date birthday        bigint dept_id FK        bigint post_id FK        varchar address        varchar remark        tinyint status        datetime last_login_time        varchar last_login_ip        datetime create_at        bigint creator        datetime update_at        bigint updater        tinyint delete_flag        datetime delete_at        int version    &#125;    sys_role &#123;        bigint id PK        varchar role_name        varchar role_code        varchar description        tinyint data_scope        int sort_order        tinyint status        datetime create_at        bigint creator        datetime update_at        bigint updater        tinyint delete_flag        datetime delete_at        int version    &#125;    sys_menu &#123;        bigint id PK        varchar menu_name        varchar menu_code        bigint parent_id        tinyint menu_type        varchar path        varchar component        varchar icon        varchar permission        varchar target        tinyint is_cache        tinyint is_visible        tinyint is_external        int sort_order        tinyint status        datetime create_at        bigint creator        datetime update_at        bigint updater        tinyint delete_flag        datetime delete_at        int version    &#125;    %% 日志表    sys_login_log &#123;        bigint id PK        varchar username        bigint user_id FK        varchar ipaddr        varchar login_location        varchar browser        varchar os        varchar device        tinyint status        varchar message        datetime login_time    &#125;    sys_operation_log &#123;        bigint id PK        varchar title        tinyint business_type        varchar business_type_name        varchar method        varchar request_method        tinyint operator_type        varchar operator_name        varchar dept_name        varchar operation_url        varchar operation_ip        varchar operation_location        text operation_param        text json_result        tinyint operation_status        varchar error_msg        datetime operation_time        bigint cost_time    &#125;    sys_error_log &#123;        bigint id PK        varchar title        varchar request_uri        varchar request_method        text request_params        bigint user_id FK        varchar username        varchar user_ip        varchar user_agent        text exception_info        varchar exception_name        text stack_trace        int line_number        varchar class_name        varchar method_name        tinyint status        bigint process_user_id FK        varchar process_user_name        varchar process_remark        datetime process_time        datetime create_time    &#125;    %% 系统配置表    sys_tenant &#123;        bigint id PK        varchar tenant_name        varchar tenant_code        varchar contact_name        varchar contact_phone        varchar contact_email        varchar domain        bigint package_id FK        datetime expire_time        tinyint status        datetime create_at        bigint creator        datetime update_at        bigint updater        tinyint delete_flag        datetime delete_at        int version    &#125;    sys_tenant_package &#123;        bigint id PK        varchar package_name        varchar package_code        varchar description        int max_users        int max_roles        int max_menus        bigint max_storage        tinyint status        datetime create_at        bigint creator        datetime update_at        bigint updater        tinyint delete_flag        datetime delete_at        int version    &#125;    sys_tenant_config &#123;        bigint id PK        bigint tenant_id FK        varchar config_key        text config_value        tinyint config_type        varchar remark        datetime create_at        bigint creator        datetime update_at        bigint updater        tinyint delete_flag        datetime delete_at        int version    &#125;    sys_dict_type &#123;        bigint id PK        varchar dict_name        varchar dict_type        varchar description        tinyint status        datetime create_at        bigint creator        datetime update_at        bigint updater        tinyint delete_flag        datetime delete_at        int version    &#125;    sys_dict_data &#123;        bigint id PK        int dict_sort        varchar dict_label        varchar dict_value        varchar dict_type        varchar css_class        varchar list_class        tinyint is_default        tinyint status        datetime create_at        bigint creator        datetime update_at        bigint updater        tinyint delete_flag        datetime delete_at        int version    &#125;    sys_params &#123;        bigint id PK        varchar param_name        varchar param_key        text param_value        tinyint is_system        varchar remark        datetime create_at        bigint creator        datetime update_at        bigint updater        tinyint delete_flag        datetime delete_at        int version    &#125;    %% 关联表    sys_user_role &#123;        bigint id PK        bigint user_id FK        bigint role_id FK    &#125;    sys_role_menu &#123;        bigint id PK        bigint role_id FK        bigint menu_id FK    &#125;    sys_role_dept &#123;        bigint id PK        bigint role_id FK        bigint dept_id FK    &#125;</code></pre><h2 id="3-表字段详细说明"><a href="#3-表字段详细说明" class="headerlink" title="3. 表字段详细说明"></a>3. 表字段详细说明</h2><h3 id="3-1-部门表-sys-dept"><a href="#3-1-部门表-sys-dept" class="headerlink" title="3.1 部门表 (sys_dept)"></a>3.1 部门表 (sys_dept)</h3><table><thead><tr><th>字段名</th><th>类型</th><th>长度</th><th>允许空</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>BIGINT</td><td>-</td><td>NO</td><td>AUTO_INCREMENT</td><td>部门ID</td></tr><tr><td>dept_name</td><td>VARCHAR</td><td>50</td><td>NO</td><td>-</td><td>部门名称</td></tr><tr><td>dept_code</td><td>VARCHAR</td><td>50</td><td>NO</td><td>-</td><td>部门编码</td></tr><tr><td>parent_id</td><td>BIGINT</td><td>-</td><td>NO</td><td>0</td><td>父部门ID</td></tr><tr><td>leader_id</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>负责人用户ID</td></tr><tr><td>leader_phone</td><td>VARCHAR</td><td>20</td><td>YES</td><td>NULL</td><td>负责人联系电话</td></tr><tr><td>leader_email</td><td>VARCHAR</td><td>100</td><td>YES</td><td>NULL</td><td>负责人邮箱</td></tr><tr><td>status</td><td>TINYINT</td><td>-</td><td>NO</td><td>1</td><td>状态：0-禁用，1-正常</td></tr><tr><td>sort</td><td>INT</td><td>-</td><td>NO</td><td>0</td><td>排序</td></tr><tr><td>create_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP</td><td>创建时间</td></tr><tr><td>creator</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>创建人ID</td></tr><tr><td>update_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP ON UPDATE</td><td>更新时间</td></tr><tr><td>updater</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>更新人ID</td></tr><tr><td>delete_flag</td><td>TINYINT</td><td>-</td><td>NO</td><td>0</td><td>是否删除：0-否，1-是</td></tr><tr><td>delete_at</td><td>DATETIME</td><td>-</td><td>YES</td><td>NULL</td><td>删除时间</td></tr><tr><td>version</td><td>INT</td><td>-</td><td>NO</td><td>1</td><td>乐观锁版本号</td></tr><tr><td>tenant_id</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>租户ID</td></tr></tbody></table><h3 id="3-2-岗位表-sys-post"><a href="#3-2-岗位表-sys-post" class="headerlink" title="3.2 岗位表 (sys_post)"></a>3.2 岗位表 (sys_post)</h3><table><thead><tr><th>字段名</th><th>类型</th><th>长度</th><th>允许空</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>BIGINT</td><td>-</td><td>NO</td><td>AUTO_INCREMENT</td><td>岗位ID</td></tr><tr><td>post_name</td><td>VARCHAR</td><td>50</td><td>NO</td><td>-</td><td>岗位名称</td></tr><tr><td>post_code</td><td>VARCHAR</td><td>50</td><td>NO</td><td>-</td><td>岗位编码</td></tr><tr><td>dept_id</td><td>BIGINT</td><td>-</td><td>NO</td><td>-</td><td>所属部门ID</td></tr><tr><td>sort</td><td>INT</td><td>-</td><td>NO</td><td>0</td><td>排序</td></tr><tr><td>status</td><td>TINYINT</td><td>-</td><td>NO</td><td>1</td><td>状态：0-禁用，1-正常</td></tr><tr><td>create_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP</td><td>创建时间</td></tr><tr><td>creator</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>创建人ID</td></tr><tr><td>update_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP ON UPDATE</td><td>更新时间</td></tr><tr><td>updater</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>更新人ID</td></tr><tr><td>delete_flag</td><td>TINYINT</td><td>-</td><td>NO</td><td>0</td><td>是否删除：0-否，1-是</td></tr><tr><td>delete_at</td><td>DATETIME</td><td>-</td><td>YES</td><td>NULL</td><td>删除时间</td></tr><tr><td>version</td><td>INT</td><td>-</td><td>NO</td><td>1</td><td>乐观锁版本号</td></tr><tr><td>tenant_id</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>租户ID</td></tr></tbody></table><h3 id="3-3-用户表-sys-user"><a href="#3-3-用户表-sys-user" class="headerlink" title="3.3 用户表 (sys_user)"></a>3.3 用户表 (sys_user)</h3><table><thead><tr><th>字段名</th><th>类型</th><th>长度</th><th>允许空</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>BIGINT</td><td>-</td><td>NO</td><td>AUTO_INCREMENT</td><td>用户ID</td></tr><tr><td>username</td><td>VARCHAR</td><td>50</td><td>NO</td><td>-</td><td>用户名</td></tr><tr><td>password</td><td>VARCHAR</td><td>100</td><td>NO</td><td>-</td><td>密码</td></tr><tr><td>nickname</td><td>VARCHAR</td><td>50</td><td>YES</td><td>NULL</td><td>昵称</td></tr><tr><td>real_name</td><td>VARCHAR</td><td>50</td><td>YES</td><td>NULL</td><td>真实姓名</td></tr><tr><td>email</td><td>VARCHAR</td><td>100</td><td>YES</td><td>NULL</td><td>邮箱</td></tr><tr><td>phone</td><td>VARCHAR</td><td>20</td><td>YES</td><td>NULL</td><td>手机号</td></tr><tr><td>avatar</td><td>VARCHAR</td><td>255</td><td>YES</td><td>NULL</td><td>头像地址</td></tr><tr><td>sex</td><td>CHAR</td><td>1</td><td>YES</td><td>‘0’</td><td>性别：0-未知，1-男，2-女</td></tr><tr><td>birthday</td><td>DATE</td><td>-</td><td>YES</td><td>NULL</td><td>生日</td></tr><tr><td>dept_id</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>部门ID</td></tr><tr><td>post_id</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>岗位ID</td></tr><tr><td>address</td><td>VARCHAR</td><td>200</td><td>YES</td><td>NULL</td><td>地址</td></tr><tr><td>remark</td><td>VARCHAR</td><td>500</td><td>YES</td><td>NULL</td><td>备注</td></tr><tr><td>sort</td><td>INT</td><td>-</td><td>NO</td><td>0</td><td>排序</td></tr><tr><td>status</td><td>TINYINT</td><td>-</td><td>NO</td><td>1</td><td>状态：0-禁用，1-正常</td></tr><tr><td>last_login_time</td><td>DATETIME</td><td>-</td><td>YES</td><td>NULL</td><td>最后登录时间</td></tr><tr><td>last_login_ip</td><td>VARCHAR</td><td>50</td><td>YES</td><td>NULL</td><td>最后登录IP</td></tr><tr><td>create_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP</td><td>创建时间</td></tr><tr><td>creator</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>创建人ID</td></tr><tr><td>update_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP ON UPDATE</td><td>更新时间</td></tr><tr><td>updater</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>更新人ID</td></tr><tr><td>delete_flag</td><td>TINYINT</td><td>-</td><td>NO</td><td>0</td><td>是否删除：0-否，1-是</td></tr><tr><td>delete_at</td><td>DATETIME</td><td>-</td><td>YES</td><td>NULL</td><td>删除时间</td></tr><tr><td>version</td><td>INT</td><td>-</td><td>NO</td><td>1</td><td>乐观锁版本号</td></tr><tr><td>tenant_id</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>租户ID</td></tr></tbody></table><h3 id="3-4-角色表-sys-role"><a href="#3-4-角色表-sys-role" class="headerlink" title="3.4 角色表 (sys_role)"></a>3.4 角色表 (sys_role)</h3><table><thead><tr><th>字段名</th><th>类型</th><th>长度</th><th>允许空</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>BIGINT</td><td>-</td><td>NO</td><td>AUTO_INCREMENT</td><td>角色ID</td></tr><tr><td>role_name</td><td>VARCHAR</td><td>50</td><td>NO</td><td>-</td><td>角色名称</td></tr><tr><td>role_code</td><td>VARCHAR</td><td>50</td><td>NO</td><td>-</td><td>角色编码</td></tr><tr><td>remark</td><td>VARCHAR</td><td>200</td><td>YES</td><td>NULL</td><td>备注</td></tr><tr><td>data_scope</td><td>TINYINT</td><td>-</td><td>NO</td><td>1</td><td>数据权限：1-全部，2-本部门，3-本部门及下级，4-自定义</td></tr><tr><td>sort</td><td>INT</td><td>-</td><td>NO</td><td>0</td><td>排序</td></tr><tr><td>status</td><td>TINYINT</td><td>-</td><td>NO</td><td>1</td><td>状态：0-禁用，1-正常</td></tr><tr><td>create_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP</td><td>创建时间</td></tr><tr><td>creator</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>创建人ID</td></tr><tr><td>update_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP ON UPDATE</td><td>更新时间</td></tr><tr><td>updater</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>更新人ID</td></tr><tr><td>delete_flag</td><td>TINYINT</td><td>-</td><td>NO</td><td>0</td><td>是否删除：0-否，1-是</td></tr><tr><td>delete_at</td><td>DATETIME</td><td>-</td><td>YES</td><td>NULL</td><td>删除时间</td></tr><tr><td>version</td><td>INT</td><td>-</td><td>NO</td><td>1</td><td>乐观锁版本号</td></tr><tr><td>tenant_id</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>租户ID</td></tr></tbody></table><h3 id="3-5-菜单表-sys-menu"><a href="#3-5-菜单表-sys-menu" class="headerlink" title="3.5 菜单表 (sys_menu)"></a>3.5 菜单表 (sys_menu)</h3><table><thead><tr><th>字段名</th><th>类型</th><th>长度</th><th>允许空</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>BIGINT</td><td>-</td><td>NO</td><td>AUTO_INCREMENT</td><td>菜单ID</td></tr><tr><td>menu_name</td><td>VARCHAR</td><td>50</td><td>NO</td><td>-</td><td>菜单名称</td></tr><tr><td>menu_code</td><td>VARCHAR</td><td>100</td><td>NO</td><td>-</td><td>菜单编码&#x2F;权限标识</td></tr><tr><td>parent_id</td><td>BIGINT</td><td>-</td><td>NO</td><td>0</td><td>父菜单ID</td></tr><tr><td>menu_type</td><td>TINYINT</td><td>-</td><td>NO</td><td>-</td><td>菜单类型：1-目录，2-菜单，3-按钮</td></tr><tr><td>path</td><td>VARCHAR</td><td>200</td><td>YES</td><td>NULL</td><td>路由路径</td></tr><tr><td>component</td><td>VARCHAR</td><td>200</td><td>YES</td><td>NULL</td><td>组件路径</td></tr><tr><td>icon</td><td>VARCHAR</td><td>100</td><td>YES</td><td>NULL</td><td>图标</td></tr><tr><td>permission</td><td>VARCHAR</td><td>100</td><td>YES</td><td>NULL</td><td>权限标识</td></tr><tr><td>target</td><td>VARCHAR</td><td>20</td><td>NO</td><td>‘_self’</td><td>打开方式：_self-当前页，_blank-新页</td></tr><tr><td>is_cache</td><td>TINYINT</td><td>-</td><td>NO</td><td>0</td><td>是否缓存：0-否，1-是</td></tr><tr><td>is_visible</td><td>TINYINT</td><td>-</td><td>NO</td><td>1</td><td>是否显示：0-否，1-是</td></tr><tr><td>is_external</td><td>TINYINT</td><td>-</td><td>NO</td><td>0</td><td>是否外链：0-否，1-是</td></tr><tr><td>sort</td><td>INT</td><td>-</td><td>NO</td><td>0</td><td>排序</td></tr><tr><td>status</td><td>TINYINT</td><td>-</td><td>NO</td><td>1</td><td>状态：0-禁用，1-正常</td></tr><tr><td>create_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP</td><td>创建时间</td></tr><tr><td>creator</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>创建人ID</td></tr><tr><td>update_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP ON UPDATE</td><td>更新时间</td></tr><tr><td>updater</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>更新人ID</td></tr><tr><td>delete_flag</td><td>TINYINT</td><td>-</td><td>NO</td><td>0</td><td>是否删除：0-否，1-是</td></tr><tr><td>delete_at</td><td>DATETIME</td><td>-</td><td>YES</td><td>NULL</td><td>删除时间</td></tr><tr><td>version</td><td>INT</td><td>-</td><td>NO</td><td>1</td><td>乐观锁版本号</td></tr><tr><td>tenant_id</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>租户ID</td></tr></tbody></table><h3 id="3-6-日志表"><a href="#3-6-日志表" class="headerlink" title="3.6 日志表"></a>3.6 日志表</h3><h4 id="3-6-1-登录日志表-sys-login-log"><a href="#3-6-1-登录日志表-sys-login-log" class="headerlink" title="3.6.1 登录日志表 (sys_login_log)"></a>3.6.1 登录日志表 (sys_login_log)</h4><p>| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |<br>| — | — | — | — | — |<br>| id | BIGINT | - | NO | AUTO_INCREMENT | 日志ID |<br>| user_id | BIGINT | - | YES | NULL | 用户ID |<br>| username | VARCHAR | 50 | NO | - | 用户名 |<br>| ipaddr | VARCHAR | 50 | NO | - | 登录IP地址 |<br>| login_location | VARCHAR | 255 | YES | NULL | 登录地点 |<br>| browser | VARCHAR | 50 | YES | NULL | 浏览器类型 |<br>| os | VARCHAR | 50 | YES | NULL | 操作系统 |<br>| status | TINYINT | - | NO | 0 | 登录状态：0-失败，1-成功 |<br>| msg | VARCHAR | 255 | YES | NULL | 提示信息 |<br>| login_time | DATETIME | - | NO | CURRENT_TIMESTAMP | 登录时间 |<br>| create_at | DATETIME | - | NO | CURRENT_TIMESTAMP | 创建时间 |</p><h4 id="3-6-2-操作日志表-sys-operation-log"><a href="#3-6-2-操作日志表-sys-operation-log" class="headerlink" title="3.6.2 操作日志表 (sys_operation_log)"></a>3.6.2 操作日志表 (sys_operation_log)</h4><table><thead><tr><th>字段名</th><th>类型</th><th>长度</th><th>允许空</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>BIGINT</td><td>-</td><td>NO</td><td>AUTO_INCREMENT</td><td>日志ID</td></tr><tr><td>user_id</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>操作用户ID</td></tr><tr><td>username</td><td>VARCHAR</td><td>50</td><td>NO</td><td>-</td><td>操作用户名</td></tr><tr><td>business_type</td><td>TINYINT</td><td>-</td><td>NO</td><td>0</td><td>业务类型（0-其他 1-新增 2-修改 3-删除）</td></tr><tr><td>method</td><td>VARCHAR</td><td>10</td><td>NO</td><td>-</td><td>请求方式</td></tr><tr><td>request_method</td><td>VARCHAR</td><td>10</td><td>NO</td><td>-</td><td>请求类型</td></tr><tr><td>operator_type</td><td>TINYINT</td><td>NO</td><td>-</td><td>0</td><td>操作类别（0-其它 1-后台用户 2-手机端用户）</td></tr><tr><td>oper_name</td><td>VARCHAR</td><td>50</td><td>YES</td><td>NULL</td><td>操作人员</td></tr><tr><td>dept_name</td><td>VARCHAR</td><td>50</td><td>YES</td><td>NULL</td><td>部门名称</td></tr><tr><td>oper_url</td><td>VARCHAR</td><td>255</td><td>YES</td><td>NULL</td><td>请求URL</td></tr><tr><td>oper_ip</td><td>VARCHAR</td><td>50</td><td>NO</td><td>-</td><td>操作地址</td></tr><tr><td>oper_location</td><td>VARCHAR</td><td>255</td><td>YES</td><td>NULL</td><td>操作地点</td></tr><tr><td>oper_param</td><td>TEXT</td><td>-</td><td>YES</td><td>NULL</td><td>请求参数</td></tr><tr><td>json_result</td><td>TEXT</td><td>-</td><td>YES</td><td>NULL</td><td>返回参数</td></tr><tr><td>status</td><td>TINYINT</td><td>NO</td><td>NO</td><td>0</td><td>操作状态：0-正常，1-异常</td></tr><tr><td>error_msg</td><td>VARCHAR</td><td>2000</td><td>YES</td><td>NULL</td><td>错误消息</td></tr><tr><td>oper_time</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP</td><td>操作时间</td></tr><tr><td>create_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP</td><td>创建时间</td></tr></tbody></table><h4 id="3-3-3-错误日志表-sys-error-log"><a href="#3-3-3-错误日志表-sys-error-log" class="headerlink" title="3.3.3 错误日志表 (sys_error_log)"></a>3.3.3 错误日志表 (sys_error_log)</h4><table><thead><tr><th>字段</th><th>类型</th><th>长度</th><th>允许空</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>BIGINT</td><td>-</td><td>NO</td><td>AUTO_INCREMENT</td><td>日志ID</td></tr><tr><td>user_id</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>用户ID</td></tr><tr><td>username</td><td>VARCHAR</td><td>50</td><td>YES</td><td>NULL</td><td>用户名</td></tr><tr><td>request_url</td><td>VARCHAR</td><td>255</td><td>NO</td><td>-</td><td>请求URL</td></tr><tr><td>method</td><td>VARCHAR</td><td>10</td><td>NO</td><td>-</td><td>请求方式</td></tr><tr><td>params</td><td>TEXT</td><td>-</td><td>YES</td><td>NULL</td><td>请求参数</td></tr><tr><td>error_message</td><td>TEXT</td><td>NO</td><td>-</td><td>错误消息</td><td></td></tr><tr><td>error_stack</td><td>TEXT</td><td>-</td><td>YES</td><td>NULL</td><td>错误堆栈</td></tr><tr><td>line_number</td><td>INT</td><td>-</td><td>YES</td><td>NULL</td><td>错误行号</td></tr><tr><td>class_name</td><td>VARCHAR</td><td>200</td><td>YES</td><td>NULL</td><td>Java类名</td></tr><tr><td>method_name</td><td>VARCHAR</td><td>200</td><td>YES</td><td>NULL</td><td>方法名</td></tr><tr><td>user_agent</td><td>VARCHAR</td><td>500</td><td>YES</td><td>NULL</td><td>用户代理</td></tr><tr><td>ip</td><td>VARCHAR</td><td>128</td><td>YES</td><td>NULL</td><td>操作IP地址</td></tr><tr><td>status</td><td>TINYINT</td><td>-</td><td>NO</td><td>0</td><td>状态</td></tr><tr><td>error_time</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP</td><td>错误时间</td></tr><tr><td>create_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP</td><td>创建时间</td></tr></tbody></table><h3 id="3-7-系统配置表"><a href="#3-7-系统配置表" class="headerlink" title="3.7 系统配置表"></a>3.7 系统配置表</h3><h4 id="3-7-1-租户表-sys-tenant"><a href="#3-7-1-租户表-sys-tenant" class="headerlink" title="3.7.1 租户表 (sys_tenant)"></a>3.7.1 租户表 (sys_tenant)</h4><table><thead><tr><th>字段名</th><th>类型</th><th>长度</th><th>允许空</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>BIGINT</td><td>-</td><td>NO</td><td>AUTO_INCREMENT</td><td>租户ID</td></tr><tr><td>tenant_name</td><td>VARCHAR</td><td>50</td><td>NO</td><td>-</td><td>租户名称</td></tr><tr><td>tenant_code</td><td>VARCHAR(20)</td><td>NO</td><td>-</td><td>租户编码</td><td></td></tr><tr><td>contact_name</td><td>VARCHAR(30)</td><td>NO</td><td>-</td><td>联系人</td><td></td></tr><tr><td>contact_phone</td><td>VARCHAR(20)</td><td>YES</td><td>NULL</td><td>联系电话</td><td></td></tr><tr><td>contact_email</td><td>VARCHAR(50)</td><td>YES</td><td>NULL</td><td>联系邮箱</td><td></td></tr><tr><td>company_name</td><td>VARCHAR(100)</td><td>YES</td><td>NULL</td><td>企业名称</td><td></td></tr><tr><td>domain</td><td>VARCHAR(100)</td><td>YES</td><td>NULL</td><td>域名</td><td></td></tr><tr><td>address</td><td>VARCHAR(200)</td><td>YES</td><td>NULL</td><td>地址</td><td></td></tr><tr><td>phone</td><td>VARCHAR(20)</td><td>YES</td><td>NULL</td><td>电话</td><td></td></tr><tr><td>email</td><td>VARCHAR(100)</td><td>YES</td><td>NULL</td><td>邮箱</td><td></td></tr><tr><td>package_id</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>套餐ID</td></tr><tr><td>expire_time</td><td>DATETIME</td><td>-</td><td>YES</td><td>NULL</td><td>到期时间</td></tr><tr><td>account_count</td><td>INT</td><td>-</td><td>NO</td><td>0</td><td>账号数量</td></tr><tr><td>sort</td><td>INT</td><td>-</td><td>NO</td><td>0</td><td>排序</td></tr><tr><td>status</td><td>TINYINT</td><td>-</td><td>NO</td><td>1</td><td>状态：0-禁用，1-正常</td></tr><tr><td>create_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP</td><td>创建时间</td></tr><tr><td>creator</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>创建人ID</td></tr><tr><td>update_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP ON UPDATE</td><td>更新时间</td></tr><tr><td>updater</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>更新人ID</td></tr><tr><td>delete_flag</td><td>TINYINT</td><td>-</td><td>NO</td><td>0</td><td>是否删除：0-否，1-是</td></tr><tr><td>delete_at</td><td>DATETIME</td><td>-</td><td>YES</td><td>NULL</td><td>删除时间</td></tr><tr><td>version</td><td>INT</td><td>-</td><td>NO</td><td>1</td><td>乐观锁版本号</td></tr></tbody></table><h4 id="3-7-2-租户套餐表-sys-tenant-package"><a href="#3-7-2-租户套餐表-sys-tenant-package" class="headerlink" title="3.7.2 租户套餐表 (sys_tenant_package)"></a>3.7.2 租户套餐表 (sys_tenant_package)</h4><table><thead><tr><th>字段</th><th>类型</th><th>长度</th><th>允许空</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>BIGINT</td><td>-</td><td>NO</td><td>AUTO_INCREMENT</td><td>套餐ID</td></tr><tr><td>package_name</td><td>VARCHAR</td><td>50</td><td>NO</td><td>-</td><td>套餐名称</td></tr><tr><td>package_code</td><td>VARCHAR(20)</td><td>NO</td><td>-</td><td>套餐编码</td><td></td></tr><tr><td>max_users</td><td>INT</td><td>-</td><td>NO</td><td>10</td><td>最大用户数</td></tr><tr><td>max_storage</td><td>BIGINT</td><td>-</td><td>NO</td><td>1073741824</td><td>最大存储空间（字节）</td></tr><tr><td>price</td><td>DECIMAL</td><td>10,2</td><td>-</td><td>NO</td><td>0.00</td></tr><tr><td>cycle_unit</td><td>TINYINT</td><td>-</td><td>NO</td><td>1</td><td>计费周期：1-月，2-季，3-年</td></tr><tr><td>features</td><td>TEXT</td><td>-</td><td>YES</td><td>NULL</td><td>功能特性（JSON格式）</td></tr><tr><td>description</td><td>VARCHAR(500)</td><td>YES</td><td>NULL</td><td>套餐描述</td><td></td></tr><tr><td>status</td><td>TINYINT</td><td>-</td><td>NO</td><td>1</td><td>状态：0-禁用，1-正常</td></tr><tr><td>sort_order</td><td>INT</td><td>-</td><td>NO</td><td>0</td><td>排序</td></tr><tr><td>create_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP</td><td>创建时间</td></tr><tr><td>creator</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>创建人ID</td></tr><tr><td>update_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP ON UPDATE</td><td>更新时间</td></tr><tr><td>updater</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>更新人ID</td></tr><tr><td>delete_flag</td><td>TINYINT</td><td>-</td><td>NO</td><td>0</td><td>是否删除：0-否，1-是</td></tr><tr><td>delete_at</td><td>DATETIME</td><td>-</td><td>YES</td><td>NULL</td><td>删除时间</td></tr><tr><td>version</td><td>INT</td><td>-</td><td>NO</td><td>1</td><td>乐观锁版本号</td></tr></tbody></table><h4 id="3-7-3-租户配置表-sys-tenant-config"><a href="#3-7-3-租户配置表-sys-tenant-config" class="headerlink" title="3.7.3 租户配置表 (sys_tenant_config)"></a>3.7.3 租户配置表 (sys_tenant_config)</h4><table><thead><tr><th>字段名</th><th>类型</th><th>邮长度</th><th>允许空</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>BIGINT</td><td>-</td><td>NO</td><td>AUTO_INCREMENT</td><td>配置ID</td></tr><tr><td>tenant_id</td><td>BIGINT</td><td>-</td><td>NO</td><td>-</td><td>租户ID</td></tr><tr><td>config_key</td><td>VARCHAR(100)</td><td>NO</td><td>-</td><td>配置键</td><td></td></tr><tr><td>config_value</td><td>TEXT</td><td>-</td><td>YES</td><td>NULL</td><td>配置值</td></tr><tr><td>config_type</td><td>TINYINT</td><td>-</td><td>NO</td><td>0</td><td>系统内置（0-否 1-是）</td></tr><tr><td>is_encrypted</td><td>TINYINT</td><td>-</td><td>NO</td><td>0</td><td>是否加密（0-否 1-是）</td></tr><tr><td>remark</td><td>VARCHAR(500)</td><td>YES</td><td>NULL</td><td>备注</td><td></td></tr><tr><td>create_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP</td><td>创建时间</td></tr><tr><td>creator</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>创建人ID</td></tr><tr><td>update_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP ON UPDATE</td><td>更新时间</td></tr><tr><td>updater</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>更新人ID</td></tr><tr><td>delete_flag</td><td>TINYINT</td><td>-</td><td>NO</td><td>0</td><td>是否删除：0-否，1-是</td></tr><tr><td>delete_at</td><td>DATETIME</td><td>-</td><td>YES</td><td>NULL</td><td>删除时间</td></tr><tr><td>version</td><td>INT</td><td>-</td><td>NO</td><td>1</td><td>乐观锁版本号</td></tr></tbody></table><h4 id="3-7-4-字典类型表-sys-dict-type"><a href="#3-7-4-字典类型表-sys-dict-type" class="headerlink" title="3.7.4 字典类型表 (sys_dict_type)"></a>3.7.4 字典类型表 (sys_dict_type)</h4><table><thead><tr><th>字段名</th><th>类型</th><th>长度</th><th>允许空</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>BIGINT</td><td>-</td><td>NO</td><td>AUTO_INCREMENT</td><td>字典主键</td></tr><tr><td>dict_name</td><td>VARCHAR(100)</td><td>NO</td><td>-</td><td>字典名称</td><td></td></tr><tr><td>dict_type</td><td>VARCHAR(100)</td><td>NO</td><td>-</td><td>字典类型</td><td></td></tr><tr><td>sort</td><td>INT</td><td>-</td><td>NO</td><td>0</td><td>排序</td></tr><tr><td>status</td><td>TINYINT</td><td>-</td><td>NO</td><td>1</td><td>状态（0正常 1停用）</td></tr><tr><td>create_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP</td><td>创建时间</td></tr><tr><td>creator</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>创建人</td></tr><tr><td>update_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP ON UPDATE</td><td>更新时间</td></tr><tr><td>updater</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>更新人</td></tr><tr><td>delete_flag</td><td>TINYINT</td><td>-</td><td>NO</td><td>0</td><td>是否删除</td></tr><tr><td>delete_at</td><td>DATETIME</td><td>-</td><td>YES</td><td>NULL</td><td>删除时间</td></tr><tr><td>version</td><td>INT</td><td>-</td><td>NO</td><td>1</td><td>乐观锁版本号</td></tr><tr><td>remark</td><td>VARCHAR(500)</td><td>YES</td><td>NULL</td><td>备注</td><td></td></tr></tbody></table><h4 id="3-7-5-字典数据表-sys-dict-data"><a href="#3-7-5-字典数据表-sys-dict-data" class="headerlink" title="3.7.5 字典数据表 (sys_dict_data)"></a>3.7.5 字典数据表 (sys_dict_data)</h4><table><thead><tr><th>字段名</th><th>类型</th><th>长度</th><th>允许空</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>BIGINT</td><td>-</td><td>NO</td><td>AUTO_INCREMENT</td><td>数据编号</td></tr><tr><td>dict_sort</td><td>INT</td><td>-</td><td>NO</td><td>0</td><td>字典排序</td></tr><tr><td>dict_label</td><td>VARCHAR(100)</td><td>NO</td><td>-</td><td>字典标签</td><td></td></tr><tr><td>dict_value</td><td>VARCHAR(100)</td><td>NO</td><td>-</td><td>字典键值</td><td></td></tr><tr><td>dict_type</td><td>VARCHAR(100)</td><td>NO</td><td>-</td><td>字典类型</td><td></td></tr><tr><td>css_class</td><td>VARCHAR(100</td><td>YES</td><td>NULL</td><td>表格回显样式</td><td></td></tr><tr><td>list_class</td><td>VARCHAR(100)</td><td>YES</td><td>NULL</td><td>表格列表样式</td><td></td></tr><tr><td>is_default</td><td>TINYINT</td><td>-</td><td>NO</td><td>N</td><td>是否默认（Y是 N否）</td></tr><tr><td>sort</td><td>INT</td><td>-</td><td>NO</td><td>0</td><td>排序</td></tr><tr><td>status</td><td>TINYINT</td><td>-</td><td>NO</td><td>1</td><td>状态（0正常 1停用）</td></tr><tr><td>create_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP</td><td>创建时间</td></tr><tr><td>creator</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>创建人</td></tr><tr><td>update_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP ON UPDATE</td><td>更新时间</td></tr><tr><td>updater</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>更新人</td></tr><tr><td>delete_flag</td><td>TINYINT</td><td>-</td><td>NO</td><td>0</td><td>是否删除</td></tr><tr><td>delete_at</td><td>DATETIME</td><td>-</td><td>YES</td><td>NULL</td><td>删除时间</td></tr><tr><td>version</td><td>INT</td><td>-</td><td>NO</td><td>1</td><td>乐观锁版本号</td></tr><tr><td>remark</td><td>VARCHAR(500)</td><td>YES</td><td>NULL</td><td>备注</td><td></td></tr></tbody></table><h4 id="3-7-6-参数表-sys-params"><a href="#3-7-6-参数表-sys-params" class="headerlink" title="3.7.6 参数表 (sys_params)"></a>3.7.6 参数表 (sys_params)</h4><table><thead><tr><th>字段名</th><th>类型</th><th>长度</th><th>允许空</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>BIGINT</td><td>-</td><td>NO</td><td>AUTO_INCREMENT</td><td>参数ID</td></tr><tr><td>param_name</td><td>VARCHAR(100)</td><td>NO</td><td>-</td><td>参数名称</td><td></td></tr><tr><td>param_key</td><td>VARCHAR(100) NO</td><td>-</td><td>参数键名</td><td></td><td></td></tr><tr><td>param_value</td><td>VARCHAR(500)</td><td>YES</td><td>NULL</td><td>参数键值</td><td></td></tr><tr><td>param_type</td><td>TINYINT</td><td>-</td><td>NO</td><td>0</td><td>系统内置（0-否 1-是）</td></tr><tr><td>is_encrypted</td><td>TINYINT</td><td>-</td><td>NO</td><td>0</td><td>是否加密（0-否 1-是）</td></tr><tr><td>sort</td><td>INT</td><td>-</td><td>NO</td><td>0</td><td>排序</td></tr><tr><td>status</td><td>TINYINT</td><td>-</td><td>NO</td><td>1</td><td>状态（0正常 1停用）</td></tr><tr><td>remark</td><td>VARCHAR(500)</td><td>YES</td><td>NULL</td><td>备注</td><td></td></tr><tr><td>create_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP</td><td>创建时间</td></tr><tr><td>creator</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>创建人ID</td></tr><tr><td>update_at</td><td>DATETIME</td><td>-</td><td>NO</td><td>CURRENT_TIMESTAMP ON UPDATE</td><td>更新时间</td></tr><tr><td>updater</td><td>BIGINT</td><td>-</td><td>YES</td><td>NULL</td><td>更新人ID</td></tr><tr><td>delete_flag</td><td>TINYINT</td><td>-</td><td>NO</td><td>0</td><td>是否删除：0-否，1-是</td></tr><tr><td>delete_at</td><td>DATETIME</td><td>-</td><td>YES</td><td>NULL</td><td>删除时间</td></tr><tr><td>version</td><td>INT</td><td>-</td><td>NO</td><td>1</td><td>乐观锁版本号</td></tr></tbody></table><h3 id="3-8-关联表"><a href="#3-8-关联表" class="headerlink" title="3.8 关联表"></a>3.8 关联表</h3><h4 id="3-8-1-用户角色关联表-sys-user-role"><a href="#3-8-1-用户角色关联表-sys-user-role" class="headerlink" title="3.8.1 用户角色关联表 (sys_user_role)"></a>3.8.1 用户角色关联表 (sys_user_role)</h4><table><thead><tr><th>字段名</th><th>类型</th><th>长度</th><th>允许空</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>BIGINT</td><td>-</td><td>NO</td><td>AUTO_INCREMENT</td><td>主键ID</td></tr><tr><td>user_id</td><td>BIGINT</td><td>-</td><td>NO</td><td>-</td><td>用户ID</td></tr><tr><td>role_id</td><td>BIGINT</td><td>-</td><td>NO</td><td>-</td><td>角色ID</td></tr></tbody></table><h4 id="3-8-2-角色菜单关联表-sys-role-menu"><a href="#3-8-2-角色菜单关联表-sys-role-menu" class="headerlink" title="3.8.2 角色菜单关联表 (sys_role_menu)"></a>3.8.2 角色菜单关联表 (sys_role_menu)</h4><table><thead><tr><th>字段名</th><th>类型</th><th>长度</th><th>允许空</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>BIGINT</td><td>-</td><td>NO</td><td>AUTO_INCREMENT</td><td>主键ID</td></tr><tr><td>role_id</td><td>BIGINT</td><td>-</td><td>NO</td><td>-</td><td>角色ID</td></tr><tr><td>menu_id</td><td>BIGINT</td><td>-</td><td>NO</td><td>-</td><td>菜单ID</td></tr></tbody></table><h4 id="3-8-3-角色部门关联表-sys-role-dept"><a href="#3-8-3-角色部门关联表-sys-role-dept" class="headerlink" title="3.8.3 角色部门关联表 (sys_role_dept)"></a>3.8.3 角色部门关联表 (sys_role_dept)</h4><table><thead><tr><th>字段名</th><th>类型</th><th>长度</th><th>允许空</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>BIGINT</td><td>-</td><td>NO</td><td>AUTO_INCREMENT</td><td>主键ID</td></tr><tr><td>role_id</td><td>BIGINT</td><td>-</td><td>NO</td><td>-</td><td>角色ID</td></tr><tr><td>dept_id</td><td>BIGINT</td><td>-</td><td>NO</td><td>-</td><td>部门ID</td></tr></tbody></table><h2 id="4-索引设计"><a href="#4-索引设计" class="headerlink" title="4. 索引设计"></a>4. 索引设计</h2><h3 id="4-1-主键索引"><a href="#4-1-主键索引" class="headerlink" title="4.1 主键索引"></a>4.1 主键索引</h3><p>所有表的 <code>id</code> 字段自动创建主键索引（PRIMARY KEY）。</p><h3 id="4-2-唯一索引"><a href="#4-2-唯一索引" class="headerlink" title="4.2 唯一索引"></a>4.2 唯一索引</h3><table><thead><tr><th>表名</th><th>索引名</th><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>sys_user</td><td>uk_username</td><td>username</td><td>用户名唯一</td></tr><tr><td>sys_user</td><td>uk_email</td><td>email</td><td>邮箱唯一</td></tr><tr><td>sys_user</td><td>uk_phone</td><td>phone</td><td>手机号唯一</td></tr><tr><td>sys_role</td><td>uk_role_code</td><td>role_code</td><td>角色编码唯一</td></tr><tr><td>sys_dept</td><td>uk_dept_code</td><td>dept_code</td><td>部门编码唯一</td></tr><tr><td>sys_post</td><td>uk_post_code</td><td>post_code</td><td>岗位编码唯一</td></tr><tr><td>sys_menu</td><td>uk_menu_code</td><td>menu_code</td><td>菜单编码唯一</td></tr><tr><td>sys_tenant</td><td>uk_tenant_code</td><td>tenant_code</td><td>租户编码唯一</td></tr><tr><td>sys_dict_type</td><td>uk_dict_type</td><td>dict_type</td><td>字典类型唯一</td></tr></tbody></table><h3 id="4-3-普通索引"><a href="#4-3-普通索引" class="headerlink" title="4.3 普通索引"></a>4.3 普通索引</h3><table><thead><tr><th>表名</th><th>索引名</th><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>sys_user</td><td>idx_dept_id</td><td>dept_id</td><td>部门查询</td></tr><tr><td>sys_user</td><td>idx_post_id</td><td>post_id</td><td>岗位查询</td></tr><tr><td>sys_user</td><td>idx_status</td><td>status</td><td>状态筛选</td></tr><tr><td>sys_user</td><td>idx_tenant_id</td><td>tenant_id</td><td>租户隔离</td></tr><tr><td>sys_role</td><td>idx_status</td><td>status</td><td>状态筛选</td></tr><tr><td>sys_role</td><td>idx_data_scope</td><td>data_scope</td><td>数据权限查询</td></tr><tr><td>sys_menu</td><td>idx_parent_id</td><td>parent_id</td><td>父菜单查询</td></tr><tr><td>sys_menu</td><td>idx_menu_type</td><td>menu_type</td><td>菜单类型筛选</td></tr><tr><td>sys_dept</td><td>idx_parent_id</td><td>parent_id</td><td>父部门查询</td></tr><tr><td>sys_dept</td><td>idx_status</td><td>status</td><td>状态筛选</td></tr><tr><td>sys_post</td><td>idx_dept_id</td><td>dept_id</td><td>部门岗位查询</td></tr><tr><td>sys_tenant</td><td>idx_package_id</td><td>package_id</td><td>套餐查询</td></tr></tbody></table><h3 id="4-4-复合索引"><a href="#4-4-复合索引" class="headerlink" title="4.4 复合索引"></a>4.4 复合索引</h3><table><thead><tr><th>表名</th><th>索引名</th><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>sys_user_role</td><td>idx_user_role</td><td>user_id, role_id</td><td>用户角色查询</td></tr><tr><td>sys_role_menu</td><td>idx_role_menu</td><td>role_id, menu_id</td><td>角色菜单查询</td></tr><tr><td>sys_role_dept</td><td>idx_role_dept</td><td>role_id, dept_id</td><td>角色部门查询</td></tr><tr><td>sys_dict_data</td><td>idx_dict_type_status</td><td>dict_type, status</td><td>字典数据查询</td></tr><tr><td>sys_login_log</td><td>idx_user_time</td><td>user_id, login_time</td><td>用户登录记录</td></tr><tr><td>sys_operation_log</td><td>idx_user_time</td><td>user_id, operation_time</td><td>用户操作记录</td></tr><tr><td>sys_tenant_config</td><td>idx_tenant_key</td><td>tenant_id, config_key</td><td>租户配置查询</td></tr></tbody></table><h3 id="4-5-日志表索引"><a href="#4-5-日志表索引" class="headerlink" title="4.5 日志表索引"></a>4.5 日志表索引</h3><table><thead><tr><th>表名</th><th>索引名</th><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>sys_login_log</td><td>idx_login_time</td><td>login_time</td><td>按登录时间查询</td></tr><tr><td>sys_login_log</td><td>idx_username_time</td><td>username, login_time</td><td>用户登录历史</td></tr><tr><td>sys_operation_log</td><td>idx_operation_time</td><td>operation_time</td><td>按操作时间查询</td></tr><tr><td>sys_operation_log</td><td>idx_business_type</td><td>business_type</td><td>按业务类型查询</td></tr><tr><td>sys_error_log</td><td>idx_create_time</td><td>create_time</td><td>按创建时间查询</td></tr><tr><td>sys_error_log</td><td>idx_status</td><td>status</td><td>按处理状态查询</td></tr></tbody></table><h3 id="4-6-软删除索引"><a href="#4-6-软删除索引" class="headerlink" title="4.6 软删除索引"></a>4.6 软删除索引</h3><table><thead><tr><th>表名</th><th>索引名</th><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>sys_user</td><td>idx_delete_flag</td><td>delete_flag</td><td>软删除筛选</td></tr><tr><td>sys_role</td><td>idx_delete_flag</td><td>delete_flag</td><td>软删除筛选</td></tr><tr><td>sys_menu</td><td>idx_delete_flag</td><td>delete_flag</td><td>软删除筛选</td></tr><tr><td>sys_dept</td><td>idx_delete_flag</td><td>delete_flag</td><td>软删除筛选</td></tr><tr><td>sys_post</td><td>idx_delete_flag</td><td>delete_flag</td><td>软删除筛选</td></tr><tr><td>sys_tenant</td><td>idx_delete_flag</td><td>delete_flag</td><td>软删除筛选</td></tr></tbody></table><h2 id="5-安全设计"><a href="#5-安全设计" class="headerlink" title="5. 安全设计"></a>5. 安全设计</h2><h3 id="5-1-密码安全"><a href="#5-1-密码安全" class="headerlink" title="5.1 密码安全"></a>5.1 密码安全</h3><ul><li>用户密码必须经过 <strong>bcrypt</strong> 或 <strong>PBKDF2</strong> 算法加密存储</li><li>密码字段长度至少 255 字符，以支持加密后的字符串</li><li>强制密码策略：最少 8 位，包含大小写字母、数字和特殊字符</li></ul><h3 id="5-2-数据脱敏"><a href="#5-2-数据脱敏" class="headerlink" title="5.2 数据脱敏"></a>5.2 数据脱敏</h3><ul><li>手机号：显示前 3 位和后 4 位，中间用 * 替代（如：138****1234）</li><li>邮箱：显示前 3 位和 @ 以后的内容（如：zha***@example.com）</li><li>身份证号：显示前 6 位和后 4 位</li><li>银行卡号：显示前 6 位和后 4 位</li></ul><h3 id="5-3-数据权限控制"><a href="#5-3-数据权限控制" class="headerlink" title="5.3 数据权限控制"></a>5.3 数据权限控制</h3><ul><li>租户隔离：所有查询必须带 <code>tenant_id</code> 条件</li><li>部门数据权限：根据角色的 <code>data_scope</code> 控制数据可见范围</li><li>行级权限：重要业务表可扩展 <code>dept_id</code> 字段实现行级权限</li></ul><h3 id="5-4-审计日志"><a href="#5-4-审计日志" class="headerlink" title="5.4 审计日志"></a>5.4 审计日志</h3><ul><li>关键操作必须记录操作日志（增删改）</li><li>登录行为必须记录登录日志</li><li>系统异常必须记录错误日志</li><li>日志包含操作人、操作时间、操作内容、IP 地址等信息</li></ul><h2 id="6-性能优化建议"><a href="#6-性能优化建议" class="headerlink" title="6. 性能优化建议"></a>6. 性能优化建议</h2><h3 id="6-1-分区策略"><a href="#6-1-分区策略" class="headerlink" title="6.1 分区策略"></a>6.1 分区策略</h3><p>对数据量大的表建议按时间分区：</p><table><thead><tr><th>表名</th><th>分区策略</th><th>分区字段</th><th>分区间隔</th></tr></thead><tbody><tr><td>sys_login_log</td><td>RANGE</td><td>login_time</td><td>按月分区</td></tr><tr><td>sys_operation_log</td><td>RANGE</td><td>operation_time</td><td>按月分区</td></tr><tr><td>sys_error_log</td><td>RANGE</td><td>create_time</td><td>按月分区</td></tr></tbody></table><h3 id="6-2-查询优化"><a href="#6-2-查询优化" class="headerlink" title="6.2 查询优化"></a>6.2 查询优化</h3><ul><li>使用覆盖索引减少回表查询</li><li>避免 SELECT *，只查询需要的字段</li><li>合理使用 JOIN，避免大表关联</li><li>分页查询使用索引优化</li></ul><h3 id="6-3-读写分离"><a href="#6-3-读写分离" class="headerlink" title="6.3 读写分离"></a>6.3 读写分离</h3><ul><li>日志类表可以考虑读写分离</li><li>报表查询可以考虑只读从库</li><li>主库负责写操作，从库负责读操作</li></ul><h3 id="6-4-缓存策略"><a href="#6-4-缓存策略" class="headerlink" title="6.4 缓存策略"></a>6.4 缓存策略</h3><ul><li>用户角色权限信息缓存（Redis）</li><li>字典数据缓存</li><li>菜单树结构缓存</li><li>部门树结构缓存</li></ul><h2 id="7-数据字典"><a href="#7-数据字典" class="headerlink" title="7. 数据字典"></a>7. 数据字典</h2><h3 id="7-1-通用状态值"><a href="#7-1-通用状态值" class="headerlink" title="7.1 通用状态值"></a>7.1 通用状态值</h3><ul><li><strong>status</strong>: 0-禁用&#x2F;失败，1-正常&#x2F;成功</li><li><strong>delete_flag</strong>: 0-未删除，1-已删除</li><li><strong>is_default</strong>: 0-否，1-是</li><li><strong>is_system</strong>: 0-否，1-是</li></ul><h3 id="7-2-用户性别-sex"><a href="#7-2-用户性别-sex" class="headerlink" title="7.2 用户性别 (sex)"></a>7.2 用户性别 (sex)</h3><ul><li>0: 未知</li><li>1: 男</li><li>2: 女</li></ul><h3 id="7-3-菜单类型-menu-type"><a href="#7-3-菜单类型-menu-type" class="headerlink" title="7.3 菜单类型 (menu_type)"></a>7.3 菜单类型 (menu_type)</h3><ul><li>1: 目录</li><li>2: 菜单</li><li>3: 按钮</li></ul><h3 id="7-4-数据权限范围-data-scope"><a href="#7-4-数据权限范围-data-scope" class="headerlink" title="7.4 数据权限范围 (data_scope)"></a>7.4 数据权限范围 (data_scope)</h3><ul><li>1: 全部数据权限</li><li>2: 本部门数据权限</li><li>3: 本部门及下级部门数据权限</li><li>4: 自定义数据权限</li></ul><h3 id="7-5-业务类型-business-type"><a href="#7-5-业务类型-business-type" class="headerlink" title="7.5 业务类型 (business_type)"></a>7.5 业务类型 (business_type)</h3><ul><li>0: 其他</li><li>1: 新增</li><li>2: 修改</li><li>3: 删除</li><li>4: 授权</li><li>5: 导出</li><li>6: 导入</li></ul><h3 id="7-6-操作类别-operator-type"><a href="#7-6-操作类别-operator-type" class="headerlink" title="7.6 操作类别 (operator_type)"></a>7.6 操作类别 (operator_type)</h3><ul><li>0: 其它</li><li>1: 后台用户</li><li>2: 手机端用户</li></ul><h3 id="7-7-租户套餐周期-cycle-unit"><a href="#7-7-租户套餐周期-cycle-unit" class="headerlink" title="7.7 租户套餐周期 (cycle_unit)"></a>7.7 租户套餐周期 (cycle_unit)</h3><ul><li>1: 月</li><li>2: 季</li><li>3: 年</li></ul><h2 id="8-相关链接"><a href="#8-相关链接" class="headerlink" title="8. 相关链接"></a>8. 相关链接</h2><ul><li>[[企业级权限管理系统数据库设计-MySQL版本]] - MySQL版本</li><li>[[企业级权限管理系统数据库设计-PostgreSQL版本]] - PostgreSQL版本</li></ul>]]></content>
    
    
    <categories>
      
      <category>数据库</category>
      
    </categories>
    
    
    <tags>
      
      <tag>数据库</tag>
      
      <tag>RBAC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cursor规则</title>
    <link href="/posts/AI/Cursor%E8%A7%84%E5%88%99/5829/"/>
    <url>/posts/AI/Cursor%E8%A7%84%E5%88%99/5829/</url>
    
    <content type="html"><![CDATA[<p>以下是一份「可直接放进 <code>.cursor/rules/000-always.mdc</code>」的最前面、最优先、全局生效的 Cursor Rule 模板（2025-05 之后新版 MDC 格式）。<br>它把「系统元指令 → 项目架构 → 代码风格 → 安全&#x2F;性能红线」一次性锁死，Agent 每次对话都会先读它，再动手写代码。<br>把 <code>&#123;&#123;project_name&#125;&#125;</code> 和 <code>&#123;&#123;tech_stack&#125;&#125;</code> 替换成自己的即可开箱即用。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs mdc">---<br>description: &quot;000-ALWAYS：最优先全局规则，任何对话都强制注入&quot;<br>globs: [&quot;**/*&quot;]<br>type: &quot;always&quot;<br>---<br><br># 000-ALWAYS · 最前面生效的 Cursor Rule<br><br>## 0 语言与平台基线<br>- **必须全程用简体中文回答**（代码本身仍用英文命名）。  <br>- 当前运行环境：&#123;&#123;os_name&#125;&#125;（&#123;&#123;arch&#125;&#125;），默认 Shell 用 `&#123;&#123;shell_cmd&#125;&#125;`，包管理用 `&#123;&#123;pkg_cmd&#125;&#125;`，Node 版本 ≥&#123;&#123;node_ver&#125;&#125;，Python 版本 ≥&#123;&#123;py_ver&#125;&#125;。  <br>- 任何安装/启动/调试命令都先检测环境，再给出「一键复制」的完整指令块。<br><br>## 1 身份与行为<br>- 你是 **&#123;&#123;project_name&#125;&#125;** 的资深架构师，精通 &#123;&#123;tech_stack&#125;&#125;。  <br>- 采用“结对编程”模式：先思考→再摘要→再动手；任何改动必须可回滚。  <br>- 禁止直接输出代码块给用户；必须用 `edit_file`/`create_file` 工具提交变更，以便审查与 diff。<br><br>## 2 上下文纪律<br>- 修改文件前务必 `read_file` 对应内容；超过 50 行的改动须分片提交，每片仅改一个目的。  <br>- 若任务涉及多文件，先打印 **MVP 执行清单** 待用户确认后再进行。<br><br>## 3 代码可运行性<br>- 生成代码必须 **立即可运行**：依赖完整、类型安全、环境变量有默认值、README 同步更新。  <br>- 新建项目时自动创建依赖锁定文件（package-lock/poetry.lock/requirements.txt）与一键启动脚本。<br><br>## 4 风格与规范<br>- 严格遵循官方风格指南；命名用英文，禁止拼音；函数 ≤30 行，文件 ≤300 行，超出即拆分。  <br>- **每个导出函数**都必须有「函数级注释」：一句话描述职责、参数含义、返回值、可能的异常；复杂算法加「行内注释」。  <br>- 优先使用标准库与现有依赖；新增第三方包需注明理由并锁定版本。<br><br>## 5 安全与性能红线<br>- 默认防注入、防 XSS、CSRF、SQLi；所有用户输入先验后验。  <br>- 前端 bundle 体积 +20 % 以上须提示；后端 API 响应 &gt;200 ms 须给优化方案。  <br>- 秘钥、token 绝不硬编码，一律走环境变量；日志脱敏，不打印完整手机号/邮箱。<br><br>## 6 失败策略<br>- 同一任务连续 3 次仍报错即停止，向用户报告阻塞原因并给出替代方案。<br><br>&gt; 本规则全局始终注入，任何后续规则不得与之冲突；如有特殊场景需要覆盖，需在摘要中说明理由并征得用户确认。<br></code></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs txt">your-repo/<br>└── .cursor/<br>    └── rules/<br>        └── 000-always.mdc   // 文件名以 000- 开头确保最前加载<br></code></pre></td></tr></table></figure><p>这样配置后，无论 Agent 模式还是普通对话，Cursor 都会先把这份“最前面的 AI Coding 提示词”读进上下文，再开始写代码，从根本上减少“乱改、风格漂移、安全漏洞”等常见问题。</p>]]></content>
    
    
    <categories>
      
      <category>AI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Cursor</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Monorepo</title>
    <link href="/posts/%E5%89%8D%E7%AB%AF/Monorepo%E5%B7%A5%E7%A8%8B%E7%AE%A1%E7%90%86%E6%96%B9%E6%A1%88/41960/"/>
    <url>/posts/%E5%89%8D%E7%AB%AF/Monorepo%E5%B7%A5%E7%A8%8B%E7%AE%A1%E7%90%86%E6%96%B9%E6%A1%88/41960/</url>
    
    <content type="html"><![CDATA[<h1 id="Monorepo工程管理方案"><a href="#Monorepo工程管理方案" class="headerlink" title="Monorepo工程管理方案"></a>Monorepo工程管理方案</h1><h2 id="mutirepo-vs-monorepo"><a href="#mutirepo-vs-monorepo" class="headerlink" title="mutirepo vs monorepo"></a>mutirepo vs monorepo</h2><ul><li>mutirepo : 一个包对应一个仓库</li><li>monorepo : 多个包对应一个仓库<br>常见monorepo管理工具:</li><li><code>pnpm</code></li><li>npm</li><li>yarn</li><li>Lerna</li><li>Nx</li><li>Rush</li><li>……</li></ul><h2 id="pnpm-monorepo"><a href="#pnpm-monorepo" class="headerlink" title="pnpm monorepo"></a>pnpm monorepo</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">touch</span> pnpm-workspace.yaml<br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 子包位置</span><br><span class="hljs-attr">packages:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;packages/*&quot;</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;apps/*&quot;</span><br></code></pre></td></tr></table></figure><p>在工程根目录下执行初始化</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pnpm --workspace-root init<br></code></pre></td></tr></table></figure><h2 id="环境版本锁定"><a href="#环境版本锁定" class="headerlink" title="环境版本锁定"></a>环境版本锁定</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// 跟工程 package.json</span><br><br>  <span class="hljs-attr">&quot;engines&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;node&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&gt;=22.12.0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;npm&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&gt;=10.9.0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;pnpm&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&gt;=10.14.0&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt"># .npmrc<br>engine-strict=true<br></code></pre></td></tr></table></figure><h2 id="TypeScript"><a href="#TypeScript" class="headerlink" title="TypeScript"></a>TypeScript</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pnpm add -Dw typescript @types/node<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">touch</span> tsconfig.json<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// tsconfig.json</span><br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;compilerOptions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;baseUrl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;.&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;module&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;esnext&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;target&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;esnext&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;types&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;lib&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;esnext&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;sourceMap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;declaration&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;declarationMap&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;noUncheckedIndexedAccess&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;exactOptionalPropertyTypes&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;strict&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;verbatimModuleSyntax&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;moduleResolution&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;bundler&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;isolatedModules&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;noUncheckedSideEffectImports&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;moduleDetection&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;force&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;skipLibCheck&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;exclude&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;node_modules&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;dist&quot;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="代码风格与质量检查"><a href="#代码风格与质量检查" class="headerlink" title="代码风格与质量检查"></a>代码风格与质量检查</h2><h3 id="prettier"><a href="#prettier" class="headerlink" title="prettier"></a>prettier</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pnpm -Dw add prettier<br><span class="hljs-built_in">touch</span> prettier.config.js<br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// prettier.config.js</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@type</span> &#123;<span class="hljs-type">import(&#x27;prettier&#x27;).Config</span>&#125;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> https://www.prettier.cn/docs/options.html</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>    <span class="hljs-comment">// 指定最大换行长度</span><br>    <span class="hljs-attr">printWidth</span>:<span class="hljs-number">120</span>,<br>    <span class="hljs-comment">// 指定缩进空格数</span><br>    <span class="hljs-attr">tabWidth</span>:<span class="hljs-number">2</span>,<br>    <span class="hljs-comment">// 是否使用制表符进行缩进</span><br>    <span class="hljs-attr">useTabs</span>:<span class="hljs-literal">false</span>,<br>    <span class="hljs-comment">// 是否在语句末尾添加分号</span><br>    <span class="hljs-attr">semi</span>:<span class="hljs-literal">true</span>,<br>    <span class="hljs-comment">// 是否使用单引号 (true:单引号,false:双引号)</span><br>    <span class="hljs-attr">singleQuote</span>:<span class="hljs-literal">false</span>,<br>    <span class="hljs-comment">// 对象属性引用是否使用单引号</span><br>    <span class="hljs-attr">quoteProps</span>:<span class="hljs-string">&quot;as-needed&quot;</span>,<br>    <span class="hljs-comment">// 在JSX中是否使用单引号 (true:单引号,false:双引号)</span><br>    <span class="hljs-attr">jsxSingleQuote</span>:<span class="hljs-literal">false</span>,<br>    <span class="hljs-comment">// 多行时尽可能打印尾随逗号  </span><br>    <span class="hljs-attr">trailingComma</span>:<span class="hljs-string">&quot;none&quot;</span>,<br>    <span class="hljs-comment">// 在对象括号内使用空格</span><br>    <span class="hljs-attr">bracketSpacing</span>:<span class="hljs-literal">true</span>,<br>    <span class="hljs-comment">// 在对象括号内使用空格</span><br>    <span class="hljs-attr">bracketSameLine</span>:<span class="hljs-literal">false</span>,<br>    <span class="hljs-comment">// 箭头函数参数括号</span><br>    <span class="hljs-attr">arrowParens</span>:<span class="hljs-string">&quot;avoid&quot;</span>,<br>    <span class="hljs-attr">requirePragma</span>:<span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">insertPragma</span>:<span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">proseWrap</span>:<span class="hljs-string">&quot;preserve&quot;</span>,<br>    <span class="hljs-attr">htmlWhitespaceSensitivity</span>:<span class="hljs-string">&quot;css&quot;</span>,<br>    <span class="hljs-attr">vueIndentScriptAndStyle</span>:<span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">endOfLine</span>:<span class="hljs-string">&quot;auto&quot;</span>,<br>    <span class="hljs-attr">rangeStart</span>:<span class="hljs-number">0</span>,<br>    <span class="hljs-attr">rangeEnd</span>:<span class="hljs-title class_">Infinity</span>,<br>&#125;<br></code></pre></td></tr></table></figure><p><code>prettier</code>忽略项</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">touch</span> .prettierignore<br></code></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs txt">// .prettierignore<br>dist<br>public<br>node_modules<br>.local<br>pnpm-lock.yaml<br></code></pre></td></tr></table></figure><p><code>prettier</code>脚本命令</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;script&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;lint:prettier&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;prettier --write \&quot;**/*.&#123;js,ts,mjs,cjs,json,tsx,css,less,scss,vue,html,md&#125;\&quot;&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="ESLint"><a href="#ESLint" class="headerlink" title="ESLint"></a>ESLint</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pnpm -Dw add eslint@latest @eslint/js globals typescript-eslint eslint-plugin-prettier eslint-config-prettier eslint-plugin-vue<br></code></pre></td></tr></table></figure><table><thead><tr><th>类别</th><th>库名</th></tr></thead><tbody><tr><td>核心引擎</td><td>eslint</td></tr><tr><td>官方规则集</td><td>@eslint&#x2F;js</td></tr><tr><td>全局变量支持</td><td>globals</td></tr><tr><td>TypeScript支持</td><td>typescript-eslint</td></tr><tr><td>类型定义(辅助)</td><td>@types&#x2F;node</td></tr><tr><td>Prettier集成</td><td>eslint-plugin-prettier, eslint-config-prettier</td></tr><tr><td>Vue支持</td><td>eslint-plugin-vue</td></tr></tbody></table><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs php">touch eslint.config.js<br><br><br>import &#123; defineConfig &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;eslint-define-config&quot;</span>;<br>import eslint <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@eslint/js&quot;</span>;<br>import tseslint <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;typescript-eslint&quot;</span>;<br>import eslintPluginPrettier <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;eslint-plugin-prettier&quot;</span>;<br>import eslintPluginVue <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;eslint-plugin-vue&quot;</span>;<br>import globals <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;globals&quot;</span>;<br>import eslintConfigPrettier <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;eslint-config-prettier&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ignores</span> = [<br>  <span class="hljs-string">&quot;**/dist/**&quot;</span>,<br>  <span class="hljs-string">&quot;**/node_modules/**&quot;</span>,<br>  <span class="hljs-string">&quot;.*&quot;</span>,<br>  <span class="hljs-string">&quot;scripts/**&quot;</span>,<br>  <span class="hljs-string">&quot;**/*.d.ts&quot;</span>,<br>];<br><br>export <span class="hljs-keyword">default</span> <span class="hljs-title function_ invoke__">defineConfig</span>(<br>  // 通用配置<br>  &#123;<br>    ignores, // 忽略项<br>    <span class="hljs-attr">extends</span>: [<br>      eslint.configs.recommended,<br>      ...tseslint.configs.recommended,<br>      eslintConfigPrettier,<br>    ], // 继承规则<br>    <span class="hljs-attr">plugins</span>: &#123;<br>      <span class="hljs-attr">prettier</span>: eslintPluginPrettier,<br>    &#125;,<br>    <span class="hljs-attr">languageOptions</span>: &#123;<br>      <span class="hljs-attr">ecmaVersion</span>: <span class="hljs-string">&quot;latest&quot;</span>,<br>      <span class="hljs-attr">sourceType</span>: <span class="hljs-string">&quot;module&quot;</span>,<br>      <span class="hljs-attr">parse</span>: tseslint.parser,<br>    &#125;,<br>    <span class="hljs-attr">rules</span>: &#123;<br>      // 自定义<br>      <span class="hljs-string">&quot;no-var&quot;</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>    &#125;,<br>  &#125;,<br>  // 前端配置<br>  &#123;<br>    ignores,<br>    <span class="hljs-attr">files</span>: [<br>      <span class="hljs-string">&quot;apps/frontend/**/*.&#123;ts,js,tsx,jsx,vue&#125;&quot;</span>,<br>      <span class="hljs-string">&quot;packages/components/**/*.&#123;ts,js,tsx,jsx,vue&#125;&quot;</span>,<br>    ],<br>    <span class="hljs-attr">extends</span>: [<br>      ...eslintPluginVue.configs[<span class="hljs-string">&quot;flat/recommended&quot;</span>],<br>      eslintConfigPrettier,<br>    ],<br>    <span class="hljs-attr">languageOptions</span>: &#123;<br>      <span class="hljs-attr">globals</span>: &#123;<br>        ...globals.browser,<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>  // 后端配置<br>  &#123;<br>    ignores,<br>    <span class="hljs-attr">files</span>: [<span class="hljs-string">&quot;apps/backend/**/*.&#123;ts,js&#125;&quot;</span>],<br>    <span class="hljs-attr">languageOptions</span>: &#123;<br>      <span class="hljs-attr">globals</span>: &#123;<br>        ...globals.node,<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>);<br><br></code></pre></td></tr></table></figure><h3 id="拼写检查"><a href="#拼写检查" class="headerlink" title="拼写检查"></a>拼写检查</h3><p><code>VsCode插件</code>:<code>Code Spell Checker</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pnpm -Dw add cspell @cspell/dict-lorem-ipsum<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs json">touch cspell.json<br><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;import&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;@cspell/dict-lorem-ipsum/cspell.ext.json&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;caseSensitive&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;dictionaries&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;custom-dictionary&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;dictionaryDefinitions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;custom-dictionary&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./.cspell/custom-dictionary.txt&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;addWords&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;ignorePaths&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-string">&quot;**/node_modules/**&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/dist/**&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/build/**&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/lib/**&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/docs/**&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/vendor/**&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/public/**&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/static/**&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/out/**&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/tmp/**&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/*.d.ts&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/package.json&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/*.md&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/stats.html&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;eslint.config.mjs&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;.gitignore&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;.prettierignore&quot;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br><br></code></pre></td></tr></table></figure><h2 id="git提交规范"><a href="#git提交规范" class="headerlink" title="git提交规范"></a>git提交规范</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs txt">touch .gitignore<br><br># .gitignore<br><br></code></pre></td></tr></table></figure><h3 id="commitizen"><a href="#commitizen" class="headerlink" title="commitizen"></a>commitizen</h3><p>用于检查提交</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pnpm -Dw add @commitlint/cli @commitlint/config-conventional commitizen cz-git<br></code></pre></td></tr></table></figure><ul><li>@commitlint&#x2F;cli 是 commitlint 工具的核心</li><li>@commitlint&#x2F;config-conventional 是基于 conventional commits 规范的配置文件</li><li>commitizen 提供一个交互式撰写commit信息的插件</li><li>cz-git 是国产工具</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// package.json</span><br> <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br> <span class="hljs-attr">&quot;commit&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;git-cz&quot;</span><br> <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br> <span class="hljs-attr">&quot;config&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;commitizen&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;node_modules/cz-git&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br></code></pre></td></tr></table></figure><p>配置 <code>cz-git</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs js">touch commitlint.<span class="hljs-property">config</span>.<span class="hljs-property">js</span><br><br><span class="hljs-comment">/** <span class="hljs-doctag">@type</span> &#123;<span class="hljs-type">import(&#x27;cz-git&#x27;).UserConfig</span>&#125; */</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">extends</span>: [<span class="hljs-string">&quot;@commitlint/config-conventional&quot;</span>],<br>  <span class="hljs-attr">rules</span>: &#123;<br>    <span class="hljs-comment">// @see: https://commitlint.js.org/#/reference-rules</span><br>    <span class="hljs-string">&quot;body-leading-blank&quot;</span>: [<span class="hljs-number">2</span>, <span class="hljs-string">&quot;always&quot;</span>],<br>    <span class="hljs-string">&quot;footer-leading-blank&quot;</span>: [<span class="hljs-number">1</span>, <span class="hljs-string">&quot;always&quot;</span>],<br>    <span class="hljs-string">&quot;header-max-length&quot;</span>: [<span class="hljs-number">2</span>, <span class="hljs-string">&quot;always&quot;</span>, <span class="hljs-number">108</span>],<br>    <span class="hljs-string">&quot;subject-case&quot;</span>: [<span class="hljs-number">0</span>],<br>    <span class="hljs-string">&quot;type-enum&quot;</span>: [<br>      <span class="hljs-number">2</span>,<br>      <span class="hljs-string">&quot;always&quot;</span>,<br>      [<br>        <span class="hljs-string">&quot;feat&quot;</span>,<br>        <span class="hljs-string">&quot;fix&quot;</span>,<br>        <span class="hljs-string">&quot;docs&quot;</span>,<br>        <span class="hljs-string">&quot;style&quot;</span>,<br>        <span class="hljs-string">&quot;refactor&quot;</span>,<br>        <span class="hljs-string">&quot;perf&quot;</span>,<br>        <span class="hljs-string">&quot;test&quot;</span>,<br>        <span class="hljs-string">&quot;build&quot;</span>,<br>        <span class="hljs-string">&quot;ci&quot;</span>,<br>        <span class="hljs-string">&quot;chore&quot;</span>,<br>        <span class="hljs-string">&quot;revert&quot;</span>,<br>        <span class="hljs-string">&quot;wip&quot;</span>,<br>        <span class="hljs-string">&quot;workflow&quot;</span>,<br>        <span class="hljs-string">&quot;types&quot;</span>,<br>        <span class="hljs-string">&quot;release&quot;</span><br>      ]<br>    ]<br>  &#125;,<br>  <span class="hljs-attr">prompt</span>: &#123;<br>    <span class="hljs-attr">types</span>: [<br>      &#123; <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;feat&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;新功能：新增功能&quot;</span> &#125;,<br>      &#123; <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;fix&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;修复：修复缺陷&quot;</span> &#125;,<br>      &#123; <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;docs&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;文档：更新文档&quot;</span> &#125;,<br>      &#123; <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;refactor&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;重构：重构代码(不新增功能也不修复 bug)&quot;</span> &#125;,<br>      &#123; <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;perf&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;性能：提升性能&quot;</span> &#125;,<br>      &#123; <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;测试：新增测试&quot;</span> &#125;,<br>      &#123; <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;chore&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;工具：更改构建流程或辅助工具&quot;</span> &#125;,<br>      &#123; <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;revert&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;回滚：代码回滚&quot;</span> &#125;,<br>      &#123; <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;style&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;样式：格式调整(不影响代码运行)&quot;</span> &#125;<br>    ],<br>    <span class="hljs-attr">scopes</span>: [<span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;backend&quot;</span>, <span class="hljs-string">&quot;frontend&quot;</span>, <span class="hljs-string">&quot;components&quot;</span>, <span class="hljs-string">&quot;utils&quot;</span>],<br>    <span class="hljs-attr">allowCustomScopes</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">skipQuestions</span>: [<span class="hljs-string">&quot;body&quot;</span>, <span class="hljs-string">&quot;footerPrefix&quot;</span>, <span class="hljs-string">&quot;footer&quot;</span>, <span class="hljs-string">&quot;breaking&quot;</span>],<br>    <span class="hljs-attr">messages</span>: &#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;选择提交类型：&quot;</span>,<br>      <span class="hljs-attr">scope</span>: <span class="hljs-string">&quot;选择提交范围(可选)：&quot;</span>,<br>      <span class="hljs-attr">subject</span>: <span class="hljs-string">&quot;请简要描述更改：&quot;</span>,<br>      <span class="hljs-attr">body</span>: <span class="hljs-string">&quot;详细描述(可选)：&quot;</span>,<br>      <span class="hljs-attr">footer</span>: <span class="hljs-string">&quot;关联 ISSUE 或 BREAKING CHANGE(可选)：&quot;</span>,<br>      <span class="hljs-attr">confirmCommit</span>: <span class="hljs-string">&quot;✅ 确认提交？&quot;</span><br>    &#125;<br>  &#125;<br>&#125;;<br><br><br></code></pre></td></tr></table></figure><h3 id="husky"><a href="#husky" class="headerlink" title="husky"></a>husky</h3><p>连接 git hook 自定义 提交前后事件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pnpm -Dw add husky<br>pnpx husky init<br></code></pre></td></tr></table></figure><p>配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">// .husky/pre-commit<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">!/usr/bin/env sh</span><br>pnpm lint:prettier &amp;&amp; pnpm lint:eslint &amp;&amp; pnpm lint:cspell<br></code></pre></td></tr></table></figure><h3 id="lint-staged"><a href="#lint-staged" class="headerlink" title="lint-staged"></a>lint-staged</h3><p>检查暂存区文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pnpm -Dw add lint-staged<br></code></pre></td></tr></table></figure><p>配置命令</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;precommit&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;lint-staged&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// .lintstagedrc.js</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br><span class="hljs-string">&quot;*.&#123;js,ts,mjs,json,tsx,css,less,scss,vue,html,md&#125;&quot;</span>:[<span class="hljs-string">&quot;cspell lint&quot;</span>],<br><span class="hljs-string">&quot;*.&#123;js,ts,vue,md&#125;&quot;</span>:[<span class="hljs-string">&quot;prettier --write&quot;</span>,<span class="hljs-string">&quot;eslint&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="公共库打包"><a href="#公共库打包" class="headerlink" title="公共库打包"></a>公共库打包</h2><p>安装<code>rollup</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pnpm -Dw add rollup @rollup/plugin-node-resolve @rollup/plugin-commonjs rollup-plugin-typescript2 @rollup/plugin-terser @vitejs/plugin-vue rollup-plugin-postcss<br></code></pre></td></tr></table></figure><ul><li><code>@rollup/plugin-node-resolve</code>: 解析 node_modules 中的依赖</li><li><code>@rollup/plugin-commonjs</code>: 将 CommonJS 模块转为 ESM</li><li><code>rollup-plugin-typescript2</code>: 让 Rollup 支持 TS 编译</li><li><code>@rollup/plugin-terser</code>： 压缩和混淆</li><li><code>@vitejs/plugin-vue</code>： 支持SFC编译</li><li><code>rollup-plugin-postcss</code>： 处理css代码<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// scropts/buildBase.js</span><br><br><span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;node:path&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-variable constant_">URL</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;node:url&quot;</span>;<br><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;node:fs&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; nodeResolve &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@rollup/plugin-node-resolve&quot;</span>;<br><span class="hljs-keyword">import</span> commonjs <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@rollup/plugin-commonjs&quot;</span>;<br><span class="hljs-keyword">import</span> typescript <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;rollup-plugin-typescript2&quot;</span>;<br><span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@vitejs/plugin-vue&quot;</span>;<br><span class="hljs-keyword">import</span> postcss <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;rollup-plugin-postcss&quot;</span>;<br><br><span class="hljs-keyword">const</span> __filename = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>);<br><span class="hljs-keyword">const</span> __dirname = path.<span class="hljs-title function_">dirname</span>(__filename);<br><br><span class="hljs-keyword">const</span> packages = [<span class="hljs-string">&quot;utils&quot;</span>, <span class="hljs-string">&quot;components&quot;</span>];<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getPackageRoots</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> packages.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">pkg</span> =&gt;</span> path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;../packages&quot;</span>, pkg));<br>&#125;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">packageJson</span>(<span class="hljs-params">root</span>) &#123;<br>  <span class="hljs-keyword">const</span> jsonPath = path.<span class="hljs-title function_">resolve</span>(root, <span class="hljs-string">&quot;package.json&quot;</span>);<br>  <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> fs.<span class="hljs-property">promises</span>.<span class="hljs-title function_">readFile</span>(jsonPath, <span class="hljs-string">&quot;utf-8&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(content);<br>&#125;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getRollupConfig</span>(<span class="hljs-params">root</span>) &#123;<br>  <span class="hljs-keyword">const</span> config = <span class="hljs-keyword">await</span> <span class="hljs-title function_">packageJson</span>(root);<br>  <span class="hljs-keyword">const</span> tsconfig = path.<span class="hljs-title function_">resolve</span>(root, <span class="hljs-string">&quot;tsconfig.json&quot;</span>);<br>  <span class="hljs-keyword">const</span> &#123; name, formats &#125; = config.<span class="hljs-property">buildOptions</span> || &#123;&#125;;<br>  <span class="hljs-keyword">const</span> dist = path.<span class="hljs-title function_">resolve</span>(root, <span class="hljs-string">&quot;./dist&quot;</span>);<br>  <span class="hljs-keyword">const</span> entry = path.<span class="hljs-title function_">resolve</span>(root, <span class="hljs-string">&quot;./src/index.ts&quot;</span>);<br>  <span class="hljs-keyword">const</span> rollupOptions = &#123;<br>    <span class="hljs-attr">input</span>: entry,<br>    <span class="hljs-attr">sourcemap</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">external</span>: [<span class="hljs-string">&quot;vue&quot;</span>],<br>    <span class="hljs-attr">plugins</span>: [<br>      <span class="hljs-title function_">nodeResolve</span>(),<br>      <span class="hljs-title function_">commonjs</span>(),<br>      <span class="hljs-title function_">typescript</span>(&#123;<br>        tsconfig,<br>        <span class="hljs-attr">compilerOptions</span>: &#123;<br>          <span class="hljs-attr">outDir</span>: dist<br>        &#125;<br>      &#125;),<br>      <span class="hljs-title function_">vue</span>(&#123;<br>        <span class="hljs-attr">template</span>: &#123;<br>          <span class="hljs-attr">compilerOptions</span>: &#123;<br>            <span class="hljs-comment">// 自定义转换函数，在生成 AST 时移除特定属性</span><br>            <span class="hljs-attr">nodeTransforms</span>: [<br>              <span class="hljs-function"><span class="hljs-params">node</span> =&gt;</span> &#123;<br>                <span class="hljs-keyword">if</span> (node.<span class="hljs-property">type</span> === <span class="hljs-number">1</span> <span class="hljs-comment">/* NodeTypes.ELEMENT */</span>) &#123;<br>                  <span class="hljs-comment">// 过滤掉所有 data-testid 属性</span><br>                  node.<span class="hljs-property">props</span> = node.<span class="hljs-property">props</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">prop</span> =&gt;</span> &#123;<br>                    <span class="hljs-keyword">if</span> (prop.<span class="hljs-property">type</span> === <span class="hljs-number">6</span> <span class="hljs-comment">/* NodeTypes.ATTRIBUTE */</span>) &#123;<br>                      <span class="hljs-keyword">return</span> prop.<span class="hljs-property">name</span> !== <span class="hljs-string">&quot;data-testid&quot;</span>;<br>                    &#125;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>                  &#125;);<br>                &#125;<br>              &#125;<br>            ]<br>          &#125;<br>        &#125;<br>      &#125;),<br>      <span class="hljs-title function_">postcss</span>()<br>    ],<br>    <span class="hljs-attr">dir</span>: dist<br>  &#125;;<br>  <span class="hljs-keyword">const</span> output = [];<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> format <span class="hljs-keyword">of</span> formats) &#123;<br>    <span class="hljs-keyword">const</span> outputItem = &#123;<br>      format,<br>      <span class="hljs-attr">file</span>: path.<span class="hljs-title function_">resolve</span>(dist, <span class="hljs-string">`index.<span class="hljs-subst">$&#123;format&#125;</span>.js`</span>),<br>      <span class="hljs-attr">sourcemap</span>: <span class="hljs-literal">true</span>,<br>      <span class="hljs-attr">globals</span>: &#123;<br>        <span class="hljs-attr">vue</span>: <span class="hljs-string">&quot;Vue&quot;</span><br>      &#125;<br>    &#125;;<br>    <span class="hljs-keyword">if</span> (format === <span class="hljs-string">&quot;iife&quot;</span>) &#123;<br>      outputItem.<span class="hljs-property">name</span> = name;<br>    &#125;<br>    output.<span class="hljs-title function_">push</span>(outputItem);<br>  &#125;<br>  rollupOptions.<span class="hljs-property">output</span> = output;<br>  <span class="hljs-comment">// watch options</span><br>  rollupOptions.<span class="hljs-property">watch</span> = &#123;<br>    <span class="hljs-attr">include</span>: path.<span class="hljs-title function_">resolve</span>(root, <span class="hljs-string">&quot;src/**&quot;</span>),<br>    <span class="hljs-attr">exclude</span>: path.<span class="hljs-title function_">resolve</span>(root, <span class="hljs-string">&quot;node_modules/**&quot;</span>),<br>    <span class="hljs-attr">clearScreen</span>: <span class="hljs-literal">false</span><br>  &#125;;<br>  <span class="hljs-keyword">return</span> rollupOptions;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getRollupConfigs</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> roots = <span class="hljs-title function_">getPackageRoots</span>();<br>  <span class="hljs-keyword">const</span> configs = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(roots.<span class="hljs-title function_">map</span>(getRollupConfig));<br>  <span class="hljs-keyword">const</span> result = &#123;&#125;;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; packages.<span class="hljs-property">length</span>; i++) &#123;<br>    result[packages[i]] = configs[i];<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">clearDist</span>(<span class="hljs-params">name</span>) &#123;<br>  <span class="hljs-keyword">const</span> dist = path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;../packages&quot;</span>, name, <span class="hljs-string">&quot;dist&quot;</span>);<br>  <span class="hljs-keyword">if</span> (fs.<span class="hljs-title function_">existsSync</span>(dist)) &#123;<br>    fs.<span class="hljs-title function_">rmSync</span>(dist, &#123; <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">force</span>: <span class="hljs-literal">true</span> &#125;);<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// scripts/build.js</span><br><span class="hljs-keyword">import</span> &#123; getRollupConfigs, clearDist &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./buildBase.js&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; rollup &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;rollup&quot;</span>;<br><span class="hljs-keyword">import</span> terser <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@rollup/plugin-terser&quot;</span>;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> configs = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getRollupConfigs</span>();<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> name <span class="hljs-keyword">in</span> configs) &#123;<br>    <span class="hljs-title function_">clearDist</span>(name);<br>    <span class="hljs-keyword">const</span> config = configs[name];<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`📦 正在打包: <span class="hljs-subst">$&#123;name&#125;</span>`</span>);<br>    <span class="hljs-keyword">const</span> bundle = <span class="hljs-keyword">await</span> <span class="hljs-title function_">rollup</span>(&#123;<br>      <span class="hljs-attr">input</span>: config.<span class="hljs-property">input</span>,<br>      <span class="hljs-attr">plugins</span>: [...config.<span class="hljs-property">plugins</span>, <span class="hljs-title function_">terser</span>()],<br>      <span class="hljs-attr">external</span>: config.<span class="hljs-property">external</span><br>    &#125;);<br>    <span class="hljs-keyword">const</span> tasks = [];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> output <span class="hljs-keyword">of</span> config.<span class="hljs-property">output</span>) &#123;<br>      tasks.<span class="hljs-title function_">push</span>(bundle.<span class="hljs-title function_">write</span>(output));<br>    &#125;<br>    <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(tasks);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`✅ <span class="hljs-subst">$&#123;name&#125;</span> 打包完成`</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-title function_">build</span>();<br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// scripts/dev.js</span><br><span class="hljs-keyword">import</span> &#123; getRollupConfigs &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./buildBase.js&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; watch &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;rollup&quot;</span>;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">dev</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> configs = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getRollupConfigs</span>();<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> name <span class="hljs-keyword">in</span> configs) &#123;<br>    <span class="hljs-keyword">const</span> config = configs[name];<br>    <span class="hljs-keyword">const</span> watcher = <span class="hljs-title function_">watch</span>(<br>      config.<span class="hljs-property">output</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> (&#123;<br>        <span class="hljs-attr">input</span>: config.<span class="hljs-property">input</span>,<br>        <span class="hljs-attr">plugins</span>: config.<span class="hljs-property">plugins</span>,<br>        <span class="hljs-attr">external</span>: config.<span class="hljs-property">external</span>,<br>        <span class="hljs-attr">output</span>: o,<br>        <span class="hljs-attr">watch</span>: config.<span class="hljs-property">watch</span><br>      &#125;))<br>    );<br>    watcher.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;event&quot;</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (event.<span class="hljs-property">code</span> === <span class="hljs-string">&quot;START&quot;</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`👁️ 开始监听: <span class="hljs-subst">$&#123;name&#125;</span>`</span>);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.<span class="hljs-property">code</span> === <span class="hljs-string">&quot;ERROR&quot;</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`❌ <span class="hljs-subst">$&#123;name&#125;</span>打包失败:`</span>, event.<span class="hljs-property">error</span>);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.<span class="hljs-property">code</span> === <span class="hljs-string">&quot;BUNDLE_START&quot;</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`📦 正在打包: <span class="hljs-subst">$&#123;name&#125;</span>`</span>);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.<span class="hljs-property">code</span> === <span class="hljs-string">&quot;BUNDLE_END&quot;</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`✅ <span class="hljs-subst">$&#123;name&#125;</span> 打包完成`</span>);<br>      &#125;<br>    &#125;);<br>  &#125;<br>&#125;<br><br><span class="hljs-title function_">dev</span>();<br></code></pre></td></tr></table></figure><h2 id="统一测试"><a href="#统一测试" class="headerlink" title="统一测试"></a>统一测试</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pnpm -Dw add vitest @vitest/browser vitest-browser-vue vue<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>前端</category>
      
      <category>Monorepo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Monorepo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>从零构建企业级自动化部署脚本</title>
    <link href="/posts/%E5%90%8E%E7%AB%AF/Shell/%E4%BB%8E%E9%9B%B6%E6%9E%84%E5%BB%BA%E4%BC%81%E4%B8%9A%E7%BA%A7%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC/36122/"/>
    <url>/posts/%E5%90%8E%E7%AB%AF/Shell/%E4%BB%8E%E9%9B%B6%E6%9E%84%E5%BB%BA%E4%BC%81%E4%B8%9A%E7%BA%A7%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC/36122/</url>
    
    <content type="html"><![CDATA[<h1 id="从零构建企业级自动化部署脚本：支持多项目并发部署与智能备份"><a href="#从零构建企业级自动化部署脚本：支持多项目并发部署与智能备份" class="headerlink" title="从零构建企业级自动化部署脚本：支持多项目并发部署与智能备份"></a>从零构建企业级自动化部署脚本：支持多项目并发部署与智能备份</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在现代软件开发中，部署是一个频繁且重要的环节。传统的手动部署方式不仅效率低下，还容易出现人为错误。本文将详细介绍一个企业级的自动化部署脚本，它支持多项目并发部署、智能备份、文件校验等功能，大大提升了部署效率和可靠性。</p><h2 id="脚本设计目标"><a href="#脚本设计目标" class="headerlink" title="脚本设计目标"></a>脚本设计目标</h2><h3 id="核心需求"><a href="#核心需求" class="headerlink" title="核心需求"></a>核心需求</h3><ol><li><p><strong>多项目支持</strong>：从JSON配置文件读取多个项目的部署信息</p></li><li><p><strong>智能备份</strong>：自动备份服务器上的现有项目，避免数据丢失</p></li><li><p><strong>并发部署</strong>：多个项目同时部署，提升整体效率</p></li><li><p><strong>文件校验</strong>：部署完成后验证文件完整性</p></li><li><p><strong>用户友好</strong>：提供进度条和详细的状态反馈</p></li><li><p><strong>安全可靠</strong>：支持SSH密钥认证，防止意外交互</p></li></ol><h3 id="技术特性"><a href="#技术特性" class="headerlink" title="技术特性"></a>技术特性</h3><ul><li><p>支持断点续传（rsync的–partial选项）</p></li><li><p>彩色输出和进度条显示</p></li><li><p>详细的成功&#x2F;失败报告</p></li><li><p>可选的单项目或多项目部署</p></li></ul><h2 id="核心架构设计"><a href="#核心架构设计" class="headerlink" title="核心架构设计"></a>核心架构设计</h2><h3 id="1-配置驱动"><a href="#1-配置驱动" class="headerlink" title="1. 配置驱动"></a>1. 配置驱动</h3><p>脚本采用JSON配置文件的方式管理部署信息，每个项目包含：</p><ul><li><p>项目名称</p></li><li><p>服务器信息（IP、端口、用户）</p></li><li><p>本地源码目录</p></li><li><p>远程目标目录</p></li></ul><h3 id="2-并发控制"><a href="#2-并发控制" class="headerlink" title="2. 并发控制"></a>2. 并发控制</h3><p>使用bash的后台作业管理，通过<code>&amp;</code>和<code>wait</code>命令实现并发部署，同时限制最大并发数避免服务器过载。</p><h3 id="3-状态管理"><a href="#3-状态管理" class="headerlink" title="3. 状态管理"></a>3. 状态管理</h3><p>通过临时文件在子进程和父进程之间传递状态信息，确保部署结果的准确记录。</p><h2 id="代码实现详解"><a href="#代码实现详解" class="headerlink" title="代码实现详解"></a>代码实现详解</h2><h3 id="第一步：环境准备和依赖检查"><a href="#第一步：环境准备和依赖检查" class="headerlink" title="第一步：环境准备和依赖检查"></a>第一步：环境准备和依赖检查</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment">#!/bin/bash</span><br><br><br><br><span class="hljs-comment"># 颜色输出函数</span><br><br><span class="hljs-function"><span class="hljs-title">green</span></span>() &#123; <span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;\033[32m%b\033[0m\n&#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span>; &#125;<br><br><span class="hljs-function"><span class="hljs-title">red</span></span>() &#123; <span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;\033[31m%b\033[0m\n&#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span>; &#125;<br><br><span class="hljs-function"><span class="hljs-title">yellow</span></span>() &#123; <span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;\033[33m%b\033[0m\n&#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span>; &#125;<br><br><span class="hljs-function"><span class="hljs-title">blue</span></span>() &#123; <span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;\033[34m%b\033[0m\n&#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span>; &#125;<br><br>  <br><br><span class="hljs-comment"># 依赖检查</span><br><br><span class="hljs-built_in">command</span> -v rsync &gt;/dev/null || &#123; red <span class="hljs-string">&quot;请先安装 rsync&quot;</span>; <span class="hljs-built_in">exit</span> 1; &#125;<br><br><span class="hljs-built_in">command</span> -v jq &gt;/dev/null || &#123; red <span class="hljs-string">&quot;请先安装 jq&quot;</span>; <span class="hljs-built_in">exit</span> 1; &#125;<br><br></code></pre></td></tr></table></figure><p><strong>设计思路</strong>：</p><ul><li><p>使用ANSI转义序列实现彩色输出，提升用户体验</p></li><li><p>在脚本开始时检查必要工具，避免运行时才发现依赖缺失</p></li></ul><h3 id="第二步：进度条实现"><a href="#第二步：进度条实现" class="headerlink" title="第二步：进度条实现"></a>第二步：进度条实现</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-function"><span class="hljs-title">progress_bar</span></span>() &#123;<br><br><span class="hljs-built_in">local</span> current=<span class="hljs-variable">$1</span><br><br><span class="hljs-built_in">local</span> total=<span class="hljs-variable">$2</span><br><br><span class="hljs-built_in">local</span> width=50<br><br><span class="hljs-built_in">local</span> percentage=$((current * <span class="hljs-number">100</span> / total))<br><br><span class="hljs-built_in">local</span> filled=$((current * width / total))<br><br><span class="hljs-built_in">local</span> empty=$((width - filled))<br><br>  <br><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;\r\033[36m[&#x27;</span><br><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;%*s&#x27;</span> <span class="hljs-variable">$filled</span> | <span class="hljs-built_in">tr</span> <span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-string">&#x27;#&#x27;</span><br><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;%*s&#x27;</span> <span class="hljs-variable">$empty</span> | <span class="hljs-built_in">tr</span> <span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-string">&#x27;-&#x27;</span><br><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;] %d%%\033[0m&#x27;</span> <span class="hljs-variable">$percentage</span><br><br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>设计思路</strong>：</p><ul><li><p>使用<code>\r</code>实现同行刷新，避免输出过多行</p></li><li><p>通过计算填充和空白字符数量实现可视化进度</p></li><li><p>使用<code>#</code>和<code>-</code>字符确保在不同终端环境下的兼容性</p></li></ul><h3 id="第三步：配置解析"><a href="#第三步：配置解析" class="headerlink" title="第三步：配置解析"></a>第三步：配置解析</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment"># 读取配置文件</span><br><br>DEPLOY_CONFIG=<span class="hljs-string">&quot;scripts/deploy.json&quot;</span><br><br>PROJECTS_DATA=$(jq -r <span class="hljs-string">&#x27;.&#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$DEPLOY_CONFIG</span>&quot;</span>)<br><br>PROJECT_COUNT=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$PROJECTS_DATA</span>&quot;</span> | jq <span class="hljs-string">&#x27;length&#x27;</span>)<br><br>  <br><br><span class="hljs-comment"># 解析项目信息</span><br><br><span class="hljs-function"><span class="hljs-title">get_project_info</span></span>() &#123;<br><br><span class="hljs-built_in">local</span> index=<span class="hljs-variable">$1</span><br><br><span class="hljs-built_in">local</span> field=<span class="hljs-variable">$2</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$PROJECTS_DATA</span>&quot;</span> | jq -r <span class="hljs-string">&quot;.[<span class="hljs-variable">$index</span>].<span class="hljs-variable">$field</span>&quot;</span><br><br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>设计思路</strong>：</p><ul><li><p>使用<code>jq</code>一次性读取整个JSON文件，避免多次文件IO</p></li><li><p>通过函数封装项目信息获取，提高代码复用性</p></li><li><p>预先计算项目总数，用于进度条显示</p></li></ul><h3 id="第四步：用户交互"><a href="#第四步：用户交互" class="headerlink" title="第四步：用户交互"></a>第四步：用户交互</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;请选择部署方式：&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;a) 部署所有项目&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;s) 选择特定项目&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;q) 退出&quot;</span><br><br>  <br><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;请输入选择 (a/s/q): &quot;</span> choice<br><br>  <br><br><span class="hljs-keyword">case</span> <span class="hljs-variable">$choice</span> <span class="hljs-keyword">in</span><br><br>a) SELECTED_INDICES=$(<span class="hljs-built_in">seq</span> 0 $((PROJECT_COUNT - <span class="hljs-number">1</span>)));;<br><br>s)<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;可用项目：&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 0 $((PROJECT_COUNT - <span class="hljs-number">1</span>))); <span class="hljs-keyword">do</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$i</span>) <span class="hljs-subst">$(get_project_info $i name)</span>&quot;</span><br><br><span class="hljs-keyword">done</span><br><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;请输入项目编号（多个用空格分隔）: &quot;</span> -a indices<br><br>SELECTED_INDICES=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;indices[@]&#125;</span>&quot;</span><br><br>;;<br><br>q) <span class="hljs-built_in">exit</span> 0;;<br><br>*) red <span class="hljs-string">&quot;无效选择&quot;</span>; <span class="hljs-built_in">exit</span> 1;;<br><br><span class="hljs-keyword">esac</span><br><br></code></pre></td></tr></table></figure><p><strong>设计思路</strong>：</p><ul><li><p>提供灵活的部署选择，支持全量或选择性部署</p></li><li><p>使用数组存储用户选择，便于后续处理</p></li><li><p>清晰的用户界面，降低使用门槛</p></li></ul><h3 id="第五步：核心部署函数"><a href="#第五步：核心部署函数" class="headerlink" title="第五步：核心部署函数"></a>第五步：核心部署函数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-function"><span class="hljs-title">deploy_project</span></span>() &#123;<br><br><span class="hljs-built_in">local</span> index=<span class="hljs-variable">$1</span><br><br><span class="hljs-built_in">local</span> PROJECT_NAME=$(get_project_info <span class="hljs-variable">$index</span> name)<br><br><span class="hljs-built_in">local</span> SERVER=$(get_project_info <span class="hljs-variable">$index</span> server)<br><br><span class="hljs-built_in">local</span> PORT=$(get_project_info <span class="hljs-variable">$index</span> port)<br><br><span class="hljs-built_in">local</span> TARGET_DIR=$(get_project_info <span class="hljs-variable">$index</span> target_dir)<br><br><span class="hljs-built_in">local</span> SRC_DIR=$(get_project_info <span class="hljs-variable">$index</span> src_dir)<br><br><span class="hljs-built_in">local</span> SSH_KEY=<span class="hljs-string">&quot;~/.ssh/id_rsa&quot;</span><br><br><span class="hljs-built_in">local</span> log_file=<span class="hljs-string">&quot;/tmp/deploy_<span class="hljs-variable">$&#123;PROJECT_NAME&#125;</span>_$$.log&quot;</span><br><br><span class="hljs-built_in">local</span> exit_code=0<br><br><span class="hljs-comment"># 检查源目录</span><br><br><span class="hljs-keyword">if</span> [[ ! -d <span class="hljs-string">&quot;<span class="hljs-variable">$SRC_DIR</span>&quot;</span> ]]; <span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;FAILED:<span class="hljs-variable">$PROJECT_NAME</span>:源目录不存在 (<span class="hljs-variable">$SRC_DIR</span>)&quot;</span> &gt;&gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span><br><br><span class="hljs-built_in">return</span> 1<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># 检查SSH连接</span><br><br><span class="hljs-keyword">if</span> ! ssh -i <span class="hljs-string">&quot;<span class="hljs-variable">$SSH_KEY</span>&quot;</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$PORT</span>&quot;</span> -o BatchMode=<span class="hljs-built_in">yes</span> -o ConnectTimeout=10 -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null <span class="hljs-string">&quot;<span class="hljs-variable">$SERVER</span>&quot;</span> <span class="hljs-string">&quot;echo &#x27;SSH连接测试&#x27;&quot;</span> &gt;/dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;FAILED:<span class="hljs-variable">$PROJECT_NAME</span>:SSH连接失败&quot;</span> &gt;&gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span><br><br><span class="hljs-built_in">return</span> 1<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># 备份现有目录</span><br><br><span class="hljs-keyword">if</span> ssh -i <span class="hljs-string">&quot;<span class="hljs-variable">$SSH_KEY</span>&quot;</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$PORT</span>&quot;</span> -o BatchMode=<span class="hljs-built_in">yes</span> -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null <span class="hljs-string">&quot;<span class="hljs-variable">$SERVER</span>&quot;</span> <span class="hljs-string">&quot;[ -d &#x27;<span class="hljs-variable">$TARGET_DIR</span>&#x27; ]&quot;</span>; <span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">local</span> backup_suffix=$(<span class="hljs-built_in">date</span> +%Y%m%d%H%M)<br><br><span class="hljs-built_in">local</span> dir_name=$(<span class="hljs-built_in">basename</span> <span class="hljs-string">&quot;<span class="hljs-variable">$TARGET_DIR</span>&quot;</span>)<br><br><span class="hljs-built_in">local</span> BACKUP_NAME=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;dir_name&#125;</span>_back<span class="hljs-variable">$&#123;backup_suffix&#125;</span>&quot;</span><br><br><span class="hljs-built_in">local</span> backup_path=$(<span class="hljs-built_in">dirname</span> <span class="hljs-string">&quot;<span class="hljs-variable">$TARGET_DIR</span>&quot;</span>)/<span class="hljs-variable">$BACKUP_NAME</span><br><br>ssh -i <span class="hljs-string">&quot;<span class="hljs-variable">$SSH_KEY</span>&quot;</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$PORT</span>&quot;</span> -o BatchMode=<span class="hljs-built_in">yes</span> -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null <span class="hljs-string">&quot;<span class="hljs-variable">$SERVER</span>&quot;</span> <span class="hljs-string">&quot;mv &#x27;<span class="hljs-variable">$TARGET_DIR</span>&#x27; &#x27;<span class="hljs-variable">$backup_path</span>&#x27;&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$PROJECT_NAME</span> -&gt; <span class="hljs-variable">$BACKUP_NAME</span>&quot;</span> &gt; <span class="hljs-string">&quot;/tmp/renamed_<span class="hljs-variable">$&#123;PROJECT_NAME&#125;</span>_$$.tmp&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># 执行rsync同步</span><br><br><span class="hljs-keyword">if</span> rsync -avz --delete --progress \<br><br>-e <span class="hljs-string">&quot;ssh -i <span class="hljs-variable">$SSH_KEY</span> -p <span class="hljs-variable">$PORT</span> -o BatchMode=yes -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null&quot;</span> \<br><br>--iconv=UTF-8-MAC,UTF-8 \<br><br>--partial \<br><br>--partial-dir=.rsync-partial \<br><br><span class="hljs-string">&quot;<span class="hljs-variable">$SRC_DIR</span>/&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$SERVER</span>:<span class="hljs-variable">$TARGET_DIR</span>/&quot;</span> &gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span> 2&gt;&amp;1; <span class="hljs-keyword">then</span><br><br><span class="hljs-comment"># 文件数量校验</span><br><br>local_file_count=$(find <span class="hljs-string">&quot;<span class="hljs-variable">$SRC_DIR</span>&quot;</span> -<span class="hljs-built_in">type</span> f \( -name <span class="hljs-string">&quot;.*&quot;</span> -o -name <span class="hljs-string">&quot;*.tmp&quot;</span> -o -name <span class="hljs-string">&quot;*.log&quot;</span> -o -name <span class="hljs-string">&quot;.DS_Store&quot;</span> \) -prune -o -<span class="hljs-built_in">type</span> f -<span class="hljs-built_in">print</span> | <span class="hljs-built_in">wc</span> -l)<br><br>remote_file_count=$(ssh -i <span class="hljs-string">&quot;<span class="hljs-variable">$SSH_KEY</span>&quot;</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$PORT</span>&quot;</span> -o BatchMode=<span class="hljs-built_in">yes</span> -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null <span class="hljs-string">&quot;<span class="hljs-variable">$SERVER</span>&quot;</span> <span class="hljs-string">&quot;find <span class="hljs-variable">$TARGET_DIR</span> -type f \( -name &#x27;.*&#x27; -o -name &#x27;*.tmp&#x27; -o -name &#x27;*.log&#x27; -o -name &#x27;.DS_Store&#x27; \) -prune -o -type f -print | wc -l&quot;</span> 2&gt;/dev/null)<br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-string">&quot;<span class="hljs-variable">$local_file_count</span>&quot;</span> == <span class="hljs-string">&quot;<span class="hljs-variable">$remote_file_count</span>&quot;</span> &amp;&amp; <span class="hljs-string">&quot;<span class="hljs-variable">$local_file_count</span>&quot;</span> -gt 0 ]]; <span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;SUCCESS:<span class="hljs-variable">$PROJECT_NAME</span>:<span class="hljs-variable">$local_file_count</span>&quot;</span> &gt;&gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span><br><br><span class="hljs-keyword">else</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;FAILED:<span class="hljs-variable">$PROJECT_NAME</span>:文件数量不匹配 (本地:<span class="hljs-variable">$local_file_count</span>, 远程:<span class="hljs-variable">$remote_file_count</span>)&quot;</span> &gt;&gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span><br><br>exit_code=1<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">else</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;FAILED:<span class="hljs-variable">$PROJECT_NAME</span>:rsync同步失败&quot;</span> &gt;&gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span><br><br>exit_code=1<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-built_in">return</span> <span class="hljs-variable">$exit_code</span><br><br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>设计思路</strong>：</p><ul><li><p><strong>分层错误处理</strong>：每个关键步骤都有独立的错误检查</p></li><li><p><strong>智能备份</strong>：自动检测并备份现有目录，使用时间戳避免冲突</p></li><li><p><strong>断点续传</strong>：rsync的<code>--partial</code>选项支持中断后继续传输</p></li><li><p><strong>文件校验</strong>：通过文件数量对比验证部署完整性</p></li><li><p><strong>状态记录</strong>：使用临时文件记录详细状态，便于父进程处理</p></li></ul><h3 id="第六步：并发管理和结果处理"><a href="#第六步：并发管理和结果处理" class="headerlink" title="第六步：并发管理和结果处理"></a>第六步：并发管理和结果处理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment"># 并发控制</span><br><br>MAX_CONCURRENT=3<br><br>current_jobs=0<br><br>job_pids=<span class="hljs-string">&quot;&quot;</span><br><br>job_names=<span class="hljs-string">&quot;&quot;</span><br><br>  <br><br><span class="hljs-comment"># 部署所有选中的项目</span><br><br><span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-variable">$SELECTED_INDICES</span>; <span class="hljs-keyword">do</span><br><br><span class="hljs-comment"># 控制并发数</span><br><br><span class="hljs-keyword">while</span> [[ <span class="hljs-variable">$current_jobs</span> -ge <span class="hljs-variable">$MAX_CONCURRENT</span> ]]; <span class="hljs-keyword">do</span><br><br>wait_for_job<br><br><span class="hljs-keyword">done</span><br><br><span class="hljs-comment"># 启动新任务</span><br><br>deploy_project <span class="hljs-variable">$index</span> &amp;<br><br><span class="hljs-built_in">local</span> pid=$!<br><br>job_pids=<span class="hljs-string">&quot;<span class="hljs-variable">$job_pids</span> <span class="hljs-variable">$pid</span>&quot;</span><br><br>job_names=<span class="hljs-string">&quot;<span class="hljs-variable">$job_names</span> <span class="hljs-variable">$index</span>&quot;</span><br><br>current_jobs=$((current_jobs + <span class="hljs-number">1</span>))<br><br><span class="hljs-keyword">done</span><br><br>  <br><br><span class="hljs-comment"># 等待所有任务完成</span><br><br><span class="hljs-keyword">while</span> [[ <span class="hljs-variable">$current_jobs</span> -gt 0 ]]; <span class="hljs-keyword">do</span><br><br>wait_for_job<br><br><span class="hljs-keyword">done</span><br><br></code></pre></td></tr></table></figure><p><strong>设计思路</strong>：</p><ul><li><p><strong>并发限制</strong>：通过<code>MAX_CONCURRENT</code>控制同时运行的任务数</p></li><li><p><strong>动态等待</strong>：使用<code>wait_for_job</code>函数处理完成的任务</p></li><li><p><strong>状态跟踪</strong>：通过字符串存储PID和项目名称，便于管理</p></li></ul><h3 id="第七步：结果汇总和展示"><a href="#第七步：结果汇总和展示" class="headerlink" title="第七步：结果汇总和展示"></a>第七步：结果汇总和展示</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment"># 显示最终结果</span><br><br><span class="hljs-built_in">echo</span><br><br><span class="hljs-keyword">if</span> [[ -n <span class="hljs-string">&quot;<span class="hljs-variable">$RENAMED_DETAILS</span>&quot;</span> ]]; <span class="hljs-keyword">then</span><br><br>blue <span class="hljs-string">&quot;📁 重命名备份的项目：<span class="hljs-variable">$RENAMED_DETAILS</span>&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br>  <br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$SUCCESS_COUNT</span> -gt 0 ]]; <span class="hljs-keyword">then</span><br><br>green <span class="hljs-string">&quot;✅ 部署成功的项目：<span class="hljs-variable">$SUCCESS_PROJECTS</span>&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br>  <br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$FAILED_COUNT</span> -gt 0 ]]; <span class="hljs-keyword">then</span><br><br>red <span class="hljs-string">&quot;❌ 部署失败的项目：<span class="hljs-variable">$FAILED_PROJECTS</span>&quot;</span><br><br><span class="hljs-built_in">echo</span><br><br>red <span class="hljs-string">&quot;失败原因：&quot;</span><br><br><span class="hljs-keyword">for</span> reason <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;FAILED_REASONS[@]&#125;</span>&quot;</span>; <span class="hljs-keyword">do</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; - <span class="hljs-variable">$reason</span>&quot;</span><br><br><span class="hljs-keyword">done</span><br><br><span class="hljs-keyword">fi</span><br><br>  <br><br><span class="hljs-comment"># 根据结果选择颜色</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$FAILED_COUNT</span> -eq 0 ]]; <span class="hljs-keyword">then</span><br><br>green <span class="hljs-string">&quot;部署完成！共部署 <span class="hljs-variable">$SUCCESS_COUNT</span> 个项目，失败 <span class="hljs-variable">$FAILED_COUNT</span> 个项目&quot;</span><br><br><span class="hljs-keyword">else</span><br><br>red <span class="hljs-string">&quot;部署完成！共部署 <span class="hljs-variable">$SUCCESS_COUNT</span> 个项目，失败 <span class="hljs-variable">$FAILED_COUNT</span> 个项目&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br></code></pre></td></tr></table></figure><p><strong>设计思路</strong>：</p><ul><li><p><strong>分类展示</strong>：分别显示备份、成功、失败的项目</p></li><li><p><strong>详细反馈</strong>：提供具体的失败原因，便于问题排查</p></li><li><p><strong>动态颜色</strong>：根据部署结果选择不同的颜色显示</p></li></ul><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment">#!/bin/bash</span><br><br>  <br><br><span class="hljs-comment"># -------------------------------------------------</span><br><br><span class="hljs-comment"># deploy.sh — 一键把本地文件/目录推到远端 Linux 服务器</span><br><br><span class="hljs-comment"># 依赖: rsync (本地+远端都要有), jq (用于解析JSON)</span><br><br><span class="hljs-comment"># -------------------------------------------------</span><br><br><span class="hljs-comment"># 从 deploy.json 读取配置并遍历推送</span><br><br>  <br><br><span class="hljs-comment"># 颜色输出函数</span><br><br><span class="hljs-function"><span class="hljs-title">green</span></span>() &#123; <span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;\033[32m%b\033[0m\n&#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span>; &#125;<br><br><span class="hljs-function"><span class="hljs-title">red</span></span>() &#123; <span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;\033[31m%b\033[0m\n&#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span>; &#125;<br><br><span class="hljs-function"><span class="hljs-title">yellow</span></span>() &#123; <span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;\033[33m%b\033[0m\n&#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span>; &#125;<br><br><span class="hljs-function"><span class="hljs-title">blue</span></span>() &#123; <span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;\033[34m%b\033[0m\n&#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span>; &#125;<br><br>  <br><br><span class="hljs-comment"># 进度条函数</span><br><br><span class="hljs-function"><span class="hljs-title">progress_bar</span></span>() &#123;<br><br><span class="hljs-built_in">local</span> current=<span class="hljs-variable">$1</span><br><br><span class="hljs-built_in">local</span> total=<span class="hljs-variable">$2</span><br><br><span class="hljs-built_in">local</span> width=50<br><br><span class="hljs-built_in">local</span> percentage=$((current * <span class="hljs-number">100</span> / total))<br><br><span class="hljs-built_in">local</span> filled=$((current * width / total))<br><br><span class="hljs-built_in">local</span> empty=$((width - filled))<br><br>  <br><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;\r\033[36m[&#x27;</span><br><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;%*s&#x27;</span> <span class="hljs-variable">$filled</span> | <span class="hljs-built_in">tr</span> <span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-string">&#x27;#&#x27;</span><br><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;%*s&#x27;</span> <span class="hljs-variable">$empty</span> | <span class="hljs-built_in">tr</span> <span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-string">&#x27;-&#x27;</span><br><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;] %d%%\033[0m&#x27;</span> <span class="hljs-variable">$percentage</span><br><br>&#125;<br><br>  <br><br><span class="hljs-comment"># 检查依赖</span><br><br><span class="hljs-built_in">command</span> -v rsync &gt;/dev/null || &#123; red <span class="hljs-string">&quot;请先安装 rsync&quot;</span>; <span class="hljs-built_in">exit</span> 1; &#125;<br><br><span class="hljs-built_in">command</span> -v jq &gt;/dev/null || &#123; red <span class="hljs-string">&quot;请先安装 jq&quot;</span>; <span class="hljs-built_in">exit</span> 1; &#125;<br><br>  <br><br><span class="hljs-comment"># 配置文件</span><br><br>DEPLOY_CONFIG=<span class="hljs-string">&quot;scripts/deploy.json&quot;</span><br><br>[[ -f <span class="hljs-string">&quot;<span class="hljs-variable">$DEPLOY_CONFIG</span>&quot;</span> ]] || &#123; red <span class="hljs-string">&quot;配置文件不存在：<span class="hljs-variable">$DEPLOY_CONFIG</span>&quot;</span>; <span class="hljs-built_in">exit</span> 1; &#125;<br><br>  <br><br><span class="hljs-comment"># 读取项目数据</span><br><br>PROJECTS_DATA=$(jq -r <span class="hljs-string">&#x27;.&#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$DEPLOY_CONFIG</span>&quot;</span>)<br><br>PROJECT_COUNT=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$PROJECTS_DATA</span>&quot;</span> | jq <span class="hljs-string">&#x27;length&#x27;</span>)<br><br>  <br><br><span class="hljs-comment"># 获取项目信息的辅助函数</span><br><br><span class="hljs-function"><span class="hljs-title">get_project_info</span></span>() &#123;<br><br><span class="hljs-built_in">local</span> index=<span class="hljs-variable">$1</span><br><br><span class="hljs-built_in">local</span> field=<span class="hljs-variable">$2</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$PROJECTS_DATA</span>&quot;</span> | jq -r <span class="hljs-string">&quot;.[<span class="hljs-variable">$index</span>].<span class="hljs-variable">$field</span>&quot;</span><br><br>&#125;<br><br>  <br><br><span class="hljs-comment"># 获取项目名称的辅助函数</span><br><br><span class="hljs-function"><span class="hljs-title">get_project_name</span></span>() &#123;<br><br><span class="hljs-built_in">local</span> pid=<span class="hljs-variable">$1</span><br><br><span class="hljs-built_in">local</span> index=0<br><br><span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> <span class="hljs-variable">$job_pids</span>; <span class="hljs-keyword">do</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$p</span> -eq <span class="hljs-variable">$pid</span> ]]; <span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">local</span> name_index=0<br><br><span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-variable">$job_names</span>; <span class="hljs-keyword">do</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$name_index</span> -eq <span class="hljs-variable">$index</span> ]]; <span class="hljs-keyword">then</span><br><br>get_project_info <span class="hljs-variable">$n</span> name<br><br><span class="hljs-built_in">return</span><br><br><span class="hljs-keyword">fi</span><br><br>name_index=$((name_index + <span class="hljs-number">1</span>))<br><br><span class="hljs-keyword">done</span><br><br><span class="hljs-keyword">fi</span><br><br>index=$((index + <span class="hljs-number">1</span>))<br><br><span class="hljs-keyword">done</span><br><br>&#125;<br><br>  <br><br><span class="hljs-comment"># 从PID列表中移除指定PID</span><br><br><span class="hljs-function"><span class="hljs-title">remove_pid</span></span>() &#123;<br><br><span class="hljs-built_in">local</span> target_pid=<span class="hljs-variable">$1</span><br><br><span class="hljs-built_in">local</span> new_pids=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-built_in">local</span> new_names=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-built_in">local</span> index=0<br><br><span class="hljs-keyword">for</span> pid <span class="hljs-keyword">in</span> <span class="hljs-variable">$job_pids</span>; <span class="hljs-keyword">do</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$pid</span> -ne <span class="hljs-variable">$target_pid</span> ]]; <span class="hljs-keyword">then</span><br><br>new_pids=<span class="hljs-string">&quot;<span class="hljs-variable">$new_pids</span> <span class="hljs-variable">$pid</span>&quot;</span><br><br><span class="hljs-comment"># 获取对应的项目名称</span><br><br><span class="hljs-built_in">local</span> name_index=0<br><br><span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> <span class="hljs-variable">$job_names</span>; <span class="hljs-keyword">do</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$name_index</span> -eq <span class="hljs-variable">$index</span> ]]; <span class="hljs-keyword">then</span><br><br>new_names=<span class="hljs-string">&quot;<span class="hljs-variable">$new_names</span> <span class="hljs-variable">$name</span>&quot;</span><br><br><span class="hljs-built_in">break</span><br><br><span class="hljs-keyword">fi</span><br><br>name_index=$((name_index + <span class="hljs-number">1</span>))<br><br><span class="hljs-keyword">done</span><br><br><span class="hljs-keyword">fi</span><br><br>index=$((index + <span class="hljs-number">1</span>))<br><br><span class="hljs-keyword">done</span><br><br>job_pids=<span class="hljs-string">&quot;<span class="hljs-variable">$new_pids</span>&quot;</span><br><br>job_names=<span class="hljs-string">&quot;<span class="hljs-variable">$new_names</span>&quot;</span><br><br>&#125;<br><br>  <br><br><span class="hljs-comment"># 等待作业完成的函数</span><br><br><span class="hljs-function"><span class="hljs-title">wait_for_job</span></span>() &#123;<br><br><span class="hljs-built_in">local</span> completed_pid<br><br><span class="hljs-keyword">for</span> pid <span class="hljs-keyword">in</span> <span class="hljs-variable">$job_pids</span>; <span class="hljs-keyword">do</span><br><br><span class="hljs-keyword">if</span> ! <span class="hljs-built_in">kill</span> -0 <span class="hljs-variable">$pid</span> 2&gt;/dev/null; <span class="hljs-keyword">then</span><br><br>completed_pid=<span class="hljs-variable">$pid</span><br><br><span class="hljs-built_in">break</span><br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">done</span><br><br><span class="hljs-keyword">if</span> [[ -n <span class="hljs-string">&quot;<span class="hljs-variable">$completed_pid</span>&quot;</span> ]]; <span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">local</span> project_name=$(get_project_name <span class="hljs-variable">$completed_pid</span>)<br><br><span class="hljs-built_in">local</span> log_file=<span class="hljs-string">&quot;/tmp/deploy_<span class="hljs-variable">$&#123;project_name&#125;</span>_$$.log&quot;</span><br><br><span class="hljs-comment"># 检查部署结果</span><br><br><span class="hljs-keyword">if</span> grep -q <span class="hljs-string">&quot;SUCCESS:<span class="hljs-variable">$project_name</span>:&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span>; <span class="hljs-keyword">then</span><br><br><span class="hljs-comment"># 获取文件数量信息</span><br><br>file_count=$(grep <span class="hljs-string">&quot;SUCCESS:<span class="hljs-variable">$project_name</span>:&quot;</span> <span class="hljs-string">&quot;/tmp/deploy_<span class="hljs-variable">$&#123;project_name&#125;</span>_$$.log&quot;</span> | <span class="hljs-built_in">cut</span> -d<span class="hljs-string">&#x27;:&#x27;</span> -f3)<br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$SUCCESS_COUNT</span> -eq 0 ]]; <span class="hljs-keyword">then</span><br><br>SUCCESS_PROJECTS=<span class="hljs-string">&quot;<span class="hljs-variable">$project_name</span> -&gt; 共<span class="hljs-variable">$&#123;file_count&#125;</span>个文件&quot;</span><br><br><span class="hljs-keyword">else</span><br><br>SUCCESS_PROJECTS=<span class="hljs-string">&quot;<span class="hljs-variable">$SUCCESS_PROJECTS</span>, <span class="hljs-variable">$project_name</span> -&gt; 共<span class="hljs-variable">$&#123;file_count&#125;</span>个文件&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br>SUCCESS_COUNT=$((SUCCESS_COUNT + <span class="hljs-number">1</span>))<br><br><span class="hljs-keyword">else</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$FAILED_COUNT</span> -eq 0 ]]; <span class="hljs-keyword">then</span><br><br>FAILED_PROJECTS=<span class="hljs-string">&quot;<span class="hljs-variable">$project_name</span>&quot;</span><br><br><span class="hljs-keyword">else</span><br><br>FAILED_PROJECTS=<span class="hljs-string">&quot;<span class="hljs-variable">$FAILED_PROJECTS</span>, <span class="hljs-variable">$project_name</span>&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br>FAILED_COUNT=$((FAILED_COUNT + <span class="hljs-number">1</span>))<br><br><span class="hljs-comment"># 获取失败原因</span><br><br><span class="hljs-built_in">local</span> reason=$(grep <span class="hljs-string">&quot;FAILED:<span class="hljs-variable">$project_name</span>:&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span> | <span class="hljs-built_in">cut</span> -d<span class="hljs-string">&#x27;:&#x27;</span> -f3-)<br><br>FAILED_REASONS+=(<span class="hljs-string">&quot;<span class="hljs-variable">$project_name</span>: <span class="hljs-variable">$reason</span>&quot;</span>)<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># 检查是否有重命名记录</span><br><br><span class="hljs-keyword">if</span> [[ -f <span class="hljs-string">&quot;/tmp/renamed_<span class="hljs-variable">$&#123;project_name&#125;</span>_$$.tmp&quot;</span> ]]; <span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">local</span> renamed_info=$(<span class="hljs-built_in">cat</span> <span class="hljs-string">&quot;/tmp/renamed_<span class="hljs-variable">$&#123;project_name&#125;</span>_$$.tmp&quot;</span>)<br><br><span class="hljs-keyword">if</span> [[ -z <span class="hljs-string">&quot;<span class="hljs-variable">$RENAMED_DETAILS</span>&quot;</span> ]]; <span class="hljs-keyword">then</span><br><br>RENAMED_DETAILS=<span class="hljs-string">&quot;<span class="hljs-variable">$renamed_info</span>&quot;</span><br><br><span class="hljs-keyword">else</span><br><br>RENAMED_DETAILS=<span class="hljs-string">&quot;<span class="hljs-variable">$RENAMED_DETAILS</span>, <span class="hljs-variable">$renamed_info</span>&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-built_in">rm</span> -f <span class="hljs-string">&quot;/tmp/renamed_<span class="hljs-variable">$&#123;project_name&#125;</span>_$$.tmp&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># 清理日志文件</span><br><br><span class="hljs-built_in">rm</span> -f <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span><br><br><span class="hljs-comment"># 从PID列表中移除</span><br><br>remove_pid <span class="hljs-variable">$completed_pid</span><br><br>current_jobs=$((current_jobs - <span class="hljs-number">1</span>))<br><br><span class="hljs-comment"># 更新进度条</span><br><br><span class="hljs-built_in">local</span> completed=$((TOTAL_JOBS - current_jobs))<br><br>progress_bar <span class="hljs-variable">$completed</span> <span class="hljs-variable">$TOTAL_JOBS</span><br><br><span class="hljs-keyword">fi</span><br><br>&#125;<br><br>  <br><br><span class="hljs-comment"># 部署单个项目的函数</span><br><br><span class="hljs-function"><span class="hljs-title">deploy_project</span></span>() &#123;<br><br><span class="hljs-built_in">local</span> index=<span class="hljs-variable">$1</span><br><br><span class="hljs-built_in">local</span> PROJECT_NAME=$(get_project_info <span class="hljs-variable">$index</span> name)<br><br><span class="hljs-built_in">local</span> SERVER=$(get_project_info <span class="hljs-variable">$index</span> server)<br><br><span class="hljs-built_in">local</span> PORT=$(get_project_info <span class="hljs-variable">$index</span> port)<br><br><span class="hljs-built_in">local</span> TARGET_DIR=$(get_project_info <span class="hljs-variable">$index</span> target_dir)<br><br><span class="hljs-built_in">local</span> SRC_DIR=$(get_project_info <span class="hljs-variable">$index</span> src_dir)<br><br><span class="hljs-built_in">local</span> SSH_KEY=<span class="hljs-string">&quot;~/.ssh/id_rsa&quot;</span><br><br><span class="hljs-built_in">local</span> log_file=<span class="hljs-string">&quot;/tmp/deploy_<span class="hljs-variable">$&#123;PROJECT_NAME&#125;</span>_$$.log&quot;</span><br><br><span class="hljs-built_in">local</span> exit_code=0<br><br><span class="hljs-comment"># 检查源目录</span><br><br><span class="hljs-keyword">if</span> [[ ! -d <span class="hljs-string">&quot;<span class="hljs-variable">$SRC_DIR</span>&quot;</span> ]]; <span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;FAILED:<span class="hljs-variable">$PROJECT_NAME</span>:源目录不存在 (<span class="hljs-variable">$SRC_DIR</span>)&quot;</span> &gt;&gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span><br><br><span class="hljs-built_in">return</span> 1<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># 检查SSH连接</span><br><br><span class="hljs-keyword">if</span> ! ssh -i <span class="hljs-string">&quot;<span class="hljs-variable">$SSH_KEY</span>&quot;</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$PORT</span>&quot;</span> -o BatchMode=<span class="hljs-built_in">yes</span> -o ConnectTimeout=10 -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null <span class="hljs-string">&quot;<span class="hljs-variable">$SERVER</span>&quot;</span> <span class="hljs-string">&quot;echo &#x27;SSH连接测试&#x27;&quot;</span> &gt;/dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;FAILED:<span class="hljs-variable">$PROJECT_NAME</span>:SSH连接失败&quot;</span> &gt;&gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span><br><br><span class="hljs-built_in">return</span> 1<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># 备份现有目录</span><br><br><span class="hljs-keyword">if</span> ssh -i <span class="hljs-string">&quot;<span class="hljs-variable">$SSH_KEY</span>&quot;</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$PORT</span>&quot;</span> -o BatchMode=<span class="hljs-built_in">yes</span> -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null <span class="hljs-string">&quot;<span class="hljs-variable">$SERVER</span>&quot;</span> <span class="hljs-string">&quot;[ -d &#x27;<span class="hljs-variable">$TARGET_DIR</span>&#x27; ]&quot;</span>; <span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">local</span> backup_suffix=$(<span class="hljs-built_in">date</span> +%Y%m%d%H%M)<br><br><span class="hljs-built_in">local</span> dir_name=$(<span class="hljs-built_in">basename</span> <span class="hljs-string">&quot;<span class="hljs-variable">$TARGET_DIR</span>&quot;</span>)<br><br><span class="hljs-built_in">local</span> BACKUP_NAME=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;dir_name&#125;</span>_back<span class="hljs-variable">$&#123;backup_suffix&#125;</span>&quot;</span><br><br><span class="hljs-built_in">local</span> backup_path=$(<span class="hljs-built_in">dirname</span> <span class="hljs-string">&quot;<span class="hljs-variable">$TARGET_DIR</span>&quot;</span>)/<span class="hljs-variable">$BACKUP_NAME</span><br><br>ssh -i <span class="hljs-string">&quot;<span class="hljs-variable">$SSH_KEY</span>&quot;</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$PORT</span>&quot;</span> -o BatchMode=<span class="hljs-built_in">yes</span> -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null <span class="hljs-string">&quot;<span class="hljs-variable">$SERVER</span>&quot;</span> <span class="hljs-string">&quot;mv &#x27;<span class="hljs-variable">$TARGET_DIR</span>&#x27; &#x27;<span class="hljs-variable">$backup_path</span>&#x27;&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$PROJECT_NAME</span> -&gt; <span class="hljs-variable">$BACKUP_NAME</span>&quot;</span> &gt; <span class="hljs-string">&quot;/tmp/renamed_<span class="hljs-variable">$&#123;PROJECT_NAME&#125;</span>_$$.tmp&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># 执行rsync同步</span><br><br><span class="hljs-keyword">if</span> rsync -avz --delete --progress \<br><br>-e <span class="hljs-string">&quot;ssh -i <span class="hljs-variable">$SSH_KEY</span> -p <span class="hljs-variable">$PORT</span> -o BatchMode=yes -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null&quot;</span> \<br><br>--iconv=UTF-8-MAC,UTF-8 \<br><br>--partial \<br><br>--partial-dir=.rsync-partial \<br><br><span class="hljs-string">&quot;<span class="hljs-variable">$SRC_DIR</span>/&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$SERVER</span>:<span class="hljs-variable">$TARGET_DIR</span>/&quot;</span> &gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span> 2&gt;&amp;1; <span class="hljs-keyword">then</span><br><br><span class="hljs-comment"># 计算文件数量校验</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;计算文件数量...&quot;</span><br><br>local_file_count=$(find <span class="hljs-string">&quot;<span class="hljs-variable">$SRC_DIR</span>&quot;</span> -<span class="hljs-built_in">type</span> f \( -name <span class="hljs-string">&quot;.*&quot;</span> -o -name <span class="hljs-string">&quot;*.tmp&quot;</span> -o -name <span class="hljs-string">&quot;*.log&quot;</span> -o -name <span class="hljs-string">&quot;.DS_Store&quot;</span> \) -prune -o -<span class="hljs-built_in">type</span> f -<span class="hljs-built_in">print</span> | <span class="hljs-built_in">wc</span> -l)<br><br>remote_file_count=$(ssh -i <span class="hljs-string">&quot;<span class="hljs-variable">$SSH_KEY</span>&quot;</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$PORT</span>&quot;</span> -o BatchMode=<span class="hljs-built_in">yes</span> -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null <span class="hljs-string">&quot;<span class="hljs-variable">$SERVER</span>&quot;</span> <span class="hljs-string">&quot;find <span class="hljs-variable">$TARGET_DIR</span> -type f \( -name &#x27;.*&#x27; -o -name &#x27;*.tmp&#x27; -o -name &#x27;*.log&#x27; -o -name &#x27;.DS_Store&#x27; \) -prune -o -type f -print | wc -l&quot;</span> 2&gt;/dev/null)<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;本地文件数量: <span class="hljs-variable">$local_file_count</span>&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;远程文件数量: <span class="hljs-variable">$remote_file_count</span>&quot;</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-string">&quot;<span class="hljs-variable">$local_file_count</span>&quot;</span> == <span class="hljs-string">&quot;<span class="hljs-variable">$remote_file_count</span>&quot;</span> &amp;&amp; <span class="hljs-string">&quot;<span class="hljs-variable">$local_file_count</span>&quot;</span> -gt 0 ]]; <span class="hljs-keyword">then</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;✅ 文件数量匹配，部署成功&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;SUCCESS:<span class="hljs-variable">$PROJECT_NAME</span>:<span class="hljs-variable">$local_file_count</span>&quot;</span> &gt;&gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span><br><br><span class="hljs-keyword">else</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;❌ 文件数量不匹配，部署失败&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;FAILED:<span class="hljs-variable">$PROJECT_NAME</span>:文件数量不匹配 (本地:<span class="hljs-variable">$local_file_count</span>, 远程:<span class="hljs-variable">$remote_file_count</span>)&quot;</span> &gt;&gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span><br><br>exit_code=1<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">else</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;FAILED:<span class="hljs-variable">$PROJECT_NAME</span>:rsync同步失败&quot;</span> &gt;&gt; <span class="hljs-string">&quot;<span class="hljs-variable">$log_file</span>&quot;</span><br><br>exit_code=1<br><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-built_in">return</span> <span class="hljs-variable">$exit_code</span><br><br>&#125;<br><br>  <br><br><span class="hljs-comment"># 主程序开始</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;🚀 自动化部署脚本启动&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;📋 发现 <span class="hljs-variable">$PROJECT_COUNT</span> 个配置项目&quot;</span><br><br>  <br><br><span class="hljs-comment"># 用户选择部署方式</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;请选择部署方式：&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;a) 部署所有项目&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;s) 选择特定项目&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;q) 退出&quot;</span><br><br>  <br><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;请输入选择 (a/s/q): &quot;</span> choice<br><br>  <br><br><span class="hljs-keyword">case</span> <span class="hljs-variable">$choice</span> <span class="hljs-keyword">in</span><br><br>a) SELECTED_INDICES=$(<span class="hljs-built_in">seq</span> 0 $((PROJECT_COUNT - <span class="hljs-number">1</span>)));;<br><br>s)<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;可用项目：&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 0 $((PROJECT_COUNT - <span class="hljs-number">1</span>))); <span class="hljs-keyword">do</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$i</span>) <span class="hljs-subst">$(get_project_info $i name)</span>&quot;</span><br><br><span class="hljs-keyword">done</span><br><br><span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;请输入项目编号（多个用空格分隔）: &quot;</span> -a indices<br><br>SELECTED_INDICES=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;indices[@]&#125;</span>&quot;</span><br><br>;;<br><br>q) <span class="hljs-built_in">exit</span> 0;;<br><br>*) red <span class="hljs-string">&quot;无效选择&quot;</span>; <span class="hljs-built_in">exit</span> 1;;<br><br><span class="hljs-keyword">esac</span><br><br>  <br><br><span class="hljs-comment"># 初始化变量</span><br><br>SUCCESS_COUNT=0<br><br>FAILED_COUNT=0<br><br>SUCCESS_PROJECTS=<span class="hljs-string">&quot;&quot;</span><br><br>FAILED_PROJECTS=<span class="hljs-string">&quot;&quot;</span><br><br>RENAMED_DETAILS=<span class="hljs-string">&quot;&quot;</span><br><br>FAILED_REASONS=()<br><br>MAX_CONCURRENT=3<br><br>current_jobs=0<br><br>job_pids=<span class="hljs-string">&quot;&quot;</span><br><br>job_names=<span class="hljs-string">&quot;&quot;</span><br><br>TOTAL_JOBS=$(<span class="hljs-built_in">echo</span> <span class="hljs-variable">$SELECTED_INDICES</span> | <span class="hljs-built_in">wc</span> -w)<br><br>  <br><br><span class="hljs-built_in">echo</span><br><br>blue <span class="hljs-string">&quot;开始部署 <span class="hljs-variable">$TOTAL_JOBS</span> 个项目...&quot;</span><br><br>  <br><br><span class="hljs-comment"># 部署所有选中的项目</span><br><br><span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-variable">$SELECTED_INDICES</span>; <span class="hljs-keyword">do</span><br><br><span class="hljs-comment"># 控制并发数</span><br><br><span class="hljs-keyword">while</span> [[ <span class="hljs-variable">$current_jobs</span> -ge <span class="hljs-variable">$MAX_CONCURRENT</span> ]]; <span class="hljs-keyword">do</span><br><br>wait_for_job<br><br><span class="hljs-keyword">done</span><br><br><span class="hljs-comment"># 启动新任务</span><br><br>deploy_project <span class="hljs-variable">$index</span> &amp;<br><br><span class="hljs-built_in">local</span> pid=$!<br><br>job_pids=<span class="hljs-string">&quot;<span class="hljs-variable">$job_pids</span> <span class="hljs-variable">$pid</span>&quot;</span><br><br>job_names=<span class="hljs-string">&quot;<span class="hljs-variable">$job_names</span> <span class="hljs-variable">$index</span>&quot;</span><br><br>current_jobs=$((current_jobs + <span class="hljs-number">1</span>))<br><br><span class="hljs-keyword">done</span><br><br>  <br><br><span class="hljs-comment"># 等待所有任务完成</span><br><br><span class="hljs-keyword">while</span> [[ <span class="hljs-variable">$current_jobs</span> -gt 0 ]]; <span class="hljs-keyword">do</span><br><br>wait_for_job<br><br><span class="hljs-keyword">done</span><br><br>  <br><br><span class="hljs-comment"># 显示最终结果</span><br><br><span class="hljs-built_in">echo</span><br><br><span class="hljs-keyword">if</span> [[ -n <span class="hljs-string">&quot;<span class="hljs-variable">$RENAMED_DETAILS</span>&quot;</span> ]]; <span class="hljs-keyword">then</span><br><br>blue <span class="hljs-string">&quot;📁 重命名备份的项目：<span class="hljs-variable">$RENAMED_DETAILS</span>&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br>  <br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$SUCCESS_COUNT</span> -gt 0 ]]; <span class="hljs-keyword">then</span><br><br>green <span class="hljs-string">&quot;✅ 部署成功的项目：<span class="hljs-variable">$SUCCESS_PROJECTS</span>&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br>  <br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$FAILED_COUNT</span> -gt 0 ]]; <span class="hljs-keyword">then</span><br><br>red <span class="hljs-string">&quot;❌ 部署失败的项目：<span class="hljs-variable">$FAILED_PROJECTS</span>&quot;</span><br><br><span class="hljs-built_in">echo</span><br><br>red <span class="hljs-string">&quot;失败原因：&quot;</span><br><br><span class="hljs-keyword">for</span> reason <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;FAILED_REASONS[@]&#125;</span>&quot;</span>; <span class="hljs-keyword">do</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; - <span class="hljs-variable">$reason</span>&quot;</span><br><br><span class="hljs-keyword">done</span><br><br><span class="hljs-keyword">fi</span><br><br>  <br><br><span class="hljs-comment"># 根据结果选择颜色</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$FAILED_COUNT</span> -eq 0 ]]; <span class="hljs-keyword">then</span><br><br>green <span class="hljs-string">&quot;部署完成！共部署 <span class="hljs-variable">$SUCCESS_COUNT</span> 个项目，失败 <span class="hljs-variable">$FAILED_COUNT</span> 个项目&quot;</span><br><br><span class="hljs-keyword">else</span><br><br>red <span class="hljs-string">&quot;部署完成！共部署 <span class="hljs-variable">$SUCCESS_COUNT</span> 个项目，失败 <span class="hljs-variable">$FAILED_COUNT</span> 个项目&quot;</span><br><br><span class="hljs-keyword">fi</span><br><br></code></pre></td></tr></table></figure><h2 id="配置文件示例"><a href="#配置文件示例" class="headerlink" title="配置文件示例"></a>配置文件示例</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs json"><br><span class="hljs-punctuation">[</span><br><br><span class="hljs-punctuation">&#123;</span><br><br><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;前端项目&quot;</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;server&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;deploy@192.168.1.100&quot;</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2222</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;target_dir&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/var/www/frontend&quot;</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;src_dir&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dist/frontend&quot;</span><br><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-punctuation">&#123;</span><br><br><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;管理后台&quot;</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;server&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;deploy@192.168.1.100&quot;</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2222</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;target_dir&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/var/www/admin&quot;</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;src_dir&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dist/admin&quot;</span><br><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-punctuation">&#123;</span><br><br><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;API服务&quot;</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;server&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;deploy@192.168.1.101&quot;</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2222</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;target_dir&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/var/www/api&quot;</span><span class="hljs-punctuation">,</span><br><br><span class="hljs-attr">&quot;src_dir&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dist/api&quot;</span><br><br><span class="hljs-punctuation">&#125;</span><br><br><span class="hljs-punctuation">]</span><br><br></code></pre></td></tr></table></figure><p><strong>配置说明</strong>：</p><ul><li><p><code>name</code>: 项目名称，用于显示和日志记录</p></li><li><p><code>server</code>: 服务器地址，格式为 <code>用户@主机</code></p></li><li><p><code>port</code>: SSH端口号，建议使用非标准端口</p></li><li><p><code>target_dir</code>: 远程服务器上的目标目录</p></li><li><p><code>src_dir</code>: 本地源码目录，相对于脚本执行位置</p></li></ul><h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><h3 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1. 环境准备"></a>1. 环境准备</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment"># 安装依赖工具</span><br><br><span class="hljs-comment"># Ubuntu/Debian</span><br><br><span class="hljs-built_in">sudo</span> apt-get install rsync jq<br><br>  <br><br><span class="hljs-comment"># CentOS/RHEL</span><br><br><span class="hljs-built_in">sudo</span> yum install rsync jq<br><br>  <br><br><span class="hljs-comment"># macOS</span><br><br>brew install rsync jq<br><br></code></pre></td></tr></table></figure><h3 id="2-SSH密钥配置"><a href="#2-SSH密钥配置" class="headerlink" title="2. SSH密钥配置"></a>2. SSH密钥配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment"># 生成SSH密钥（如果还没有）</span><br><br>ssh-keygen -t rsa -b 4096<br><br>  <br><br><span class="hljs-comment"># 将公钥复制到服务器</span><br><br>ssh-copy-id user@server.example.com<br><br></code></pre></td></tr></table></figure><h3 id="3-配置文件设置"><a href="#3-配置文件设置" class="headerlink" title="3. 配置文件设置"></a>3. 配置文件设置</h3><p>在<code>scripts/deploy.json</code>中配置您的项目信息，注意脱敏处理：</p><ul><li><p>使用内网IP或域名替代公网IP</p></li><li><p>使用非标准端口</p></li><li><p>配置适当的用户权限</p></li></ul><h3 id="4-执行部署"><a href="#4-执行部署" class="headerlink" title="4. 执行部署"></a>4. 执行部署</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment"># 给脚本执行权限</span><br><br><span class="hljs-built_in">chmod</span> +x scripts/deploy.sh<br><br>  <br><br><span class="hljs-comment"># 执行部署</span><br><br>./scripts/deploy.sh<br><br></code></pre></td></tr></table></figure><h2 id="实际使用示例"><a href="#实际使用示例" class="headerlink" title="实际使用示例"></a>实际使用示例</h2><h3 id="1-脚本执行过程"><a href="#1-脚本执行过程" class="headerlink" title="1. 脚本执行过程"></a>1. 脚本执行过程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>$ ./scripts/deploy.sh<br><br>  <br><br>🚀 自动化部署脚本启动<br><br>📋 发现 3 个配置项目<br><br>  <br><br>请选择部署方式：<br><br>a) 部署所有项目<br><br>s) 选择特定项目<br><br>q) 退出<br><br>  <br><br>请输入选择 (a/s/q): a<br><br>  <br><br>开始部署 3 个项目...<br><br>  <br><br>[##################################################] 100%<br><br>  <br><br>📁 重命名备份的项目：前端项目 -&gt; frontend_back202412230145, 管理后台 -&gt; admin_back202412230145<br><br>✅ 部署成功的项目：前端项目 -&gt; 共1250个文件, 管理后台 -&gt; 共892个文件, API服务 -&gt; 共567个文件<br><br>部署完成！共部署 3 个项目，失败 0 个项目<br><br></code></pre></td></tr></table></figure><h3 id="2-选择性部署"><a href="#2-选择性部署" class="headerlink" title="2. 选择性部署"></a>2. 选择性部署</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>$ ./scripts/deploy.sh<br><br>  <br><br>🚀 自动化部署脚本启动<br><br>📋 发现 3 个配置项目<br><br>  <br><br>请选择部署方式：<br><br>a) 部署所有项目<br><br>s) 选择特定项目<br><br>q) 退出<br><br>  <br><br>请输入选择 (a/s/q): s<br><br>  <br><br>可用项目：<br><br>0) 前端项目<br><br>1) 管理后台<br><br>2) API服务<br><br>  <br><br>请输入项目编号（多个用空格分隔）: 0 2<br><br>  <br><br>开始部署 2 个项目...<br><br>  <br><br>[##################################################] 100%<br><br>  <br><br>✅ 部署成功的项目：前端项目 -&gt; 共1250个文件, API服务 -&gt; 共567个文件<br><br>部署完成！共部署 2 个项目，失败 0 个项目<br><br></code></pre></td></tr></table></figure><h3 id="3-部署失败处理"><a href="#3-部署失败处理" class="headerlink" title="3. 部署失败处理"></a>3. 部署失败处理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>$ ./scripts/deploy.sh<br><br>  <br><br>🚀 自动化部署脚本启动<br><br>📋 发现 3 个配置项目<br><br>  <br><br>请选择部署方式：<br><br>a) 部署所有项目<br><br>s) 选择特定项目<br><br>q) 退出<br><br>  <br><br>请输入选择 (a/s/q): a<br><br>  <br><br>开始部署 3 个项目...<br><br>  <br><br>[##################################################] 100%<br><br>  <br><br>✅ 部署成功的项目：前端项目 -&gt; 共1250个文件<br><br>❌ 部署失败的项目：管理后台, API服务<br><br>  <br><br>失败原因：<br><br>- 管理后台: SSH连接失败<br><br>- API服务: 源目录不存在 (dist/api)<br><br>  <br><br>部署完成！共部署 1 个项目，失败 2 个项目<br><br></code></pre></td></tr></table></figure><h2 id="脚本优势"><a href="#脚本优势" class="headerlink" title="脚本优势"></a>脚本优势</h2><h3 id="1-高效性"><a href="#1-高效性" class="headerlink" title="1. 高效性"></a>1. 高效性</h3><ul><li><p><strong>并发部署</strong>：多个项目同时进行，大幅提升效率</p></li><li><p><strong>断点续传</strong>：支持网络中断后继续传输</p></li><li><p><strong>增量同步</strong>：只传输变更的文件</p></li></ul><h3 id="2-可靠性"><a href="#2-可靠性" class="headerlink" title="2. 可靠性"></a>2. 可靠性</h3><ul><li><p><strong>智能备份</strong>：自动备份现有项目，避免数据丢失</p></li><li><p><strong>文件校验</strong>：部署完成后验证文件完整性</p></li><li><p><strong>错误处理</strong>：详细的错误信息和失败原因</p></li></ul><h3 id="3-易用性"><a href="#3-易用性" class="headerlink" title="3. 易用性"></a>3. 易用性</h3><ul><li><p><strong>配置驱动</strong>：通过JSON文件管理项目配置</p></li><li><p><strong>交互选择</strong>：支持全量或选择性部署</p></li><li><p><strong>进度显示</strong>：实时显示部署进度和状态</p></li></ul><h3 id="4-安全性"><a href="#4-安全性" class="headerlink" title="4. 安全性"></a>4. 安全性</h3><ul><li><p><strong>SSH密钥认证</strong>：避免密码明文传输</p></li><li><p><strong>批量模式</strong>：防止意外交互</p></li><li><p><strong>权限控制</strong>：支持不同用户和端口配置</p></li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这个自动化部署脚本通过合理的设计和实现，解决了传统部署方式中的效率低下、容易出错等问题。它支持多项目并发部署、智能备份、文件校验等企业级功能，大大提升了部署的效率和可靠性。</p><p>脚本采用模块化设计，每个功能都有清晰的职责划分，便于维护和扩展。通过配置文件驱动的方式，使得添加新项目变得非常简单。同时，详细的错误处理和状态反馈，让用户能够快速定位和解决问题。</p><p>在实际使用中，建议根据具体环境调整并发数量、SSH超时时间等参数，以获得最佳的性能和稳定性。</p><hr><p><em>本文详细介绍了从零构建企业级自动化部署脚本的完整过程，包括设计思路、实现细节和使用方法。希望对您的自动化部署实践有所帮助！</em></p>]]></content>
    
    
    <categories>
      
      <category>后端</category>
      
      <category>Shell</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Shell</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Rust入门</title>
    <link href="/posts/%E5%90%8E%E7%AB%AF/Rust/Rust%E5%85%A5%E9%97%A8/29388/"/>
    <url>/posts/%E5%90%8E%E7%AB%AF/Rust/Rust%E5%85%A5%E9%97%A8/29388/</url>
    
    <content type="html"><![CDATA[<h1 id="环境安装"><a href="#环境安装" class="headerlink" title="环境安装"></a>环境安装</h1><h2 id="RustRover安装"><a href="#RustRover安装" class="headerlink" title="RustRover安装"></a>RustRover安装</h2><p><a href="https://www.jetbrains.com/rust/">下载地址</a></p><h2 id="Rust安装"><a href="#Rust安装" class="headerlink" title="Rust安装"></a>Rust安装</h2><p>下载安装：</p><ul><li><a href="https://www.rust-lang.org/tools/install">RUSTUP-INIT.EXE</a></li><li><a href="https://visualstudio.microsoft.com/zh-hans/">Visual Studio C++ Build Tools</a></li><li>升级：<code>rustup update</code></li><li>卸载：<code>rustup self uninstall</code></li></ul><h1 id="基本语法和数据类型"><a href="#基本语法和数据类型" class="headerlink" title="基本语法和数据类型"></a>基本语法和数据类型</h1><h2 id="变量-可变性"><a href="#变量-可变性" class="headerlink" title="变量&amp;可变性"></a>变量&amp;可变性</h2><ul><li>声明变量<br>  <code>let some_number = 1;</code><br>  默认：变量是不可变的</li><li>声明可变变量<br>  <code>let mut another_number = 2;</code></li></ul><h2 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h2><ul><li>声明常量<br>  <code>const SPECIAL_NUMBER:i32 = 3;</code><br>  <code>const THREE_HOURS_IN_SECONDS:u32 = 60*60*3;</code><ul><li>使用<code>const</code>声明</li><li>不可以使用<code>mut</code></li><li>必须标注类型</li><li>可在任意作用域声明</li><li>仅可以使用常量表达式赋值</li></ul></li></ul><h2 id="变量遮蔽-Shadowing"><a href="#变量遮蔽-Shadowing" class="headerlink" title="变量遮蔽(Shadowing)"></a>变量遮蔽(Shadowing)</h2><p><code>let my_number = 1;</code><br><code>let my_number = 2;</code></p><ul><li>可以用之前变量相同的名字声明一个新变量：第一个变量被第二个变量“遮蔽”了</li><li>就是创建了一个新变量，只不过名字相同</li></ul><h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><h3 id="Interger-整数"><a href="#Interger-整数" class="headerlink" title="Interger 整数"></a>Interger 整数</h3><p><code>let my_number:i32 = 1;</code></p><table><thead><tr><th>Length长度</th><th>Signed有符号</th><th>Unsigned无符号</th></tr></thead><tbody><tr><td>8-bit</td><td>i8</td><td>u8</td></tr><tr><td>16-bit</td><td>i16</td><td>u16</td></tr><tr><td>32-bit</td><td>i32</td><td>u32</td></tr><tr><td>64-bit</td><td>i64</td><td>u64</td></tr><tr><td>128-bit</td><td>i128</td><td>u128</td></tr><tr><td>arch</td><td>isize</td><td>usize</td></tr></tbody></table><table><thead><tr><th>Number literals 数值字面值</th><th>示例</th></tr></thead><tbody><tr><td>Decimal 十进制</td><td>98_222</td></tr><tr><td>Hex 十六进制</td><td>0xff</td></tr><tr><td>Octal 八进制</td><td>0o77</td></tr><tr><td>Binary 二进制</td><td>0b1111_0000</td></tr><tr><td>Byte(u8 only) 字节</td><td>b’A’</td></tr></tbody></table><h3 id="Floating-Point-浮点"><a href="#Floating-Point-浮点" class="headerlink" title="Floating Point 浮点"></a>Floating Point 浮点</h3><p><code>let my_floating_point:f64 = 2.5;</code></p><ul><li>f32：4字节</li><li>f64：8字节</li><li>都有符号</li></ul><h3 id="Boolean-布尔"><a href="#Boolean-布尔" class="headerlink" title="Boolean 布尔"></a>Boolean 布尔</h3><p><code>let this_is_bool:bool = true;</code></p><ul><li>两个值：true，false</li><li>1字节</li></ul><h3 id="Character-字符"><a href="#Character-字符" class="headerlink" title="Character 字符"></a>Character 字符</h3><p><code>let this_is_chat:char = &#39;A&#39;;</code></p><ul><li>4字节</li><li>表示一个Unicode标量值</li></ul><h3 id="Tuple-元组"><a href="#Tuple-元组" class="headerlink" title="Tuple 元组"></a>Tuple 元组</h3><p><code>let my_tuple = (&#39;A&#39;,1,1.2);</code><br><code>my_tuple.0;</code></p><ul><li>固定长度</li><li>可包含不同类型的元素</li></ul><h3 id="Array数组"><a href="#Array数组" class="headerlink" title="Array数组"></a>Array数组</h3><p><code>let my_array =[1,2,3];</code><br><code>let a=[3;5]; // 5,5,5,5,5</code></p><ul><li>固定长度</li><li>元素类型相同</li></ul><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><ul><li>函数&amp;变量的命名规范：snakecase:</li><li>所有字母都小写；</li><li>单词之间用_连接；<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>()&#123;<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;Hello&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">demo</span>(val:<span class="hljs-type">i32</span>,unit:<span class="hljs-type">char</span>)&#123;<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;demo:&#123;&#125;&quot;</span>,val);<br><span class="hljs-keyword">return</span> val;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Control-Flow-控制流"><a href="#Control-Flow-控制流" class="headerlink" title="Control Flow 控制流"></a>Control Flow 控制流</h2><h3 id="if表达式"><a href="#if表达式" class="headerlink" title="if表达式"></a>if表达式</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>()&#123;<br><span class="hljs-keyword">let</span> <span class="hljs-variable">number</span> =<span class="hljs-number">3</span>;<br><span class="hljs-keyword">if</span> number &lt; <span class="hljs-number">5</span> &#123;<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;1&quot;</span>);<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> number % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>&#123;<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;2&quot;</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;3&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="循环-loop-while-for"><a href="#循环-loop-while-for" class="headerlink" title="循环 loop while for"></a>循环 loop while for</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>()&#123;<br><span class="hljs-keyword">loop</span> &#123;<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;loop&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>break: 停止loop</li><li>continue: 跳出本次迭代<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>()&#123;<br><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">number</span> = <span class="hljs-number">3</span>;<br><span class="hljs-keyword">while</span> number != <span class="hljs-number">0</span> &#123;<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;while number:&#123;number&#125;&quot;</span>);<br>number -= <span class="hljs-number">1</span>;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>()&#123;<br><span class="hljs-keyword">let</span> <span class="hljs-variable">a</span> = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>];<br><span class="hljs-keyword">for</span> <span class="hljs-variable">item</span> <span class="hljs-keyword">in</span> a &#123;<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;for item:&#123;item&#125;&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>()&#123;<br><span class="hljs-keyword">for</span> <span class="hljs-variable">item</span> <span class="hljs-keyword">in</span> (<span class="hljs-number">1</span>..<span class="hljs-number">4</span>).<span class="hljs-title function_ invoke__">rev</span>() &#123;<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;for Range:&#123;item&#125;&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>后端</category>
      
      <category>Rust</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Rust</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows安装WSL</title>
    <link href="/posts/%E5%90%8E%E7%AB%AF/Windows%E5%AE%89%E8%A3%85WSL/61426/"/>
    <url>/posts/%E5%90%8E%E7%AB%AF/Windows%E5%AE%89%E8%A3%85WSL/61426/</url>
    
    <content type="html"><![CDATA[<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs txt">wsl --install<br><br>jhy@JHY:~$ lsb_release -a<br>No LSB modules are available.<br>Distributor ID: Ubuntu<br>Description:    Ubuntu 24.04.2 LTS<br>Release:        24.04<br>Codename:       noble<br><br>wsl --export Ubuntu D:\jhy\WSL\wsl-ubuntu24.04.tar<br>wsl --unregister Ubuntu<br>wsl --import Ubuntu D:\jhy\WSL\wsl-ubuntu D:\jhy\WSL\wsl-ubuntu24.04.tar<br>wsl -d Ubuntu <br># 关闭<br>wsl --shutdown<br></code></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">sudo apt update<br>sudo apt upgrade<br></code></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs txt">sudo apt install nodejs npm<br><br>node --version<br>npm --version<br></code></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs txt">sudo npm install -g @anthropic-ai/claude-code<br>npm config set os linux<br><br>claude<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WSL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WSL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cursor插件栏改为纵向</title>
    <link href="/posts/%E5%89%8D%E7%AB%AF/Tools/Cursor%E6%8F%92%E4%BB%B6%E6%A0%8F%E6%94%B9%E4%B8%BA%E7%BA%B5%E5%90%91/32536/"/>
    <url>/posts/%E5%89%8D%E7%AB%AF/Tools/Cursor%E6%8F%92%E4%BB%B6%E6%A0%8F%E6%94%B9%E4%B8%BA%E7%BA%B5%E5%90%91/32536/</url>
    
    <content type="html"><![CDATA[<h1 id="修改-Cursor-插件栏改为纵向"><a href="#修改-Cursor-插件栏改为纵向" class="headerlink" title="修改 Cursor 插件栏改为纵向"></a>修改 Cursor 插件栏改为纵向</h1><ol><li><code>Ctrl+Shift+P</code>打开搜索<code>Open User Settings</code></li><li>设置中搜索：<code>workbench.activityBar.orientation</code>，修改为 <code>vertical</code> 即可。</li></ol>]]></content>
    
    
    <categories>
      
      <category>前端</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Cursor</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flutter不同终端屏幕适配</title>
    <link href="/posts/%E5%89%8D%E7%AB%AF/Flutter/Flutter%E4%B8%8D%E5%90%8C%E7%BB%88%E7%AB%AF%E5%B1%8F%E5%B9%95%E9%80%82%E9%85%8D/33879/"/>
    <url>/posts/%E5%89%8D%E7%AB%AF/Flutter/Flutter%E4%B8%8D%E5%90%8C%E7%BB%88%E7%AB%AF%E5%B1%8F%E5%B9%95%E9%80%82%E9%85%8D/33879/</url>
    
    <content type="html"><![CDATA[<h1 id="Flutter不同终端屏幕适配"><a href="#Flutter不同终端屏幕适配" class="headerlink" title="Flutter不同终端屏幕适配"></a>Flutter不同终端屏幕适配</h1><p><a href="https://github.com/OpenFlutter/flutter_screenutil/blob/master/README_CN.md">flutter_screenutil中文官方文档</a></p><h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h2><p>运行命令:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">flutter pub add flutter_screenutil<br></code></pre></td></tr></table></figure><p>运行以上命令会在<code>pubspec.yaml</code>中添加:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-string">...</span><br>  <span class="hljs-attr">flutter_screenutil:</span> <span class="hljs-string">^5.9.3</span><br></code></pre></td></tr></table></figure><h2 id="2-封装"><a href="#2-封装" class="headerlink" title="2. 封装"></a>2. 封装</h2><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_screenutil/flutter_screenutil.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:get/get.dart&#x27;</span>;<br><br><span class="hljs-comment">/// <span class="language-markdown">屏幕适配工具类</span></span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ScreenAdapter</span> </span>&#123;<br>  <span class="hljs-comment">/// <span class="language-markdown">初始化方法</span></span><br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> init(BuildContext context) &#123;<br>    ScreenUtil.init(<br>      context,<br>      designSize: _getDesignSize(context),<br>      minTextAdapt: <span class="hljs-keyword">true</span>,<br>      splitScreenMode: <span class="hljs-keyword">true</span>,<br>    );<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">根据屏幕方向获取设计尺寸</span></span><br>  <span class="hljs-keyword">static</span> Size _getDesignSize(BuildContext context) &#123;<br>    <span class="hljs-keyword">final</span> orientation = MediaQuery.of(context).orientation;<br>    <span class="hljs-keyword">return</span> orientation == Orientation.portrait<br>        ? <span class="hljs-keyword">const</span> Size(<span class="hljs-number">375</span>, <span class="hljs-number">812</span>) <span class="hljs-comment">// 竖屏设计尺寸</span><br>        : <span class="hljs-keyword">const</span> Size(<span class="hljs-number">812</span>, <span class="hljs-number">375</span>); <span class="hljs-comment">// 横屏设计尺寸</span><br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">宽度适配</span></span><br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> width(<span class="hljs-built_in">double</span> width) &#123;<br>    <span class="hljs-keyword">return</span> width.w;<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">高度适配</span></span><br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> height(<span class="hljs-built_in">double</span> height) &#123;<br>    <span class="hljs-keyword">return</span> height.h;<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">字体大小适配</span></span><br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> fontSize(<span class="hljs-built_in">double</span> fontSize) &#123;<br>    <span class="hljs-keyword">return</span> fontSize.sp;<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">获取屏幕宽度</span></span><br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> <span class="hljs-keyword">get</span> screenWidth =&gt; Get.width;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">获取屏幕高度</span></span><br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> <span class="hljs-keyword">get</span> screenHeight =&gt; Get.height;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">设备像素比</span></span><br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> <span class="hljs-keyword">get</span> pixelRatio =&gt; Get.pixelRatio;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">设备类型判断</span></span><br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-keyword">get</span> isPhone =&gt; screenWidth &lt; <span class="hljs-number">600</span>;<br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-keyword">get</span> isTablet =&gt; screenWidth &gt;= <span class="hljs-number">600</span> &amp;&amp; screenWidth &lt; <span class="hljs-number">1024</span>;<br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-keyword">get</span> isDesktop =&gt; screenWidth &gt;= <span class="hljs-number">1024</span>;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">响应式布局方法</span></span><br>  <span class="hljs-keyword">static</span> T responsive&lt;T&gt;(&#123;<br>    <span class="hljs-keyword">required</span> T phone,<br>    T? tablet,<br>    T? desktop,<br>  &#125;) &#123;<br>    <span class="hljs-keyword">if</span> (isDesktop &amp;&amp; desktop != <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> desktop;<br>    <span class="hljs-keyword">if</span> (isTablet &amp;&amp; tablet != <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> tablet;<br>    <span class="hljs-keyword">return</span> phone;<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">边距适配</span></span><br>  <span class="hljs-keyword">static</span> EdgeInsets padding(&#123;<br>    <span class="hljs-built_in">double?</span> all,<br>    <span class="hljs-built_in">double?</span> horizontal,<br>    <span class="hljs-built_in">double?</span> vertical,<br>    <span class="hljs-built_in">double?</span> left,<br>    <span class="hljs-built_in">double?</span> right,<br>    <span class="hljs-built_in">double?</span> top,<br>    <span class="hljs-built_in">double?</span> bottom,<br>  &#125;) &#123;<br>    <span class="hljs-keyword">return</span> EdgeInsets.only(<br>      left: (left ?? horizontal ?? all ?? <span class="hljs-number">0</span>).w,<br>      right: (right ?? horizontal ?? all ?? <span class="hljs-number">0</span>).w,<br>      top: (top ?? vertical ?? all ?? <span class="hljs-number">0</span>).h,<br>      bottom: (bottom ?? vertical ?? all ?? <span class="hljs-number">0</span>).h,<br>    );<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">圆角适配</span></span><br>  <span class="hljs-keyword">static</span> BorderRadius radius([<span class="hljs-built_in">double</span> radius = <span class="hljs-number">0</span>]) &#123;<br>    <span class="hljs-keyword">return</span> BorderRadius.circular(radius.r);<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">横竖屏切换监听（正确实现）</span></span><br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> addOrientationListener(VoidCallback callback) &#123;<br>    <span class="hljs-comment">// 使用 GetX 的 Workers 监听屏幕变化</span><br>    ever(Get.mediaQuery <span class="hljs-keyword">as</span> RxInterface&lt;<span class="hljs-built_in">Object?</span>&gt;, (_) =&gt; callback());<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">获取当前屏幕方向</span></span><br>  <span class="hljs-keyword">static</span> Orientation <span class="hljs-keyword">get</span> orientation =&gt; Get.mediaQuery.orientation;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>前端</category>
      
      <category>Flutter</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Flutter</tag>
      
      <tag>GetX</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>get_cli安装和使用</title>
    <link href="/posts/%E5%89%8D%E7%AB%AF/Flutter/GetX%E9%9B%86%E6%88%90/40222/"/>
    <url>/posts/%E5%89%8D%E7%AB%AF/Flutter/GetX%E9%9B%86%E6%88%90/40222/</url>
    
    <content type="html"><![CDATA[<h1 id="GetX集成"><a href="#GetX集成" class="headerlink" title="GetX集成"></a>GetX集成</h1><p><a href="https://github.com/jonataslaw/getx/blob/master/README.zh-cn.md">GetX中文官方文档</a></p><h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h2><p>运行命令:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">flutter pub add get<br></code></pre></td></tr></table></figure><p>运行以上命令会在<code>pubspec.yaml</code>中添加:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-string">...</span><br>  <span class="hljs-attr">get:</span> <span class="hljs-string">^4.6.5</span> <br></code></pre></td></tr></table></figure><h2 id="2-目录结构"><a href="#2-目录结构" class="headerlink" title="2. 目录结构"></a>2. 目录结构</h2><h3 id="2-1-GetX-Pattern"><a href="#2-1-GetX-Pattern" class="headerlink" title="2.1 GetX Pattern"></a>2.1 GetX Pattern</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">lib/<br>├─app/               <span class="hljs-comment"># 应用主目录（可选层级）</span><br>│  ├─data/           <span class="hljs-comment"># 数据层（可能存放模型或仓储）</span><br>│  ├─modules/        <span class="hljs-comment"># 模块化目录</span><br>│  │  └─home/        <span class="hljs-comment"># 首页模块</span><br>│  │     ├─bindings/ <span class="hljs-comment"># 依赖绑定</span><br>│  │     ├─controllers/ <span class="hljs-comment"># 控制器</span><br>│  │     └─views/    <span class="hljs-comment"># 页面UI</span><br>│  └─routes/         <span class="hljs-comment"># 路由配置</span><br>└─main.dart            <span class="hljs-comment"># 入口文件</span><br></code></pre></td></tr></table></figure><p>2.2 推荐混合结构</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">lib/<br>├─app/               <span class="hljs-comment"># 应用主目录（可选层级）</span><br>|  ├─controllers/    <span class="hljs-comment"># 全局控制器</span><br>|  ├─views/          <span class="hljs-comment"># 全局视图</span><br>|  ├─core/           <span class="hljs-comment"># 常量、工具、主题</span><br>│  |  ├─constants/<br>│  |  ├─utils/<br>│  |  └─themes/<br>│  ├─data/           <span class="hljs-comment"># 数据层（可能存放模型或仓储）</span><br>│  ├─modules/        <span class="hljs-comment"># 模块化目录</span><br>|  ├─services/       <span class="hljs-comment"># 全局服务</span><br>│  │  └─home/        <span class="hljs-comment"># 首页模块</span><br>│  │     ├─bindings/ <span class="hljs-comment"># 依赖绑定</span><br>│  │     ├─controllers/ <span class="hljs-comment"># 控制器</span><br>│  │     └─views/    <span class="hljs-comment"># 页面UI</span><br>│  └─routes/         <span class="hljs-comment"># 路由配置</span><br>└─main.dart            <span class="hljs-comment"># 入口文件</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>前端</category>
      
      <category>Flutter</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Flutter</tag>
      
      <tag>GetX</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>get_cli安装和使用</title>
    <link href="/posts/%E5%89%8D%E7%AB%AF/Flutter/get_cli%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/40222/"/>
    <url>/posts/%E5%89%8D%E7%AB%AF/Flutter/get_cli%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/40222/</url>
    
    <content type="html"><![CDATA[<h1 id="get-cli安装和使用"><a href="#get-cli安装和使用" class="headerlink" title="get_cli安装和使用"></a>get_cli安装和使用</h1><h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h2><p>运行命令:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">flutter pub global activate get_cli<br></code></pre></td></tr></table></figure><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs maxima">C:\Users\x&gt;flutter pub global <span class="hljs-built_in">activate</span> get_cli<br>Flutter assets will be downloaded from https://storage.flutter-io.cn. Make sure you trust this source!<br>Package get_cli <span class="hljs-built_in">is</span> currently active <span class="hljs-built_in">at</span> version <span class="hljs-number">1.8</span><span class="hljs-number">.4</span>.<br>Resolving <span class="hljs-built_in">dependencies</span>...<br>The package get_cli <span class="hljs-built_in">is</span> already activated <span class="hljs-built_in">at</span> newest available version.<br>To recompile executables, <span class="hljs-built_in">first</span> run `flutter pub global <span class="hljs-built_in">deactivate</span> get_cli`.<br>Installed executables <span class="hljs-built_in">get</span> <span class="hljs-keyword">and</span> getx.<br>Warning: Pub installs executables into C:\Users\x\AppData\Local\Pub\Cache\bin, which <span class="hljs-built_in">is</span> <span class="hljs-keyword">not</span> on your path.<br>You can <span class="hljs-built_in">fix</span> that by adding that <span class="hljs-built_in">directory</span> to your <span class="hljs-built_in">system</span>&#x27;s <span class="hljs-string">&quot;Path&quot;</span> environment variable.<br>A web search <span class="hljs-keyword">for</span> <span class="hljs-string">&quot;configure windows path&quot;</span> will <span class="hljs-built_in">show</span> you how.<br>Activated get_cli <span class="hljs-number">1.8</span><span class="hljs-number">.4</span>.<br><br>Windows:将 C:\Users\x\AppData\Local\Pub\Cache\bin 添加进环境变量 Path里<br></code></pre></td></tr></table></figure><h2 id="2-验证安装"><a href="#2-验证安装" class="headerlink" title="2. 验证安装"></a>2. 验证安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">C:\Users\x&gt;get -v<br>░██████╗░███████╗████████╗   ░█████╗░██╗░░░░░░██╗<br>██╔════╝░██╔════╝╚══██╔══╝   ██╔══██╗██║░░░░░░██║<br>██║░░██╗░█████╗░░░░░██║░░░   ██║░░╚═╝██║░░░░░░██║<br>██║░░╚██╗██╔══╝░░░░░██║░░░   ██║░░██╗██║░░░░░░██║<br>╚██████╔╝███████╗░░░██║░░░   ╚█████╔╝███████╗ ██║<br>░╚═════╝░╚══════╝░░░╚═╝░░░   ░╚════╝░╚══════╝ ╚═╝<br><br>Version: 1.8.4<br><br>Time: 66 Milliseconds<br></code></pre></td></tr></table></figure><h2 id="3-使用"><a href="#3-使用" class="headerlink" title="3. 使用"></a>3. 使用</h2><table><thead><tr><th>功能</th><th>命令</th><th>备注</th></tr></thead><tbody><tr><td>新建项目</td><td>get create project</td><td>新建一个项目，执行期间会选择几个属性，一路下去就行了</td></tr><tr><td>初始化</td><td>get init</td><td>新建项目里也会执行这步，清空lib文件夹内容，填充为初始的目录结构</td></tr><tr><td>创建页面</td><td>get create page:页面名字</td><td>会创建view, controller ，binding 和 routes</td></tr><tr><td>创建控制器</td><td>get create controller:test</td><td>指定文件夹不用写完整路径末级名字就行</td></tr><tr><td>创建控制器</td><td>get create controller:auth</td><td>用模版或者url创建控制器</td></tr><tr><td>创建view</td><td>get create view:name</td><td>创建view</td></tr><tr><td>国际化</td><td>get generate locales assets&#x2F;locales</td><td>需要在指定目录创建对应json文件</td></tr><tr><td>创建实体类</td><td>get generate model on home with assets&#x2F;models&#x2F;user.json</td><td>需要在指定目录创建对应json文件</td></tr></tbody></table><p>其他命令可参考官方文档: <a href="https://github.com/jonataslaw/get_cli/blob/master/README-zh_CN.md">get_cli中文官方文档</a></p>]]></content>
    
    
    <categories>
      
      <category>前端</category>
      
      <category>Flutter</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Flutter</tag>
      
      <tag>get_cli</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flutter GetX 实战&lt;小米商城&gt;</title>
    <link href="/posts/%E5%89%8D%E7%AB%AF/FlutterGetX%E5%AE%9E%E6%88%98/64979/"/>
    <url>/posts/%E5%89%8D%E7%AB%AF/FlutterGetX%E5%AE%9E%E6%88%98/64979/</url>
    
    <content type="html"><![CDATA[<h2 id="安装get-cli"><a href="#安装get-cli" class="headerlink" title="安装get_cli"></a>安装get_cli</h2><p><code>flutter pub global activate get_cli</code></p><p>临时: <code>flutter pub global activate -s git https://github.com/jonataslaw/get_cli</code></p><p>win: <code>安装路径添加进path环境变量</code></p><h2 id="集成"><a href="#集成" class="headerlink" title="集成"></a>集成</h2><p>创建完项目执行<code>get init</code></p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-symbol">E:</span>\CoreCode\GS\XDS\xmshop&gt;<span class="hljs-keyword">get</span> init<br>? Which architecture <span class="hljs-keyword">do</span> you want <span class="hljs-keyword">to</span> use? (Use arrow keys)<br>&gt; GetX Pattern (<span class="hljs-keyword">by</span> Kauê)<br>  CLEAN (<span class="hljs-keyword">by</span> Arktekko)<br>? 你的 <span class="hljs-keyword">lib</span> 文件夹不是空的。你确定要覆盖你的应用吗？ <br> 警告:操作不可逆 (Use arrow keys)<br>&gt; 是的!<br>  不<br>✓  <span class="hljs-comment">&#x27;Package: get 已安装！</span><br>✓  文件: main.dart 创建成功，路径: <span class="hljs-keyword">lib</span>\\main.dart<br>✓  文件: home_controller.dart 创建成功，路径: <span class="hljs-keyword">lib</span>\app\modules\home\\controllers\\home_controller.dart<br>✓  文件: home_view.dart 创建成功，路径: <span class="hljs-keyword">lib</span>\app\modules\home\\views\\home_view.dart<br>✓  文件: home_binding.dart 创建成功，路径: <span class="hljs-keyword">lib</span>\app\modules\home\\bindings\\home_binding.dart<br>✓  文件: app_routes.dart 创建成功，路径: <span class="hljs-keyword">lib</span>\\app\\routes\\app_routes.dart<br>✓  文件: app_pages.dart 创建成功，路径: <span class="hljs-keyword">lib</span>\\app\\routes\\app_pages.dart<br>✓  home route 创建成功.<br>✓  Home page 创建成功.<br>✓  GetX 结构生成成功。<br></code></pre></td></tr></table></figure><h3 id="get命令创建页面"><a href="#get命令创建页面" class="headerlink" title="get命令创建页面"></a>get命令创建页面</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">get</span> <span class="hljs-keyword">create</span> page:tabs<br><span class="hljs-keyword">get</span> <span class="hljs-keyword">create</span> page:home<br><span class="hljs-keyword">get</span> <span class="hljs-keyword">create</span> page:category<br><span class="hljs-keyword">get</span> <span class="hljs-keyword">create</span> page:service<br><span class="hljs-keyword">get</span> <span class="hljs-keyword">create</span> page:cart<br><span class="hljs-keyword">get</span> <span class="hljs-keyword">create</span> page:<span class="hljs-keyword">user</span><br><span class="hljs-keyword">get</span> <span class="hljs-keyword">create</span> page:serach<br></code></pre></td></tr></table></figure><h2 id="路由设置"><a href="#路由设置" class="headerlink" title="路由设置"></a>路由设置</h2><ol><li><p>优化页面路由 只留tabs</p></li><li><p>在tabs 的bindings里加载其他页面</p><p> <a href="E:\CoreCode\GS\XDS\xmshop\lib\app\modules\tabs\bindings\tabs_binding.dart">tabs_binding.dart</a> </p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:get/get.dart&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../controllers/tabs_controller.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../home/controllers/home_controller.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../category/controllers/category_controller.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../give/controllers/give_controller.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../cart/controllers/cart_controller.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../user/controllers/user_controller.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TabsBinding</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Bindings</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> dependencies() &#123;<br>    Get.lazyPut&lt;TabsController&gt;(<br>      () =&gt; TabsController(),<br>    );<br>    Get.lazyPut&lt;HomeController&gt;(<br>      () =&gt; HomeController(),<br>    );<br>    Get.lazyPut&lt;CategoryController&gt;(<br>      () =&gt; CategoryController(),<br>    );<br>    Get.lazyPut&lt;GiveController&gt;(<br>      () =&gt; GiveController(),<br>    );<br>    Get.lazyPut&lt;CartController&gt;(<br>      () =&gt; CartController(),<br>    );<br>    Get.lazyPut&lt;UserController&gt;(<br>      () =&gt; UserController(),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h2 id="配置tab切换"><a href="#配置tab切换" class="headerlink" title="配置tab切换"></a>配置tab切换</h2><p>   bottomNavigationBar</p>   <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:get/get.dart&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../controllers/tabs_controller.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TabsView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetView</span>&lt;<span class="hljs-title">TabsController</span>&gt; </span>&#123;<br>  <span class="hljs-keyword">const</span> TabsView(&#123;Key? key&#125;) : <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Obx(() =&gt; Scaffold(<br>          appBar: AppBar(<br>            title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&#x27;TabsView&#x27;</span>),<br>            centerTitle: <span class="hljs-keyword">true</span>,<br>          ),<br>          body: Text(<span class="hljs-string">&quot;tab&quot;</span>),<br>          bottomNavigationBar: BottomNavigationBar(<br>            fixedColor: Colors.red,<br>            currentIndex: controller.currentIndex.value,<br>            type: BottomNavigationBarType.fixed,<br>            onTap: (index) &#123;<br>              controller.setCurrentIndex(index);<br>            &#125;,<br>            items: <span class="hljs-keyword">const</span> [<br>              BottomNavigationBarItem(<br>                icon: Icon(Icons.home),<br>                label: <span class="hljs-string">&quot;首页&quot;</span>,<br>              ),<br>              BottomNavigationBarItem(<br>                icon: Icon(Icons.category),<br>                label: <span class="hljs-string">&quot;分类&quot;</span>,<br>              ),<br>              BottomNavigationBarItem(<br>                icon: Icon(Icons.room_service),<br>                label: <span class="hljs-string">&quot;服务&quot;</span>,<br>              ),<br>              BottomNavigationBarItem(<br>                icon: Icon(Icons.shopping_cart),<br>                label: <span class="hljs-string">&quot;购物车&quot;</span>,<br>              ),<br>              BottomNavigationBarItem(<br>                icon: Icon(Icons.people),<br>                label: <span class="hljs-string">&quot;我的&quot;</span>,<br>              )<br>            ],<br>          ),<br>        ));<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>   <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:get/get.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TabsController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetxController</span> </span>&#123;<br>  RxInt currentIndex = <span class="hljs-number">0</span>.obs;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> onInit() &#123;<br>    <span class="hljs-keyword">super</span>.onInit();<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> onClose() &#123;<br>    <span class="hljs-keyword">super</span>.onClose();<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> setCurrentIndex(index) &#123;<br>    currentIndex.value = index;<br>    update();<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="切换页面"><a href="#切换页面" class="headerlink" title="切换页面"></a>切换页面</h2>   <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:get/get.dart&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../controllers/tabs_controller.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TabsView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetView</span>&lt;<span class="hljs-title">TabsController</span>&gt; </span>&#123;<br>  <span class="hljs-keyword">const</span> TabsView(&#123;<span class="hljs-keyword">super</span>.key&#125;);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Obx(() =&gt; Scaffold(<br>          <span class="hljs-comment">// 简单切换页面</span><br>          <span class="hljs-comment">// body: controller.pages[controller.currentIndex.value],</span><br>          <span class="hljs-comment">// 可左右滑动切换</span><br>          body: PageView(<br>            controller: controller.pageController,<br>            children: controller.pages,<br>            onPageChanged: (index) &#123;<br>              controller.setCurrentIndex(index);<br>            &#125;,<br>          ),<br>          bottomNavigationBar: BottomNavigationBar(<br>            fixedColor: Colors.red,<br>            currentIndex: controller.currentIndex.value,<br>            type: BottomNavigationBarType.fixed,<br>            onTap: (index) &#123;<br>              controller.setCurrentIndex(index);<br>              controller.pageController.jumpToPage(index);<br>            &#125;,<br>            items: <span class="hljs-keyword">const</span> [<br>              BottomNavigationBarItem(<br>                icon: Icon(Icons.home),<br>                label: <span class="hljs-string">&quot;首页&quot;</span>,<br>              ),<br>              BottomNavigationBarItem(<br>                icon: Icon(Icons.category),<br>                label: <span class="hljs-string">&quot;分类&quot;</span>,<br>              ),<br>              BottomNavigationBarItem(<br>                icon: Icon(Icons.room_service),<br>                label: <span class="hljs-string">&quot;服务&quot;</span>,<br>              ),<br>              BottomNavigationBarItem(<br>                icon: Icon(Icons.shopping_cart),<br>                label: <span class="hljs-string">&quot;购物车&quot;</span>,<br>              ),<br>              BottomNavigationBarItem(<br>                icon: Icon(Icons.people),<br>                label: <span class="hljs-string">&quot;我的&quot;</span>,<br>              )<br>            ],<br>          ),<br>        ));<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>   <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:get/get.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../cart/views/cart_view.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../category/views/category_view.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../give/views/give_view.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../home/views/home_view.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../user/views/user_view.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TabsController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetxController</span> </span>&#123;<br>  <span class="hljs-comment">// 当前选中tab的索引</span><br>  RxInt currentIndex = <span class="hljs-number">0</span>.obs;<br><br>  <span class="hljs-comment">// 页面列表</span><br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;Widget&gt; pages = <span class="hljs-keyword">const</span> [<br>    HomeView(),<br>    CategoryView(),<br>    GiveView(),<br>    UserView(),<br>    CartView()<br>  ];<br><br>  PageController pageController = PageController(initialPage: <span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">void</span> setCurrentIndex(index) &#123;<br>    currentIndex.value = index;<br>    update();<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>   <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:get/get.dart&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../controllers/home_controller.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../../services/keepAliveWrapper.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetView</span>&lt;<span class="hljs-title">HomeController</span>&gt; </span>&#123;<br>  <span class="hljs-keyword">const</span> HomeView(&#123;<span class="hljs-keyword">super</span>.key&#125;);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-comment">// 页面缓存</span><br>    <span class="hljs-keyword">return</span> KeepAliveWrapper(<br>        child: Scaffold(<br>            appBar: AppBar(<br>              title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&#x27;HomeView&#x27;</span>),<br>              centerTitle: <span class="hljs-keyword">true</span>,<br>            ),<br>            body: ListView(<br>              children: <span class="hljs-keyword">const</span> [<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;2222&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;567567567566666666666666666666&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;567567567&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;5675675667567&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>                ListTile(<br>                  title: Text(<span class="hljs-string">&#x27;111111111111&#x27;</span>),<br>                ),<br>              ],<br>            )));<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>   <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KeepAliveWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-keyword">const</span> KeepAliveWrapper(<br>      &#123;<span class="hljs-keyword">super</span>.key, <span class="hljs-meta">@required</span> <span class="hljs-keyword">this</span>.child, <span class="hljs-keyword">this</span>.keepAlive = <span class="hljs-keyword">true</span>&#125;);<br><br>  <span class="hljs-keyword">final</span> Widget? child;<br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> keepAlive;<br><br>  <span class="hljs-meta">@override</span><br>  State&lt;KeepAliveWrapper&gt; createState() =&gt; _KeepAliveWrapperState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_KeepAliveWrapperState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">KeepAliveWrapper</span>&gt;</span><br><span class="hljs-class">    <span class="hljs-title">with</span> <span class="hljs-title">AutomaticKeepAliveClientMixin</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> widget.child!;<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-built_in">bool</span> <span class="hljs-keyword">get</span> wantKeepAlive =&gt; widget.keepAlive;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="不同终端屏幕适配"><a href="#不同终端屏幕适配" class="headerlink" title="不同终端屏幕适配"></a>不同终端屏幕适配</h2><p><a href="https://pub.dev/packages/flutter_screenutil">https://pub.dev/packages/flutter_screenutil</a></p><p><a href="https://github.com/OpenFlutter/flutter_screenutil/blob/master/README_CN.md">https://github.com/OpenFlutter/flutter_screenutil/blob/master/README_CN.md</a></p><p>pubspec.yaml</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">dependencies:</span><br><span class="hljs-symbol">  flutter:</span><br><span class="hljs-symbol">    sdk:</span> flutter<br>  <span class="hljs-meta"># add flutter_screenutil</span><br><span class="hljs-symbol">  flutter_screenutil:</span> ^<span class="hljs-number">5.9</span><span class="hljs-number">.3</span><br></code></pre></td></tr></table></figure><p>使用的地方引入</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_screenutil/flutter_screenutil.dart&#x27;</span>;<br></code></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> main() =&gt; runApp(MyApp());<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-comment">//填入设计稿中设备的屏幕尺寸,单位dp</span><br>    <span class="hljs-keyword">return</span> ScreenUtilInit(<br>      designSize: <span class="hljs-keyword">const</span> Size(<span class="hljs-number">360</span>, <span class="hljs-number">690</span>),<br>      minTextAdapt: <span class="hljs-keyword">true</span>,<br>      splitScreenMode: <span class="hljs-keyword">true</span>,<br>      builder: (context , child) &#123;<br>        <span class="hljs-keyword">return</span> MaterialApp(<br>          debugShowCheckedModeBanner: <span class="hljs-keyword">false</span>,<br>          title: <span class="hljs-string">&#x27;First Method&#x27;</span>,<br>          <span class="hljs-comment">// You can use the library anywhere in the app even in theme</span><br>          theme: ThemeData(<br>            primarySwatch: Colors.blue,<br>            textTheme: Typography.englishLike2018.apply(fontSizeFactor: <span class="hljs-number">1</span>.sp),<br>          ),<br>          home: child,<br>        );<br>      &#125;,<br>      child: <span class="hljs-keyword">const</span> HomePage(title: <span class="hljs-string">&#x27;First Method&#x27;</span>),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="封装screenutil"><a href="#封装screenutil" class="headerlink" title="封装screenutil"></a>封装screenutil</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_screenutil/flutter_screenutil.dart&#x27;</span>;<br><br><span class="hljs-comment">/// <span class="language-markdown">屏幕适配</span></span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ScreenAdapter</span> </span>&#123;<br>  <span class="hljs-comment">/// <span class="language-markdown">获取对象的高度属性</span></span><br>  <span class="hljs-keyword">static</span> height(<span class="hljs-built_in">num</span> v) &#123;<br>    <span class="hljs-keyword">return</span> v.h;<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">获取对象的宽度属性</span></span><br>  <span class="hljs-keyword">static</span> width(<span class="hljs-built_in">num</span> v) &#123;<br>    <span class="hljs-keyword">return</span> v.w;<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">获取对象的字体大小属性</span></span><br>  <span class="hljs-keyword">static</span> fontSize(<span class="hljs-built_in">num</span> v) &#123;<br>    <span class="hljs-keyword">return</span> v.sp;<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">获取屏幕宽度</span></span><br>  <span class="hljs-keyword">static</span> getScreenWidth() &#123;<br>    <span class="hljs-comment">// return ScreenUtil().screenWidth;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>.sw;<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">获取屏幕高度</span></span><br>  <span class="hljs-keyword">static</span> getScreenHeight() &#123;<br>    <span class="hljs-comment">// return ScreenUtil().screenHeight;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>.sh;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="透明状态栏"><a href="#透明状态栏" class="headerlink" title="透明状态栏"></a>透明状态栏</h2><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// 配置透明的状态栏</span><br>SystemUiOverlayStyle systemUiOverlayStyle =<br>    <span class="hljs-keyword">const</span> SystemUiOverlayStyle(statusBarColor: Colors.transparent);<br>SystemChrome.setSystemUIOverlayStyle(systemUiOverlayStyle);<br></code></pre></td></tr></table></figure><h2 id="透明顶部导航-上下滑动切换动画"><a href="#透明顶部导航-上下滑动切换动画" class="headerlink" title="透明顶部导航 &amp; 上下滑动切换动画"></a>透明顶部导航 &amp; 上下滑动切换动画</h2><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// home_view.dart</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:get/get.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:xmshop/app/services/hyIcon.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:xmshop/app/services/screenAdapter.dart&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../controllers/home_controller.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../../../services/keepAliveWrapper.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetView</span>&lt;<span class="hljs-title">HomeController</span>&gt; </span>&#123;<br>  <span class="hljs-keyword">const</span> HomeView(&#123;<span class="hljs-keyword">super</span>.key&#125;);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-comment">// 页面缓存</span><br>    <span class="hljs-keyword">return</span> KeepAliveWrapper(<br>        child: Scaffold(<br>            body: Stack(children: [<br>      ListView.builder(<br>          controller: controller.scrollController, <span class="hljs-comment">// 绑定控制器</span><br>          itemCount: <span class="hljs-number">20</span>,<br>          itemBuilder: (context, index) &#123;<br>            <span class="hljs-keyword">if</span> (index == <span class="hljs-number">0</span>) &#123;<br>              <span class="hljs-keyword">return</span> SizedBox(<br>                width: ScreenAdapter.width(<span class="hljs-number">1080</span>),<br>                height: ScreenAdapter.height(<span class="hljs-number">682</span>),<br>                child: Image.network(<br>                  <span class="hljs-string">&quot;https://www.itying.com/images/focus/focus02.png&quot;</span>,<br>                  fit: BoxFit.cover,<br>                ),<br>              );<br>            &#125;<br>            <span class="hljs-keyword">return</span> ListTile(title: Text(<span class="hljs-string">&#x27;第<span class="hljs-subst">$index</span>个元素&#x27;</span>));<br>          &#125;),<br>      Positioned(<br>          top: <span class="hljs-number">0</span>,<br>          left: <span class="hljs-number">0</span>,<br>          right: <span class="hljs-number">0</span>,<br>          child: Obx(() =&gt; AppBar(<br>                leading: controller.flag.value<br>                    ? <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&quot;&quot;</span>)<br>                    : <span class="hljs-keyword">const</span> Icon(<br>                        HyIcon.xiaomi,<br>                        color: Colors.white,<br>                      ),<br>                <span class="hljs-comment">// leading 宽度</span><br>                leadingWidth:<br>                    controller.flag.value ? <span class="hljs-number">10</span> : ScreenAdapter.width(<span class="hljs-number">140</span>),<br>                <span class="hljs-comment">// 动画容器</span><br>                title: AnimatedContainer(<br>                  <span class="hljs-comment">// 改变宽度</span><br>                  width: controller.flag.value<br>                      ? ScreenAdapter.width(<span class="hljs-number">800</span>)<br>                      : ScreenAdapter.width(<span class="hljs-number">620</span>),<br>                  height: ScreenAdapter.height(<span class="hljs-number">96</span>),<br>                  decoration: BoxDecoration(<br>                      color: <span class="hljs-keyword">const</span> Color.fromARGB(<span class="hljs-number">200</span>, <span class="hljs-number">241</span>, <span class="hljs-number">236</span>, <span class="hljs-number">225</span>),<br>                      borderRadius:<br>                          BorderRadius.circular(ScreenAdapter.width(<span class="hljs-number">50</span>))),<br>                  duration: <span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">300</span>),<br>                  child: Row(<br>                    crossAxisAlignment: CrossAxisAlignment.center,<br>                    children: [<br>                      Padding(<br>                        padding: EdgeInsets.fromLTRB(ScreenAdapter.width(<span class="hljs-number">34</span>), <span class="hljs-number">0</span>,<br>                            ScreenAdapter.width(<span class="hljs-number">10</span>), <span class="hljs-number">0</span>),<br>                        child: Icon(<br>                          Icons.search,<br>                          size: ScreenAdapter.fontSize(<span class="hljs-number">40</span>),<br>                        ),<br>                      ),<br>                      Text(<br>                        <span class="hljs-string">&quot;手机&quot;</span>,<br>                        style: TextStyle(<br>                            fontSize: ScreenAdapter.fontSize(<span class="hljs-number">32</span>),<br>                            color: Colors.black54),<br>                      )<br>                    ],<br>                  ),<br>                ),<br>                centerTitle: <span class="hljs-keyword">true</span>,<br>                backgroundColor:<br>                    controller.flag.value ? Colors.white : Colors.transparent,<br>                elevation: <span class="hljs-number">0</span>,<br>                actions: [<br>                  IconButton(<br>                      onPressed: () &#123;<br>                        Get.toNamed(<span class="hljs-string">&#x27;/cart&#x27;</span>);<br>                      &#125;,<br>                      icon: Icon(<br>                        Icons.qr_code,<br>                        color: controller.flag.value<br>                            ? Colors.black87<br>                            : Colors.white,<br>                      )),<br>                  IconButton(<br>                      onPressed: () &#123;<br>                        Get.toNamed(<span class="hljs-string">&#x27;/cart&#x27;</span>);<br>                      &#125;,<br>                      icon: Icon(<br>                        Icons.message,<br>                        color: controller.flag.value<br>                            ? Colors.black87<br>                            : Colors.white,<br>                      ))<br>                ],<br>              )))<br>    ])));<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// home_controller.dart</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:get/get.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetxController</span> </span>&#123;<br>  <span class="hljs-comment">// 滚动条控制器</span><br>  <span class="hljs-keyword">final</span> ScrollController scrollController = ScrollController();<br><br>  <span class="hljs-comment">// 开关</span><br>  <span class="hljs-keyword">final</span> RxBool flag = <span class="hljs-keyword">false</span>.obs;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> onInit() &#123;<br>    <span class="hljs-keyword">super</span>.onInit();<br>    <span class="hljs-comment">// 监听滚动条滚动</span><br>    scrollController.addListener(() &#123;<br>      <span class="hljs-comment">// 下拉高度大于10时，显示返回顶部按钮</span><br>      <span class="hljs-keyword">final</span> pixels = scrollController.position.pixels;<br>      <span class="hljs-comment">// 根据滚动位置更新 flag 值</span><br>      <span class="hljs-keyword">if</span> (pixels &gt;= <span class="hljs-number">10</span> &amp;&amp; !flag.value) &#123;<br>        flag.value = <span class="hljs-keyword">true</span>;<br>        update(); <span class="hljs-comment">// 显示返回顶部按钮</span><br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pixels &lt; <span class="hljs-number">10</span> &amp;&amp; flag.value) &#123;<br>        flag.value = <span class="hljs-keyword">false</span>;<br>        update(); <span class="hljs-comment">// 隐藏返回顶部按钮</span><br>      &#125;<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> onReady() &#123;<br>    <span class="hljs-keyword">super</span>.onReady();<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> onClose() &#123;<br>    <span class="hljs-keyword">super</span>.onClose();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="轮播图"><a href="#轮播图" class="headerlink" title="轮播图"></a>轮播图</h2><h3 id="swiper-插件"><a href="#swiper-插件" class="headerlink" title="swiper 插件"></a>swiper 插件</h3><p><a href="https://pub.dev/packages/flutter_swiper_view">https://pub.dev/packages/flutter_swiper_view</a></p><p><a href="https://github.com/feicien/flutter_swiper_view/blob/master/README-ZH.md">https://github.com/feicien/flutter_swiper_view/blob/master/README-ZH.md</a></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span> <br>  <span class="hljs-attr">flutter_swiper_view:</span> <span class="hljs-string">^1.1.8</span><br></code></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_swiper_view/flutter_swiper_view.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() =&gt; runApp(<span class="hljs-keyword">const</span> MyApp());<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-keyword">const</span> MyApp(&#123;Key? key&#125;) : <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> MaterialApp(<br>      title: <span class="hljs-string">&#x27;Flutter Demo&#x27;</span>,<br>      theme: ThemeData(<br>        primarySwatch: Colors.blue,<br>      ),<br>      home: <span class="hljs-keyword">const</span> MyHomePage(title: <span class="hljs-string">&#x27;Flutter Demo Home Page&#x27;</span>),<br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyHomePage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-keyword">const</span> MyHomePage(&#123;Key? key, <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.title&#125;) : <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> title;<br><br>  <span class="hljs-meta">@override</span><br>  State&lt;MyHomePage&gt; createState() =&gt; _MyHomePageState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_MyHomePageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">MyHomePage</span>&gt; </span>&#123;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(widget.title),<br>      ),<br>      body: Swiper(<br>        itemBuilder: (context, index)&#123;<br>          <span class="hljs-keyword">return</span> Image.network(<span class="hljs-string">&quot;https://via.placeholder.com/350x150&quot;</span>,fit: BoxFit.fill,);<br>        &#125;,<br>        itemCount: <span class="hljs-number">3</span>,<br>        pagination: <span class="hljs-keyword">const</span> SwiperPagination(),<br>        control: <span class="hljs-keyword">const</span> SwiperControl(),<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Dio-网络请求"><a href="#Dio-网络请求" class="headerlink" title="Dio 网络请求"></a>Dio 网络请求</h3><p><a href="https://pub.dev/packages/dio">https://pub.dev/packages/dio</a></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span> <br>  <span class="hljs-attr">dio:</span> <span class="hljs-string">^5.5.0+1</span><br></code></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">/// <span class="language-markdown">内容区域</span></span><br> Widget _homePage() &#123;<br>   <span class="hljs-keyword">return</span> Positioned(<br>       top: -<span class="hljs-number">40</span>,<br>       left: <span class="hljs-number">0</span>,<br>       right: <span class="hljs-number">0</span>,<br>       bottom: <span class="hljs-number">0</span>,<br>       <span class="hljs-comment">// https://www.itying.com/images/focus/focus02.png</span><br>       child: ListView(<br>         controller: controller.scrollController,<br>         children: [<br>           SizedBox(<br>             width: ScreenAdapter.getScreenWidth(),<br>             height: ScreenAdapter.height(<span class="hljs-number">682</span>),<br>             child: Obx(() =&gt; Swiper(<br>                   itemBuilder: (context, index) &#123;<br>                     <span class="hljs-built_in">String</span> picUrl =<br>                         <span class="hljs-string">&quot;https://miapp.itying.com/<span class="hljs-subst">$&#123;controller.swiperList[index][<span class="hljs-string">&#x27;pic&#x27;</span>]&#125;</span>&quot;</span>;<br>                     <span class="hljs-keyword">return</span> Image.network(<br>                       picUrl.replaceAll(<span class="hljs-string">&quot;\\&quot;</span>, <span class="hljs-string">&quot;/&quot;</span>),<br>                       fit: BoxFit.fill,<br>                     );<br>                   &#125;,<br>                   itemCount: controller.swiperList.length,<br><br>                   pagination:<br>                       <span class="hljs-keyword">const</span> SwiperPagination(builder: SwiperPagination.rect),<br>                   <span class="hljs-comment">// 自动轮播</span><br>                   autoplay: <span class="hljs-keyword">true</span>,<br>                   <span class="hljs-comment">// 循环轮播</span><br>                   loop: <span class="hljs-keyword">true</span>,<br>                   <span class="hljs-comment">// 动画切换时间</span><br>                   duration: <span class="hljs-number">2000</span>,<br>                 )),<br>           )<br>         ],<br>       ));<br> &#125;<br></code></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// controller</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:get/get.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:dio/dio.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetxController</span> </span>&#123;<br>  <span class="hljs-comment">// 滚动条控制器</span><br>  <span class="hljs-keyword">final</span> ScrollController scrollController = ScrollController();<br><br>  <span class="hljs-comment">// 浮动导航开关</span><br>  <span class="hljs-keyword">final</span> RxBool flag = <span class="hljs-keyword">false</span>.obs;<br><br>  <span class="hljs-comment">// https://miapp.itying.com/api/focus</span><br>  RxList swiperList = [].obs;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> onInit() &#123;<br>    <span class="hljs-keyword">super</span>.onInit();<br>    <span class="hljs-comment">// 监听滚动条滚动</span><br>    scrollControllerListener();<br>    <span class="hljs-comment">// 获取焦点数据</span><br>    getFocusData();<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">监听滚动条滚动</span></span><br>  scrollControllerListener() &#123;<br>    scrollController.addListener(() &#123;<br>      <span class="hljs-comment">// 下拉高度大于10时，显示返回顶部按钮</span><br>      <span class="hljs-keyword">final</span> pixels = scrollController.position.pixels;<br>      <span class="hljs-comment">// 根据滚动位置更新 flag 值</span><br>      <span class="hljs-keyword">if</span> (pixels &gt;= <span class="hljs-number">10</span> &amp;&amp; !flag.value) &#123;<br>        flag.value = <span class="hljs-keyword">true</span>;<br>        update(); <span class="hljs-comment">// 显示返回顶部按钮</span><br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pixels &lt; <span class="hljs-number">10</span> &amp;&amp; flag.value) &#123;<br>        flag.value = <span class="hljs-keyword">false</span>;<br>        update(); <span class="hljs-comment">// 隐藏返回顶部按钮</span><br>      &#125;<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-comment">/// <span class="language-markdown">获取焦点数据</span></span><br>  getFocusData() <span class="hljs-keyword">async</span> &#123;<br>    <span class="hljs-keyword">var</span> response = <span class="hljs-keyword">await</span> Dio().<span class="hljs-keyword">get</span>(<span class="hljs-string">&quot;https://miapp.itying.com/api/focus&quot;</span>);<br>    swiperList.value = response.data[<span class="hljs-string">&quot;result&quot;</span>];<br>    update();<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="模型类"><a href="#模型类" class="headerlink" title="模型类"></a>模型类</h2><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">/// <span class="language-markdown">焦点数据模型</span></span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FocusModel</span> </span>&#123;<br>  <span class="hljs-built_in">String?</span> sId;<br>  <span class="hljs-built_in">String?</span> title;<br>  <span class="hljs-built_in">String?</span> status;<br>  <span class="hljs-built_in">String?</span> pic;<br>  <span class="hljs-built_in">String?</span> url;<br><br>  FocusModel(&#123;<span class="hljs-keyword">this</span>.sId, <span class="hljs-keyword">this</span>.title, <span class="hljs-keyword">this</span>.status, <span class="hljs-keyword">this</span>.pic, <span class="hljs-keyword">this</span>.url&#125;);<br><br>  FocusModel.fromJson(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; json) &#123;<br>    sId = json[<span class="hljs-string">&#x27;_id&#x27;</span>];<br>    title = json[<span class="hljs-string">&#x27;title&#x27;</span>];<br>    status = json[<span class="hljs-string">&#x27;status&#x27;</span>];<br>    pic = json[<span class="hljs-string">&#x27;pic&#x27;</span>];<br>    url = json[<span class="hljs-string">&#x27;url&#x27;</span>];<br>  &#125;<br><br>  <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; toJson() &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; data = &lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;&#123;&#125;;<br>    data[<span class="hljs-string">&#x27;_id&#x27;</span>] = sId;<br>    data[<span class="hljs-string">&#x27;title&#x27;</span>] = title;<br>    data[<span class="hljs-string">&#x27;status&#x27;</span>] = status;<br>    data[<span class="hljs-string">&#x27;pic&#x27;</span>] = pic;<br>    data[<span class="hljs-string">&#x27;url&#x27;</span>] = url;<br>    <span class="hljs-keyword">return</span> data;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="在线网站生成"><a href="#在线网站生成" class="headerlink" title="在线网站生成"></a>在线网站生成</h3><p><a href="https://autocode.icu/jsontodart">https://autocode.icu/jsontodart</a></p><h3 id="get-cli-生成"><a href="#get-cli-生成" class="headerlink" title="get_cli 生成"></a>get_cli 生成</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs verilog">get <span class="hljs-keyword">generate</span> model on models from <span class="hljs-string">&quot;https://miapp.itying.com/api/focus&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Focus</span> </span>&#123;<br>  <span class="hljs-built_in">List</span>&lt;Result&gt;? result;<br><br>  Focus(&#123;<span class="hljs-keyword">this</span>.result&#125;);<br><br>  Focus.fromJson(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; json) &#123;<br>    <span class="hljs-keyword">if</span> (json[<span class="hljs-string">&#x27;result&#x27;</span>] != <span class="hljs-keyword">null</span>) &#123;<br>      result = &lt;Result&gt;[];<br>      json[<span class="hljs-string">&#x27;result&#x27;</span>].forEach((v) &#123;<br>        result?.add(Result.fromJson(v));<br>      &#125;);<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; toJson() &#123;<br>    <span class="hljs-keyword">final</span> data = &lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;&#123;&#125;;<br>    <span class="hljs-keyword">if</span> (result != <span class="hljs-keyword">null</span>) &#123;<br>      data[<span class="hljs-string">&#x27;result&#x27;</span>] = result?.map((v) =&gt; v.toJson()).toList();<br>    &#125;<br>    <span class="hljs-keyword">return</span> data;<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Result</span> </span>&#123;<br>  <span class="hljs-built_in">String?</span> sId;<br>  <span class="hljs-built_in">String?</span> title;<br>  <span class="hljs-built_in">String?</span> status;<br>  <span class="hljs-built_in">String?</span> pic;<br>  <span class="hljs-built_in">String?</span> url;<br>  <span class="hljs-built_in">int?</span> position;<br><br>  Result(<br>      &#123;<span class="hljs-keyword">this</span>.sId, <span class="hljs-keyword">this</span>.title, <span class="hljs-keyword">this</span>.status, <span class="hljs-keyword">this</span>.pic, <span class="hljs-keyword">this</span>.url, <span class="hljs-keyword">this</span>.position&#125;);<br><br>  Result.fromJson(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; json) &#123;<br>    sId = json[<span class="hljs-string">&#x27;_id&#x27;</span>];<br>    title = json[<span class="hljs-string">&#x27;title&#x27;</span>];<br>    status = json[<span class="hljs-string">&#x27;status&#x27;</span>];<br>    pic = json[<span class="hljs-string">&#x27;pic&#x27;</span>];<br>    url = json[<span class="hljs-string">&#x27;url&#x27;</span>];<br>    position = json[<span class="hljs-string">&#x27;position&#x27;</span>];<br>  &#125;<br><br>  <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; toJson() &#123;<br>    <span class="hljs-keyword">final</span> data = &lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;&#123;&#125;;<br>    data[<span class="hljs-string">&#x27;_id&#x27;</span>] = sId;<br>    data[<span class="hljs-string">&#x27;title&#x27;</span>] = title;<br>    data[<span class="hljs-string">&#x27;status&#x27;</span>] = status;<br>    data[<span class="hljs-string">&#x27;pic&#x27;</span>] = pic;<br>    data[<span class="hljs-string">&#x27;url&#x27;</span>] = url;<br>    data[<span class="hljs-string">&#x27;position&#x27;</span>] = position;<br>    <span class="hljs-keyword">return</span> data;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="使用第三方库生成"><a href="#使用第三方库生成" class="headerlink" title="使用第三方库生成"></a>使用第三方库生成</h3><p><a href="https://doc.flutterchina.club/json/">https://doc.flutterchina.club/json/</a></p><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">/// <span class="language-markdown">获取焦点数据</span></span><br>  getFocusData() <span class="hljs-keyword">async</span> &#123;<br>    <span class="hljs-keyword">var</span> response = <span class="hljs-keyword">await</span> Dio().<span class="hljs-keyword">get</span>(<span class="hljs-string">&quot;https://miapp.itying.com/api/focus&quot;</span>);<br>    <span class="hljs-built_in">print</span>(response.data[<span class="hljs-string">&quot;result&quot;</span>]);<br>    FocusModel focusModel = FocusModel.fromJson(response.data);<br>    swiperList.value = focusModel.result!;<br>    update();<br>  &#125;<br><br><span class="hljs-built_in">String</span> picUrl = <span class="hljs-string">&quot;https://miapp.itying.com/<span class="hljs-subst">$&#123;controller.swiperList[index].pic&#125;</span>&quot;</span>;<br></code></pre></td></tr></table></figure><h2 id="轮播分类数据渲染"><a href="#轮播分类数据渲染" class="headerlink" title="轮播分类数据渲染"></a>轮播分类数据渲染</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 配置本地资源图片</span><br><span class="hljs-attr">flutter:</span><br>  <span class="hljs-attr">assets:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">assets/images/xiaomiBanner.png</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">assets/images/2.0x/xiaomiBanner.png</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">assets/images/3.0x/xiaomiBanner.png</span><br></code></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">/// <span class="language-markdown">分类</span></span><br>  Widget _category() &#123;<br>    <span class="hljs-keyword">return</span> SizedBox(<br>      width: ScreenAdapter.getScreenWidth(),<br>      height: ScreenAdapter.height(<span class="hljs-number">470</span>),<br>      child: Obx(() =&gt; Swiper(<br>            itemBuilder: (context, index) &#123;<br>              <span class="hljs-keyword">return</span> GridView.builder(<br>                  itemCount: <span class="hljs-number">10</span>,<br>                  gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(<br>                    crossAxisCount: <span class="hljs-number">5</span>,<br>                    crossAxisSpacing: ScreenAdapter.width(<span class="hljs-number">20</span>),<br>                    mainAxisSpacing: ScreenAdapter.height(<span class="hljs-number">20</span>),<br>                  ),<br>                  itemBuilder: (context, i) &#123;<br>                    <span class="hljs-keyword">return</span> Column(<br>                      children: [<br>                        Container(<br>                          alignment: Alignment.center,<br>                          width: ScreenAdapter.height(<span class="hljs-number">140</span>),<br>                          height: ScreenAdapter.height(<span class="hljs-number">140</span>),<br>                          child: Image.network(<br>                            <span class="hljs-string">&quot;https://miapp.itying.com/<span class="hljs-subst">$&#123;controller.categoryList[index * <span class="hljs-number">10</span> + i].pic&#125;</span>&quot;</span>,<br>                            fit: BoxFit.fitHeight,<br>                          ),<br>                        ),<br>                        Padding(<br>                          padding: EdgeInsets.fromLTRB(<br>                              <span class="hljs-number">0</span>, ScreenAdapter.height(<span class="hljs-number">4</span>), <span class="hljs-number">0</span>, <span class="hljs-number">0</span>),<br>                          child: Text(<br>                            <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;controller.categoryList[index * <span class="hljs-number">10</span> + i].title&#125;</span>&quot;</span>,<br>                            style:<br>                                TextStyle(fontSize: ScreenAdapter.fontSize(<span class="hljs-number">34</span>)),<br>                          ),<br>                        )<br>                      ],<br>                    );<br>                  &#125;);<br>            &#125;,<br>            itemCount: controller.categoryList.length ~/ <span class="hljs-number">10</span>, <span class="hljs-comment">// 取整</span><br>            <span class="hljs-comment">// 自定义指示器</span><br>            pagination: SwiperPagination(<br>              margin: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">0.0</span>),<br>              builder: SwiperCustomPagination(<br>                  builder: (BuildContext context, SwiperPluginConfig config) &#123;<br>                <span class="hljs-keyword">return</span> ConstrainedBox(<br>                    constraints:<br>                        BoxConstraints.expand(height: ScreenAdapter.height(<span class="hljs-number">20</span>)),<br>                    child: Row(<br>                      children: &lt;Widget&gt;[<br>                        Expanded(<br>                          child: Align(<br>                            alignment: Alignment.center,<br>                            child: <span class="hljs-keyword">const</span> RectSwiperPaginationBuilder(<br>                                    color: Colors.black12,<br>                                    activeColor: Colors.black54)<br>                                .build(context, config),<br>                          ),<br>                        )<br>                      ],<br>                    ));<br>              &#125;),<br>            ),<br>          )),<br>    );<br>  &#125;<br></code></pre></td></tr></table></figure><h2 id="封装Dio"><a href="#封装Dio" class="headerlink" title="封装Dio"></a>封装Dio</h2><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:dio/dio.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:fluttertoast/fluttertoast.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HttpsClient</span> </span>&#123;<br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">String</span> domain = <span class="hljs-string">&quot;https://miapp.itying.com/&quot;</span>;<br>  <span class="hljs-keyword">static</span> Dio dio = Dio();<br><br>  HttpsClient() &#123;<br>    BaseOptions options = BaseOptions();<br>    options.baseUrl = domain;<br>    <span class="hljs-comment">// 超时时间</span><br>    options.connectTimeout = <span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">5</span>);<br>    <span class="hljs-comment">// 接收数据超时时间</span><br>    options.receiveTimeout = <span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">5</span>);<br>    <span class="hljs-comment">// 响应数据格式</span><br>    options.responseType = ResponseType.json;<br>    dio.options = options;<br>  &#125;<br><br>  Future&lt;<span class="hljs-built_in">dynamic</span>&gt; <span class="hljs-keyword">get</span>(<span class="hljs-built_in">String</span> url) <span class="hljs-keyword">async</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">var</span> response = dio.<span class="hljs-keyword">get</span>(url);<br>      <span class="hljs-keyword">return</span> response;<br>    &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>      Fluttertoast.showToast(<br>          msg: <span class="hljs-string">&quot;请求数据异常&quot;</span>,<br>          toastLength: Toast.LENGTH_SHORT,<br>          gravity: ToastGravity.CENTER,<br>          timeInSecForIosWeb: <span class="hljs-number">1</span>,<br>          backgroundColor: Colors.red,<br>          textColor: Colors.white,<br>          fontSize: <span class="hljs-number">16.0</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">static</span> replaceUri(pic) &#123;<br>    <span class="hljs-built_in">String</span> picUrl = domain + pic;<br>    <span class="hljs-keyword">return</span> picUrl.replaceAll(<span class="hljs-string">&quot;\\&quot;</span>, <span class="hljs-string">&quot;/&quot;</span>);<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="封装GetX"><a href="#封装GetX" class="headerlink" title="封装GetX"></a>封装GetX</h2>]]></content>
    
    
    <categories>
      
      <category>前端</category>
      
      <category>Flutter</category>
      
      <category>Dart</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Flutter</tag>
      
      <tag>Getx</tag>
      
      <tag>Dio</tag>
      
      <tag>flutter_screenutil</tag>
      
      <tag>flutter_swiper_view</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo Fluid 文章</title>
    <link href="/posts/%E5%89%8D%E7%AB%AF/Hexo&amp;Fluid/34482/"/>
    <url>/posts/%E5%89%8D%E7%AB%AF/Hexo&amp;Fluid/34482/</url>
    
    <content type="html"><![CDATA[<h2 id="测试发布文章"><a href="#测试发布文章" class="headerlink" title="测试发布文章"></a>测试发布文章</h2><p><code>这是一篇测试发布文章。</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">quick_sort</span>(<span class="hljs-params">arr</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(arr) &lt;= <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> arr<br>    pivot = arr[<span class="hljs-number">0</span>]<br>    left = []<br>    right = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(arr)):<br>        <span class="hljs-keyword">if</span> arr[i] &lt; pivot:<br>            left.append(arr[i])<br>        <span class="hljs-keyword">else</span>:<br>            right.append(arr[i])<br>    <span class="hljs-keyword">return</span> quick_sort(left) + [pivot] + quick_sort(right)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>前端</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Fluid</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
